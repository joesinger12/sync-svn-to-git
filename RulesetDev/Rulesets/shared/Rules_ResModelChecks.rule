; -------------------------------------------------------------------------
; Rules pertaining to:   Checks Performed on Proposed Model for Energy Code and general Simulation Worthiness
; CEC Title-24 Residential Energy Code
; -------------------------------------------------------------------------
; Copyright (c) 2012-2014, California Energy Commission
; Copyright (c) 2012-2014, Wrightsoft Corporation
; All rights reserved.
; Redistribution and use in source and binary forms, with or without modification,
; are permitted provided that the following conditions are met:
; - Redistributions of source code must retain the above copyright notice, this
;   list of conditions and the following disclaimer.
; - Redistributions in binary form must reproduce the above copyright notice, this
;   list of conditions, the following disclaimer in the documentation and/or other
;   materials provided with the distribution.
; - Neither the name of the California Energy Commission nor the names of its
;   contributors may be used to endorse or promote products derived from this
;   software without specific prior written permission.
; DISCLAIMER: THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
; "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
; THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
; NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL CALIFORNIA ENERGY COMMISSION,
; WRIGHTSOFT CORPORATION, ITRON, INC. OR ANY OTHER AUTHOR OR COPYRIGHT HOLDER OF
; THIS SOFTWARE (COLLECTIVELY, THE "AUTHORS") BE LIABLE FOR ANY DIRECT, INDIRECT,
; INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
; LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
; OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
; LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
; OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
; ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  EACH LICENSEE AND SUBLICENSEE OF THE
; SOFTWARE AGREES NOT TO ASSERT ANY CLAIM AGAINST ANY OF THE AUTHORS RELATING TO
; THIS SOFTWARE, WHETHER DUE TO PERFORMANCE ISSUES, TITLE OR INFRINGEMENT ISSUES,
; STRICT LIABILITY OR OTHERWISE.
; -------------------------------------------------------------------------

ENUM_PROPERTIES_VALUE   ; ensures retrieval/logic/us of enum properties assume numeric value (alternative is ENUM_PROPERTIES_STRING)

;*************************************************************************
RULELIST "ProposedModelCodeCheck" 1 0 0 0
;
;   Rules which are executed on the input building description to ensure
;   that all mandatory requirements are met and that there aren't any errors
;   or omissions in the user model.
;
;*************************************************************************
;"log status"   ResProj:Action = {  if (DevMode==0 .OR. LocalStatus(RunAbbrev) < 1 .OR. EnergyCodeYearNum < 2019) then  UNCHANGED  else
;   PostMessageToLog( "    evaluating 'ProposedModelCodeCheck' rules on '%s' model...", RunAbbrev )  endif  }
;"dbg" ResProj:Action = { PostMessageToLog( "    evaluating 'ProposedModelCodeCheck' rules on '%s' model...", RunAbbrev ) }

	"Check for valid ClimateZone specified"
		ResProj:Action		= {	if (ClimateZone > 0.5 .AND. ClimateZone < 16.5) then  UNCHANGED
									else	PostError( "A valid CEC Climate Zone must be specified prior to performing analysis (see Project tab of Project tabbed dialog)" )  endif  }

; SAC 2/12/19 - remove restriction preventing EAA analysis (tic #1042)
;	"(temporarily) Prevent 2019 code compliance for any models other than new construction"      ; SAC 2/19/18 - (tic #980)
;		ResProj:Action		= {	if (EnergyCodeYearNum >= 2019 .AND. BypassRuleLimits < 0.5 .AND. (RunScope != 1 .OR. IsAddAlone > 0.5))
;									then  PostError( "2019 Title-24 compliance analyis currently available only for New Construction projects." )
;									else  UNCHANGED  endif  }

   "check to ensure no Spc objects are assigned SpcFunc of high rise res"  Proj:Action =        ; SAC 06/10/22
      {  if (IfValidAnd( IsComRuleset > 0 ) .AND. IfValidAnd( AnalysisVersion >= 220000 ))
         then  EvalRulelist( "ModelErrorCheck_SpcFunc_HighRiseRes" )
         else  UNCHANGED  endif  }

; revised several rules to be ignored for Com models where ResDwellUnits toggled OFF - SAC 05/18/22

  ; SAC 2/9/15 - check flag documenting requirement of alterations including at least 2 categories of upgraded component(s)
	"Call subordinate rulelist to generate max estimated alteration cateogries"
		ResProj:Action		= {	if (IfValidAnd( IsComRuleset > 0 ) .AND. IfValidAnd( Proj:ResDwellUnits > 0 )==0) then  UNCHANGED
                              else if (RunScope == 2 .AND. SumAcrossIf( ResZn:IsNew, ResZn:FloorArea > 1 ) < 0.5) then  EvalRulelist( "Count_NumAlterations" )
									else  UNCHANGED  endif endif  }
	; SAC 3/8/19 - added logic to perform check on AlterIncl2Categs (& NumAlterations) only for analysis PRIOR to 2019 (tic #1085)
	"Report AlterIncl2Categs problem"
		ResProj:Action		= {	if (IfValidAnd( IsComRuleset > 0 ) .AND. IfValidAnd( Proj:ResDwellUnits > 0 )==0) then  UNCHANGED
                              else if (RunScope == 2 .AND. SumAcrossIf( ResZn:IsNew, ResZn:FloorArea > 1 ) < 0.5 .AND. ResProj:EnergyCodeYearNum < 2019)
									then	if (IfValidAnd( AlterIncl2Categs > 0.5 )==0)
											then	PostError( "Proj:AlterIncl2Categs (CBECC-Res: checkbox in Project dialog > Analysis tab) must be selected to confirm that alterations span multiple categories (as per standard section 150.2(b)2)." )
											else if (IfValidAnd( NumAlterations < 2 ))
											then	PostWarning( "Number of alterations (from standard table 150.2-B) is %.0f, despite user confirming multiple alterations specified ( ResProj:AlterIncl2Categs).", NumAlterations )
											else  UNCHANGED  endif endif
									else  UNCHANGED  endif endif  }

; SAC 6/25/14 - checks no longer @ Proj level, as of introduction of DwellUnit object
;	"Check for consistency in conditioned areas between dwelling unit & physical model inputs"
;		ResProj:Action		= {	if (IsMultiFamily < 0.5 .OR. UnitTotCondFlrArea == CondFloorArea) then  UNCHANGED
;									else	PostError( "The sum of each dwelling unit count * area (%.1f) must be equal to the sum of the areas of each conditioned zone in the model (%.1f)",
;															UnitTotCondFlrArea, CondFloorArea )  endif  }

	; SAC 4/21/15 - added check to ensure at least one zone where Status = 'Existing' for EAA projects  ; SumChildrenIf -> SumAcrossIf - SAC 05/19/23 (tic #3479)
	"Check to ensure at least one zone of Status = 'Existing' present when Run Scope = 'Addition and/or Alteration'"
		ResProj:Action		= {	if (RunScope != 2 .OR. SumAcrossIf( ResZn:FloorArea, ResZn:Status = 1 ) > 0.1) then  UNCHANGED
									else	PostError( "At least one 'Existing' zone must be specified when Run Scope = 'Addition and/or Alteration'.  If this model is of an addition alone, then change Run Scope to 'New Construction' and select 'Addition Alone project'." )  endif  }

	; SAC 6/6/13 - added check for conditioned/living/sleeping zones present in model
	"Check for at least one conditioned zone plus one zone of each (conditioned) type (living & sleeping) when control credits selected"
		ResProj:Action		= {	if (IfValidAnd( IsComRuleset > 0 ) .AND. IfValidAnd( Proj:ResDwellUnits > 0 )==0) then  UNCHANGED
                              else if ( ResProj:ZonalControl < 0.5 .AND. SumAll( ResZn:CondFloorArea ) < 0.1)
									then  PostError( "At least one conditioned zone must be specified in the model prior to performing analysis" )
									else if ( ResProj:ZonalControl > 0.5 .AND. SumAll( ResZn:LvgCondFloorArea ) < 0.1 .AND. SumAll( ResZn:SlpCondFloorArea ) < 0.1)
									then	PostError( "At least one Living and one Sleeping zone must exist in the model when Zonal Control Credit is selected" )
									else if ( ResProj:ZonalControl > 0.5 .AND. SumAll( ResZn:LvgCondFloorArea ) < 0.1)
									then	PostError( "No zones classified as 'Living' are present in the model.  At least one Living and one Sleeping zone must exist in the model when Zonal Control Credit is selected" )
									else if ( ResProj:ZonalControl > 0.5 .AND. SumAll( ResZn:SlpCondFloorArea ) < 0.1)
									then	PostError( "No zones classified as 'Sleeping' are present in the model.  At least one Living and one Sleeping zone must exist in the model when Zonal Control Credit is selected" )
									else	UNCHANGED  endif endif endif endif endif  }

	; SAC 10/26/15 - check to confirm DwellUnit:CondFlrArea is equal to DwellUnitType:CondFlrArea
   ; relaxed area check to allow for slightly smaller DwellUnits (vs. DUT) - SAC 10/10/22
	"Check for valid DwellUnit:DwellUnitTypeRef assignment and consistency between DwellUnit: and DwellUnitType:CondFlrArea"
		DwellUnit:Action	= {	if (Proj:IsSFamResRuleset) then  UNCHANGED
										else if (LocalCompAssigned( DwellUnitTypeRef ) == 0 .OR. IfValidAnd( DwellUnitTypeRef:CondFlrArea > 0 )==0)
										then  PostError( "DwellUnit '%s' contains no reference to a DwellUnitType object (or the referenced DwellUnitType has no valid conditioned floor area).", Name )
										else if (IfValidAnd( CondFlrArea > 0 )==0)
										then	PostError( "DwellUnit '%s' contains no valid conditioned floor area.", Name )
                              else if (Proj:AnalysisVersion >= 220200 .AND. CondFlrArea < (DwellUnitTypeRef:CondFlrArea * 0.95))
                              then  PostError( "DwellUnit '%s' conditioned floor area (%g) must be >= 95%% of its referenced DwellUnitType '%s' (%g).", Name, CondFlrArea, DwellUnitTypeRef:Name, DwellUnitTypeRef:CondFlrArea )
                              else if (Proj:AnalysisVersion >= 220200 .AND. CondFlrArea > (DwellUnitTypeRef:CondFlrArea + 0.1))
                              then  PostError( "DwellUnit '%s' conditioned floor area (%g) cannot exceed that of its referenced DwellUnitType '%s' (%g).", Name, CondFlrArea, DwellUnitTypeRef:Name, DwellUnitTypeRef:CondFlrArea )
                              else if (Proj:AnalysisVersion < 220200 .AND. 
                                       (CondFlrArea >= (DwellUnitTypeRef:CondFlrArea + 0.1) .OR. CondFlrArea <= (DwellUnitTypeRef:CondFlrArea - 0.1)))
                              then  PostError( "DwellUnit '%s' conditioned floor area (%g) must be equal to that of its referenced DwellUnitType '%s' (%g).", Name, CondFlrArea, DwellUnitTypeRef:Name, DwellUnitTypeRef:CondFlrArea )
                              else  UNCHANGED  endif endif endif endif endif endif  }

   ;  ;         then  if (EnableResearchMode > 0) 
   ;  ;               then  PostWarning( "ResZns with 4 window orientations cannot have more than 1 dwelling, '%s' has %g dwellings (and 4 window orientations). This zone must be split up before performing compliance analysis.", Name, NumDwellingUnits )
   ;  ;               else  PostError(   "ResZn '%s' has %g dwellings and 4 window orientations, which is not allowed in compliance analysis. 4 window orientation zones can have no more than 1 dwelling each.", Name, NumDwellingUnits )  endif
   ;  ;         else if (IfValidAnd( NumDwellingUnits > 2 ) .AND. NumWinOrientations > 2)
   ;  ;         then  if (EnableResearchMode > 0) 
   ;  ;               then  PostWarning( "ResZns with 3 window orientations cannot have more than 2 dwellings, '%s' has %g dwellings (and 3 window orientations). This zone must be split up before performing compliance analysis.", Name, NumDwellingUnits )
   ;  ;               else  PostError(   "ResZn '%s' has %g dwellings and 3 window orientations, which is not allowed in compliance analysis. 3 window orientation zones can have no more than 2 dwellings each.", Name, NumDwellingUnits )  endif
   ;  "check to ensure # zone dwellings inline w/ # of window orientations"   ResZn:Action =    ; SAC 04/18/24 (tic #3554)
   ;     {  if (IfValidAnd( NumDwellingUnits > 1 ) .AND. NumWinOrientations > 3)
   ;        then
   ;              PostWarning( "ResZns with 4 window orientations cannot have more than 1 dwelling, '%s' has %g dwellings (and 4 window orientations). This zone must be split up before performing compliance analysis.", Name, NumDwellingUnits )
   ;        else if (IfValidAnd( NumDwellingUnits > 2 ) .AND. NumWinOrientations > 2)
   ;        then
   ;              PostWarning( "ResZns with 3 window orientations cannot have more than 2 dwellings, '%s' has %g dwellings (and 3 window orientations). This zone must be split up before performing compliance analysis.", Name, NumDwellingUnits )
   ;        else if (IfValidAnd( NumDwellingUnits > 1 ) .AND. NumWinOrientations > 2)
   ;        then  PostWarning( "ResZns with 3 window orientations are best modeled as separate zones. ResZn '%s' has %g dwellings (and 3 window orientations). Consider splitting this zone up to ensure consistent window orientations for all dwellings before performing compliance analysis.", Name, NumDwellingUnits )
   ;        else if (IfValidAnd( NumDwellingUnits > 6 ) .AND. NumWinOrientations > 1)
   ;        then  PostWarning( "Dwellings in a single zone should all have the same window orientations. ResZn '%s' has %g dwellings and 2 window orientations. Consider splitting this zone up to ensure consistent window orientations for all dwellings before performing compliance analysis.", Name, NumDwellingUnits )
   ;        else  UNCHANGED  endif endif endif endif  }

   "Ensure user has confirmed home in service territory of selected Community Solar project"    Proj:Action =        ; SAC 7/3/20 (CommunitySolar)
      {  if (CommunitySolarProjID > 0 .AND. IfValidAnd( CmntySlrProjCZCompat > 0 )==0)
         then  PostError( "Selected Community Solar project '%s' if not avaialble in %s", EnumString( CommunitySolarProject ), EnumString( ClimateZone ) )
         else if (CommunitySolarProjID > 0 .AND. InCmntySlrProjTerritory < 1)
         then  if (EnableResearchMode > 0)  ; .OR. BypassRuleLimits > 0)
               then  PostWarning( "Before valid analysis, user must acknowledge that, to the best of their knowledge, this home/building is located within the service territory of the selected community solar project:   %s", EnumString( CommunitySolarProject ) )
               else  PostError(   "User must acknowledge that, to the best of their knowledge, this home/building is located within the service territory of the selected community solar project:   %s", EnumString( CommunitySolarProject ) )
               endif
         else  UNCHANGED  endif endif  }

	"Check for invalid ADU # bedrooms and area vs. main dwelling"     ResProj:Action  =    ; SAC 2/18/20 (tic #1182)
	   {  if (IfValidAnd( IsComRuleset > 0 )) then  UNCHANGED
         else if (EnergyCodeYearNum < 2019 .OR. IsMultiFamily > 0 .OR. SFamADUType < 1) then  UNCHANGED
         else if (LocalStatus( SFamADUNumBedrooms ) < 4)
         then  PostError( "Number of ADU bedrooms is not specified but is a required input (when ADU is present)" )
         else if (IfValidAnd( SFamADUNumBedrooms > SimNumBedrooms ))
         then  if (RunScope == 1 .AND. IsAddAlone > 0.5)
               then  PostError( "Number of ADU bedrooms cannot exceed project addition bedroom count of %s", FltToStr( SimNumBedrooms ) )
               else  PostError( "Number of ADU bedrooms cannot exceed overall project bedroom count of %s", FltToStr( SimNumBedrooms ) )  endif
         else if (LocalStatus( SFamADUArea ) < 4)
         then  PostError( "ADU conditioned area is not specified but is a required input (when ADU is present)" )
         else if (IfValidAnd( SFamADUArea > CondFloorArea ))
         then  PostError( "Conditioned area of ADU cannot exceed overall project area of %s ft2", FltToStr( CondFloorArea ) )
         else if (RunScope == 1 .AND. IsAddAlone < 0.5 .AND. IfValidAnd( SFamADUNumBedrooms = SimNumBedrooms ))
         then  PostError( "Overall project bedroom count must exceed the number of ADU bedrooms (%s) or switch the project to Addition Alone", FltToStr( SFamADUNumBedrooms ) )
         else if (RunScope == 1 .AND. IsAddAlone < 0.5 .AND. IfValidAnd( SFamADUArea = CondFloorArea ))
         then  PostError( "ADU conditioned area must be less than the overall project area of %s ft2", FltToStr( CondFloorArea ) )
         else  UNCHANGED  endif endif endif endif endif endif endif endif  }

; checks for valid & minimum IAQ ventilation (for both SFam & MFam models) - SAC 9/10/13 added
; mjb 12/17/13 - do not check for IAQ fan if E+A+A
; SAC 7/29/15 - do not check IAQ vent if it has been disabled by user (when BypassRuleLimits is activated)
   ; SAC 11/01/19 - relaxed insufficient IAQ error to warning when BypassRuleLimits activated
   ; added small 0.05 CFM margin of error to min CFM error message - SAC 7/26/20 (tic #1174)
	"Check for single family IAQ ventilation valid and sufficient"
		ResProj:Action		= {	if (IsMultiFamily > 0.5 .OR. IAQDisabled > 0) then  UNCHANGED
									else if (UnitIAQOption[1] == 3)		; "CFI (Central Fan Integrated) IAQ"
									then	PostError( "Model IAQ option 'CFI (Central Fan Integrated) IAQ' is not yet implemented.  Another selection needs to be made on the IAQ tab of the Project data dialog box." )
									else if (UnitIAQCFMTot[1]  < (UnitMinIAQCFM[1] - 0.05) .AND. RunScope == 1)
									then	if (BypassRuleLimits > 0.5)
									      then  PostWarning( "Minimum IAQ Ventilation NOT MET:  %s required, %s entered (CFM).  Review inputs on the IAQ tab of the Project data dialog box.", FltToStr( UnitMinIAQCFM[1] , 1 ), FltToStr( UnitIAQCFMTot[1] , 1 ) )
									      else  PostError(   "Minimum IAQ Ventilation NOT MET:  %s required, %s entered (CFM).  Review inputs on the IAQ tab of the Project data dialog box.", FltToStr( UnitMinIAQCFM[1] , 1 ), FltToStr( UnitIAQCFMTot[1] , 1 ) )  endif
									else	UNCHANGED  endif endif endif  }

   ; similar check as above, but for SFam ADU - SAC 08/10/20 (tic #1240)
	"Check for single family ADU IAQ ventilation valid and sufficient"
		ResProj:Action		= {	if (IsMultiFamily > 0.5 .OR. IAQDisabled > 0 .OR. IfValidAnd( SFamADUIAQUI > 0 )==0 .OR. IfValidAnd( UnitMinIAQCFM[2] > 0.5 )==0) then  UNCHANGED
									else if (UnitIAQOption[2] == 3)		; "CFI (Central Fan Integrated) IAQ"
									then	PostError( "Model ADU IAQ option 'CFI (Central Fan Integrated) IAQ' is not yet implemented.  Another selection needs to be made on the ADU tab of the Project data dialog box." )
									else if (ADUIAQCFMTot[1]  < (UnitMinIAQCFM[2] - 0.05) .AND. RunScope == 1)
									then	if (BypassRuleLimits > 0.5)
									      then  PostWarning( "Minimum ADU IAQ Ventilation NOT MET:  %s required, %s entered (CFM).  Review inputs on the ADU tab of the Project data dialog box.", FltToStr( UnitMinIAQCFM[2] , 1 ), FltToStr( ADUIAQCFMTot[1] , 1 ) )
									      else  PostError(   "Minimum ADU IAQ Ventilation NOT MET:  %s required, %s entered (CFM).  Review inputs on the ADU tab of the Project data dialog box.", FltToStr( UnitMinIAQCFM[2] , 1 ), FltToStr( ADUIAQCFMTot[1] , 1 ) )  endif
									else	UNCHANGED  endif endif endif  }

; SAC 11/12/14 - added DwellUnit IAQ CFM checks, replacing old MFam ones that were removed 6/25/14 (GC issue 410)
   ; SAC 11/01/19 - relaxed insufficient IAQ error to warning when BypassRuleLimits activated
   ; added small 0.05 CFM margin of error to min CFM error message - SAC 7/26/20 (tic #1174)
; to be replaced w/ new MFam checks - SAC 05/18/22
	"Check for multifamily IAQ ventilation valid and sufficient"
		DwellUnit:Action	= {	if (Proj:IsSFamResRuleset .OR. LocalCompAssigned( DwellUnitTypeRef ) == 0 .OR. IfValidAnd( MinIAQCFM > 0.05 )==0 .OR. IfValidAnd( DwellUnitTypeRef:IAQDisabled > 0 )) then  UNCHANGED
										else if (DwellUnitTypeRef:IAQOption == 3)
										then	PostError( "Model IAQ option 'CFI (Central Fan Integrated) IAQ' is not yet implemented.  Another IAQ selection needs to be made for DwellUnit '%s' (DwellUnitType '%s').", Name, DwellUnitTypeRef:Name )
										else if (TotalIAQCFM > MinIAQCFM * 5)
										     then PostWarning( "The ventilation rate is more than 5 times of required. This might cause a simulation error. Review inputs for DwellUnit '%s' (DwellUnitType '%s').", Name, DwellUnitTypeRef:Name )
										else if (TotalIAQCFM < (MinIAQCFM - 0.05) .AND. ResProj:RunScope == 1)
										then	if ( ResProj:BypassRuleLimits > 0.5)
									         then  PostWarning( "Minimum IAQ Ventilation NOT MET:  %s required, %s entered (CFM).  Review inputs for DwellUnit '%s' (DwellUnitType '%s').", FltToStr( MinIAQCFM, 1 ), FltToStr( TotalIAQCFM, 1 ), Name, DwellUnitTypeRef:Name )
									         else  PostError(   "Minimum IAQ Ventilation NOT MET:  %s required, %s entered (CFM).  Review inputs for DwellUnit '%s' (DwellUnitType '%s').", FltToStr( MinIAQCFM, 1 ), FltToStr( TotalIAQCFM, 1 ), Name, DwellUnitTypeRef:Name )  endif
										else	UNCHANGED  endif endif endif endif }

   "Check for inconsistencies in IAQ fan types in MFam models"    DwellUnitType:Action =        ; SAC 7/26/20 (tic #1174)
      {  if ( Proj:IsSFamResRuleset .OR. IfValidAnd( NumAssigningDUs > 0 )==0) then  UNCHANGED
         else if ( ( ResProj:MostDUIAQ_Balanced > 0 .AND. IAQCFMIsBalanced > 0) .OR.
                   ( ResProj:MostDUIAQ_Exhaust  > 0 .AND. IfValidAnd( MostIAQ_Exhaust > 0 )) .OR.
                   ( ResProj:MostDUIAQ_Supply   > 0 .AND. IfValidAnd( MostIAQ_Supply  > 0 )) ) then  UNCHANGED
         else if (GlobalStatus( ResProj:MostDUIAQ_Type ) > 0)
         then  if (                 IAQCFMIsBalanced > 0 ) then  PostError( "DwellUnitType '%s' IAQ type Balanced must be consistent w/ predominant project IAQ type of %s", Name, ResProj:MostDUIAQ_Type )
               else if (IfValidAnd( MostIAQ_Exhaust > 0 )) then  PostError( "DwellUnitType '%s' IAQ type Exhaust must be consistent w/ predominant project IAQ type of %s" , Name, ResProj:MostDUIAQ_Type )
               else if (IfValidAnd( MostIAQ_Supply  > 0 )) then  PostError( "DwellUnitType '%s' IAQ type Supply must be consistent w/ predominant project IAQ type of %s"  , Name, ResProj:MostDUIAQ_Type )
               else  UNCHANGED  endif endif endif
         else  UNCHANGED  endif endif endif  }

   "Check for Indiv DwellUnitType IAQ HRV fan power in acceptable range"   DwellUnitType:Action =        ; SAC 10/10/22 (tic #3422)
      {  if ( Proj:IsSFamResRuleset .OR. IfValidAnd( NumAssigningDUs > 0 )==0) then  UNCHANGED
         else if ( IAQOption == 2 .AND. IAQCFMIsBalanced > 0 .AND. IAQHRVCFM > 0 .AND.
                   IfValidAnd( IAQHRVPwr > IAQHRVCFM ))
         then  PostError( "DwellUnitType '%s' IAQ HRV fan efficacy (%.2f W/CFM) exceeds limit of 1.0 W/CFM (per Std section 160.2(b)2.A.iv.b.1)", Name, (IAQHRVPwr/IAQHRVCFM) )
         else  UNCHANGED  endif endif  }

; JP 11/20/23 - Move ventilation warings to ResOtherZn-Ventilation/Exhaust.rule
; JP 3/2/23 - Move ventilation check to ResZnGrp level so the zones can be ventilated indirectly - (tic #3487)
;             Keep exhaust check at zone level that local exhaust requirements need to be met at zone level
;   "Check for residential other zone ventilation sufficient" ResOtherZn:Action = ; JP 5/31/22
;      {  if( Proj:IsSFamResRuleset .OR. IAQDisabled > 0)
;         then  UNCHANGED
;         else if(IfValidAnd(MinExhCFM > 0) .AND. IfValidAnd(TotalExhCFM < (MinExhCFM - 0.05)) .AND. ResProj:RunScope == 1)
;              then if( ResProj:BypassRuleLimits > 0.5 )
;                   then  PostWarning( "Minimum Exhaust NOT MET:  %s required, %s entered (CFM).  Review inputs for ReOtherZn '%s'.", FltToStr( MinExhCFM, 1 ), FltToStr( TotalExhCFM, 1 ), Name )
;                   else  PostError(   "Minimum Exhaust NOT MET:  %s required, %s entered (CFM).  Review inputs for ReOtherZn '%s'.", FltToStr( MinExhCFM, 1 ), FltToStr( TotalExhCFM, 1 ), Name )  endif
;         else if(IfValidAnd(MinIAQCFM > 0) .AND. IfValidAnd(TotalIAQCFM < (MinIAQCFM - 0.05)) .AND. ResProj:RunScope == 1)
;              then if( ResProj:BypassRuleLimits > 0.5 )
;                   then  PostWarning( "Min IAQ Ventilation NOT MET at zone:  %s required, %s entered (CFM).  Review inputs for ReOtherZn '%s'.", FltToStr( MinIAQCFM, 1 ), FltToStr( TotalIAQCFM, 1 ), Name )
;                   else  PostWarning( "Min IAQ Ventilation NOT MET at zone:  %s required, %s entered (CFM).  Review inputs for ReOtherZn '%s'.", FltToStr( MinIAQCFM, 1 ), FltToStr( TotalIAQCFM, 1 ), Name ) endif
;         else if(IfValidAnd(MinIAQCFM > 0) = 0 .AND. IfValidAnd(MinExhCFM > 0) = 0 .AND. (IfValidAnd(TotalIAQCFM > 0) .OR. IfValidAnd(TotalExhCFM > 0))) 
;              then PostWarning( "ResOtherZn '%s' has no ventilation or exhaust requirement but has ventilation/exhaust system specified. Review inputs for the zone.", Name )
;         else if(IfValidAnd(MinIAQCFM > 0) .AND. IfValidAnd(TotalIAQCFM > MinIAQCFM * 5))
;              then PostWarning( "The ventilation rate is more than 5 times of required. This might cause a simulation error. Review inputs for ReOtherZn '%s'.", Name )
;         else if(IfValidAnd(MinExhCFM > 0) .AND. IfValidAnd(TotalExhCFM > MinExhCFM * 5))
;              then PostWarning( "The exhaust rate is more than 5 times of required. This might cause a simulation error. Review inputs for ReOtherZn '%s'.", Name )
;         else UNCHANGED endif endif endif endif endif endif }         
;         else if(TotalIAQCFM < (MinIAQCFM - 0.05) .AND. ResProj:RunScope == 1)
;              then if( ResProj:BypassRuleLimits > 0.5 )
;                   then  PostWarning( "Minimum Ventilation NOT MET:  %s required, %s entered (CFM).  Review inputs for ReOtherZn '%s'.", FltToStr( MinIAQCFM, 1 ), FltToStr( TotalIAQCFM, 1 ), Name )
;                   else  PostError(   "Minimum Ventilation NOT MET:  %s required, %s entered (CFM).  Review inputs for ReOtherZn '%s'.", FltToStr( MinIAQCFM, 1 ), FltToStr( TotalIAQCFM, 1 ), Name )  endif
;         else UNCHANGED  endif endif endif  }

  ; SAC 3/4/16 - Check to confirm validity between PV compliance credit & detailed (EDR) PV system size (tic #609)
  ; SAC 3/25/16 - Revised rule to throw similar error when PVCompCredit and DesignRatingCalcs are selected but No EDR PV
	"Check for valid EDR PV system size when activated along w/ PV compliance credit"
		ResProj:Action		= {	if (IfValidAnd( IsComRuleset > 0 )) then  UNCHANGED
                              else if (IfValidAnd(StandardsVersion >= 2017)==0 .OR. EnablePVCredit < 1 .OR. PVCompCredit < 1 .OR. IfValidAnd( AllowDesignRating > 0.5 )==0 .OR. IfValidAnd( DesignRatingCalcs > 0.5 )==0) then  UNCHANGED
									else if (IfValidAnd( PVWDCSysTotal > 0 )==0)
									then	PostError( "When both the PV compliance credit and Energy Design Rating (EDR) PV system credit features are activated, an EDR PV system size must be specified that is >= the minimum PV compliance credit system size of %g kWdc.", PVMinRatedPower[1] )
									else if (IfValidAnd( PVWDCSysTotal < PVMinRatedPower[1] ))
									then	PostError( "When both the PV compliance credit and Energy Design Rating (EDR) PV system credit features are activated, the EDR PV system size (%g kWdc) must be >= the minimum PV compliance credit system size of %g kWdc.", PVWDCSysTotal, PVMinRatedPower[1] )
									else	UNCHANGED  endif endif endif endif  }

	"Prevent Unconditioned Zones in compliance analysis (for the time being)"		; SAC 11/18/14 - 
		ResZn:Action		= {	if (IfValidAnd( Type = 10 ))
									then  if ( ResProj:ZonalControl < 0.5)
											then  PostError( "Zone '%s' Type must be switched from Unconditioned to Conditioned.  Unconditioned zones are not currently supported in compliance analysis", Name )
											else  PostError( "Zone '%s' Type must be switched from Unconditioned to Living or Sleeping.  Unconditioned zones are not currently supported in compliance analysis", Name )
											endif
									else  UNCHANGED  endif  }

  ; SAC 1/6/14 - check for combination of zonal control credit & heat pump-conditioned zones
	"Check for combination of zonal control credit & heat pump-conditioned zones"
		ResZn:Action	= {	if ( ResProj:ZonalControl < 0.5 .OR. CondFloorArea < 0.1 .OR. LocalCompAssigned( ActiveHVACSystem ) < 0.5) then  UNCHANGED
								else if (ActiveHVACSystem:Type == 2) then  PostError( "Zonal control credit (Building tab of Project dialog) is not compatible with zones, such as '%s', conditioned by a heat pump system.", Name )
								else  UNCHANGED  endif endif  }

; SAC 1/15/14 - removed check - testing analysis for validity... (GC issue #258)
;  ; mjb 1/8/14 - check for combination of zonal control credit & combined hydronic systems
;	"Check for combination of zonal control credit & combined hydronic systems"
;		ResZn:Action	= {	if ( ResProj:ZonalControl < 0.5 .OR. CondFloorArea < 0.1 .OR. LocalCompAssigned( ActiveHVACSystem ) < 0.5) then  UNCHANGED
;								else if (ActiveHVACSystem:HeatSysType == 9) then  PostError( "Zonal control credit (Building tab of Project dialog) is not compatible with zones, such as '%s', conditioned by a combined hydronic system.", Name )
;								else  UNCHANGED  endif endif  }

	; SAC 6/6/13 - added check for minimum R-5 slab edge insulation when 'Heated Slab' is selected
	"Check for minimum R-5 slab edge insulation when 'Heated Slab' is selected"
		ResSlabFlr:Action	= {	if (HeatedSlab > 0.5 .AND. (EdgeInsulRValue < 5 .OR. EdgeInsulDepth < 16))
										then	PostError( "Slab floor '%s' requires minimum of R-5, 16 in. depth edge insulation since it is specified as heated", Name )
										else  UNCHANGED  endif  }

  ; SAC 8/26/14 - added check to prevent compliance analysis on Conditioned attics
;	"Check to ensure no ResAttic:Type = Conditioned..."
;		ResAttic:Action	= {	if (FloorArea > 0.1 .AND. Type = 1 .AND. ResProj:BypassRuleLimits < 0.5)
;									then  PostError( "Attic '%s' Type of 'Conditioned' is not allowed when performing compliance analysis.  Revise this input before reinitiating analysis.", Name )
;									else  UNCHANGED  endif  }

	; EM 2/13/15	
;TO BE IMPLEMENTED WITH PRESCRIPTIVE ADDITIONS ROOF MODS - ADD LOGIC EXCLUSIVE TO E+A+A 								
	;"Check for Attic over new zone"
	;	ResAttic:Action	= {	if (FloorAreaOverNewZone > 0.1 .AND. FloorAreaOverNewZone < (FloorArea - 0.1) )
	;								then  PostError( "Attic '%s' is over a combination of new zone and existing space / garage.  Create a separate attic for the new zone(s).", Name )
	;								else  UNCHANGED  endif  }

	; SAC 10/7/13 - augmented rule to disable SmartVent (FixedFlowOAV) in addition to NightBreeze (VarFlowOAV)
	"Check for HVAC system type (or CFI cool vent) NOT available"  ; SAC 10/3/13 - GC issue ??? - prevent system type 'Variable Outdoor Air Ventilation Central Heat/Cool System'
		ResHVACSys:Action		= {	if (FloorAreaServed[1] < 0.1) then  UNCHANGED
										else if (TypeOK < 0.5) then  PostError( "HVAC system '%s' type '%s' not currently available for analysis.", Name, EnumString( Type ) )
										else if (CFIClVentCompat > 0.5 .AND. Type != 3 .AND. CFIClVentOption > 0 .AND. ResProj:EnableFixedFlowOAV < 0.5)
										then  PostError( "HVAC system '%s' specified as supplying CFI Cool Vent, but this feature is not currently available for analysis.", Name )
										else  UNCHANGED  endif endif endif  }

   ; SAC 2/21/18 - added check to prevent analysis of model where CFI cool vent is specified @ the project level but not ClVent info specified for any HVACSys
   "Prevent analysis if CFI cool vent is specified @ the project level but not ClVent info specified for any HVACSys"
      ResProj:Action  = {
         if (EnableClVent > 0.5 .AND. UnitClVentOption == 3 .AND. 
             SumAll( ResHVACSys:IsVariableCFIClVent ) < 1 .AND.
             SumAll( ResHVACSys:IsFixedCFIClVent    ) < 1)
         then  PostError( "Cooling ventilation inputs must be specified for one or more HVAC systems when project-level Cooling Ventilation is set to '%s'.", EnumString(UnitClVentOption) )
         else  UNCHANGED  endif  }

   ; SAC 4/23/19 - added check to prevent analysis when cool venting to Attic but no attic exists in model (tic #1023)
   "Prevent analysis when cool venting to Attic but no attic exists in model"  ResProj:Action  =
      {  if (IsMultiFamily > 0 .OR. LimitedClVent == 0) then  UNCHANGED
         else if (UnitClVentOption = 1)
         then  PostError( "Cooling ventilation inputs call for exhausting to attic, but no attic exists in the model." )
         else if (UnitClVentOption = 2 .AND. ClVentFansToAttic > 0)
         then  PostError( "%g cooling ventilation fan(s) are setup to exhaust into attic, but no attic exists in the model.", ClVentFansToAttic )
         else  UNCHANGED  endif endif endif  }

   "Prevent analysis when cool vent flow exceeds code (CEC) maximum"    ResProj:Action  =       ; SAC 6/29/20 (tic #1236)
      {  if (IsMultiFamily > 0 .OR. Proj:EnableResearchMode > 0 .OR. BypassRuleLimits > 0 .OR. CondFloorArea < 1 .OR.
             (EnableClVent < 0.5 .AND. LimitedClVent < 0.5) .OR. UnitClVentOption < 1 .OR. IfValidAnd( UnitClVentCFMTot > 0 )==0) then  UNCHANGED
         else if ((UnitClVentCFMTot / CondFloorArea) > (ValidOr( MaxClVentFlow, 1000 ) + 0.01))
         then  PostError( "Cool vent flow (%s CFM/ft2) cannot exceed maximum of %s CFM/ft2 (%s CFM)",
                     FltToStr( (UnitClVentCFMTot / CondFloorArea), 2, 1, 0, 1 ), FltToStr( MaxClVentFlow, 2, 1, 0, 1 ), FltToStr( (MaxClVentFlow * CondFloorArea) ) )
         else  UNCHANGED
         endif endif  }

; SAC 11/25/14 - added checks to ensure that num htg/clg equip is > 0 and all equip for specified number is actually assigned
	"Check for valid DwellUnitType Num*EquipTypes"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1) then  UNCHANGED
											else if (HVACSysType < 1) then  PostError( "DwellUnitType '%s' has no HVAC system type specified.", Name )
											else if (HVACSysType == 2 .AND. ResProj:BypassRuleLimits < 0.5 .AND. IfValidAnd( NumHtPumpEquipTypes > 0.5 )==0)
											then  PostError( "One or more heat pump equipment assignments must be defined for DwellUnitType '%s'.", Name )
											else if (HVACSysType == 1 .AND. ResProj:BypassRuleLimits < 0.5 .AND. IfValidAnd( NumHeatEquipTypes > 0.5 )==0)
											then  PostError( "One or more heating equipment assignments must be defined for DwellUnitType '%s'.", Name )
											else if (HVACSysType == 1 .AND. ResProj:BypassRuleLimits < 0.5 .AND. IfValidAnd( NumCoolEquipTypes > 0.5 )==0)
											then  PostError( "One or more cooling equipment assignments must be defined for DwellUnitType '%s'.", Name )
											else	UNCHANGED  endif endif endif endif endif  }

	"Check for valid DwellUnitType equip assignments - heat pump #1"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 2 .OR. IfValidAnd( NumHtPumpEquipTypes >= 1 )==0 .OR. LocalCompAssigned( HVACHtPumpRef[1] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for heat pump #1.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - heat pump #2"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 2 .OR. IfValidAnd( NumHtPumpEquipTypes >= 2 )==0 .OR. LocalCompAssigned( HVACHtPumpRef[2] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for heat pump #2.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - heat pump #3"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 2 .OR. IfValidAnd( NumHtPumpEquipTypes >= 3 )==0 .OR. LocalCompAssigned( HVACHtPumpRef[3] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for heat pump #3.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - heat pump #4"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 2 .OR. IfValidAnd( NumHtPumpEquipTypes >= 4 )==0 .OR. LocalCompAssigned( HVACHtPumpRef[4] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for heat pump #4.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - heat pump #5"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 2 .OR. IfValidAnd( NumHtPumpEquipTypes >= 5 )==0 .OR. LocalCompAssigned( HVACHtPumpRef[5] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for heat pump #5.", Name )  endif  }

	"Check for valid DwellUnitType equip assignments - cooling #1"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 1 .OR. IfValidAnd( NumCoolEquipTypes >= 1 )==0 .OR. LocalCompAssigned( HVACCoolRef[1] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for cooling #1.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - cooling #2"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 1 .OR. IfValidAnd( NumCoolEquipTypes >= 2 )==0 .OR. LocalCompAssigned( HVACCoolRef[2] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for cooling #2.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - cooling #3"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 1 .OR. IfValidAnd( NumCoolEquipTypes >= 3 )==0 .OR. LocalCompAssigned( HVACCoolRef[3] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for cooling #3.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - cooling #4"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 1 .OR. IfValidAnd( NumCoolEquipTypes >= 4 )==0 .OR. LocalCompAssigned( HVACCoolRef[4] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for cooling #4.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - cooling #5"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 1 .OR. IfValidAnd( NumCoolEquipTypes >= 5 )==0 .OR. LocalCompAssigned( HVACCoolRef[5] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for cooling #5.", Name )  endif  }

	"Check for valid DwellUnitType equip assignments - heating #1"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 1 .OR. IfValidAnd( NumHeatEquipTypes >= 1 )==0 .OR. LocalCompAssigned( HVACHeatRef[1] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for heating #1.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - heating #2"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 1 .OR. IfValidAnd( NumHeatEquipTypes >= 2 )==0 .OR. LocalCompAssigned( HVACHeatRef[2] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for heating #2.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - heating #3"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 1 .OR. IfValidAnd( NumHeatEquipTypes >= 3 )==0 .OR. LocalCompAssigned( HVACHeatRef[3] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for heating #3.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - heating #4"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 1 .OR. IfValidAnd( NumHeatEquipTypes >= 4 )==0 .OR. LocalCompAssigned( HVACHeatRef[4] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for heating #4.", Name )  endif  }
	"Check for valid DwellUnitType equip assignments - heating #5"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. HVACSysType != 1 .OR. IfValidAnd( NumHeatEquipTypes >= 5 )==0 .OR. LocalCompAssigned( HVACHeatRef[5] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
											else  PostError( "DwellUnitType '%s' is lacking an equipment assignment for heating #5.", Name )  endif  }

   ; SAC 9/18/19 - handle OtherZone same as Zone (MFamProto)   ; moved up to Code check from Simulation check to perform earlier in CBECC analysis - SAC 10/13/22
	"Check for valid ResIntWall:Outside assignment"          ; added error when Outside not specified (unless other side not modeled) - SAC 10/13/22  ; ignore check for multiplied ResZnGrp surfaces - SAC 04/26/23 (tic #3392)  ; fix logic for consistency w/ when we collect Outside - SAC 10/18/23
		ResIntWall:Action	=     {	if ((ParentComponentType() == "ResZn" .OR. ParentComponentType() == "ResOtherZn") .AND.
                                     LocalCompAssigned( Outside ) < 1 .AND. (IfValidAnd( IsPartySurface > 0 )==0 .OR. IfValidAnd( OtherSideModeled > 0 )) .AND.
                                     Parent( Mult ) < 1.1)
                                 then  if (IfValidAnd( Proj:EnableResearchMode > 0 ))
                                       then  PostWarning( "Interior wall '%s' is missing the required assignment of Zone on Other Side (needed for surface and air flow simulation)", Name )
                                       else  PostError(   "Interior wall '%s' is missing the required assignment of Zone on Other Side (needed for surface and air flow simulation)", Name )  endif
                                 else if ((ParentComponentType() == "ResZn" .OR. ParentComponentType() == "ResOtherZn") .AND.
		                                    LocalCompAssigned( Outside ) == ComponentType( "Garage" ) .AND. ResProj:HasGarage < 0.1)
								      	then	if (IfValidAnd( Proj:EnableResearchMode > 0 ))
                                       then  PostWarning( "Interior wall '%s' assigns garage '%s' as being on the outside, but garage modeling is disabled in the Project dialog", Name, Outside:Name )
                                       else  PostError(   "Interior wall '%s' assigns garage '%s' as being on the outside, but garage modeling is disabled in the Project dialog", Name, Outside:Name )  endif
								      	else  UNCHANGED  endif endif  }
	"Check for valid ResIntFlr:Outside assignment"           ; added error when Outside not specified (unless other side not modeled) - SAC 10/13/22  ; ignore check for multiplied ResZnGrp surfaces - SAC 04/26/23 (tic #3392)  ; fix logic for consistency w/ when we collect Outside - SAC 10/18/23
		ResIntFlr:Action	=     {	if ((ParentComponentType() == "ResZn" .OR. ParentComponentType() == "ResOtherZn") .AND.
                                     LocalCompAssigned( Outside ) < 1 .AND. (IfValidAnd( IsPartySurface > 0 )==0 .OR. IfValidAnd( OtherSideModeled > 0 )) .AND.
                                     Parent( Mult ) < 1.1 .AND. Parent( AboveMultipliedFlr ) < 1)
                                 then  if (IfValidAnd( Proj:EnableResearchMode > 0 ))
                                       then  PostWarning( "Interior floor '%s' is missing the required assignment of Zone on Other Side (needed for surface and air flow simulation)", Name )
                                       else  PostError(   "Interior floor '%s' is missing the required assignment of Zone on Other Side (needed for surface and air flow simulation)", Name )  endif
                                 else if ((ParentComponentType() == "ResZn" .OR. ParentComponentType() == "ResOtherZn") .AND.
		                                    LocalCompAssigned( Outside ) == ComponentType( "Garage" ) .AND. ResProj:HasGarage < 0.1)
											then	if (IfValidAnd( Proj:EnableResearchMode > 0 ))
                                       then  PostWarning( "Interior floor '%s' assigns garage '%s' as being on the outside, but garage modeling is disabled in the Project dialog", Name, Outside:Name )
                                       else  PostError(   "Interior floor '%s' assigns garage '%s' as being on the outside, but garage modeling is disabled in the Project dialog", Name, Outside:Name )  endif
											else  UNCHANGED  endif endif  }
	"Check for valid ResIntCeiling:Outside assignment"       ; added error when Outside not specified (unless other side not modeled) - SAC 10/13/22  ; ignore check for multiplied ResZnGrp surfaces - SAC 04/26/23 (tic #3392)  ; fix logic for consistency w/ when we collect Outside - SAC 10/18/23
		ResIntCeiling:Action	=    {	if ((ParentComponentType() == "ResZn" .OR. ParentComponentType() == "ResOtherZn") .AND.
                                        LocalCompAssigned( Outside ) < 1 .AND. (IfValidAnd( IsPartySurface > 0 )==0 .OR. IfValidAnd( OtherSideModeled > 0 )) .AND.
                                        Parent( Mult ) < 1.1 .AND. Parent( BelowMultipliedFlr ) < 1)
                                    then  if (IfValidAnd( Proj:EnableResearchMode > 0 ))
                                          then  PostWarning( "Interior ceiling '%s' is missing the required assignment of Zone on Other Side (needed for surface and air flow simulation)", Name )
                                          else  PostError(   "Interior ceiling '%s' is missing the required assignment of Zone on Other Side (needed for surface and air flow simulation)", Name )  endif
                                    else if ((ParentComponentType() == "ResZn" .OR. ParentComponentType() == "ResOtherZn") .AND.
		                                       LocalCompAssigned( Outside ) == ComponentType( "Garage" ) .AND. ResProj:HasGarage < 0.1)
											   then	if (IfValidAnd( Proj:EnableResearchMode > 0 ))
                                          then  PostWarning( "Interior ceiling '%s' assigns garage '%s' as being on the outside, but garage modeling is disabled in the Project dialog", Name, Outside:Name )
                                          else  PostError(   "Interior ceiling '%s' assigns garage '%s' as being on the outside, but garage modeling is disabled in the Project dialog", Name, Outside:Name )  endif
											   else  UNCHANGED  endif endif  }


   ; moved the following envelope checks UP from below (in sim check) to ensure triggered BEFORE analysis - SAC 04/19/23 (tic #3497)
   ; SAC 10/20/14 - check for valid Attic assigned to every CeilingBelowAttic
	"Check for valid Attic assigned to every ResCeilingBelowAttic:AtticZone"
		ResCeilingBelowAttic:Action	= {	if (IfValidAnd( Area > 0.1 ) .AND. LocalCompAssigned( AtticZone ) < 0.1)
													then	if (IfValidAnd( Proj:EnableResearchMode > 0 ))
                                             then  PostWarning( "Ceiling below attic '%s' lacks the required assignment of AtticZone", Name )
                                             else  PostError(   "Ceiling below attic '%s' lacks the required assignment of AtticZone", Name )  endif
													else  UNCHANGED  endif  }

  ; SAC 1/28/13 - added checks to ensure that each Zone & Garage has at least 6 adjacent surfaces
  ; added logic to count adjacent surfaces of Com Spc objects - SAC 04/19/23 (tic #4397)
	"Set ResIntWall:SurfaceCount to 1"     ResIntWall:SurfaceCount    = {	1  }
	"Set ResIntCeiling:SurfaceCount to 1"  ResIntCeiling:SurfaceCount = {	1  }
	"Set ResIntFlr:SurfaceCount to 1"      ResIntFlr:SurfaceCount     = {	1  }
	"Set ResZn:SurfaceCount to # of child surfaces"		ResZn:SurfaceCount	= {
						ChildCount( ResCathedralCeiling  ) + ChildCount( ResExtWall   ) + ChildCount( ResSlabFlr ) + 
						ChildCount( ResCeilingBelowAttic ) + ChildCount( ResIntWall   ) + ChildCount( ResIntFlr  ) + ChildCount( ResFlrOverCrawlSpc ) + 
						ChildCount( ResIntCeiling        ) + ChildCount( ResUndgrWall ) + ChildCount( ResExtFlr  ) + ChildCount( ResUndgrFlr ) +
						SumRevRef( ResIntWall:Outside,     ResIntWall:SurfaceCount    ) +
						SumRevRef( ResIntCeiling:Outside,  ResIntCeiling:SurfaceCount ) +
						SumRevRef( ResIntFlr:Outside,      ResIntFlr:SurfaceCount     ) +
						SumRevRef( Ceiling:AdjacentSpcRef, Ceiling:SurfaceCount  ) +
						SumRevRef( IntFlr:AdjacentSpcRef,  IntFlr:SurfaceCount   ) +
						SumRevRef( IntWall:AdjacentSpcRef, IntWall:SurfaceCount  )  }
	"Set ResOtherZn:SurfaceCount to # of child surfaces"		ResOtherZn:SurfaceCount	=     ; SAC 9/18/19 - (MFamProto)
					{	ChildCount( ResCathedralCeiling  ) + ChildCount( ResExtWall   ) + ChildCount( ResSlabFlr ) + 
						ChildCount( ResCeilingBelowAttic ) + ChildCount( ResIntWall   ) + ChildCount( ResIntFlr  ) + ChildCount( ResFlrOverCrawlSpc ) + 
						ChildCount( ResIntCeiling        ) + ChildCount( ResUndgrWall ) + ChildCount( ResExtFlr  ) + ChildCount( ResUndgrFlr ) +
						SumRevRef( ResIntWall:Outside,     ResIntWall:SurfaceCount    ) +
						SumRevRef( ResIntCeiling:Outside,  ResIntCeiling:SurfaceCount ) +
						SumRevRef( ResIntFlr:Outside,      ResIntFlr:SurfaceCount     ) +
						SumRevRef( Ceiling:AdjacentSpcRef, Ceiling:SurfaceCount  ) +
						SumRevRef( IntFlr:AdjacentSpcRef,  IntFlr:SurfaceCount   ) +
						SumRevRef( IntWall:AdjacentSpcRef, IntWall:SurfaceCount  )  }
	"Set ResGarage:SurfaceCount to # of child surfaces"		ResGarage:SurfaceCount	= {
						ChildCount( ResCathedralCeiling  ) + ChildCount( ResExtWall ) + ChildCount( ResSlabFlr ) +
						ChildCount( ResCeilingBelowAttic ) + ChildCount( ResIntWall ) + ChildCount( ResExtFlr  ) + ChildCount( ResFlrOverCrawlSpc ) +
						ChildCount( ResIntCeiling        ) +
						SumRevRef( ResIntWall:Outside,    ResIntWall:SurfaceCount    ) +
						SumRevRef( ResIntCeiling:Outside, ResIntCeiling:SurfaceCount ) +
						SumRevRef( ResIntFlr:Outside,     ResIntFlr:SurfaceCount     )  }

  ; secondary check to ensure max individual child/adjacent surface area < sum of all surface areas
	"Set ResZn:SurfaceAreaSum to sum of child/adjacent surface areas"		ResZn:SurfaceAreaSum	= {
						SumChildren( ResCathedralCeiling:Area  ) + SumChildren( ResExtWall:Area ) + SumChildren( ResSlabFlr:Area     ) + 
						SumChildren( ResCeilingBelowAttic:Area ) + SumChildren( ResIntWall:Area ) + SumChildren( ResIntFlr:Area ) + SumChildren( ResFlrOverCrawlSpc:Area ) + 
						SumChildren( ResIntCeiling:Area        ) + SumChildren( ResUndgrWall:Area ) + SumChildren( ResExtFlr:Area ) + SumChildren( ResUndgrFlr:Area ) +
						SumRevRef( ResIntWall:Outside,    ResIntWall:Area         ) +
						SumRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) +
						SumRevRef( ResIntFlr:Outside,     ResIntFlr:Area   ) +
						SumRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area  ) +
						SumRevRef( IntFlr:AdjacentSpcRef,  IntFlr:Area   ) +
						SumRevRef( IntWall:AdjacentSpcRef, IntWall:Area  )  }
	"Set ResOtherZn:SurfaceAreaSum to sum of child/adjacent surface areas"		ResOtherZn:SurfaceAreaSum	=     ; SAC 9/18/19 - (MFamProto)
					{	SumChildren( ResCathedralCeiling:Area  ) + SumChildren( ResExtWall:Area ) + SumChildren( ResSlabFlr:Area     ) + 
						SumChildren( ResCeilingBelowAttic:Area ) + SumChildren( ResIntWall:Area ) + SumChildren( ResIntFlr:Area ) + SumChildren( ResFlrOverCrawlSpc:Area ) + 
						SumChildren( ResIntCeiling:Area        ) + SumChildren( ResUndgrWall:Area ) + SumChildren( ResExtFlr:Area ) + SumChildren( ResUndgrFlr:Area ) +
						SumRevRef( ResIntWall:Outside,    ResIntWall:Area         ) +
						SumRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) +
						SumRevRef( ResIntFlr:Outside,     ResIntFlr:Area   ) +
						SumRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area  ) +
						SumRevRef( IntFlr:AdjacentSpcRef,  IntFlr:Area   ) +
						SumRevRef( IntWall:AdjacentSpcRef, IntWall:Area  )  }
	"Set ResZn:SurfaceAreaSum to sum of child/adjacent surface areas"		ResGarage:SurfaceAreaSum	= {
						SumChildren( ResCathedralCeiling:Area  ) + SumChildren( ResExtWall:Area ) + SumChildren( ResSlabFlr:Area     ) +
						SumChildren( ResCeilingBelowAttic:Area ) + SumChildren( ResIntWall:Area ) + SumChildren( ResExtFlr:Area ) +
						SumChildren( ResIntCeiling:Area        ) + SumChildren( ResFlrOverCrawlSpc:Area ) +
						SumRevRef( ResIntWall:Outside,    ResIntWall:Area         ) +
						SumRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) +
						SumRevRef( ResIntFlr:Outside,     ResIntFlr:Area   )  }

	"Set ResZn:SurfaceAreaTop to sum of child/adjacent top surface areas"         ResZn:SurfaceAreaTop	=        ; SAC 04/19/23 (tic #3497)
					{  SumChildren( ResCathedralCeiling:Area  ) + SumChildren( ResCeilingBelowAttic:Area ) + SumChildren( ResIntCeiling:Area ) + 
						SumRevRef( ResIntFlr:Outside, ResIntFlr:Area ) + SumRevRef( IntFlr:AdjacentSpcRef, IntFlr:Area )  }
	"Set ResOtherZn:SurfaceAreaTop to sum of child/adjacent top surface areas"    ResOtherZn:SurfaceAreaTop	= 
					{	SumChildren( ResCathedralCeiling:Area  ) + SumChildren( ResCeilingBelowAttic:Area ) + SumChildren( ResIntCeiling:Area ) + 
						SumRevRef( ResIntFlr:Outside, ResIntFlr:Area ) + SumRevRef( IntFlr:AdjacentSpcRef, IntFlr:Area )  }

	"Set ResZn:SurfaceAreaBot to sum of child/adjacent bottom surface areas"      ResZn:SurfaceAreaBot	=        ; SAC 04/19/23 (tic #3497)
					{  SumChildren( ResSlabFlr:Area ) + SumChildren( ResIntFlr:Area   ) + SumChildren( ResFlrOverCrawlSpc:Area ) + 
						SumChildren( ResExtFlr:Area  ) + SumChildren( ResUndgrFlr:Area ) +
						SumRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) + SumRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area  )  }
	"Set ResOtherZn:SurfaceAreaBot to sum of child/adjacent bottomsurface areas"     ResOtherZn:SurfaceAreaBot	= 
					{	SumChildren( ResSlabFlr:Area ) + SumChildren( ResIntFlr:Area   ) + SumChildren( ResFlrOverCrawlSpc:Area ) + 
						SumChildren( ResExtFlr:Area  ) + SumChildren( ResUndgrFlr:Area ) +
						SumRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) + SumRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area  )  }

   ; switched SumRevRef() calls to MaxRevRef() when setting *:SurfaceAreaMax from surfaces of other zones that are adjacent to this zone (BL/AB) - SAC 7/9/20
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 1 RCathClgs"		   ResZn:SurfaceAreaMax	= {	if (ChildCount( ResCathedralCeiling  ) > 0) then                       MaxChild( ResCathedralCeiling:Area  )    else  0  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 2 RClgBlwAs"		   ResZn:SurfaceAreaMax	= {	if (ChildCount( ResCeilingBelowAttic ) > 0) then  max( SurfaceAreaMax, MaxChild( ResCeilingBelowAttic:Area ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 3 RIntClgs"		   ResZn:SurfaceAreaMax	= {	if (ChildCount( ResIntCeiling        ) > 0) then  max( SurfaceAreaMax, MaxChild( ResIntCeiling:Area        ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 4 RExtWalls"		   ResZn:SurfaceAreaMax	= {	if (ChildCount( ResExtWall           ) > 0) then  max( SurfaceAreaMax, MaxChild( ResExtWall:Area           ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 5 RIntWalls"		   ResZn:SurfaceAreaMax	= {	if (ChildCount( ResIntWall           ) > 0) then  max( SurfaceAreaMax, MaxChild( ResIntWall:Area           ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 6 RUndWalls"		   ResZn:SurfaceAreaMax	= {	if (ChildCount( ResUndgrWall         ) > 0) then  max( SurfaceAreaMax, MaxChild( ResUndgrWall:Area         ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 7 RSlabFlrs"		   ResZn:SurfaceAreaMax	= {	if (ChildCount( ResSlabFlr           ) > 0) then  max( SurfaceAreaMax, MaxChild( ResSlabFlr:Area           ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 8 RIntFlrs"		   ResZn:SurfaceAreaMax	= {	if (ChildCount( ResIntFlr            ) > 0) then  max( SurfaceAreaMax, MaxChild( ResIntFlr:Area            ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 9 RExtFlrs"		   ResZn:SurfaceAreaMax	= {	if (ChildCount( ResExtFlr            ) > 0) then  max( SurfaceAreaMax, MaxChild( ResExtFlr:Area            ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 10 RUndFlrs"		   ResZn:SurfaceAreaMax	= {	if (ChildCount( ResUndgrFlr          ) > 0) then  max( SurfaceAreaMax, MaxChild( ResUndgrFlr:Area          ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 11 RFlrsOvrCrwl"	ResZn:SurfaceAreaMax	= {	if (ChildCount( ResFlrOverCrawlSpc   ) > 0) then  max( SurfaceAreaMax, MaxChild( ResFlrOverCrawlSpc:Area   ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 12 adj RIntWalls"  ResZn:SurfaceAreaMax	= {	if (SumRevRef( ResIntWall:Outside,    ResIntWall:Area    ) > 0) then  max( SurfaceAreaMax, MaxRevRef( ResIntWall:Outside,    ResIntWall:Area    ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 13 adj RIntClgs"	ResZn:SurfaceAreaMax	= {	if (SumRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) > 0) then  max( SurfaceAreaMax, MaxRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 14 adj RIntFlrs"	ResZn:SurfaceAreaMax	= {	if (SumRevRef( ResIntFlr:Outside,     ResIntFlr:Area     ) > 0) then  max( SurfaceAreaMax, MaxRevRef( ResIntFlr:Outside,     ResIntFlr:Area     ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 15 adj Ceiling"    ResZn:SurfaceAreaMax	= {	if (SumRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area ) > 0) then  max( SurfaceAreaMax, MaxRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area ) )  else  UNCHANGED  endif  }    ; SAC 04/19/23 (tic #3497)
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 16 adj IntFlr"	   ResZn:SurfaceAreaMax	= {	if (SumRevRef( IntFlr:AdjacentSpcRef,  IntFlr:Area  ) > 0) then  max( SurfaceAreaMax, MaxRevRef( IntFlr:AdjacentSpcRef,  IntFlr:Area  ) )  else  UNCHANGED  endif  }
	"Set ResZn:SurfaceAreaMax to MAX of child/adj surface areas - 17 adj IntWall"	   ResZn:SurfaceAreaMax	= {	if (SumRevRef( IntWall:AdjacentSpcRef, IntWall:Area ) > 0) then  max( SurfaceAreaMax, MaxRevRef( IntWall:AdjacentSpcRef, IntWall:Area ) )  else  UNCHANGED  endif  }

   ; SAC 9/18/19 - OtherZone (MFamProto)
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 1 CathClgs"		ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResCathedralCeiling  ) > 0) then                       MaxChild( ResCathedralCeiling:Area  )    else  0  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 2 ClgBlwAs"		ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResCeilingBelowAttic ) > 0) then  max( SurfaceAreaMax, MaxChild( ResCeilingBelowAttic:Area ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 3 IntClgs"			ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResIntCeiling        ) > 0) then  max( SurfaceAreaMax, MaxChild( ResIntCeiling:Area        ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 4 ExtWalls"		ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResExtWall           ) > 0) then  max( SurfaceAreaMax, MaxChild( ResExtWall:Area           ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 5 IntWalls"		ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResIntWall           ) > 0) then  max( SurfaceAreaMax, MaxChild( ResIntWall:Area           ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 6 UndWalls"		ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResUndgrWall         ) > 0) then  max( SurfaceAreaMax, MaxChild( ResUndgrWall:Area         ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 7 SlabFlrs"		ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResSlabFlr           ) > 0) then  max( SurfaceAreaMax, MaxChild( ResSlabFlr:Area           ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 8 IntFlrs"			ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResIntFlr            ) > 0) then  max( SurfaceAreaMax, MaxChild( ResIntFlr:Area            ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 9 ExtFlrs"			ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResExtFlr            ) > 0) then  max( SurfaceAreaMax, MaxChild( ResExtFlr:Area            ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 10 UndFlrs"		ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResUndgrFlr          ) > 0) then  max( SurfaceAreaMax, MaxChild( ResUndgrFlr:Area          ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 11 adj IntWalls"	ResOtherZn:SurfaceAreaMax	= {	if (SumRevRef( ResIntWall:Outside,    ResIntWall:Area         ) > 0) then  max( SurfaceAreaMax, MaxRevRef( ResIntWall:Outside,         ResIntWall:Area         ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 12 adj IntClgs"	ResOtherZn:SurfaceAreaMax	= {	if (SumRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) > 0) then  max( SurfaceAreaMax, MaxRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 13 adj IntFlrs"	ResOtherZn:SurfaceAreaMax	= {	if (SumRevRef( ResIntFlr:Outside,     ResIntFlr:Area   ) > 0) then  max( SurfaceAreaMax, MaxRevRef( ResIntFlr:Outside,   ResIntFlr:Area   ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 14 FlrsOvrCrwl"	ResOtherZn:SurfaceAreaMax	= {	if (ChildCount( ResFlrOverCrawlSpc    ) > 0) then  max( SurfaceAreaMax, MaxChild( ResFlrOverCrawlSpc:Area    ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 15 adj Ceiling"  ResOtherZn:SurfaceAreaMax	= {	if (SumRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area ) > 0) then  max( SurfaceAreaMax, MaxRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area ) )  else  UNCHANGED  endif  }    ; SAC 04/19/23 (tic #3497)
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 16 adj IntFlr"   ResOtherZn:SurfaceAreaMax	= {	if (SumRevRef( IntFlr:AdjacentSpcRef,  IntFlr:Area  ) > 0) then  max( SurfaceAreaMax, MaxRevRef( IntFlr:AdjacentSpcRef,  IntFlr:Area  ) )  else  UNCHANGED  endif  }
	"Set ResOtherZn:SurfaceAreaMax to MAX of child/adj surface areas - 17 adj IntWall"	ResOtherZn:SurfaceAreaMax	= {	if (SumRevRef( IntWall:AdjacentSpcRef, IntWall:Area ) > 0) then  max( SurfaceAreaMax, MaxRevRef( IntWall:AdjacentSpcRef, IntWall:Area ) )  else  UNCHANGED  endif  }

	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 1 CathClgs"			ResGarage:SurfaceAreaMax	= {	if (ChildCount( CathedralCeiling  ) > 0) then                       MaxChild( ResCathedralCeiling:Area  )    else  0  endif  }
	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 2 ClgBlwAs"			ResGarage:SurfaceAreaMax	= {	if (ChildCount( CeilingBelowAttic ) > 0) then  max( SurfaceAreaMax, MaxChild( ResCeilingBelowAttic:Area ) )  else  UNCHANGED  endif  }
	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 3 IntClgs"			ResGarage:SurfaceAreaMax	= {	if (ChildCount( InteriorCeiling   ) > 0) then  max( SurfaceAreaMax, MaxChild( ResIntCeiling:Area   ) )  else  UNCHANGED  endif  }
	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 4 ExtWalls"			ResGarage:SurfaceAreaMax	= {	if (ChildCount( ExtWall           ) > 0) then  max( SurfaceAreaMax, MaxChild( ResExtWall:Area           ) )  else  UNCHANGED  endif  }
	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 5 IntWalls"			ResGarage:SurfaceAreaMax	= {	if (ChildCount( IntWall           ) > 0) then  max( SurfaceAreaMax, MaxChild( ResIntWall:Area           ) )  else  UNCHANGED  endif  }
;	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 6 UndWalls"			ResGarage:SurfaceAreaMax	= {	if (ChildCount( UndWall           ) > 0) then  max( SurfaceAreaMax, MaxChild( ResUndgrWall:Area           ) )  else  UNCHANGED  endif  }
	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 7 SlabFlrs"			ResGarage:SurfaceAreaMax	= {	if (ChildCount( SlabFloor         ) > 0) then  max( SurfaceAreaMax, MaxChild( ResSlabFlr:Area         ) )  else  UNCHANGED  endif  }
;	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 8 IntFlrs"			ResGarage:SurfaceAreaMax	= {	if (ChildCount( InteriorFloor     ) > 0) then  max( SurfaceAreaMax, MaxChild( ResIntFlr:Area     ) )  else  UNCHANGED  endif  }
	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 9 ExtFlrs"			ResGarage:SurfaceAreaMax	= {	if (ChildCount( ExteriorFloor     ) > 0) then  max( SurfaceAreaMax, MaxChild( ResExtFlr:Area     ) )  else  UNCHANGED  endif  }
;	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 10 UndFlrs"			ResGarage:SurfaceAreaMax	= {	if (ChildCount( UndFloor          ) > 0) then  max( SurfaceAreaMax, MaxChild( ResUndgrFlr:Area          ) )  else  UNCHANGED  endif  }
	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 11 adj IntWalls"	ResGarage:SurfaceAreaMax	= {	if (SumRevRef( ResIntWall:Outside,         ResIntWall:Area         ) > 0) then  max( SurfaceAreaMax, MaxRevRef( ResIntWall:Outside,         ResIntWall:Area         ) )  else  UNCHANGED  endif  }
	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 12 adj IntClgs"	ResGarage:SurfaceAreaMax	= {	if (SumRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) > 0) then  max( SurfaceAreaMax, MaxRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) )  else  UNCHANGED  endif  }
	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 13 adj IntFlrs"	ResGarage:SurfaceAreaMax	= {	if (SumRevRef( ResIntFlr:Outside,   ResIntFlr:Area   ) > 0) then  max( SurfaceAreaMax, MaxRevRef( ResIntFlr:Outside,   ResIntFlr:Area   ) )  else  UNCHANGED  endif  }
	"Set ResGarage:SurfaceAreaMax to MAX of child/adj surface areas - 14 FlrsOvrCrwl"	ResGarage:SurfaceAreaMax	= {	if (ChildCount( FloorOverCrawl    ) > 0) then  max( SurfaceAreaMax, MaxChild( ResFlrOverCrawlSpc:Area    ) )  else  UNCHANGED  endif  }

   ; added to enhance reporting of objects that exceed limits on surface area - SAC 04/20/23 (tic #3497)
   "Set ResZn:SurfaceAreaMaxComp - 1 RCathClgs"		   ResZn:SurfaceAreaMaxComp = {  if (                                            SurfaceAreaMax > 0 .AND. ChildCount( ResCathedralCeiling  ) > 0) then  if (SurfaceAreaMax == MaxChild( ResCathedralCeiling:Area  )) then  Format(  "child ResCathedralCeiling '%s' of", MaxChildComp( ResCathedralCeiling:Area  ) )  else UNDEFINED endif  else UNDEFINED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 2 RClgBlwAs"		   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResCeilingBelowAttic ) > 0) then  if (SurfaceAreaMax == MaxChild( ResCeilingBelowAttic:Area )) then  Format( "child ResCeilingBelowAttic '%s' of", MaxChildComp( ResCeilingBelowAttic:Area ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 3 RIntClgs"		   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResIntCeiling        ) > 0) then  if (SurfaceAreaMax == MaxChild( ResIntCeiling:Area        )) then  Format(        "child ResIntCeiling '%s' of", MaxChildComp( ResIntCeiling:Area        ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 4 RExtWalls"		   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResExtWall           ) > 0) then  if (SurfaceAreaMax == MaxChild( ResExtWall:Area           )) then  Format(           "child ResExtWall '%s' of", MaxChildComp( ResExtWall:Area           ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 5 RIntWalls"		   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResIntWall           ) > 0) then  if (SurfaceAreaMax == MaxChild( ResIntWall:Area           )) then  Format(           "child ResIntWall '%s' of", MaxChildComp( ResIntWall:Area           ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 6 RUndWalls"		   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResUndgrWall         ) > 0) then  if (SurfaceAreaMax == MaxChild( ResUndgrWall:Area         )) then  Format(         "child ResUndgrWall '%s' of", MaxChildComp( ResUndgrWall:Area         ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 7 RSlabFlrs"		   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResSlabFlr           ) > 0) then  if (SurfaceAreaMax == MaxChild( ResSlabFlr:Area           )) then  Format(           "child ResSlabFlr '%s' of", MaxChildComp( ResSlabFlr:Area           ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 8 RIntFlrs"		   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResIntFlr            ) > 0) then  if (SurfaceAreaMax == MaxChild( ResIntFlr:Area            )) then  Format(            "child ResIntFlr '%s' of", MaxChildComp( ResIntFlr:Area            ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 9 RExtFlrs"		   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResExtFlr            ) > 0) then  if (SurfaceAreaMax == MaxChild( ResExtFlr:Area            )) then  Format(            "child ResExtFlr '%s' of", MaxChildComp( ResExtFlr:Area            ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 10 RUndFlrs"		   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResUndgrFlr          ) > 0) then  if (SurfaceAreaMax == MaxChild( ResUndgrFlr:Area          )) then  Format(          "child ResUndgrFlr '%s' of", MaxChildComp( ResUndgrFlr:Area          ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 11 RFlrsOvrCrwl"	ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResFlrOverCrawlSpc   ) > 0) then  if (SurfaceAreaMax == MaxChild( ResFlrOverCrawlSpc:Area   )) then  Format(   "child ResFlrOverCrawlSpc '%s' of", MaxChildComp( ResFlrOverCrawlSpc:Area   ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 12 adj RIntWalls"  ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( ResIntWall:Outside,    ResIntWall:Area    ) > 0) then  if (SurfaceAreaMax == MaxRevRef( ResIntWall:Outside,    ResIntWall:Area    )) then  Format(    "adjacent ResIntWall '%s' to", MaxRevRefComp( ResIntWall:Outside,    ResIntWall:Area    ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 13 adj RIntClgs"	ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) > 0) then  if (SurfaceAreaMax == MaxRevRef( ResIntCeiling:Outside, ResIntCeiling:Area )) then  Format( "adjacent ResIntCeiling '%s' to", MaxRevRefComp( ResIntCeiling:Outside, ResIntCeiling:Area ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 14 adj RIntFlrs"	ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( ResIntFlr:Outside,     ResIntFlr:Area     ) > 0) then  if (SurfaceAreaMax == MaxRevRef( ResIntFlr:Outside,     ResIntFlr:Area     )) then  Format(     "adjacent ResIntFlr '%s' to", MaxRevRefComp( ResIntFlr:Outside,     ResIntFlr:Area     ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 15 adj Ceiling"    ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area      ) > 0) then  if (SurfaceAreaMax == MaxRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area      )) then  Format(       "adjacent Ceiling '%s' to", MaxRevRefComp( Ceiling:AdjacentSpcRef, Ceiling:Area      ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 16 adj IntFlr"	   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( IntFlr:AdjacentSpcRef,  IntFlr:Area       ) > 0) then  if (SurfaceAreaMax == MaxRevRef( IntFlr:AdjacentSpcRef,  IntFlr:Area       )) then  Format(        "adjacent IntFlr '%s' to", MaxRevRefComp( IntFlr:AdjacentSpcRef,  IntFlr:Area       ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResZn:SurfaceAreaMaxComp - 17 adj IntWall"	   ResZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( IntWall:AdjacentSpcRef, IntWall:Area      ) > 0) then  if (SurfaceAreaMax == MaxRevRef( IntWall:AdjacentSpcRef, IntWall:Area      )) then  Format(       "adjacent IntWall '%s' to", MaxRevRefComp( IntWall:AdjacentSpcRef, IntWall:Area      ) )  else UNCHANGED endif  else UNCHANGED endif  }

   "Set ResOtherZn:SurfaceAreaMaxComp - 1 RCathClgs"		   ResOtherZn:SurfaceAreaMaxComp = {  if (                                            SurfaceAreaMax > 0 .AND. ChildCount( ResCathedralCeiling  ) > 0) then  if (SurfaceAreaMax == MaxChild( ResCathedralCeiling:Area  )) then  Format(  "child ResCathedralCeiling '%s' of", MaxChildComp( ResCathedralCeiling:Area  ) )  else UNDEFINED endif  else UNDEFINED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 2 RClgBlwAs"		   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResCeilingBelowAttic ) > 0) then  if (SurfaceAreaMax == MaxChild( ResCeilingBelowAttic:Area )) then  Format( "child ResCeilingBelowAttic '%s' of", MaxChildComp( ResCeilingBelowAttic:Area ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 3 RIntClgs"		   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResIntCeiling        ) > 0) then  if (SurfaceAreaMax == MaxChild( ResIntCeiling:Area        )) then  Format(        "child ResIntCeiling '%s' of", MaxChildComp( ResIntCeiling:Area        ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 4 RExtWalls"		   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResExtWall           ) > 0) then  if (SurfaceAreaMax == MaxChild( ResExtWall:Area           )) then  Format(           "child ResExtWall '%s' of", MaxChildComp( ResExtWall:Area           ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 5 RIntWalls"		   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResIntWall           ) > 0) then  if (SurfaceAreaMax == MaxChild( ResIntWall:Area           )) then  Format(           "child ResIntWall '%s' of", MaxChildComp( ResIntWall:Area           ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 6 RUndWalls"		   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResUndgrWall         ) > 0) then  if (SurfaceAreaMax == MaxChild( ResUndgrWall:Area         )) then  Format(         "child ResUndgrWall '%s' of", MaxChildComp( ResUndgrWall:Area         ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 7 RSlabFlrs"		   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResSlabFlr           ) > 0) then  if (SurfaceAreaMax == MaxChild( ResSlabFlr:Area           )) then  Format(           "child ResSlabFlr '%s' of", MaxChildComp( ResSlabFlr:Area           ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 8 RIntFlrs"		   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResIntFlr            ) > 0) then  if (SurfaceAreaMax == MaxChild( ResIntFlr:Area            )) then  Format(            "child ResIntFlr '%s' of", MaxChildComp( ResIntFlr:Area            ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 9 RExtFlrs"		   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResExtFlr            ) > 0) then  if (SurfaceAreaMax == MaxChild( ResExtFlr:Area            )) then  Format(            "child ResExtFlr '%s' of", MaxChildComp( ResExtFlr:Area            ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 10 RUndFlrs"		   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResUndgrFlr          ) > 0) then  if (SurfaceAreaMax == MaxChild( ResUndgrFlr:Area          )) then  Format(          "child ResUndgrFlr '%s' of", MaxChildComp( ResUndgrFlr:Area          ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 11 RFlrsOvrCrwl"	   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. ChildCount( ResFlrOverCrawlSpc   ) > 0) then  if (SurfaceAreaMax == MaxChild( ResFlrOverCrawlSpc:Area   )) then  Format(   "child ResFlrOverCrawlSpc '%s' of", MaxChildComp( ResFlrOverCrawlSpc:Area   ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 12 adj RIntWalls"   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( ResIntWall:Outside,    ResIntWall:Area    ) > 0) then  if (SurfaceAreaMax == MaxRevRef( ResIntWall:Outside,    ResIntWall:Area    )) then  Format(    "adjacent ResIntWall '%s' to", MaxRevRefComp( ResIntWall:Outside,    ResIntWall:Area    ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 13 adj RIntClgs"	   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( ResIntCeiling:Outside, ResIntCeiling:Area ) > 0) then  if (SurfaceAreaMax == MaxRevRef( ResIntCeiling:Outside, ResIntCeiling:Area )) then  Format( "adjacent ResIntCeiling '%s' to", MaxRevRefComp( ResIntCeiling:Outside, ResIntCeiling:Area ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 14 adj RIntFlrs"	   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( ResIntFlr:Outside,     ResIntFlr:Area     ) > 0) then  if (SurfaceAreaMax == MaxRevRef( ResIntFlr:Outside,     ResIntFlr:Area     )) then  Format(     "adjacent ResIntFlr '%s' to", MaxRevRefComp( ResIntFlr:Outside,     ResIntFlr:Area     ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 15 adj Ceiling"     ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area      ) > 0) then  if (SurfaceAreaMax == MaxRevRef( Ceiling:AdjacentSpcRef, Ceiling:Area      )) then  Format(       "adjacent Ceiling '%s' to", MaxRevRefComp( Ceiling:AdjacentSpcRef, Ceiling:Area      ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 16 adj IntFlr"	   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( IntFlr:AdjacentSpcRef,  IntFlr:Area       ) > 0) then  if (SurfaceAreaMax == MaxRevRef( IntFlr:AdjacentSpcRef,  IntFlr:Area       )) then  Format(        "adjacent IntFlr '%s' to", MaxRevRefComp( IntFlr:AdjacentSpcRef,  IntFlr:Area       ) )  else UNCHANGED endif  else UNCHANGED endif  }
   "Set ResOtherZn:SurfaceAreaMaxComp - 17 adj IntWall"	   ResOtherZn:SurfaceAreaMaxComp = {  if (LocalStatus( SurfaceAreaMaxComp ) < 1 .AND. SurfaceAreaMax > 0 .AND. SumRevRef( IntWall:AdjacentSpcRef, IntWall:Area      ) > 0) then  if (SurfaceAreaMax == MaxRevRef( IntWall:AdjacentSpcRef, IntWall:Area      )) then  Format(       "adjacent IntWall '%s' to", MaxRevRefComp( IntWall:AdjacentSpcRef, IntWall:Area      ) )  else UNCHANGED endif  else UNCHANGED endif  }

; MFAM TO DO - need to revise settings in Com rules to include (and simulate) adjacent Com surfaces - SAC 10/27/21

   ; restored and enhanced surface count & area checks - SAC 04/19/23 (tic #3497)  ; added logic to bypass these check when EnableResearchMode is activated - SAC 01/05/24
   ; bypass these checks when automatically generating ZB (zn boundry) int surfaces - SAC 02/01/24
	"Check for sufficient ResZn:SurfaceCount"		ResZn:Action	=
      {  if (IfValidAnd( Proj:EnableResearchMode > 0 ) .OR. ResProj:IntSurfModelMthd > 0) then  UNCHANGED
         else if (SurfaceCount < 3)
         then	PostError( "Residential Zone (ResZn) '%s' has too few child and/or adjacent surfaces (%g, minimum is 3) to be simulated.", Name, SurfaceCount )
         else if (SurfaceAreaMax > (SurfaceAreaSum * 0.4))
         then	if (LocalStatus( SurfaceAreaMaxComp ) > 0)
               then  PostError( "The largest %s residential zone (ResZn) '%s' is too large in relation to the sum of all child/adjacent surface areas (%g > %g (40%% of %g)).", SurfaceAreaMaxComp, Name, SurfaceAreaMax, (SurfaceAreaSum * 0.4), SurfaceAreaSum )
               else  PostError( "The largest child/adjacent surface of residential zone (ResZn) '%s' is too large in relation to the sum of all child/adjacent surface areas (%g > %g (40%% of %g)).", Name, SurfaceAreaMax, (SurfaceAreaSum * 0.4), SurfaceAreaSum )  endif
         else if (BelowMultipliedFlr < 1 .AND. Mult < 1.1 .AND. IfValidAnd( SurfaceAreaTop >= (FloorArea * 0.4) )==0)
         then	PostError( "Residential zone (ResZn) '%s' has too little top/ceiling surface area (%g) - must be at least 40%% of overall zone area (%g).", Name, SurfaceAreaTop, FloorArea )
         else if (AboveMultipliedFlr < 1 .AND. Mult < 1.1 .AND. IfValidAnd( SurfaceAreaTop <= (FloorArea * 2.5) )==0)
         then	PostError( "Residential zone (ResZn) '%s' has too much top/ceiling surface area (%g) - can't be more than 250%% of overall zone area (%g).", Name, SurfaceAreaTop, FloorArea )
         else if (AboveMultipliedFlr < 1 .AND. Mult < 1.1 .AND. IfValidAnd( SurfaceAreaBot >= (FloorArea * 0.4) )==0)
         then	PostError( "Residential zone (ResZn) '%s' has too little bottom/floor surface area (%g) - must be at least 40%% of overall zone area (%g).", Name, SurfaceAreaBot, FloorArea )
         else if (BelowMultipliedFlr < 1 .AND. Mult < 1.1 .AND. IfValidAnd( SurfaceAreaBot <= (FloorArea * 2.5) )==0)
         then	PostError( "Residential zone (ResZn) '%s' has too much bottom/floor surface area (%g) - can't be more than 250%% of overall zone area (%g).", Name, SurfaceAreaBot, FloorArea )
         else	UNCHANGED  endif endif endif endif endif endif endif  }
	"Check for sufficient ResOtherZn:SurfaceCount"	ResOtherZn:Action	=     ; SAC 9/18/19 - (MFamProto)
      {  if (IfValidAnd( Proj:EnableResearchMode > 0 ) .OR. ResProj:IntSurfModelMthd > 0) then  UNCHANGED
         else if (SurfaceCount < 3)
         then	PostError( "Residential OtherZone (ResOtherZn) '%s' has too few child and/or adjacent surfaces (%g, minimum is 3) to be simulated.", Name, SurfaceCount )
         else if (SurfaceAreaMax > (SurfaceAreaSum * 0.4))
         then	if (LocalStatus( SurfaceAreaMaxComp ) > 0)
               then  PostError( "The largest %s residential OtherZone (ResOtherZn) '%s' is too large in relation to the sum of all child/adjacent surface areas (%g > %g (40%% of %g)).", SurfaceAreaMaxComp, Name, SurfaceAreaMax, (SurfaceAreaSum * 0.4), SurfaceAreaSum )
               else  PostError( "The largest child/adjacent surface of residential OtherZone (ResOtherZn) '%s' is too large in relation to the sum of all child/adjacent surface areas (%g > %g (40%% of %g)).", Name, SurfaceAreaMax, (SurfaceAreaSum * 0.4), SurfaceAreaSum )  endif
         else if (BelowMultipliedFlr < 1 .AND. Mult < 1.1 .AND. IfValidAnd( SurfaceAreaTop >= (Area * 0.4) )==0)
         then	PostError( "Residential zone (ResZn) '%s' has too little top/ceiling surface area (%g) - must be at least 40%% of overall zone area (%g).", Name, SurfaceAreaTop, Area )
         else if (AboveMultipliedFlr < 1 .AND. Mult < 1.1 .AND. IfValidAnd( SurfaceAreaTop <= (Area * 2.5) )==0)
         then	PostError( "Residential zone (ResZn) '%s' has too much top/ceiling surface area (%g) - can't be more than 250%% of overall zone area (%g).", Name, SurfaceAreaTop, Area )
         else if (AboveMultipliedFlr < 1 .AND. Mult < 1.1 .AND. IfValidAnd( SurfaceAreaBot >= (Area * 0.4) )==0)
         then	PostError( "Residential zone (ResZn) '%s' has too little bottom/floor surface area (%g) - must be at least 40%% of overall zone area (%g).", Name, SurfaceAreaBot, Area )
         else if (BelowMultipliedFlr < 1 .AND. Mult < 1.1 .AND. IfValidAnd( SurfaceAreaBot <= (Area * 2.5) )==0)
         then	PostError( "Residential zone (ResZn) '%s' has too much bottom/floor surface area (%g) - can't be more than 250%% of overall zone area (%g).", Name, SurfaceAreaBot, Area )
         else	UNCHANGED  endif endif endif endif endif endif endif  }
;	"Check for sufficient ResGarage:SurfaceCount"	ResGarage:Action	= {	if ( ResProj:HasGarage < 0.5) then  UNCHANGED
;																							else if (SurfaceCount < 6)
;																							then	PostError( "Garage '%s' has too few child and/or adjacent surfaces (%g, minimum is 6) to be simulated.", Name, SurfaceCount )
;																							else if (SurfaceAreaMax > (SurfaceAreaSum / 2))
;																							then	PostError( "The largest child/adjacent surface of garage '%s' is too large in relation to the sum of all child/adjacent surface areas (%g > %g).", Name, SurfaceAreaMax, (SurfaceAreaSum / 2) )
;																							else	UNCHANGED  endif endif endif  }
;"store BEMProc details" Proj:Action = {  StoreBEMProc( Format( "%s midModelChks", ResProj:RunAbbrev ), 0 )  }

   "Initialize ResZn:OutsideConnection"         ResZn:OutsideConnection	=           ; SAC 04/19/23 (tic #3497)
      {  if ( (ChildCount( ResCathedralCeiling ) + ChildCount( ResExtWall ) + ChildCount( ResCeilingBelowAttic ) +
               ChildCount( ResFlrOverCrawlSpc  ) + ChildCount( ResExtFlr  )) > 0 ) then  1  else  0  endif  }
   "Initialize ResOtherZn:OutsideConnection"    ResOtherZn:OutsideConnection	=
      {  if ( (ChildCount( ResCathedralCeiling ) + ChildCount( ResExtWall ) + ChildCount( ResCeilingBelowAttic ) +
               ChildCount( ResFlrOverCrawlSpc  ) + ChildCount( ResExtFlr  )) > 0 ) then  1  else  0  endif  }
   "Indirect OutsideConnection #1"     Proj:Action =
      {  if ( (ComponentCount( ResZn      ) > 0 .AND. MinAll( ResZn:OutsideConnection      ) < 1) .OR.
              (ComponentCount( ResOtherZn ) > 0 .AND. MinAll( ResOtherZn:OutsideConnection ) < 1) )
         then  EvalRulelist( "SetIndirectOutsideConnection_First" )  else  UNCHANGED  endif  }
   "Indirect OutsideConnection #2"     Proj:Action =
      {  if ( (ComponentCount( ResZn      ) > 0 .AND. MinAll( ResZn:OutsideConnection      ) < 1) .OR.
              (ComponentCount( ResOtherZn ) > 0 .AND. MinAll( ResOtherZn:OutsideConnection ) < 1) )
         then  EvalRulelist( "SetIndirectOutsideConnection" )  else  UNCHANGED  endif  }
   "Indirect OutsideConnection #3"     Proj:Action =
      {  if ( (ComponentCount( ResZn      ) > 0 .AND. MinAll( ResZn:OutsideConnection      ) < 1) .OR.
              (ComponentCount( ResOtherZn ) > 0 .AND. MinAll( ResOtherZn:OutsideConnection ) < 1) )
         then  EvalRulelist( "SetIndirectOutsideConnection" )  else  UNCHANGED  endif  }
   "Indirect OutsideConnection #4"     Proj:Action =
      {  if ( (ComponentCount( ResZn      ) > 0 .AND. MinAll( ResZn:OutsideConnection      ) < 1) .OR.
              (ComponentCount( ResOtherZn ) > 0 .AND. MinAll( ResOtherZn:OutsideConnection ) < 1) )
         then  EvalRulelist( "SetIndirectOutsideConnection" )  else  UNCHANGED  endif  }
   "Indirect OutsideConnection #5"     Proj:Action =
      {  if ( (ComponentCount( ResZn      ) > 0 .AND. MinAll( ResZn:OutsideConnection      ) < 1) .OR.
              (ComponentCount( ResOtherZn ) > 0 .AND. MinAll( ResOtherZn:OutsideConnection ) < 1) )
         then  EvalRulelist( "SetIndirectOutsideConnection" )  else  UNCHANGED  endif  }
	"Report insufficient ResZn connection to outside"		   ResZn:Action	   =     ; SAC 04/20/23 (tic #3497)   ; allow when generating ZB surfaces (w/ relief vents) - SAC 02/01/24
      {  if (OutsideConnection > 0 .OR. ResProj:IntSurfModelMthd > 0) then  UNCHANGED
         else  PostError( "ResZn '%s' has no connection to the outside (direct through exterior surfaces or indirect through adjacent zones w/ ext surfaces), which is required", Name )  endif  }
	"Report insufficient ResOtherZn connection to outside"   ResOtherZn:Action	=
      {  if (OutsideConnection > 0 .OR. ResProj:IntSurfModelMthd > 0) then  UNCHANGED
         else  PostError( "ResOtherZn '%s' has no connection to the outside (via exterior surfaces of this or adjacent zones), which is required", Name )  endif  }

	"Check consistency between Zone area & the sum of the child DwellUnit areas"		; SAC 6/25/14
		ResZn:Action = {	if ( Proj:IsSFamResRuleset .OR. IfValidAnd( ResProj:ZonalControl > 0.5 ))	then  UNCHANGED
								else if (Type == 10 .AND.  DwellingUnitArea_Cond > 1) then  PostError( "Zone '%s' in Unconditioned but has conditioned dwelling unit assigned area of %s SqFt.", Name, FltToStr( DwellingUnitArea_Cond ) )
								else if (Type  < 10 .AND. (DwellingUnitArea_Cond <= (FloorArea-1) .OR. DwellingUnitArea_Cond >= (FloorArea+1)))
								then	PostError( "There is a mismatch between conditioned area (%s SqFt) and assigned dwelling unit area (%s SqFt) for zone '%s'", FltToStr( FloorArea ), FltToStr( DwellingUnitArea_Cond ), Name )
								else  UNCHANGED  endif endif endif  }
;		"Check for mismatch between zone area & dwelling unit zone assignment & area inputs (no zonal controls)"  ; SAC 7/29/13 - GC issue #137
;				ResZn:Action		= {	if ( Proj:IsSFamResRuleset .OR. IfValidAnd( ResProj:ZonalControl > 0.5 ))	then  UNCHANGED
;											else if (Type == 10 .AND. DwellingUnitArea_Cond > 1) then  PostError( "Zone '%s' in Unconditioned but has conditioned dwelling unit assigned area of %s SqFt.", Name, FltToStr( DwellingUnitArea_Cond ) )
;											else if (Type == 1  .AND. DwellingUnitArea_Cond != FloorArea) then  PostError( "There is a mismatch between conditioned area (%s SqFt) and assigned dwelling unit area (%s SqFt) for zone '%s'", FltToStr( FloorArea ), FltToStr( DwellingUnitArea_Cond ), Name )
;											else  UNCHANGED  endif endif endif  }
;		"Check for mismatch between zone area & dwelling unit zone assignment & area inputs (with zonal controls)"  ; SAC 7/29/13 - GC issue #137
;				ResZn:Action		= {	if ( Proj:IsSFamResRuleset .OR. IfValidAnd( ResProj:ZonalControl < 0.5 ))	then  UNCHANGED
;											else if (Type == 10 .AND. (DwellingUnitArea_Liv > 1 .OR. DwellingUnitArea_Slp > 1)) then  PostError( "Zone '%s' in Unconditioned but has conditioned (living and/or sleeping) dwelling unit assigned area of %s SqFt.", Name, FltToStr( (DwellingUnitArea_Liv + DwellingUnitArea_Slp) ) )
;											else if (Type == 2  .AND.  DwellingUnitArea_Slp > 1) then  PostError( "Living zone '%s' is assigned in dwelling unit screen(s) as a sleeping zone (total of %s SqFt).", Name, FltToStr( DwellingUnitArea_Slp ) )
;											else if (Type == 3  .AND.  DwellingUnitArea_Liv > 1) then  PostError( "Sleeping zone '%s' is assigned in dwelling unit screen(s) as a living zone (total of %s SqFt).", Name, FltToStr( DwellingUnitArea_Liv ) )
;											else if (Type == 2  .AND.  DwellingUnitArea_Liv != FloorArea) then  PostError( "There is a mismatch between living area (%s SqFt) and assigned dwelling unit area (%s SqFt) for zone '%s'", FltToStr( FloorArea ), FltToStr( DwellingUnitArea_Liv ), Name )
;											else if (Type == 3  .AND.  DwellingUnitArea_Slp != FloorArea) then  PostError( "There is a mismatch between sleeping area (%s SqFt) and assigned dwelling unit area (%s SqFt) for zone '%s'", FltToStr( FloorArea ), FltToStr( DwellingUnitArea_Slp ), Name )
;											else  UNCHANGED  endif endif endif endif endif endif  }

	"Check for CrawlSpace objects w/ Type settings that are not yet implemented"  ; SAC 10/17/13 - GC issue #213
			ResCrawlSpc:Action		= {	if (Area < 0.1) then  UNCHANGED
												else if (Type != 0)	; "Normal (vented)"
												then	PostError( "Crawl space type '%s' selected for '%s' is not currently implemented.  This must be changed to 'Normal (vented)' in order to perform the analysis.", EnumString( Type ), Name )
												else  UNCHANGED  endif endif  }


   ; same checks for SFam HVACSys objects
	"Check for valid ResHVACSys:Num*EquipTypes"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else if (Type < 1) then  PostError( "HVACSys '%s' has no HVAC system type specified.", Name )
									else if (Type == 2 .AND. ResProj:BypassRuleLimits < 0.5 .AND. IfValidAnd( NumHtPumpSystemTypes > 0.5 )==0)
									then  PostError( "One or more heat pump equipment assignments must be defined for HVACSys '%s'.", Name )
									else if ((Type == 1 .OR. Type == 3) .AND. ResProj:BypassRuleLimits < 0.5 .AND. IfValidAnd( NumHeatSystemTypes > 0.5 )==0)
									then  PostError( "One or more heating equipment assignments must be defined for HVACSys '%s'.", Name )
									else if ((Type == 1 .OR. Type == 3) .AND. ResProj:BypassRuleLimits < 0.5 .AND. IfValidAnd( NumCoolSystemTypes > 0.5 )==0)
									then  PostError( "One or more cooling equipment assignments must be defined for HVACSys '%s'.", Name )
									else	UNCHANGED  endif endif endif endif endif  }

	"Check for valid HVACSys equip assignments - heat pump #1"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. Type != 2 .OR. IfValidAnd( NumHtPumpSystemTypes >= 1 )==0 .OR. LocalCompAssigned( HtPumpSystem[1] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heat pump #1.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heat pump #2"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. Type != 2 .OR. IfValidAnd( NumHtPumpSystemTypes >= 2 )==0 .OR. LocalCompAssigned( HtPumpSystem[2] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heat pump #2.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heat pump #3"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. Type != 2 .OR. IfValidAnd( NumHtPumpSystemTypes >= 3 )==0 .OR. LocalCompAssigned( HtPumpSystem[3] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heat pump #3.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heat pump #4"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. Type != 2 .OR. IfValidAnd( NumHtPumpSystemTypes >= 4 )==0 .OR. LocalCompAssigned( HtPumpSystem[4] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heat pump #4.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heat pump #5"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. Type != 2 .OR. IfValidAnd( NumHtPumpSystemTypes >= 5 )==0 .OR. LocalCompAssigned( HtPumpSystem[5] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heat pump #5.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heat pump #6"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. Type != 2 .OR. IfValidAnd( NumHtPumpSystemTypes >= 6 )==0 .OR. LocalCompAssigned( HtPumpSystem[6] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heat pump #6.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heat pump #7"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. Type != 2 .OR. IfValidAnd( NumHtPumpSystemTypes >= 7 )==0 .OR. LocalCompAssigned( HtPumpSystem[7] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heat pump #7.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heat pump #8"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. Type != 2 .OR. IfValidAnd( NumHtPumpSystemTypes >= 8 )==0 .OR. LocalCompAssigned( HtPumpSystem[8] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heat pump #8.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heat pump #9"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. Type != 2 .OR. IfValidAnd( NumHtPumpSystemTypes >= 9 )==0 .OR. LocalCompAssigned( HtPumpSystem[9] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heat pump #9.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heat pump #10"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. Type != 2 .OR. IfValidAnd( NumHtPumpSystemTypes >= 10 )==0 .OR. LocalCompAssigned( HtPumpSystem[10] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heat pump #10.", Name )  endif  }

	"Check for valid HVACSys equip assignments - cooling #1"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumCoolSystemTypes >= 1 )==0 .OR. LocalCompAssigned( CoolSystem[1] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for cooling #1.", Name )  endif  }
	"Check for valid HVACSys equip assignments - cooling #2"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumCoolSystemTypes >= 2 )==0 .OR. LocalCompAssigned( CoolSystem[2] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for cooling #2.", Name )  endif  }
	"Check for valid HVACSys equip assignments - cooling #3"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumCoolSystemTypes >= 3 )==0 .OR. LocalCompAssigned( CoolSystem[3] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for cooling #3.", Name )  endif  }
	"Check for valid HVACSys equip assignments - cooling #4"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumCoolSystemTypes >= 4 )==0 .OR. LocalCompAssigned( CoolSystem[4] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for cooling #4.", Name )  endif  }
	"Check for valid HVACSys equip assignments - cooling #5"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumCoolSystemTypes >= 5 )==0 .OR. LocalCompAssigned( CoolSystem[5] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for cooling #5.", Name )  endif  }
	"Check for valid HVACSys equip assignments - cooling #6"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumCoolSystemTypes >= 6 )==0 .OR. LocalCompAssigned( CoolSystem[6] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for cooling #6.", Name )  endif  }
	"Check for valid HVACSys equip assignments - cooling #7"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumCoolSystemTypes >= 7 )==0 .OR. LocalCompAssigned( CoolSystem[7] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for cooling #7.", Name )  endif  }
	"Check for valid HVACSys equip assignments - cooling #8"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumCoolSystemTypes >= 8 )==0 .OR. LocalCompAssigned( CoolSystem[8] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for cooling #8.", Name )  endif  }
	"Check for valid HVACSys equip assignments - cooling #9"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumCoolSystemTypes >= 9 )==0 .OR. LocalCompAssigned( CoolSystem[9] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for cooling #9.", Name )  endif  }
	"Check for valid HVACSys equip assignments - cooling #10"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumCoolSystemTypes >= 10 )==0 .OR. LocalCompAssigned( CoolSystem[10] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for cooling #10.", Name )  endif  }

	"Check for valid HVACSys equip assignments - heating #1"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumHeatSystemTypes >= 1 )==0 .OR. LocalCompAssigned( HeatSystem[1] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heating #1.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heating #2"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumHeatSystemTypes >= 2 )==0 .OR. LocalCompAssigned( HeatSystem[2] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heating #2.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heating #3"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumHeatSystemTypes >= 3 )==0 .OR. LocalCompAssigned( HeatSystem[3] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heating #3.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heating #4"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumHeatSystemTypes >= 4 )==0 .OR. LocalCompAssigned( HeatSystem[4] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heating #4.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heating #5"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumHeatSystemTypes >= 5 )==0 .OR. LocalCompAssigned( HeatSystem[5] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heating #5.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heating #6"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumHeatSystemTypes >= 6 )==0 .OR. LocalCompAssigned( HeatSystem[6] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heating #6.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heating #7"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumHeatSystemTypes >= 7 )==0 .OR. LocalCompAssigned( HeatSystem[7] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heating #7.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heating #8"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumHeatSystemTypes >= 8 )==0 .OR. LocalCompAssigned( HeatSystem[8] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heating #8.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heating #9"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumHeatSystemTypes >= 9 )==0 .OR. LocalCompAssigned( HeatSystem[9] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heating #9.", Name )  endif  }
	"Check for valid HVACSys equip assignments - heating #10"
		ResHVACSys:Action	= {	if ( Proj:IsComRuleset .OR. FloorAreaServed < 1 .OR. (Type != 1 .AND. Type != 3) .OR. IfValidAnd( NumHeatSystemTypes >= 10 )==0 .OR. LocalCompAssigned( HeatSystem[10] ) > 0.5 .OR. ResProj:BypassRuleLimits > 0.5) then  UNCHANGED
									else  PostError( "HVACSys '%s' is lacking an equipment assignment for heating #10.", Name )  endif  }

   "Check for compatible HVACSys heating & cooling equip types (PkgGasFurnace w/ PkgAirCond)"         ResHVACSys:Action =              ; SAC 08/23/20 (tic #1227)
      {  if ( Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
         else if (Type != 2 .AND. HeatSysType == 18 .AND. CoolSysType != 3)
         then  PostError( "HVACSys '%s' has incompatible heating and cooling equip types (%s can only be combined with PkgAirCond - Central packaged A/C system (< 65 kBtuh))", Name, EnumString( HeatSysType ) )
         else  UNCHANGED  endif endif  }
   "Check for compatible DwellUnitType heating & cooling equip types (PkgGasFurnace w/ PkgAirCond)"   DwellUnitType:Action =        ; SAC 08/23/20 (tic #1227)
      {  if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1) then  UNCHANGED
         else if (HVACSysType != 2 .AND. HeatEqpType == 18 .AND. CoolEqpType != 3)
         then  PostError( "DwellUnitType '%s' has incompatible heating and cooling equip types (%s can only be combined with PkgAirCond - Central packaged A/C system (< 65 kBtuh))", Name, EnumString( HeatEqpType ) )
         else  UNCHANGED  endif endif  }

;this rule copied from simulation check so that it is evaluated prior to HVACdist placement.
	"Check for existing DistribSystem not of a ducted type but assigned to an HVAC system requiring ducts (or vice-versa)"
		ResHVACSys:Action	= {	if (strlen( DuctMsg ) < 3) then  UNCHANGED
									else if (HtOrClDucted > 0.5 .AND. LocalCompAssigned( DistribSystem ) == 0)
									then	switch (HtOrClDucted)
												case  1 : PostError( "Ducts required for heating system but not defined for HVAC system '%s' (%s)", Name, EnumString( Type ) )
												case  2 : PostError( "Ducts required for cooling system but not defined for HVAC system '%s' (%s)", Name, EnumString( Type ) )
												default : PostError( "Ducts required for heating & cooling systems but not defined for HVAC system '%s' (%s)", Name, EnumString( Type ) )
											endswitch
									else if (HtOrClDucted > 0.5 .AND. DistribSystem:DuctsPresent == 0 .AND. DistribSystem:Type != 7 .AND. DistribSystem:Type != 12)
									then	switch (HtOrClDucted)
												case  1 : PostError( "Ducts required for heating system but assigned distribution system lacks ducts for HVAC system '%s' (%s)", Name, EnumString( Type ) )
												case  2 : PostError( "Ducts required for cooling system but assigned distribution system lacks ducts for HVAC system '%s' (%s)", Name, EnumString( Type ) )
												default : PostError( "Ducts required for htg & clg systems but assigned distribution system lacks ducts for HVAC system '%s' (%s)", Name, EnumString( Type ) )
											endswitch
									else if (HtOrClDucted < 0.5 .AND. LocalCompAssigned( DistribSystem ) > 0)
									then	if (DistribSystem:DuctsPresent > 0)
											then  PostError( "Ducts not required for heating or cooling but included in assigned distribution system for HVAC system '%s' (%s)", Name, EnumString( Type ) )
											else  UNCHANGED  endif
									else  UNCHANGED  endif endif endif endif  }

; SAC 11/14/14 - added checks to ensure that heating & cooling equipment types and counts are consistent w/ each other for all centrally ducted systems
      ; SAC 7/17/19 - cleaned up logic and wrapped EqpCountsMustAlign in IfValidAnd() checks to prevent eval errors
	"Check for consistent Num*EquipTypes for centrally ducted heat/cool systems"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset) then  UNCHANGED
		                           else if (IfValidAnd( NumHeatEquipTypes != NumCoolEquipTypes ) .AND. IfValidAnd( EqpCountsMustAlign > 0 ) .AND. AssignedDUFlrArea > 0)
											then	PostError( "Centrally ducted HVAC system serving DwellUnitType '%s' must have consistent numbers of heating and cooling unit types (%.0f <> %.0f).", Name, NumHeatEquipTypes, NumCoolEquipTypes )
											else  UNCHANGED  endif endif  }
	"Check for consistent Counts for heat/cool unit type #1 (for centrally ducted heat/cool systems)"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset) then  UNCHANGED
		                           else if (IfValidAnd( NumHeatEquipTypes >= 1 )==0 .OR. IfValidAnd( NumCoolEquipTypes >= 1 )==0 .OR. IfValidAnd( HeatEquipCount[1] = CoolEquipCount[1] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. AssignedDUFlrArea < 1) then  UNCHANGED
											else	PostError( "Centrally ducted HVAC system serving DwellUnitType '%s' must have consistent counts of heating and cooling unit type #1 (%.0f <> %.0f).", Name, HeatEquipCount[1], CoolEquipCount[1] )  endif endif  }
	"Check for consistent Counts for heat/cool unit type #2 (for centrally ducted heat/cool systems)"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset) then  UNCHANGED
		                           else if (IfValidAnd( NumHeatEquipTypes >= 2 )==0 .OR. IfValidAnd( NumCoolEquipTypes >= 2 )==0 .OR. IfValidAnd( HeatEquipCount[2] = CoolEquipCount[2] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. AssignedDUFlrArea < 1) then  UNCHANGED
											else	PostError( "Centrally ducted HVAC system serving DwellUnitType '%s' must have consistent counts of heating and cooling unit type #2 (%.0f <> %.0f).", Name, HeatEquipCount[2], CoolEquipCount[2] )  endif endif  }
	"Check for consistent Counts for heat/cool unit type #3 (for centrally ducted heat/cool systems)"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset) then  UNCHANGED
		                           else if (IfValidAnd( NumHeatEquipTypes >= 3 )==0 .OR. IfValidAnd( NumCoolEquipTypes >= 3 )==0 .OR. IfValidAnd( HeatEquipCount[3] = CoolEquipCount[3] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. AssignedDUFlrArea < 1) then  UNCHANGED
											else	PostError( "Centrally ducted HVAC system serving DwellUnitType '%s' must have consistent counts of heating and cooling unit type #3 (%.0f <> %.0f).", Name, HeatEquipCount[3], CoolEquipCount[3] )  endif endif  }
	"Check for consistent Counts for heat/cool unit type #4 (for centrally ducted heat/cool systems)"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset) then  UNCHANGED
		                           else if (IfValidAnd( NumHeatEquipTypes >= 4 )==0 .OR. IfValidAnd( NumCoolEquipTypes >= 4 )==0 .OR. IfValidAnd( HeatEquipCount[4] = CoolEquipCount[4] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. AssignedDUFlrArea < 1) then  UNCHANGED
											else	PostError( "Centrally ducted HVAC system serving DwellUnitType '%s' must have consistent counts of heating and cooling unit type #4 (%.0f <> %.0f).", Name, HeatEquipCount[4], CoolEquipCount[4] )  endif endif  }
	"Check for consistent Counts for heat/cool unit type #5 (for centrally ducted heat/cool systems)"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset) then  UNCHANGED
		                           else if (IfValidAnd( NumHeatEquipTypes >= 5 )==0 .OR. IfValidAnd( NumCoolEquipTypes >= 5 )==0 .OR. IfValidAnd( HeatEquipCount[5] = CoolEquipCount[5] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. AssignedDUFlrArea < 1) then  UNCHANGED
											else	PostError( "Centrally ducted HVAC system serving DwellUnitType '%s' must have consistent counts of heating and cooling unit type #5 (%.0f <> %.0f).", Name, HeatEquipCount[5], CoolEquipCount[5] )  endif endif  }

; SAC 11/14/14 - added checks to ensure that heating & cooling equipment types and counts are consistent w/ each other for all centrally ducted systems
	"Check for consistent Num*SystemTypes for centrally ducted heat/cool systems"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes = NumCoolSystemTypes ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent numbers of heating and cooling unit types (%.0f <> %.0f).", Name, NumHeatSystemTypes, NumCoolSystemTypes )  endif  }
	"Check for consistent Counts for heat/cool unit type #1 (for centrally ducted heat/cool systems)"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes >= 1 )==0 .OR. IfValidAnd( NumCoolSystemTypes >= 1 )==0 .OR. IfValidAnd( HeatSystemCount[1] = CoolSystemCount[1] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent counts of heating and cooling unit type #1 (%.0f <> %.0f).", Name, HeatSystemCount[1], CoolSystemCount[1] )  endif  }
	"Check for consistent Counts for heat/cool unit type #2 (for centrally ducted heat/cool systems)"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes >= 2 )==0 .OR. IfValidAnd( NumCoolSystemTypes >= 2 )==0 .OR. IfValidAnd( HeatSystemCount[2] = CoolSystemCount[2] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent counts of heating and cooling unit type #2 (%.0f <> %.0f).", Name, HeatSystemCount[2], CoolSystemCount[2] )  endif  }
	"Check for consistent Counts for heat/cool unit type #3 (for centrally ducted heat/cool systems)"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes >= 3 )==0 .OR. IfValidAnd( NumCoolSystemTypes >= 3 )==0 .OR. IfValidAnd( HeatSystemCount[3] = CoolSystemCount[3] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent counts of heating and cooling unit type #3 (%.0f <> %.0f).", Name, HeatSystemCount[3], CoolSystemCount[3] )  endif  }
	"Check for consistent Counts for heat/cool unit type #4 (for centrally ducted heat/cool systems)"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes >= 4 )==0 .OR. IfValidAnd( NumCoolSystemTypes >= 4 )==0 .OR. IfValidAnd( HeatSystemCount[4] = CoolSystemCount[4] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent counts of heating and cooling unit type #4 (%.0f <> %.0f).", Name, HeatSystemCount[4], CoolSystemCount[4] )  endif  }
	"Check for consistent Counts for heat/cool unit type #5 (for centrally ducted heat/cool systems)"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes >= 5 )==0 .OR. IfValidAnd( NumCoolSystemTypes >= 5 )==0 .OR. IfValidAnd( HeatSystemCount[5] = CoolSystemCount[5] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent counts of heating and cooling unit type #5 (%.0f <> %.0f).", Name, HeatSystemCount[5], CoolSystemCount[5] )  endif  }
	"Check for consistent Counts for heat/cool unit type #6 (for centrally ducted heat/cool systems)"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes >= 6 )==0 .OR. IfValidAnd( NumCoolSystemTypes >= 6 )==0 .OR. IfValidAnd( HeatSystemCount[6] = CoolSystemCount[6] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent counts of heating and cooling unit type #6 (%.0f <> %.0f).", Name, HeatSystemCount[6], CoolSystemCount[6] )  endif  }
	"Check for consistent Counts for heat/cool unit type #7 (for centrally ducted heat/cool systems)"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes >= 7 )==0 .OR. IfValidAnd( NumCoolSystemTypes >= 7 )==0 .OR. IfValidAnd( HeatSystemCount[7] = CoolSystemCount[7] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent counts of heating and cooling unit type #7 (%.0f <> %.0f).", Name, HeatSystemCount[7], CoolSystemCount[7] )  endif  }
	"Check for consistent Counts for heat/cool unit type #8 (for centrally ducted heat/cool systems)"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes >= 8 )==0 .OR. IfValidAnd( NumCoolSystemTypes >= 8 )==0 .OR. IfValidAnd( HeatSystemCount[8] = CoolSystemCount[8] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent counts of heating and cooling unit type #8 (%.0f <> %.0f).", Name, HeatSystemCount[8], CoolSystemCount[8] )  endif  }
	"Check for consistent Counts for heat/cool unit type #9 (for centrally ducted heat/cool systems)"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes >= 9 )==0 .OR. IfValidAnd( NumCoolSystemTypes >= 9 )==0 .OR. IfValidAnd( HeatSystemCount[9] = CoolSystemCount[9] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent counts of heating and cooling unit type #9 (%.0f <> %.0f).", Name, HeatSystemCount[9], CoolSystemCount[9] )  endif  }
	"Check for consistent Counts for heat/cool unit type #10 (for centrally ducted heat/cool systems)"
		ResHVACSys:Action	= {	if (IfValidAnd( NumHeatSystemTypes >= 10 )==0 .OR. IfValidAnd( NumCoolSystemTypes >= 10 )==0 .OR. IfValidAnd( HeatSystemCount[10] = CoolSystemCount[10] ) .OR. IfValidAnd( EqpCountsMustAlign > 0 )==0 .OR. Proj:IsComRuleset .OR. FloorAreaServed < 1) then  UNCHANGED
									else	PostError( "Centrally ducted HVAC system '%s' must have consistent counts of heating and cooling unit type #10 (%.0f <> %.0f).", Name, HeatSystemCount[10], CoolSystemCount[10] )  endif  }


	; SAC 11/14/13 - added check for heat pumps including valid capacities     ; SAC 9/22/17 - enable HP autosizing    ; VCHP2 - SAC 11/01/20
;	"debug HP CAP check"									ResHtPumpSys:Action	= {	PostWarning( "HVACHtPump '%s' Type = %g  Cap47 = %g  Cap47 = %g", Name, Type, Cap47, Cap17 )	}
	"Check for valid HVACHtPump capacities"		ResHtPumpSys:Action	= {	if (FloorAreaServed < 0.1 .OR. IfValidAnd( AutoSize > 0 )) then  UNCHANGED
																								else if (Type == 22 .OR. IsPackaged > 0 .OR. Type == 7)              ; SAC 11/2/18 - VCHP    ; SAC 6/24/20 - PTHP systems    ; RoomHP - SAC 09/01/20
																								then  if (IfValidAnd(Cap47 > 0.1)==0)   ; SAC 11/13/18 - removed check on Cap17
																								      then	PostError( "Heat pump '%s' must have valid Cap47 input in order to be simulated.", Name )
																								      else  UNCHANGED  endif
																								else  if (LocalStatus( Cap47 ) < 1 .OR. (LocalStatus( Cap17 ) < 1 .AND. (Type < 12 .OR. Type == 33)))
																								      then	PostError( "Heat pump '%s' must have valid Cap47 & Cap17 inputs in order to be simulated.", Name )
																								      else if (IfValidAnd(Cap47 > 0.1) .AND. (IfValidAnd(Cap17 > 0.1) .OR. Type == 12)) then  UNCHANGED
																								      else	PostError( "Heat pump '%s' must have valid Cap47 & Cap17 inputs in order to be simulated.", Name )
																								      endif endif
																								endif endif  }

   "Check for all required Capacity & COP inputs for VCHP2 systems"     ResHtPumpSys:Action =        ; VCHP2 - SAC 07/26/21   ; SAC 09/23/21
      {  if (FloorAreaServed < 0.1 .OR. Type != 33 .OR.
             IfValidAnd( PerfDetailsError > 0 )==0) then  UNCHANGED
         else if (LocalStatus( PerfDetailsErrMsg ) > 0)
         then  if (strlen( PerfDetailsErrMsg ) > 0)
               then  PostError( "Heat pump '%s' error:  %s", Name, PerfDetailsErrMsg )
               else  UNCHANGED  endif
         else  UNCHANGED  endif endif  }

; TO DO - ResZn HVACSys check for new 2022 models - SAC 05/18/22
	"Check for all conditioned zones having valid assignments of HVAC Systems w/ valid Heating systems"  ; SAC 6/7/13 - per GC issue #103
		ResZn:Action			= {	if (IfValidAnd( Proj:IsComRuleset > 0 )) then  UNCHANGED
                              else if (Type < 0.5 .OR. Type > 9.5) then  UNCHANGED
										else if (LocalCompAssigned( ActiveHVACSystem ) == 0)
										then	PostError( "Zone '%s' is a conditioned zone that must have a valid HVAC system assigned in order to be simulated.", Name )
										else if (LocalStatus( ActiveHVACSystem:Type ) == 0)
										then	PostError( "HVAC system '%s' assigned to zone '%s' must specify a valid system Type in order to be simulated.", ActiveHVACSystem:Name, Name )
										else if (ActiveHVACSystem:Type == 2)
										then	if (ActiveHVACSystem:HaveHeating == 0)
												then	PostError( "HVAC system '%s' assigned to zone '%s' must include a valid heat pump component in order to be simulated.", ActiveHVACSystem:Name, Name )
												else if (ActiveHVACSystem:HtPumpSystem:Type < 0.5)
												then	PostError( "Heat pump component '%s' of HVAC system '%s' assigned to zone '%s' must be of a valid type in order to be simulated.", ActiveHVACSystem:HtPumpSystem:Name, ActiveHVACSystem:Name, Name )
												else  UNCHANGED  endif endif
										else if (ActiveHVACSystem:Type == 1 .OR. (ActiveHVACSystem:Type == 3 .AND. ResProj:EnableVarFlowOAV > 0.5))  ; SAC 10/3/13 - reporting Type = 3 not available above - was:  .OR. HVACSystem:Type == 3)
										then 	if (LocalCompAssigned( ActiveHVACSystem:HeatSystem ) == 0)
												then	PostError( "HVAC system '%s' assigned to zone '%s' must include a valid heating component in order to be simulated.", ActiveHVACSystem:Name, Name )
												else if (ActiveHVACSystem:HeatSystem:Type < 0.5)
												then	PostError( "Heating component '%s' of HVAC system '%s' assigned to zone '%s' must be of a valid type in order to be simulated.", ActiveHVACSystem:HeatSystem:Name, ActiveHVACSystem:Name, Name )
												else  UNCHANGED  endif endif
										else	PostError( "HVAC system '%s' assigned to zone '%s' cannot be simulated due to a unrecognized system type (%.0f).", ActiveHVACSystem:Name, Name, ActiveHVACSystem:Type )
										endif endif endif endif endif endif  }

; "Dbg-1"		ResHVACSys:Action	= {	MessageBox( "ResProj:RunScope = %g  Fan:Status = %g", ResProj:RunScope, Fan:Status )  }

   ; SAC 12/2/16 - revised check to improve label (use system name and list offending fan name @ end) and prevent check on HVACSys objects not assigned to any zones
   ; SAC 7/31/17 - added logic to prevent error for 2019+ rulesets (as fan efficacy a prescriptive, not mandatory limit) (tic #815)
   ; added logic to prevent errors for 2022+ model where Large HtPump Fan power is as high as 0.58 W/CFM - SAC 03/15/21 (tic #1268)
   ; altered checks to be performed on HVACSys for SFam and DwellUnitType for MFam - plus correct invalid fan power check thru use of MaxFanPower properties - SAC 04/08/21 (tic #1268)
   "Set DwellUnitType:MaxFanPower in MFam models"     DwellUnitType:MaxFanPower =
      {  if ( Proj:IsSFamResRuleset .OR. IfValidAnd( DUFloorAreaServed > 0.1 )==0 .OR. LocalCompAssigned( HVACFanRef ) == 0 .OR. ResProj:BypassRuleLimits > 0.5 .OR.
              ( ResProj:RunScope == 2 .AND. HVACFanRef:Status == 2 .AND. HVACFanRef:IsVerified) .OR. (( ResProj:RunScope == 2 .OR. ResProj:IsAddAlone > 0) .AND. HVACFanRef:Status == 1) ) then  UNDEFINED
         else if (HVACFanRef:Type == 1 .AND. DUSDHVFlrAreaServed == DUFloorAreaServed)
         then  T24RClimateZoneCodeBase:SDHVWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )
         else if (HVACFanRef:Type == 1 .AND. DUSDHVFlrAreaServed != DUFloorAreaServed .AND. DUGasFurnAreaServed == DUFloorAreaServed)
         then  T24RClimateZoneCodeBase:GFurnWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )
         else if (HVACFanRef:Type == 1  .AND. DUSDHVFlrAreaServed != DUFloorAreaServed .AND. DUGasFurnAreaServed != DUFloorAreaServed)
         then  if (IfValidAnd( Proj:AnalysisVersion >= 220000 ))
               then  0.58     ; lookup table doesn't represent mandatory max for heat pump systems in 2022+
               else  T24RClimateZoneCodeBase:WperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )
               endif
         else  UNDEFINED  endif endif endif endif  }
   ; revised to prevent throwing DU fan power too high error when served HVAC all Existing - SAC 06/29/23 (tic #3479)
	"Check for mandatory minimum fan system efficacy (ACM 2.2.12) - MFam models"     DwellUnitType:Action	= 
		{	if (IfValidAnd( MaxFanPower > 0 )==0 .OR. IfValidAnd( HVACFanRef:WperCFMCool <= MaxFanPower ) .OR.
             IfValidAnd( DUNewOrAltHVACFlrAreaServed > 0.5 )==0 ) then  UNCHANGED
			else if (DUSDHVFlrAreaServed == DUFloorAreaServed)
         then	PostError( "Fan '%s' assigned to DwellUnitType '%s' has fan efficacy of %g W/CFM which is higher than the mandatory maximum of %g for SDHV system (run %s).", HVACFanRef:name, Name, HVACFanRef:WperCFMCool, MaxFanPower, ResProj:RunAbbrev )
			else if (DUSDHVFlrAreaServed != DUFloorAreaServed .AND. DUGasFurnAreaServed == DUFloorAreaServed)
			then  PostError( "Fan '%s' assigned to DwellUnitType '%s' has fan efficacy of %g W/CFM which is higher than the mandatory maximum of %g for gas furnace air-handling unit (run %s).", HVACFanRef:name, Name, HVACFanRef:WperCFMCool, MaxFanPower, ResProj:RunAbbrev )
			else if (DUSDHVFlrAreaServed != DUFloorAreaServed .AND. DUGasFurnAreaServed != DUFloorAreaServed)
			then  PostError( "Fan '%s' assigned to DwellUnitType '%s' has fan efficacy of %g W/CFM which is higher than the mandatory maximum of %g (run %s).", HVACFanRef:name, Name, HVACFanRef:WperCFMCool, MaxFanPower, ResProj:RunAbbrev )
         else  UNCHANGED  endif endif  endif endif}
   "Set ResHVACSys:MaxFanPower in SFam models"           ResHVACSys:MaxFanPower =
      {  if ( ( Proj:IsComRuleset .AND. ComponentCount( OtherZone ) < 1) .OR. FloorAreaServed[1] < 0.1 .OR. LocalCompAssigned( Fan ) == 0 .OR. ResProj:BypassRuleLimits > 0.5 .OR.
              ( ResProj:RunScope == 2 .AND. Fan:Status == 2 .AND. Fan:IsVerified) .OR. (( ResProj:RunScope == 2 .OR. ResProj:IsAddAlone > 0) .AND. Fan:Status == 1) ) then  UNDEFINED
         else if (Fan:Type == 1 .AND. SDHVAreaServed == FloorAreaServed[1])
         then  T24RClimateZoneCodeBase:SDHVWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )
         else if (Fan:Type == 1 .AND. SDHVAreaServed != FloorAreaServed[1] .AND. GasFurnAreaServed == FloorAreaServed[1])
         then  T24RClimateZoneCodeBase:GFurnWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )
         else if (Fan:Type == 1  .AND. SDHVAreaServed != FloorAreaServed[1] .AND. GasFurnAreaServed != FloorAreaServed[1])
         then  if (IfValidAnd( Proj:AnalysisVersion >= 220000 ))
               then  0.58     ; lookup table doesn't represent mandatory max for heat pump systems in 2022+
               else  T24RClimateZoneCodeBase:WperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )
               endif
         else  UNDEFINED  endif endif endif endif  }
	"Check for mandatory minimum fan system efficacy (ACM 2.2.12) - SFam models"     ResHVACSys:Action	= 
		{	if (IfValidAnd( MaxFanPower > 0 )==0 .OR. IfValidAnd( Fan:WperCFMCool <= MaxFanPower )) then  UNCHANGED
			else if (SDHVAreaServed == FloorAreaServed[1])
         then	PostError( "Fan '%s' assigned to HVAC system '%s' has fan efficacy of %g W/CFM which is higher than the mandatory maximum of %g for SDHV system (run %s).", Fan:name, Name, Fan:WperCFMCool, MaxFanPower, ResProj:RunAbbrev )
			else if (SDHVAreaServed != FloorAreaServed[1] .AND. GasFurnAreaServed == FloorAreaServed[1])
			then  PostError( "Fan '%s' assigned to HVAC system '%s' has fan efficacy of %g W/CFM which is higher than the mandatory maximum of %g for gas furnace air-handling unit (run %s).", Fan:name, Name, Fan:WperCFMCool, MaxFanPower, ResProj:RunAbbrev )
			else if (SDHVAreaServed != FloorAreaServed[1] .AND. GasFurnAreaServed != FloorAreaServed[1])
			then  PostError( "Fan '%s' assigned to HVAC system '%s' has fan efficacy of %g W/CFM which is higher than the mandatory maximum of %g (run %s).", Fan:name, Name, Fan:WperCFMCool, MaxFanPower, ResProj:RunAbbrev )
         else  UNCHANGED  endif endif  endif endif}

   ; SAC 2/11/19 - revised range check & message for ResClgSys:CFMperTon to allow a min 250 CFM/ton for SDHV systems (tic #1041)
	"Check for mandatory minimum HVACCool system airflow"    ResClgSys:Action	=
	   ; SAC 12/23/13 - added improved defaulting of ResClgSys:FloorAreaServed and revised logic enable this rule to be evaluated on each HVACCool object rather than each HVACSys (which was causing GC issue #249)
	{  if ( FloorAreaServed < 0.1 .OR. ResProj:RunScope != 1 .OR. Type < 2 .OR. Type == 5 .OR. Type == 16 .OR. Type == 20 .OR. Type == 21 .OR. ResProj:BypassRuleLimits > 0.5) then UNCHANGED
		else if ( IfValidAnd( IsZonal < 1 ) )
		then  if ( Type == 18 .AND. IfValidAnd( CFMperTon < 250 ) )
      		then PostError( "SDHV Cooling System '%s' has airflow of %g CFM/Ton which is less than the mandatory minimum of 250 for non-zonal, SDHV systems", Name, CFMperTon )
		      else if ( Type != 18 .AND. IfValidAnd( CFMperTon < 350 ) )
      		then PostError( "Cooling System '%s' has airflow of %g CFM/Ton which is less than the mandatory minimum of 350 for non-zonal systems", Name, CFMperTon )
      		else  UNCHANGED  endif endif
		else if ( IfValidAnd( IsZonal > 0 ) .AND. IfValidAnd( CFMperTon < 150 ) )
		then PostError( "Cooling System '%s' has airflow of %g CFM/Ton which is less than the mandatory minimum of 150 for zonal systems", Name, CFMperTon )
		else  UNCHANGED  endif endif endif  }

   ; SAC 2/11/19 - revised range check & message for ResHtPumpSys:CFMperTon to allow a min 250 CFM/ton for SDHV systems (tic #1041)
	"Check for mandatory minimum HVACHtPump system airflow"     ResHtPumpSys:Action	= {
		if ( FloorAreaServed < 0.1 .OR. ResProj:RunScope != 1 .OR. Type < 1 .OR. Type == 7 .OR. Type == 10 .OR. Type == 11 .OR. Type == 20 .OR. Type == 21 .OR. ResProj:BypassRuleLimits > 0.5) then UNCHANGED
		else if ( IfValidAnd( IsZonal < 1 ) )
		then  if ( Type == 19 .AND. IfValidAnd( CFMperTon < 250 ) )
      		then PostError( "SDHV Heat Pump System '%s' has airflow of %g CFM/Ton which is less than the mandatory minimum of 250 for non-zonal, SDHV systems", Name, CFMperTon )
		      else if ( Type != 19 .AND. IfValidAnd( CFMperTon < 350 ) ) 
      		then PostError( "Heat Pump System '%s' has airflow of %g CFM/Ton which is less than the mandatory minimum of 350 for non-zonal systems", Name, CFMperTon )
      		else  UNCHANGED  endif endif
		else if ( IfValidAnd( IsZonal > 0 ) .AND. IfValidAnd( CFMperTon < 150 ) ) 
		then PostError( "Heat Pump System '%s' has airflow of %g CFM/Ton which is less than the mandatory minimum of 150 for zonal systems", Name, CFMperTon )
		else  UNCHANGED  endif endif endif  }

	"Check for RoomHeatPump having valid HeatPower"       ResHtPumpSys:Action	=     ; SAC 08/20/20 (tic #1003)
      {  if ( FloorAreaServed < 0.1 .OR. Type != 7 .OR.
              IfValidAnd( HeatPower > 0 ) .OR. ResProj:BypassRuleLimits > 0.5 ) then UNCHANGED
         else  PostError( "Room Heat Pump '%s' must have heating power > 0 specified", Name )  endif  }

  ; SAC 1/6/14 - added checks for water heaters assigned to each combined hydronic system AND that each such assignment is valid
  ; SAC 1/6/16 - removed check preventing elec equipment from serving as combined hydronic heat source (tic 374)
	"Check for proper ResWtrHtr: for each assignment as a combined hydronic system"
		ResHtgSys:Action	= {	if (FloorAreaServed < 0.1 .OR. Type < 1 .OR. Type != 9) then  UNCHANGED
										else if (LocalCompAssigned( CHWHeater ) < 0.5) then  PostError( "Combined hydronic heating system '%s' must include a valid water heater assginment.", Name )
								;		else if (      CHWHeater:CanBeCHWHeater < 0.5) then  PostError( "The water heater '%s' assigned to combined hydronic heating system '%s' cannot be electric powered.", CHWHeater:Name, Name )
										else  UNCHANGED  endif endif  }  ; endif  }

; "store BEMProc details"		ResProj:Action = {  StoreBEMProc( "b4 InterCondZnArea chk", 0 )  }
; "Dbg-1"	ResProj:Action	= {	MessageBox( "SumAll( ResZn:CondFloorArea ) = %g  //  MaxAll( ResZn:CondFloorArea ) = %g", SumAll( ResZn:CondFloorArea ), MaxAll( ResZn:CondFloorArea ) )  }

; SAC 5/6/18 - remove requirement of a common surface between conditioned zones (tic #1006)
;	"Check for at least some inter-conditioned zone surface area (when multiple conditioned zones are present)"
;		ResZn:Action		= {	if (Type < 10 .AND. InterCondZnArea < 1 .AND. ComponentCount( Zone ) > 1.5)
;									then	if (SumAll( ResZn:CondFloorArea ) > (MaxAll( ResZn:CondFloorArea )+1))
;											then	PostError( "Zone '%s' has no common surface with another conditioned zone (each conditioned zone must be at least one)", Name )
;											else  UNCHANGED  endif
;									else  UNCHANGED  endif  }

	"Check for consistent altered/existing HVAC system types when HVAC altered & verified"
		ResZn:Action		= {	if ( ResProj:RunScope != 2 .OR. HVACSysStatus != 2 .OR. HVACSysVerified == 0 .OR.
											LocalCompAssigned( AltHVACSystem ) == 0 .OR. LocalCompAssigned( exHVACSystem ) == 0) then  UNCHANGED
									else if (AltHVACSystem:Type != exHVACSystem:Type)
									then	PostError( "Zone '%s' has incompatible altered and existing HVAC system assignments.  To get compliance credit, altered and verified system types must be consistent.", Name )
									else if (AltHVACSystem:Type == 2)
									then	; heat pump system
											if (	T24RHeatingEquipment:HSPFValid( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", AltHVACSystem:HtPumpSysTypeAbbrev ) > 0 .AND. 
													T24RHeatingEquipment:HSPFValid( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType",  exHVACSystem:HtPumpSysTypeAbbrev ) < 1)
											then	PostError( "Zone '%s' has incompatible altered and existing heating systems.  Altered system uses HSPF/HSPF2 and existing does not.  To get compliance credit, altered and verified heating system types must be consistent.", Name )
											else if (T24RCoolingEquipment:SEERValid( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", AltHVACSystem:HtPumpSysTypeAbbrev ) > 0 .AND. 
														T24RCoolingEquipment:SEERValid( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType",  exHVACSystem:HtPumpSysTypeAbbrev ) < 1)
											then	PostError( "Zone '%s' has incompatible altered and existing cooling systems.  Altered system uses SEER/SEER2 and existing does not.  To get compliance credit, altered and verified cooling system types must be consistent.", Name )
											else if (T24RCoolingEquipment:EERValid(  "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", AltHVACSystem:HtPumpSysTypeAbbrev ) > 0 .AND. 
														T24RCoolingEquipment:EERValid(  "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType",  exHVACSystem:HtPumpSysTypeAbbrev ) < 1)
											then	PostError( "Zone '%s' has incompatible altered and existing cooling systems.  Altered system uses EER/EER2 and existing does not.  To get compliance credit, altered and verified cooling system types must be consistent.", Name )
											else  UNCHANGED  endif endif endif
									else
											if (T24RHeatingEquipment:AFUEValid( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", AltHVACSystem:HeatSysTypeAbbrev ) > 0 .AND. 
														T24RHeatingEquipment:AFUEValid( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType",  exHVACSystem:HeatSysTypeAbbrev ) < 1)
											then	PostError( "Zone '%s' has incompatible altered and existing heating systems.  Altered system uses AFUE and existing does not.  To get compliance credit, altered and verified heating system types must be consistent.", Name )
											else if (T24RCoolingEquipment:SEERValid( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", AltHVACSystem:CoolSysTypeAbbrev ) > 0 .AND. 
														T24RCoolingEquipment:SEERValid( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType",  exHVACSystem:CoolSysTypeAbbrev ) < 1)
											then	PostError( "Zone '%s' has incompatible altered and existing cooling systems.  Altered system uses SEE/SEER2 and existing does not.  To get compliance credit, altered and verified cooling system types must be consistent.", Name )
											else if (T24RCoolingEquipment:EERValid(  "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", AltHVACSystem:CoolSysTypeAbbrev ) > 0 .AND. 
														T24RCoolingEquipment:EERValid(  "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType",  exHVACSystem:CoolSysTypeAbbrev ) < 1)
											then	PostError( "Zone '%s' has incompatible altered and existing cooling systems.  Altered system uses EER/EER2 and existing does not.  To get compliance credit, altered and verified cooling system types must be consistent.", Name )
											else  UNCHANGED  endif endif endif
									endif endif endif  }

; SAC 10/26/15 - removed restriction on combination of central and non-central DHW systems
;	; SAC 3/19/15 - Check to ensure that for 2016 std design we don't have a COMBINATION of central and non-central DHW systems, since non-central std design needs to be modeled as instantaneous via simulation
;	;						and we don't have logic/rules yet to setup std design central DHW systems for simulation
;	"Ensure no combination of central & non-central DHW systems for 2016 rules"
;		ResProj:Action		= {	if ( Proj:IsComRuleset .AND. Proj:StdDesignBase >= 2016 .AND. SumAll( DwellUnitType:NumDUsCntrlDHW ) > 0.5 .AND. SumAll( DwellUnitType:NumDUsNonCntrlDHW ) > 0.5)
;									then  PostError( "Multifamily models being analyzed using 2016 Title-24 rules cannot include both central and non-central DHW systems.  Convert to all central or all non-central before re-analyzing the model." )
;									else  UNCHANGED  endif  }

  ; SAC 1/11/16 - check to ensure that New Cons projects include DHW use
  ; SAC 2/24/16 - altered logic to include EAA & AA projects in those requiring DHW use (tic #607)
	"Ensure DHW in New Cons projects"	ResProj:Action	= {	if (AnalysisType < 3) then  UNCHANGED		; allow no DHW in Research-mode analysis
																			else if (SumAcrossIf( ResDHWSys:FloorAreaServed, ResDHWSys:TotNumDHWHeaters > 0 ) > 0.5) then  UNCHANGED
																			else	PostError( "All compliance projects must include DHW equipment and assignments to zones/dwelling units." )
																			endif endif  }

  ; SAC 2/26/16 - added for error checking associated w/ ticket #607
	"Ensure that there are valid (new/alt/ex) DHWSys objects to assign to any Zones or DwellUnitTypes lacking DHWSys assignments"
		ResProj:Action		= {	if (LocalCompAssigned( MaxDHWSysByCateg[1] ) < 1 .AND. LocalCompAssigned( MaxDHWSysByCateg[4] ) < 1 .AND. SumAll( ResZn:DHWUnassignedFloorArea[1] ) >= 1)
									then	PostError( "The model includes one or more Zones with a DHW status of 'New' but no New DHWSys object to assign to the Zone(s)." )
									else if (RunScope == 2 .AND. LocalCompAssigned( MaxDHWSysByCateg[2] ) < 1 .AND. LocalCompAssigned( MaxDHWSysByCateg[5] ) < 1 .AND. SumAll( ResZn:DHWUnassignedFloorArea[2] ) >= 1)
									then	PostError( "The model includes one or more Zones with a DHW status of 'Altered' but no Altered DHWSys object to assign to the Zone(s)." )
									else if ((RunScope == 2 .OR. IsAddAlone > 0) .AND. LocalCompAssigned( MaxDHWSysByCateg[3] ) < 1 .AND. LocalCompAssigned( MaxDHWSysByCateg[6] ) < 1 .AND.
												SumAll( ResZn:DHWUnassignedFloorArea[3] ) >= 1)
									then	PostError( "The model includes one or more Zones with a DHW status of 'Existing' but no Existing DHWSys object to assign to the Zone(s)." )
									else	UNCHANGED  endif endif endif  }

	; SAC 8/17/16 - added check to ensure that all pertinent DHW assignments are present in each DwellUnitType   ; expand error checks for NumDHWSysTypes undefined or < 1 - SAC 03/01/23
   "Check for all pertinent DHW system assignments in each (modeled) DwellUnitType"
      DwellUnitType:Action	= {
         if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1) then  UNCHANGED
         else if (IfValidAnd( NumDHWSysTypes >= 1 )==0)
         then  PostError( "Number of DHW system assignment in dwelling unit type '%s' must be >= 1", Name )
         else if (IfValidAnd( NumDHWSysTypes >= 1 ) .AND. LocalCompAssigned( DHWSysRef[1] )==0)
         then  PostError( "DHW system assignment #1 missing in dwelling unit type '%s'", Name )
         else if (IfValidAnd( NumDHWSysTypes >= 2 ) .AND. LocalCompAssigned( DHWSysRef[2] )==0)
         then  PostError( "DHW system assignment #2 missing in dwelling unit type '%s'", Name )
         else if (IfValidAnd( NumDHWSysTypes >= 3 ) .AND. LocalCompAssigned( DHWSysRef[3] )==0)
         then  PostError( "DHW system assignment #3 missing in dwelling unit type '%s'", Name )
         else if (IfValidAnd( NumDHWSysTypes >= 4 ) .AND. LocalCompAssigned( DHWSysRef[4] )==0)
         then  PostError( "DHW system assignment #4 missing in dwelling unit type '%s'", Name )
         else if (IfValidAnd( NumDHWSysTypes >= 5 ) .AND. LocalCompAssigned( DHWSysRef[5] )==0)
         then  PostError( "DHW system assignment #5 missing in dwelling unit type '%s'", Name )
         else  UNCHANGED  endif endif endif endif endif endif endif  }

	; SAC 10/24/15 - added check to ensure only one DHWSys assignment to DwellUnitTypes when a central DHWSys is assigned
	"Check for no more than 1 DwellUnitType DHW system when a central system is assigned"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1 .OR. NumDHWSysTypes < 2) then  UNCHANGED
											else if (LocalCompAssigned( DHWSysRef[1] ) .AND. IfValidAnd( DHWSysRef[1]:CentralDHW > 0.5 ) .AND.
														( (                          LocalCompAssigned( DHWSysRef[2] )) .OR.
														  (NumDHWSysTypes >= 3 .AND. LocalCompAssigned( DHWSysRef[3] )) .OR.
														  (NumDHWSysTypes >= 4 .AND. LocalCompAssigned( DHWSysRef[4] )) .OR.
														  (NumDHWSysTypes >= 5 .AND. LocalCompAssigned( DHWSysRef[5] )) ) )
											then	PostError( "DHW system #1 assigned to dwelling unit type '%s' is central, so no other DHW systems can be assigned.", Name )
											else if (NumDHWSysTypes >= 2 .AND. LocalCompAssigned( DHWSysRef[2] ) .AND. IfValidAnd( DHWSysRef[2]:CentralDHW > 0.5 ) .AND.
														( (                          LocalCompAssigned( DHWSysRef[1] )) .OR.
														  (NumDHWSysTypes >= 3 .AND. LocalCompAssigned( DHWSysRef[3] )) .OR.
														  (NumDHWSysTypes >= 4 .AND. LocalCompAssigned( DHWSysRef[4] )) .OR.
														  (NumDHWSysTypes >= 5 .AND. LocalCompAssigned( DHWSysRef[5] )) ) )
											then	PostError( "DHW system #2 assigned to dwelling unit type '%s' is central, so no other DHW systems can be assigned.", Name )
											else if (NumDHWSysTypes >= 3 .AND. LocalCompAssigned( DHWSysRef[3] ) .AND. IfValidAnd( DHWSysRef[3]:CentralDHW > 0.5 ) .AND.
														( (                          LocalCompAssigned( DHWSysRef[1] )) .OR.
														  (                          LocalCompAssigned( DHWSysRef[2] )) .OR.
														  (NumDHWSysTypes >= 4 .AND. LocalCompAssigned( DHWSysRef[4] )) .OR.
														  (NumDHWSysTypes >= 5 .AND. LocalCompAssigned( DHWSysRef[5] )) ) )
											then	PostError( "DHW system #3 assigned to dwelling unit type '%s' is central, so no other DHW systems can be assigned.", Name )
											else if (NumDHWSysTypes >= 4 .AND. LocalCompAssigned( DHWSysRef[4] ) .AND. IfValidAnd( DHWSysRef[4]:CentralDHW > 0.5 ) .AND.
														( (                          LocalCompAssigned( DHWSysRef[1] )) .OR.
														  (                          LocalCompAssigned( DHWSysRef[2] )) .OR.
														  (                          LocalCompAssigned( DHWSysRef[3] )) .OR.
														  (NumDHWSysTypes >= 5 .AND. LocalCompAssigned( DHWSysRef[5] )) ) )
											then	PostError( "DHW system #4 assigned to dwelling unit type '%s' is central, so no other DHW systems can be assigned.", Name )
											else if (NumDHWSysTypes >= 5 .AND. LocalCompAssigned( DHWSysRef[5] ) .AND. IfValidAnd( DHWSysRef[5]:CentralDHW > 0.5 ) .AND.
														( LocalCompAssigned( DHWSysRef[1] ) .OR.
														  LocalCompAssigned( DHWSysRef[2] ) .OR.
														  LocalCompAssigned( DHWSysRef[3] ) .OR.
														  LocalCompAssigned( DHWSysRef[4] ) ) )
											then	PostError( "DHW system #5 assigned to dwelling unit type '%s' is central, so no other DHW systems can be assigned.", Name )
											else	UNCHANGED  endif endif endif endif endif endif  }

	; SAC 9/30/15 - new check similar to the one below for conflicts in existing vs. new/altered DHWSys objects
	; SAC 10/5/15 - added logic to check to ensure that there is at least one DHWHeater assigned (w/ Count > 0) to every DHWSys object w/ assigned floor area
   ; SAC 1/5/20 - added logic to prevent posting no DHWHeater assignment error for DHWSystems setup as central HPWHs (tic #862)
  	"Ensure DHWSys objects not assigned to serve BOTH new/altered & existing areas"
		ResDHWSys:Action		= {	if ( IfValidAnd( ResProj:RunScope == 2 ) .AND. ExFlrAreaServed >= 1 .AND. (AltFlrAreaServed + NewFlrAreaServed) >= 1)
										then	if ( Proj:IsComRuleset)
												then	PostError( "DHW System '%s' is assigned to a combination of existing and new/altered dwelling unit types.  No one system can be referenced as an existing system and a new/altered system by different dwelling unit types.", Name )
												else	PostError( "DHW System '%s' is assigned to a combination of existing and new/altered zones.  No one system can be referenced as an existing system and a new/altered system by different zones.", Name )
												endif
										else if (IfValidAnd( FloorAreaServed >= 1 ) .AND. IfValidAnd( FirstDHWHtrIndex > 0 )==0 .AND.
										         ( Proj:IsSFamResRuleset .OR. CentralDHW < 1 .OR. CentralDHWTypeVal != 2))
										then	PostError( "DHW System '%s' is assigned to one or more dwelling units/zones but no valid DHW heaters (w/ counts > 0) are assigned.", Name )
										else	UNCHANGED  endif endif  }

; SAC 5/12/15 - added checks for valid ResDHWSys:SystemType & ResDHWSys:MFamDistType specified (issue 537)
; SAC 5/13/15 - revisions to this check to ensure proper SystemType for central systems (issue 537)
; SAC 3/8/18 - extended list of allowed SystemTypes to include new 2019 Compact... (tic #983)
; SAC 1/1/20 - added new error check to prevent Central (MFam model) DHW system w/ assigned area (OtherZone) but no DwellUnit/Zone DHW assignment (tic #862)
; SAC 2/4/20 - added check for CHPWHNumComp > 0 (tic #1197)
; added check preventing a central DHW system from being assigned to both dwelling units AND ResOtherZns (due to std design solar system requirement issue) - SAC 05/08/23
; MOVED this check up from SimCheck into CodeCheck to ensure it is processed prior to any simulation - SAC 05/17/23
   ; "dbg" ResDHWSys:Action = { MessageBox( "ResDHWSys '%s':  Proj:IsComRuleset %g / CentralDHW %g / SimDHWSys %g / NumDUsServed %g / NumResOtherZnsServed %g", Name, Proj:IsComRuleset, CentralDHW, SimDHWSys, NumDUsServed, NumResOtherZnsServed ) }
   "Check ResDHWSys:SystemType selection"    ResDHWSys:Action  =
      {  if (IfValidAnd( SystemType > 0 )==0)
         then	PostError( "DHWSys '%s' must have a valid Distribution (SystemType) option selected.", Name )
         else if ( Proj:IsComRuleset .AND. IfValidAnd( CentralDHW > 0 ) .AND.
                  SystemType != 3840 .AND. SystemType != 4096 .AND. SystemType != 4352 .AND.
                  SystemType != 8392704 .AND. SystemType != 8392960 .AND. SystemType != 100 )
         then	PostError( "DHWSys '%s' Dwelling Unit Distribution (SystemType) is not compatible with multifamily, central systems.", Name )
         else if ( Proj:IsComRuleset .AND. IfValidAnd( CentralDHW > 0 ) .AND.
                  CentralDHWType == 2 .AND. IfValidAnd( CHPWHNumCompFlt > 0 )==0)
         then  PostError( "Central HPWH DHWSys '%s' missing compressor count input.", Name )
         else	UNCHANGED  endif endif endif  }
      ; remove check preventing central DHW systems w/ no dwellings assigned - SAC 04/21/23 (tic #3418)
      ;   else if ( (Proj:IsComRuleset .OR. Proj:IsComRuleset) .AND. IfValidAnd( CentralDHW > 0 ) .AND.
      ;            IfValidAnd( SimDHWSys > 0 ) .AND. IfValidAnd( NumDUsServed > 0 )==0)
      ;   then  PostError( "Central DHWSys '%s' must be assigned to serve at least one dwelling unit.", Name )
      ; removed combined res + nonres central DHW assignment error - SAC 01/12/24
      ;   else if ( Proj:IsComRuleset .AND. IfValidAnd( CentralDHW > 0 ) .AND.
      ;             IfValidAnd( NumDUsServed > 0 ) .AND. IfValidAnd( NumResOtherZnsServed > 0.1 ) .AND.
      ;             IfValidAnd( Proj:EnableResearchMode > 0 )==0 )
      ;   then  PostError( "Central DHWSys '%s' must be assigned to serve either dwelling units or common areas (ResOtherZn), but not both.", Name )

; SAC 5/13/15 - REMOVED this check preventing MFamDistType = '- none -', as this turns out to be a valid selection, even when CentralDHW is checked. (issue 537)
;	"Check ResDHWSys:MFamDistType selection"	ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. CentralDHW < 0.5 .OR. MFamDistType > 0.5) then  UNCHANGED
;																					else	PostError( "DHWSys '%s' must have a valid Central System Distribution (MFamDistType) option selected.", Name )  endif  }

   ; SAC 12/6/18 - added checks for 2019 Compact Distrib credit (tic #975)
   ; SAC 1/12/19 - added logic to prevent error if user has selected to manually enter CompactFactor
   ; SAC 3/25/19 - update for Proj-wide Compact Distrib
   ; removed check associated w/ SFamUserSpecCmpctDist and undefined SFamUserCompactFactor - SAC 09/29/21 (tic #1277)
   "Ensure all required data specified for selected Compact Distrib is specified"    ResProj:Action  = {
         if (IfValidAnd( IsComRuleset > 0 )) then  UNCHANGED
         else if ( ResProj:EnergyCodeYearNum < 2019 .OR. SFamCompactDistrib < 1 .OR. IsMultiFamily > 0.5) then  UNCHANGED
         else  if (IfValidAnd( SFamCDWeightedDist = 10001 ))
               then  PostError( "Compactness selection is '%s' but the straight-line heater to furthest room fixture distance is unspecified for all compatible recirculation DHW systems.", EnumString( SFamCompactDistrib ) )
               else if (IfValidAnd( SFamCDWeightedDist = 10002 ))
               then  PostError( "Compactness selection is '%s' but one or more of the straight-line heater to fixture distances are unspecified for the compatible DHW systems.", EnumString( SFamCompactDistrib ) )
               else if (IfValidAnd( SFamCompactFactor < 1 )==0)
               then  PostError( "Compactness selection is '%s' but heater to fixture distances do not qualify this project for the compliance credit.", EnumString( SFamCompactDistrib ) )
               else  UNCHANGED  endif endif endif
         endif endif  }
;   "Ensure all required data specified for selected Compact Distrib is specified and that those systems pass qualification test"    ResDHWSys:Action  = {
;         if (FloorAreaServed < 1 .OR. IfValidAnd( ResProj:EnergyCodeYearNum < 2019 ) .OR. CompactDistrib < 1) then  UNCHANGED
;         else if ( Proj:IsSFamResRuleset)
;         then  if (IfValidAnd( UserSpecCmpctDist > 0 ))
;               then  if (IfValidAnd( UserCompactFactor > 0 )) then  UNCHANGED
;                     else  PostError( "Custom Compactness Factor selection made for DHWSys '%s' but no Compactness Factor is specified.", Name )
;                     endif
;               else if (IfValidAnd( CDWeightedDist = 10001 ))
;               then  PostError( "DHW System '%s' compactness selection is '%s' but the straight-line heater to furthest room fixture distance is unspecified.", Name, EnumString( CompactDistrib ) )
;               else if (IfValidAnd( CDWeightedDist = 10002 ))
;               then  PostError( "DHW System '%s' compactness selection is '%s' but one or more of the straight-line heater to fixture distances are unspecified.", Name, EnumString( CompactDistrib ) )
;               else if (IfValidAnd( CompactFactor < 1 )==0)
;               then  PostError( "DHW System '%s' compactness selection is '%s' but heater to fixture distances do not qualify this system for the compliance credit.", Name, EnumString( CompactDistrib ) )
;               else  UNCHANGED  endif endif endif endif
;         else
;               UNCHANGED
;; TO DO - MFam checks by DwellUnitType & check for at least one qualified DUT assigning this DHWSys!!
;         endif endif  }

; TO DO - post Warnings for MFam DUTs that don't qualify for Compact (when assigning a DHWSys that other DUT(s) assign & qualify)

;   ; SAC 1/8/19 - temporary
;   "temporary check to prevent DWHRSys modeling for DwellUnitType DHWSys assignments of Central DHW systems (until DWHR for central DHWSys working)"  DwellUnitType:Action  = {
;         if (IfValidAnd( ResProj:BypassRuleLimits > 0 ) .OR. Proj:IsSFamResRuleset .OR. AssignedDUFlrArea < 1) then  UNCHANGED
;         else if (HtEqpUsedAsDHWHtr < 1 .AND.
;                   ( (NumDHWSysTypes >= 1 .AND. IfValidAnd( DHWSysRef[1]:CentralDHW > 0 ) .AND. IfValidAnd( NumDWHRSysDevices[1] > 0 )) .OR.
;                     (NumDHWSysTypes >= 2 .AND. IfValidAnd( DHWSysRef[2]:CentralDHW > 0 ) .AND. IfValidAnd( NumDWHRSysDevices[2] > 0 )) .OR.
;                     (NumDHWSysTypes >= 3 .AND. IfValidAnd( DHWSysRef[3]:CentralDHW > 0 ) .AND. IfValidAnd( NumDWHRSysDevices[3] > 0 )) .OR.
;                     (NumDHWSysTypes >= 4 .AND. IfValidAnd( DHWSysRef[4]:CentralDHW > 0 ) .AND. IfValidAnd( NumDWHRSysDevices[4] > 0 )) .OR.
;                     (NumDHWSysTypes >= 5 .AND. IfValidAnd( DHWSysRef[5]:CentralDHW > 0 ) .AND. IfValidAnd( NumDWHRSysDevices[5] > 0 )) ))
;         then  PostError( "Drain water heat recovery modeling not yet implemented for Central DHW systems (present in DwellUnitType '%s')", Name )
;         else  UNCHANGED  endif endif  }

   ; SAC 12/24/18 - added checks to prevent BOTH old and new (2019) drain water heat recovery modeling in the same project (both still enabled for testing purposes)
   "Prevent both global and more specific (newer) DWHRSys modeling"     Proj:Action  = {
         if (IfValidAnd( HaveShwrDrnHtRecov > 0 ) .AND. IfValidAnd( ShwrDRAINHREFF > 0 ) .AND.
             MaxAll( ResDHWSys:NumDWHRSysDevices ) > 0)
         then  PostError( "Both global (HaveShwrDrnHtRecov) and individual system (DWHRSys assigned) drain water heat recovery is specified, but only one can exist in a single model" )
         else  UNCHANGED  endif  }
   "Report error where invalid shower counts exist for any DHWSys w/ assigned DWHRSystems"   ResDHWSys:Action  = {
         if (IfValidAnd( NumDWHRSysDevices = -1 ))
         then  PostError( "Error in drain water heat recovery inputs for DHWSys '%s':  Total showers served (%g) must be >= sum of DWHRSys showers (%g)",
                              Name, ValidOr( TotShowersServed, -1 ), ValidOr( TotDWHRSysShowers, -1 ) )
         else  UNCHANGED  endif  }

   ; SAC 6/2/20 - added new check to ensure that all required inputs to Central DHWSys type HPWH are in place
   "Ensure Central HPWH DHWSys inputs valid"    ResDHWSys:Action =
      {  if ( Proj:IsSFamResRuleset .OR. CentralDHW < 0.5 .OR. (AltFlrAreaServed + NewFlrAreaServed) < 1) then  UNCHANGED
         else if (IfValidAnd( CentralDHWTypeVal = 2 )==0) then  UNCHANGED
         else if (LocalStatus( CHPWHErrMsg ) > 0) then  PostError( "DHWSys '%s' %s", Name, CHPWHErrMsg )
         else  UNCHANGED  endif endif endif  }

   ; SAC 4/13/16 - new check to ensure "Heat Pump (2016)" DHWHeaters are not assigned to new or altered DHWSys objects
   ; SAC 2/21/18 - added logic to allow central systems to include HPWHs for 2019+ analysis (per BAW request)
   ; SAC 2/27/18 - revised this mod to require BypassRuleLimits or MFamDistType = 'Multi-family: No loops or recirc pump' (0) to model central HPWHs
   ; SAC 3/8/18 - revised msg to reflect 2019 recirc limitation for all electric heater types (tic #983)
   ; SAC 12/10/18 - removed restrictions on 2019 Central HPWH & Centrl Elec (of any type) w/ recirc (tic #975)
   ; SAC 1/14/19 - restored checks for CEC workshop release (until Lrg Central Elec std design enabled)
   ; SAC 10/24/19 - disable central electric recirc check for 'new' CSE central electric system model
   ; SAC 1/21/20 - added logic to instruct user to use new CentralDHWType = 'HPWH' for central HPWHs w/ recirculation
   "Ensure central DHW systems are not served by 'Heat Pump' water heaters (heater #1)"
      ResDHWSys:Action      = {  if ( Proj:IsSFamResRuleset .OR. CentralDHW < 0.5 .OR. (AltFlrAreaServed + NewFlrAreaServed) < 1) then  UNCHANGED
                              else if (NumDHWHeaters < 1 .OR. IfValidAnd( HeaterMultFlt[1] > 0 )==0 .OR. LocalCompAssigned( DHWHeater[1] ) != ComponentType( "ResWtrHtr" )) then  UNCHANGED
                              else if (IfValidAnd( Proj:AnalysisVersion >= 190102 ) .AND. MFamDistType > 0 .AND. ResProj:BypassRuleLimits < 1 .AND. DHWHeater[1]:HeaterElementType == 5 .AND. CentralDHWType != 2)
                              then  PostError( "DHWSys '%s' must be switched to central type 'HPWH' to model a central HPWH system with recirculation", Name )
                              else if ( ResProj:EnergyCodeYearNum >= 2019 .AND. MFamDistType > 0 .AND. ResProj:BypassRuleLimits < 1 .AND. DHWHeater[1]:HeaterElementType != 1 .AND. NewCentralElecModel < 1)
                              then  PostError( "Compliance analysis not enabled for DHW heater #1 of type '%s' serving central DHW System '%s' with recirculation", EnumString( DHWHeater[1]:HeaterElementType ), Name )
                              else if (DHWHeater[1]:HeaterElementType != 5 .OR. ResProj:EnergyCodeYearNum >= 2019) then  UNCHANGED
                              else  PostError( "Compliance analysis not enabled for DHW heater #1 of type 'Heat Pump' serving central DHW System '%s'", Name )  endif endif endif endif endif  }
   "Ensure central DHW systems are not served by 'Heat Pump' water heaters (heater #2)"
      ResDHWSys:Action      = {  if ( Proj:IsSFamResRuleset .OR. CentralDHW < 0.5 .OR. (AltFlrAreaServed + NewFlrAreaServed) < 1) then  UNCHANGED
                              else if (NumDHWHeaters < 2 .OR. IfValidAnd( HeaterMultFlt[2] > 0 )==0 .OR. LocalCompAssigned( DHWHeater[2] ) != ComponentType( "ResWtrHtr" )) then  UNCHANGED
                              else if (IfValidAnd( Proj:AnalysisVersion >= 190102 ) .AND. MFamDistType > 0 .AND. ResProj:BypassRuleLimits < 1 .AND. DHWHeater[1]:HeaterElementType == 5 .AND. CentralDHWType != 2) then  UNCHANGED
                              else if ( ResProj:EnergyCodeYearNum >= 2019 .AND. MFamDistType > 0 .AND. ResProj:BypassRuleLimits < 1 .AND. DHWHeater[2]:HeaterElementType != 1 .AND. NewCentralElecModel < 1)
                              then  PostError( "Compliance analysis not enabled for DHW heater #2 of type '%s' serving central DHW System '%s' with recirculation", EnumString( DHWHeater[2]:HeaterElementType ), Name )
                              else if (DHWHeater[2]:HeaterElementType != 5 .OR. ResProj:EnergyCodeYearNum >= 2019) then  UNCHANGED
                              else  PostError( "Compliance analysis not enabled for DHW heater #2 of type 'Heat Pump' serving central DHW System '%s'", Name )  endif endif endif endif endif  }
   "Ensure central DHW systems are not served by 'Heat Pump' water heaters (heater #3)"
      ResDHWSys:Action      = {  if ( Proj:IsSFamResRuleset .OR. CentralDHW < 0.5 .OR. (AltFlrAreaServed + NewFlrAreaServed) < 1) then  UNCHANGED
                              else if (NumDHWHeaters < 3 .OR. IfValidAnd( HeaterMultFlt[3] > 0 )==0 .OR. LocalCompAssigned( DHWHeater[3] ) != ComponentType( "ResWtrHtr" )) then  UNCHANGED
                              else if ( ResProj:EnergyCodeYearNum >= 2019 .AND. MFamDistType > 0 .AND. ResProj:BypassRuleLimits < 1 .AND. DHWHeater[3]:HeaterElementType != 1 .AND. NewCentralElecModel < 1)
                              then  PostError( "Compliance analysis not enabled for DHW heater #3 of type '%s' serving central DHW System '%s' with recirculation", EnumString( DHWHeater[3]:HeaterElementType ), Name )
                              else if (DHWHeater[3]:HeaterElementType != 5 .OR. ResProj:EnergyCodeYearNum >= 2019) then  UNCHANGED
                              else  PostError( "Compliance analysis not enabled for DHW heater #3 of type 'Heat Pump' serving central DHW System '%s'", Name )  endif endif endif endif  }
   "Ensure central DHW systems are not served by 'Heat Pump' water heaters (heater #4)"
      ResDHWSys:Action      = {  if ( Proj:IsSFamResRuleset .OR. CentralDHW < 0.5 .OR. (AltFlrAreaServed + NewFlrAreaServed) < 1) then  UNCHANGED
                              else if (NumDHWHeaters < 4 .OR. IfValidAnd( HeaterMultFlt[4] > 0 )==0 .OR. LocalCompAssigned( DHWHeater[4] ) != ComponentType( "ResWtrHtr" )) then  UNCHANGED
                              else if ( ResProj:EnergyCodeYearNum >= 2019 .AND. MFamDistType > 0 .AND. ResProj:BypassRuleLimits < 1 .AND. DHWHeater[4]:HeaterElementType != 1 .AND. NewCentralElecModel < 1)
                              then  PostError( "Compliance analysis not enabled for DHW heater #4 of type '%s' serving central DHW System '%s' with recirculation", EnumString( DHWHeater[4]:HeaterElementType ), Name )
                              else if (DHWHeater[4]:HeaterElementType != 5 .OR. ResProj:EnergyCodeYearNum >= 2019) then  UNCHANGED
                              else  PostError( "Compliance analysis not enabled for DHW heater #4 of type 'Heat Pump' serving central DHW System '%s'", Name )  endif endif endif endif  }
   "Ensure central DHW systems are not served by 'Heat Pump' water heaters (heater #5)"
      ResDHWSys:Action      = {  if ( Proj:IsSFamResRuleset .OR. CentralDHW < 0.5 .OR. (AltFlrAreaServed + NewFlrAreaServed) < 1) then  UNCHANGED
                              else if (NumDHWHeaters < 5 .OR. IfValidAnd( HeaterMultFlt[5] > 0 )==0 .OR. LocalCompAssigned( DHWHeater[5] ) != ComponentType( "ResWtrHtr" )) then  UNCHANGED
                              else if ( ResProj:EnergyCodeYearNum >= 2019 .AND. MFamDistType > 0 .AND. ResProj:BypassRuleLimits < 1 .AND. DHWHeater[5]:HeaterElementType != 1 .AND. NewCentralElecModel < 1)
                              then  PostError( "Compliance analysis not enabled for DHW heater #5 of type '%s' serving central DHW System '%s' with recirculation", EnumString( DHWHeater[5]:HeaterElementType ), Name )
                              else if (DHWHeater[5]:HeaterElementType != 5 .OR. ResProj:EnergyCodeYearNum >= 2019) then  UNCHANGED
                              else  PostError( "Compliance analysis not enabled for DHW heater #5 of type 'Heat Pump' serving central DHW System '%s'", Name )  endif endif endif endif  }
   "Ensure central DHW systems are not served by 'Heat Pump' water heaters (heater #6)"
      ResDHWSys:Action      = {  if ( Proj:IsSFamResRuleset .OR. CentralDHW < 0.5 .OR. (AltFlrAreaServed + NewFlrAreaServed) < 1) then  UNCHANGED
                              else if (NumDHWHeaters < 6 .OR. IfValidAnd( HeaterMultFlt[6] > 0 )==0 .OR. LocalCompAssigned( DHWHeater[6] ) != ComponentType( "ResWtrHtr" )) then  UNCHANGED
                              else if ( ResProj:EnergyCodeYearNum >= 2019 .AND. MFamDistType > 0 .AND. ResProj:BypassRuleLimits < 1 .AND. DHWHeater[6]:HeaterElementType != 1 .AND. NewCentralElecModel < 1)
                              then  PostError( "Compliance analysis not enabled for DHW heater #6 of type '%s' serving central DHW System '%s' with recirculation", EnumString( DHWHeater[6]:HeaterElementType ), Name )
                              else if (DHWHeater[6]:HeaterElementType != 5 .OR. ResProj:EnergyCodeYearNum >= 2019) then  UNCHANGED
                              else  PostError( "Compliance analysis not enabled for DHW heater #6 of type 'Heat Pump' serving central DHW System '%s'", Name )  endif endif endif endif  }

	; SAC 12/23/14 - new check for conflicts in existing vs. new/altered DHWHeater objects
	"Ensure DHWHeater objects not assigned to serve BOTH new/altered & existing areas"
		ResWtrHtr:Action	= {	if ( ResProj:RunScope == 2 .AND. ExFlrAreaServed >= 1 .AND. (AltFlrAreaServed + NewFlrAreaServed) >= 1)
										then	PostError( "DHW Heater '%s' is assigned to DHW system(s) that serve a combination of existing and new/altered zones.  This heater should be copied and assigned separately to systems serving existing vs. new/altered zones before performing compliance analysis.", Name )
										else	UNCHANGED  endif  }
	; SAC 10/27/15 - check for this heater serving BOTH new/altered, central DHW systems -AND- other systems (existing or non-central)
	"Ensure this heater does not serve BOTH new/altered, central DHW systems -AND- other systems (existing or non-central)"
		ResWtrHtr:Action	= {	if (NewCntrlAreaServed >= 1 .AND. FloorAreaServed > (NewCntrlAreaServed + 1))
										then	if ( ResProj:RunScope == 2)
												then	PostError( "DHW Heater '%s' is assigned to a combination of new/altered Central DHW system(s) and other (existing and/or non-central) systems, which is not allowed in compliance analysis.", Name )
												else	PostError( "DHW Heater '%s' is assigned to both Central and Non-Central DHW system(s), which is not allowed in compliance analysis.", Name )
												endif
										else  UNCHANGED  endif  }

   "Prevent simulation of New/Alt DHWHeaters in 2019 analysis w/ older TankTypes"      ResWtrHtr:Action  =     ; SAC 5/27/19 (tic #1096)
      {  if (IfValidAnd( ResProj:EnergyCodeYearNum >= 2019 )==0 .OR.
             (AltFlrAreaServed + NewFlrAreaServed) < 1 .OR. HeaterElementType > 1) then  UNCHANGED
         else if (TankType = 2 .OR. TankType = 3 .OR. TankType = 5 .OR. TankType = 6)
         then  if (AltFlrAreaServed > 0 .AND. NewFlrAreaServed > 0)
               then  switch (TankType)
                        case  2 :  PostError( "New/Altered DHW heater '%s' TankType 'Large Instantaneous (existing only)' is only valid for Existing heaters.", Name )
                        case  3 :  PostError( "New/Altered DHW heater '%s' TankType 'Large Storage (existing only)' is only valid for Existing heaters.", Name )
                        case  5 :  PostError( "New/Altered DHW heater '%s' TankType 'Small Instantaneous (existing only)' is only valid for Existing heaters.", Name )
                        case  6 :  PostError( "New/Altered DHW heater '%s' TankType 'Small Storage (existing only)' is only valid for Existing heaters.", Name )
                        default :  UNCHANGED
                     endswitch
               else if (NewFlrAreaServed > 0)
               then  switch (TankType)
                        case  2 :  PostError( "New DHW heater '%s' TankType 'Large Instantaneous (existing only)' is only valid for Existing heaters.", Name )
                        case  3 :  PostError( "New DHW heater '%s' TankType 'Large Storage (existing only)' is only valid for Existing heaters.", Name )
                        case  5 :  PostError( "New DHW heater '%s' TankType 'Small Instantaneous (existing only)' is only valid for Existing heaters.", Name )
                        case  6 :  PostError( "New DHW heater '%s' TankType 'Small Storage (existing only)' is only valid for Existing heaters.", Name )
                        default :  UNCHANGED
                     endswitch
               else if (AltFlrAreaServed > 0)
               then  switch (TankType)
                        case  2 :  PostError( "Altered DHW heater '%s' TankType 'Large Instantaneous (existing only)' is only valid for Existing heaters.", Name )
                        case  3 :  PostError( "Altered DHW heater '%s' TankType 'Large Storage (existing only)' is only valid for Existing heaters.", Name )
                        case  5 :  PostError( "Altered DHW heater '%s' TankType 'Small Instantaneous (existing only)' is only valid for Existing heaters.", Name )
                        case  6 :  PostError( "Altered DHW heater '%s' TankType 'Small Storage (existing only)' is only valid for Existing heaters.", Name )
                        default :  UNCHANGED
                     endswitch
               else  UNCHANGED  endif endif endif
         else  UNCHANGED  endif endif  }

	; SAC 3/18/16 - check for valid inputs for new HPWH model
	; SAC 7/19/17 - removed check preventing analysis using Sanden models
	; SAC 1/6/20 - removed check preventing location of "- none -", which now simulates DHWHeater in Unconditioned zone (avg of DBT & 70) (tic #862)
   ; added check for valid ASHPType (HPWHComModel) when HPWH_ComProduct - SAC 02/01/21 (tic #1260)
   ; removed restriction to ASHPSplit > 0 for check on ASHPTSrc - SAC 03/31/22 (Res tic #1327)
	"Ensure valid inputs to simulate DHWHeater via new HPWH model"
		ResWtrHtr:Action	= {	if (FloorAreaServed < 1 .OR. HeaterElementType .NE. 5) then  UNCHANGED
										else if ( IfValidAnd( ResProj:CSEDHWUseMethod == 1 ))
										then	PostError( "DHW Heater '%s' heater element type of '%s' invalid when CSEDHWUseMethod = '%s'.", Name, EnumString( HeaterElementType ), EnumString( ResProj:CSEDHWUseMethod ) )
										else if (HPWH_NEEARated > 0.5 .AND. ASHPType < 1)
										then	PostError( "Valid selections for HPWH Brand and Model are required for DHW Heater '%s' with '%s' heater element type.", Name, EnumString( HeaterElementType ) )
										else if (HPWH_ComProduct > 0.5 .AND. ASHPType < 1)
										then	PostError( "Valid selection for Commercial HPWH Model is required for DHW Heater '%s' with '%s' heater element type.", Name, EnumString( HeaterElementType ) )
						;				else if (HPWH_NEEARated > 0.5 .AND. (ASHPType == 16 .OR. ASHPType == 17) .AND. Proj:EnableResearchMode < 1)
						;				then	PostError( "DHW Heater '%s' specifies a Sanden HPWH option that require activation of EnableResearchMode (and cannot be used in compliance analysis).", Name )
						;				else if (IfValidAnd( TankOutside > 0 )==0 .AND. LocalCompAssigned( TankZone ) < 1)
						;				then	PostError( "Tank location (Garage, Zone, Attic or CrawlSpace) must be defined for DHW Heater '%s' with '%s' heater element type.", Name, EnumString( HeaterElementType ) )
										else if (IfValidAnd( ASHPTSrcOutside > 0 )==0 .AND. LocalCompAssigned( ASHPTSrcZone ) < 1)
										then	PostError( "DHW Heater '%s' heat source location (Garage, Zone, Attic or CrawlSpace) must be defined for '%s' heater element type.", Name, EnumString( HeaterElementType ) )
										else	UNCHANGED  endif endif endif endif endif  }

	; SAC 4/14/16 - ensure that 'Heat Pump (2013...)' isn't used in compliance analysis (for 2016 analysis)
	"Ensure valid inputs to simulate DHWHeater via new HPWH model"
		ResWtrHtr:Action	= {	if (IfValidAnd( ResProj:StdsVersionYr >= 2017)==0 .OR. IfValidAnd(  ResProj:ResAnalysisType = 13)==0 .OR. FloorAreaServed < 1) then  UNCHANGED
										else if (HeaterElementType == 3)
										then	PostError( "Heater element type '%s' is not allowed for compliance analysis - DHW Heater '%s' .", EnumString( HeaterElementType ), Name )
										else	UNCHANGED  endif endif  }

	; SAC 6/17/16 - added checks to PREVENT use of Monthly solar fractions when doing T-24 compliance analysis (tic #682)
	"Prevent use of DHWSys monthly solar fractions when doing T-24 compliance analysis"
		ResDHWSys:Action	= {	if (IfValidAnd( FloorAreaServed[1] > 0.1 )==0 .OR. SolFracType != 2) then  UNCHANGED
									else	if (IfValidAnd( SolFracAnnRpt > 0 ))
											then	PostError( "Selection of Monthly solar fractions for DHWSys '%s' invalid for compliance analysis - suggest switching to Annual and using monthly average of %.3f.", Name, SolFracAnnRpt )
											else	PostError( "Selection of Monthly solar fractions for DHWSys '%s' invalid for compliance analysis.", Name )
											endif  endif  }
	"Prevent use of DwellUnitType monthly DHW solar fractions when doing T-24 compliance analysis"
		DwellUnitType:Action	= {	if (IfValidAnd( NumAssigningDUs > 0.5 )==0 .OR. IfValidAnd( AssignedDUFlrArea > 0.1 )==0 .OR.
												 IfValidAnd( HtEqpUsedAsDHWHtr > 0.5 )==0 .OR. DHWSolFracType != 2) then  UNCHANGED
											else	if (IfValidAnd( DHWSolFracMonAvg > 0 ))
													then	PostError( "Selection of Monthly solar fractions for DwellUnitType '%s' invalid for compliance analysis - suggest switching to Annual and using monthly average of %.3f.", Name, DHWSolFracMonAvg )
													else	PostError( "Selection of Monthly solar fractions for DwellUnitType '%s' invalid for compliance analysis.", Name )
													endif  endif  }

   "Prevent simulation of more than one assigned DHWSolarSys"     ; SAC 2/3/20 (tic #1198)
      ResProj:Action  = {  if (SumAll( DHWSolSys:DHWSysAssigned ) < 2 .OR. IfValidAnd( Proj:EnableResearchMode > 0 )) then  UNCHANGED
                        else  PostError( "Only one DHWSolarSys can be assigned to serve DHWSystem(s) per building when performing compliance analysis." )  endif  }

   "Prevent code-related DHWSolarSys issues"    DHWSolSys:Action  =      ; SAC 6/29/20 (tic #1210)   ; move this check for Com to data model RULE - SAC 05/01/23 (tic #3489)
      {  if (IfValidAnd( Proj:IsComRuleset > 0 ) .OR. IfValidAnd( DHWSysAssigned < 1 ) .OR. IfValidAnd( Proj:EnableResearchMode > 0 ) .OR.
             IfValidAnd( ErrID > 0 )==0 .OR. IfValidAnd( ErrID < 100 )) then  UNCHANGED
         else  PostError( "DHW solar system '%s' error: %s.", Name, ErrMsg )  endif  }

; SAC 12/30/15 - throw error if HVACDist assigned to both heat/cool and heating-only systems - tic 544 - fix logic 1/4/16
	"Throw err** if HVACDist assigned to both heat/cool and heating-only systems"	ResDistSys:Action  = {  
				if (IfValidAnd( Proj:IsComRuleset > 0 )) then  UNCHANGED
            else if (FloorAreaServed < 0.1 .OR. IfValidAnd( ResProj:CondFloorArea > 1 ) == 0) then  UNCHANGED
				else if (ServesCooling < 1 .OR. ServesCooling == ServesHeating) then  UNCHANGED
				else	PostError( "Distribution system '%s' is assigned to both heat+cool and heating-only systems, which is not allowed in compliance analysis.", Name )
            endif endif endif  }

; SAC 5/11/15 - check to confirm valid Attic assigned for supply and return ducts if needed (issue 536)
	"Check confirm that Attic selected for active distribution systems are valid"
		ResDistSys:Action	= {	if (FloorAreaServed < 0.1 .OR. IfValidAnd( Type = 1 )==0) then  UNCHANGED
										else if (LocalCompAssigned( SupplyDuctAttic ) == 0)
										then	PostError( "HVACDist '%s' is specified to have ducts located in an attic, but no attic is selected for the supply ducts.", Name )
										else if (IfValidAnd( SupplyDuctAttic:FloorArea <= 0 ))
										then	PostError( "HVACDist '%s' has an invalid attic '%s' (with no floor area) specified as the location of the supply ducts.", Name, SupplyDuctAttic:Name )
										else if (LocalCompAssigned( ReturnDuctAttic ) == 0)
										then	PostError( "HVACDist '%s' is specified to have ducts located in an attic, but no attic is selected for the return ducts.", Name )
										else if (IfValidAnd( ReturnDuctAttic:FloorArea <= 0 ))
										then	PostError( "HVACDist '%s' has an invalid attic '%s' (with no floor area) specified as the location of the return ducts.", Name, ReturnDuctAttic:Name )
										else	UNCHANGED  endif endif endif endif endif  }

; SAC 5/14/15 - check to confirm valid SupplyDuctLoc/ReturnDuctLoc assigned for supply and return ducts if needed (issue 536)
	"Check confirm that SupplyDuctLoc selected for active distribution systems are valid"
		ResDistSys:Action	= {	if (FloorAreaServed < 0.1 .OR. IfValidAnd( Type = 13 )==0) then  UNCHANGED
										else if (LocalCompAssigned( SupplyDuctLoc ) == 0)
										then	PostError( "HVACDist '%s' is specified to have ducts located in multiple places, but no zone/attic/garage/crawlspace is selected for the supply ducts.", Name )
										else if (LocalCompAssigned( SupplyDuctLoc ) = ComponentType( "ResAttic" ))
										then	if (IfValidAnd( SupplyDuctLoc:FloorArea <= 0 ))
												then	PostError( "HVACDist '%s' has an invalid attic '%s' (with no floor area) specified as the location of the supply ducts.", Name, SupplyDuctLoc:Name )
												else	UNCHANGED  endif
										else	UNCHANGED  endif endif endif  }
	"Check confirm that ReturnDuctLoc selected for active distribution systems are valid"
		ResDistSys:Action	= {	if (FloorAreaServed < 0.1 .OR. IfValidAnd( Type = 13 )==0) then  UNCHANGED
										else if (LocalCompAssigned( ReturnDuctLoc ) == 0)
										then	PostError( "HVACDist '%s' is specified to have ducts located in multiple places, but no zone/attic/garage/crawlspace is selected for the return ducts.", Name )
										else if (LocalCompAssigned( ReturnDuctLoc ) = ComponentType( "ResAttic" ))
										then	if (IfValidAnd( ReturnDuctLoc:FloorArea <= 0 ))
												then	PostError( "HVACDist '%s' has an invalid attic '%s' (with no floor area) specified as the location of the return ducts.", Name, ReturnDuctLoc:Name )
												else	UNCHANGED  endif
										else	UNCHANGED  endif endif endif  }
												
; mjb	5/6/14 add check for QII and Buried Duct combo
	"Check for QII and Buried Ducts"		ResDistSys:Action	= {	if (FloorAreaServed < 0.1) then  UNCHANGED
																					else if (AreBuried .OR. AreDeeplyBuried) then 
																						if (ResProj:InsulConsQuality < 1.5) then PostError( "HVACDist '%s' has buried and/or deeply buried ducts. To get compliance credit, this project must also have Quality Insulation Installation (QII).", Name ) 
																						else UNCHANGED endif
																					else UNCHANGED endif endif	}

   ; SAC 7/20/17 - added check to prevent Cons objects from being assigned to both new and non-new zone surfaces (when QII being modeled) (tic #775)
   ; SAC 5/18/18 - revised logic to accommodate QII mods caused by ResExtWall:Exception (tic #798)
   ; SAC 4/21/19 - added logic to prevent this error for Std or DRtg runs
   ; moved this rule posting error related to Cons assigned to surfaces of New and non-New zones up here from CheckSim rulelist so that it is triggered before sizing run(s) - SAC 06/29/23 (tic #3479)
   "Check for constructions assigned to both new and non-new zone surfaces (when QII being modeled)"   ResConsAssm:Action  = {
      if ( ResProj:ICQEnclCavInsMult <= ResProj:StdICQEnclCavInsMult) then  UNCHANGED  ; no QII selected
      else if ( ResProj:RunAbbrev == "s" .OR. ResProj:RunAbbrev == "zb" .OR. ResProj:RunAbbrev == "smf" .OR. ResProj:RunAbbrev == "dr") then  UNCHANGED  ; no error for Std or DRtg runs
      else if (IfValidAnd( SurfacesQIIDegraded > 0 )==0 .OR. IfValidAnd( SurfacesQIINotDegraded > 0 )==0) then  UNCHANGED
      else if (CanAssignTo == 7 .OR. CanAssignTo == 8) then  UNCHANGED  ; n/a to Attic Roofs, Slab or Und Flrs  ; now applicable to attic roofs (tic #775) - SAC 5/18/18
      else  switch (Type)
               case  2 :  UNCHANGED  ; "Concrete / ICF / Brick"  - walls
               case  3 :  UNCHANGED  ; "Hollow Unit Masonry"     - walls 
               case  4 :  UNCHANGED  ; "Adobe / Strawbale / Log" - walls
               case  9 :  UNCHANGED  ; "No Frame (concrete/CMU)" - walls/floors
               case 25 :  UNCHANGED  ; "Concrete / ICF / Brick"  - floors
               default :  PostError( "Construction '%s' is referenced by surfaces of both New Zones (w/ no exception) and other Zones/Garages (or w/ exceptions) which is not allowed when modeling Improved Construction Quality", Name )
            endswitch  endif endif endif endif  }

   ; SAC 5/14/18 - add check to ensure that if QII = Improved then at least one surface in the model will benefit in the simulation (tic #775)
   ; SAC 5/18/18 - revised logic slightly to accommodate wall exception input (tic #798)
   ; switch error to warning for QII set but not applicable for 2022.3.1 and future releases - SAC 04/15/24 (tic #1360)
   "Check for presence of at least one surface benefitting by QII = Improved"    ResProj:Action  = {  
         if (InsulConsQuality < 1.5 .OR.
             SumAll( ResCeilingBelowAttic:ICQAtticBypassApplies ) > 0) then UNCHANGED
         else if (SumAcrossIf( ResConsAssm:SurfacesQIINotDegraded, ResConsAssm:AssignedSurfaceArea > 0 ) > 0) then UNCHANGED
         else if (IfValidAnd( EnergyCodeYearNum >= 2019 ))
         then  if (IfValidAnd( Proj:AnalysisVersion >= 220301 )) 
               then  PostWarning( "Quality Insulation Installation (QII) is set to 'Yes' but no surfaces in the model can benefit from this setting. QII applies only to surfaces of New Zones/Attics." )
               else  PostError(   "Quality Insulation Installation (QII) is set to 'Yes' but no surfaces in the model can benefit from this setting. QII applies only to surfaces of New Zones/Attics." )  endif
         else  PostError( "Insulation Construction Quality is set to 'Improved' but no surfaces in the model can benefit from this setting. Improved InsulConsQuality applies only to surfaces of New Zones/Attics." )  endif endif endif  }

; SAC 1/3/16 - check for ResDistSys:DuctInsRvalOpt too high in certain cases (tic 597)
   ; SAC 4/18/19 - added logic to perform different high duct R-val error logic for pre- & post-2019 models (2019+ based on DuctSeg) (tic #874)
	"Check for ResDistSys:DuctInsRvalOpt exceeding allowed value when duct design not verified"
		ResDistSys:Action	= {
		   if (FloorAreaServed < 0.1 .OR. Status == 1 .OR. DefaultSystem > 0.5) then  UNCHANGED
			else if (DuctDesign < 0.5 .AND. IfValidAnd( DuctInsRvalOpt >= 801 )) 
			then	PostError( "Duct insulation R-value of HVACDist '%s' (R-%g) exceeds the maximum of R-8 allowed for ducts that are not verified and buried.", Name, (DuctInsRvalOpt/100) )
			else if ( Proj:StdDesignBase <= 2016 .AND. DuctDesign > 0.5 .AND. IfValidAnd( AreBuried < 0.5 ) .AND. IfValidAnd( AreDeeplyBuried < 0.5 ) .AND.
						(IfValidAnd( DuctDesignInsRvalue > 8 ) .OR. IfValidAnd( RetDuctDesignInsRvalue > 8 ))) 
			then	if (IfValidAnd( DuctDesignInsRvalue > 8 ) .AND. IfValidAnd( RetDuctDesignInsRvalue > 8 ))
					then	PostError( "Supply and return duct R-values of HVACDist '%s' (R-%g and R-%g respectively) cannot exceed R-8 unless verified and buried.", Name, DuctDesignInsRvalue, RetDuctDesignInsRvalue )
					else if (IfValidAnd( DuctDesignInsRvalue > 8 ))
					then	PostError( "Supply duct R-value of HVACDist '%s' (R-%g) cannot exceed R-8 unless verified and buried.", Name,    DuctDesignInsRvalue )
					else	PostError( "Return duct R-value of HVACDist '%s' (R-%g) cannot exceed R-8 unless verified and buried.", Name, RetDuctDesignInsRvalue )
					endif endif
			else if ( Proj:StdDesignBase >= 2019 .AND. DuctDesign > 0.5 .AND. IfValidAnd( SupplyDuctArea > 0 )==0 .AND. IfValidAnd( ReturnDuctArea > 0 )==0)
			then	PostError( "At least one valid duct segment must be defined for HVACDist '%s', when Verified Duct Design is selected.", Name )
			else if ( Proj:StdDesignBase >= 2019 .AND. DuctDesign > 0.5 .AND. SumChildren( ResDuctSeg:DuctRTooHiError ) > 0)
			then	PostError( "%g duct design segment(s) of HVACDist '%s' are defiend as 'Buried (per ACM)' with duct R-values that exceed the maximum R-8.", SumChildren( ResDuctSeg:DuctRTooHiError ), Name )
			else	UNCHANGED  endif endif endif endif endif  }

;; SAC 11/20/13 - disable E+A+A
;	"Check RunScope"	ResProj:Action	= {	if (RunScope != 1) then  PostError( "Project RunScope not yet implemented - must be set back to default of 'Newly Constructed' to perform analysis." )  else  UNCHANGED  endif  }
;	"Check ResExtWall:Status          "		ResExtWall:Action          	= {	if (Status != 3) then  PostError(           "ExtWall Status not yet implemented - '%s' Status must be set back to default of 'New' to perform compliance analysis", Name )  else  UNCHANGED  endif  }
;	"Check ResExtFlr:Status    "		ResExtFlr:Action    	= {	if (Status != 3) then  PostError(     "ExteriorFloor Status not yet implemented - '%s' Status must be set back to default of 'New' to perform compliance analysis", Name )  else  UNCHANGED  endif  }
;	"Check ResCathedralCeiling:Status "		ResCathedralCeiling:Action 	= {	if (Status != 3) then  PostError(  "CathedralCeiling Status not yet implemented - '%s' Status must be set back to default of 'New' to perform compliance analysis", Name )  else  UNCHANGED  endif  }
;	"Check ResCeilingBelowAttic:Status"		ResCeilingBelowAttic:Action	= {	if (Status != 3) then  PostError( "CeilingBelowAttic Status not yet implemented - '%s' Status must be set back to default of 'New' to perform compliance analysis", Name )  else  UNCHANGED  endif  }
;	"Check ResFlrOverCrawlSpc:Status   "		ResFlrOverCrawlSpc:Action   	= {	if (Status != 3) then  PostError(    "FloorOverCrawl Status not yet implemented - '%s' Status must be set back to default of 'New' to perform compliance analysis", Name )  else  UNCHANGED  endif  }
;	"Check Window:Status           "		Window:Action           	= {	if (Status != 3) then  PostError(            "Window Status not yet implemented - '%s' Status must be set back to default of 'New' to perform compliance analysis", Name )  else  UNCHANGED  endif  }

;  LH 170524 Added Checks to ensure ResDHWSys:Status consistancy
  "Check DHWSys1:Status is consistent with assignment from zone"  ResZn:DHWSys1 = {
    if ( DHWSys1Status != 3 .OR.    ;  New
         LocalCompAssigned( DHWSys1 ) < 1 )
    then UNCHANGED
    else if ( DHWSys1:Status = 3 )  ;  New
    then UNCHANGED
    else PostError( "DHW System '%s' is assigned status '%s' due to the predominant status of all of the 
                     zones to which it is assigned.  However it is referenced as '%s' from zone '%s'.
                     Please update inputs for consistancy.",  
                     DHWSys1:Name, LocalRefSymbolString( DHWSys1:Status ), 
                     LocalSymbolString( DHWSys1Status ), Name )
    endif endif }      

  "Check AltDHWSys1:Status is consistent with assignment from zone"  ResZn:AltDHWSys1 = {
    if ( DHWSys1Status != 2 .OR.       ;  Altered
         LocalCompAssigned( AltDHWSys1 ) < 1 )       
    then UNCHANGED
    else if ( AltDHWSys1:Status = 2 )  ;  Altered
    then UNCHANGED
    else PostError( "DHW System '%s' is assigned status '%s' due to the predominant status of all of the 
                     zones to which it is assigned.  However it is referenced as '%s' from zone '%s'.
                     Please update inputs for consistancy.",  
                     AltDHWSys1:Name, LocalRefSymbolString( AltDHWSys1:Status ), 
                     LocalSymbolString( DHWSys1Status ), Name )
    endif endif }     

  "Check exDHWSys1:Status is consistent with assignment from zone"  ResZn:exDHWSys1 = {
    if ( DHWSys1Status = 3 .OR.
       ( DHWSys1Status = 2 .AND. DHWSys1Verified = 0 ) .OR.
         LocalCompAssigned( exDHWSys1 ) < 1 )
    then UNCHANGED
    else if ( exDHWSys1:Status = 1 )  ;  Existing
    then UNCHANGED
    else PostError( "DHW System '%s' is assigned status '%s' due to the predominant status of all of the 
                     zones to which it is assigned.  However it is referenced as '%s' from zone '%s'.
                     Please update inputs for consistancy.",  
                     exDHWSys1:Name, LocalRefSymbolString( exDHWSys1:Status ), 
                     LocalSymbolString( DHWSys1Status ), Name )
    endif endif }     

   "Prevent analysis when a second DHWSys assignment to Zone is found (starting in v2019.2.0)"     ResZn:Action =     ; SAC 07/20/21
      {  if (IfValidAnd( Proj:AnalysisVersion >= 190200 )==0 .OR.
             Proj:IsComRuleset) then  UNCHANGED
         else if (DHWSys2Status == 3 .AND. LocalCompAssigned(    DHWSys2 ) > 0)  ;  New
         then  PostError( "Zone '%s' includes a second (new) DHWSys assignment (%s), which is no longer allowed in compliance analysis.", Name, DHWSys2:Name )
         else if (DHWSys2Status == 2 .AND. LocalCompAssigned( AltDHWSys2 ) > 0)  ;  Altered
         then  PostError( "Zone '%s' includes a second (altered) DHWSys assignment (%s), which is no longer allowed in compliance analysis.", Name, AltDHWSys2:Name )
         else if (DHWSys2Status == 1 .AND. LocalCompAssigned(  exDHWSys2 ) > 0)  ;  Existing
         then  PostError( "Zone '%s' includes a second (existing) DHWSys assignment (%s), which is no longer allowed in compliance analysis.", Name, exDHWSys2:Name )
         else  UNCHANGED  endif endif endif endif  }

  "Check DHWSys2:Status is consistent with assignment from zone"  ResZn:DHWSys2 = {
    if ( IfValidAnd( Proj:AnalysisVersion >= 190200 ) .OR.
         DHWSys2Status != 3 .OR.    ;  New
         LocalCompAssigned( DHWSys2 ) < 1 )       
    then UNCHANGED
    else if ( DHWSys2:Status = 3 )  ;  New
    then UNCHANGED
    else PostError( "DHW System '%s' is assigned status '%s' due to the predominant status of all of the 
                     zones to which it is assigned.  However it is referenced as '%s' from zone '%s'.
                     Please update inputs for consistancy.",  
                     DHWSys2:Name, LocalRefSymbolString( DHWSys2:Status ), 
                     LocalSymbolString( DHWSys2Status ), Name )
    endif endif }      

  "Check AltDHWSys2:Status is consistent with assignment from zone"  ResZn:AltDHWSys2 = {
    if ( IfValidAnd( Proj:AnalysisVersion >= 190200 ) .OR.
         DHWSys2Status != 2 .OR.       ;  Altered
         LocalCompAssigned( AltDHWSys2 ) < 1 )
    then UNCHANGED
    else if ( AltDHWSys2:Status = 2 )  ;  Altered
    then UNCHANGED
    else PostError( "DHW System '%s' is assigned status '%s' due to the predominant status of all of the 
                     zones to which it is assigned.  However it is referenced as '%s' from zone '%s'.
                     Please update inputs for consistancy.",  
                     AltDHWSys2:Name, LocalRefSymbolString( AltDHWSys2:Status ), 
                     LocalSymbolString( DHWSys2Status ), Name )
    endif endif }     

  "Check exDHWSys2:Status is consistent with assignment from zone"  ResZn:exDHWSys2 = {
    if ( IfValidAnd( Proj:AnalysisVersion >= 190200 ) .OR.
         DHWSys2Status != 1 .OR.      ;  Existing
         LocalCompAssigned( exDHWSys2 ) < 1 )
    then UNCHANGED
    else if ( exDHWSys2:Status = 1 )  ;  Existing
    then UNCHANGED
    else PostError( "DHW System '%s' is assigned status '%s' due to the predominant status of all of the 
                     zones to which it is assigned.  However it is referenced as '%s' from zone '%s'.
                     Please update inputs for consistancy.",  
                     exDHWSys2:Name, LocalRefSymbolString( exDHWSys2:Status ), 
                     LocalSymbolString( DHWSys2Status ), Name )
    endif endif } 

  "Check exDHWSys1 assignment to AltDHWSys1 is consistent from all zones"  ResZn:Action = {
    if( Proj:IsSFamResRuleset .AND. ResProj:RunScope == 2 .AND.
             LocalCompAssigned( AltDHWSys1 ) .AND.
             DHWSys1Verified .AND. LocalCompAssigned( exDHWSys1 ) )
    then
      if( exDHWSys1 != AltDHWSys1:VerifExDHWSysRef )
      then PostError( "Altered DHW system '%s' associated with verified existing DHW system '%s'.  However,
                       from Zone '%s', '%s' is also associated with verified existing DHW system '%s'.  Each 
                       altered DHW system can be associated with one and only one verified existing DHW
                       system.  Please modify inputs for consistancy.",  
                       AltDHWSys1:Name, AltDHWSys1:VerifExDHWSysRef,
                       Name, AltDHWSys1, exDHWSys1 )
      else UNCHANGED
      endif 
    else UNCHANGED
    endif } 

  "Check exDHWSys2 assignment to AltDHWSys2 is consistent from all zones"  ResZn:Action = {
    if( IfValidAnd( Proj:AnalysisVersion >= 190200 )==0 .AND.
        Proj:IsSFamResRuleset .AND. IfValidAnd( ResProj:RunScope == 2 ) .AND.
        LocalCompAssigned( AltDHWSys2 ) .AND.
        DHWSys2Verified .AND. LocalCompAssigned( exDHWSys2 ) )
    then
      if( exDHWSys2 != AltDHWSys2:VerifExDHWSysRef )
      then PostError( "Altered DHW system '%s' associated with verified existing DHW system '%s'.  However,
                       from Zone '%s', '%s' is also associated with verified existing DHW system '%s'.  Each 
                       altered DHW system can be associated with one and only one verified existing DHW
                       system.  Please modify inputs for consistancy.",  
                       AltDHWSys2:Name, AltDHWSys2:VerifExDHWSysRef,
                       Name, AltDHWSys2, exDHWSys2 )
      else UNCHANGED
      endif 
    else UNCHANGED
    endif }



;  LH 170524 Added Checks to ensure ResWtrHtr:Status consistancy
  "Check ResWtrHtr:Status[1] is consistent with ResDHWSys:Status" ResDHWSys:Action = {
    if( IfValidAnd( IsReferenced = 1 ) .AND. 
        IfValidAnd( DHWHeater[1]:Status > 0 ) )
    then 
      if( DHWHeater[1]:Status != HeaterStatus[1]  .AND. 
          IfValidAnd( HeaterMultFlt[1] > 0 ) )
      then PostError( "A DHW Heater may only be referenced by more than one DHW System if the DHW Systems have 
                       the same Status. 
                       DHW Heater '%s', is referenced by %s DHW System '%s', however it is also referenced by
                       another DHW System with Status '%s'.", 
                       DHWHeater[1]:Name, 
                       LocalSymbolString( Status ), Name, 
                       EnumString( DHWHeater[1]:Status ) ) 
      else UNCHANGED
      endif
    else UNCHANGED
    endif }

  "Check ResWtrHtr:Status[2] is consistent with ResDHWSys:Status" ResDHWSys:Action = {
    if( IfValidAnd( IsReferenced = 1 ) .AND. 
        IfValidAnd( DHWHeater[2]:Status > 0 ) )
    then 
      if( DHWHeater[2]:Status != HeaterStatus[2]  .AND. 
          IfValidAnd( HeaterMultFlt[2] > 0 ) )
      then PostError( "A DHW Heater may only be referenced by more than one DHW System if the DHW Systems have 
                       the same Status. 
                       DHW Heater '%s', is referenced by %s DHW System '%s', however it is also referenced by
                       another DHW System with Status '%s'.",
                       DHWHeater[2]:Name, 
                       LocalSymbolString( Status ), Name, 
                       EnumString( DHWHeater[2]:Status ) )
     else UNCHANGED
      endif
    else UNCHANGED
    endif }

  "Check ResWtrHtr:Status[3] is consistent with ResDHWSys:Status" ResDHWSys:Action = {
    if( IfValidAnd( IsReferenced = 1 ) .AND. 
        IfValidAnd( DHWHeater[3]:Status > 0 ) )
    then 
      if( DHWHeater[3]:Status != HeaterStatus[3] .AND. 
          IfValidAnd( HeaterMultFlt[3] > 0 ) )
      then PostError( "A DHW Heater may only be referenced by more than one DHW System if the DHW Systems have 
                       the same Status. 
                       DHW Heater '%s', is referenced by %s DHW System '%s', however it is also referenced by
                       another DHW System with Status '%s'.",
                       DHWHeater[3]:Name, 
                       LocalSymbolString( Status ), Name, 
                       EnumString( DHWHeater[3]:Status ) )
      else UNCHANGED
      endif
    else UNCHANGED
    endif }

  "Check ResWtrHtr:Status[4] is consistent with ResDHWSys:Status" ResDHWSys:Action = {
    if( IfValidAnd( IsReferenced = 1 ) .AND. 
        IfValidAnd( DHWHeater[4]:Status > 0 ) )
    then 
      if( DHWHeater[4]:Status != HeaterStatus[4]  .AND. 
          IfValidAnd( HeaterMultFlt[4] > 0 ) )
      then PostError( "A DHW Heater may only be referenced by more than one DHW System if the DHW Systems have 
                       the same Status. 
                       DHW Heater '%s', is referenced by %s DHW System '%s', however it is also referenced by
                       another DHW System with Status '%s'.",
                       DHWHeater[4]:Name, 
                       LocalSymbolString( Status ), Name, 
                       EnumString( DHWHeater[4]:Status ) )
      else UNCHANGED
      endif
    else UNCHANGED
    endif }

  "Check ResWtrHtr:Status[5] is consistent with ResDHWSys:Status" ResDHWSys:Action = {
    if( IfValidAnd( IsReferenced = 1 ) .AND. 
        IfValidAnd( DHWHeater[5]:Status > 0 ) )
    then 
      if( DHWHeater[5]:Status != HeaterStatus[5]  .AND. 
          IfValidAnd( HeaterMultFlt[5] > 0 ) )
      then PostError( "A DHW Heater may only be referenced b more than one DHW System if the DHW Systems have 
                       the same Status. 
                       DHW Heater '%s', is referenced by %s DHW System '%s', however it is also referenced by
                       another DHW System with Status '%s'.",
                       DHWHeater[5]:Name, 
                       LocalSymbolString( Status ), Name, 
                       EnumString( DHWHeater[5]:Status ) )
      else UNCHANGED
      endif
    else UNCHANGED
    endif }

  "Check ResWtrHtr:Status[6] is consistent with ResDHWSys:Status" ResDHWSys:Action = {
    if( IfValidAnd( IsReferenced = 1 ) .AND. 
        IfValidAnd( DHWHeater[6]:Status > 0 ) )
    then 
      if( DHWHeater[6]:Status != HeaterStatus[6]  .AND. 
          IfValidAnd( HeaterMultFlt[6] > 0 ) )
      then PostError( "A DHW Heater may only be referenced by more than one DHW System if the DHW Systems have 
                       the same Status. 
                       DHW Heater '%s', is referenced by %s DHW System '%s', however it is also referenced by
                       another DHW System with Status '%s'.",
                       DHWHeater[6]:Name, 
                       LocalSymbolString( Status ), Name, 
                       EnumString( DHWHeater[6]:Status ) )
      else UNCHANGED
      endif
    else UNCHANGED
    endif }

; remove check preventing UEF-rated Existing DHWHeaters - SAC 08/14/20 (tic #1052)
;  "Check ResWtrHtr:HeaterType is EF rated for Existing DHWHeaters" ResWtrHtr:Action = {
;    if( IfValidAnd( ResWtrHtr:Status > 0 ) )
;    then 
;      if( ResWtrHtr:Status = 1  .AND.
;          ( ResWtrHtr:HeaterType < 2 .OR.
;            ResWtrHtr:HeaterType > 6 ) )
;      then PostError( "Existing DHW Heater '%s' is a UEF or Thermal Efficiency rated DHW Heater Type.
;                       Existing DHW heaters may only be specified as EF rated systems, i.e.:
;                       Small Storage, 
;                       Small Instantaneous, 
;                       Large Storage, 
;                       Large Instantaneous.",
;                       ResWtrHtr:Name )
;      else UNCHANGED
;      endif
;    else UNCHANGED
;    endif }

END

;*************************************************************************
RULELIST "ProposedModelSimulationCheck" 1 0 0 0
;
;   Rules which are executed on the input building description to ensure
;   that there aren't any errors or omissions in the user model that might
;   prevent simulation.
;
;*************************************************************************
;"log status"   ResProj:Action = {  if (DevMode==0 .OR. LocalStatus(RunAbbrev) < 1 .OR. EnergyCodeYearNum < 2019) then  UNCHANGED  else
;   PostMessageToLog( "    evaluating 'ProposedModelSimulationCheck' rules on '%s' model...", RunAbbrev )  endif  }

; revised several rules to be ignored for Com models where ResDwellUnits toggled OFF - SAC 05/18/22

	"Check for existence of at least one zone object - and prevent OtherZones in SFam models"    ; SAC 9/10/19 - added OtherZone check (MFamProto)
		ResProj:Action	= {	if (IfValidAnd( IsComRuleset > 0 ) .AND. IfValidAnd( Proj:ResDwellUnits > 0 )==0) then  UNCHANGED
                        else if (AnalysisType > 0 .AND. ComponentCount( Zone ) < 1)		; SAC 2/4/16 - disable check for 'Research' mode
								then  PostError( "At least one Zone object must be present in the model prior to simulation" )
								else if (AnalysisType > 0 .AND. IsMultiFamily == 0 .AND. SumAll( ResOtherZn:Area ) > 0.1 .AND.
                                 IfValidAnd( Proj:EnableResearchMode > 0 )==0 .AND. IfValidAnd( BypassRuleLimits > 0 )==0)
								then  PostError( "OtherZone objects cannot be present in single family projects" )
								else  UNCHANGED  endif endif endif  }


  ; SAC 6/24/14 - prevent selection of ZonalControl for Multifamily models (incompatible w/ new DwellUnitType & DwellUnit objects)
	"Prevent selection of ZonalControl for Multifamily models"
		ResProj:Action	= {	if (ZonalControl > 0.5 .AND. IsMultiFamily > 0.5)
								then  PostError( "Zonal Control Credit is not an available analysis option for multifamily buildings." )  else  UNCHANGED  endif  }

;"debug" ResProj:Action = { PostMessageToLog( "Max Res flr mult: %g / CondWinAreaCFARat: %g", MaxAll( ResZnGrp:Mult ), CondWinAreaCFARat ) }
   "global check for sufficient Window area - ResProj:CondWinAreaCFARat > 0.05"     ResProj:Action =     ; SAC 09/30/21
      {  if (IfValidAnd( IsComRuleset > 0 ) .AND. IfValidAnd( Proj:ResDwellUnits > 0 )==0) then  UNCHANGED
         else if (RunScope = 1 .AND. IfValidAnd( IsAddAlone > 0 )) then  UNCHANGED
         else if (IfValidAnd( CondWinAreaCFARat >= 0 )==0)
         then  PostError( "Error calculating building-wide ratio of conditioned zone window area & floor area ( ResProj:CondWinAreaCFARat)" )
         else if (IfValidAnd( CondWinAreaCFARat < 0.05 ))
         then  PostError( "Ratio of conditioned zone window area / floor area (%0.3f) deemed too small, must be >= 0.05", CondWinAreaCFARat )
         else  UNCHANGED  endif endif endif endif  }

   "global check for conditioned area and sufficient ratio of conditioned volume / floor area"     ResProj:Action =     ; SAC 09/30/21
      {  if (IfValidAnd( IsComRuleset > 0 ) .AND. IfValidAnd( Proj:ResDwellUnits > 0 )==0) then  UNCHANGED
         else if (IfValidAnd( CondFloorArea > 0 )==0)
         then  PostError( "No conditioned zone floor area found in model, must be > 0" )
         else if (ValidOr( CondVolume, 0 ) / CondFloorAreaWithMult < 7)
         then  PostError( "Ratio of conditioned zone volume / floor area (%0.1f) deemed too small, must be >= 7", ValidOr( CondVolume, 0 ) / CondFloorAreaWithMult )
         else  UNCHANGED  endif endif endif  }

; SAC 8/1/14 - removed check to prevent compliance analysis on Conditioned attics
;  ; SAC 4/25/14 - revised ResAttic:Type check to ALLOW conditioned attics when ResProj:BypassRuleLimits is set
;	"Check to ensure no ResAttic:Type = Conditioned..."		; SAC 4/7/14
;		ResAttic:Action	= {	if (FloorArea > 0.1 .AND. Type = 1 .AND. ResProj:BypassRuleLimits < 0.5) then  PostError( "Attic:Type of 'Conditioned' is not yet implemented.  Revise this input prior to performing analysis." )
;									else  UNCHANGED  endif  }

   "Check to ensure 3D-related PVArray inputs are not used unless EnableResearchMode is activated"    ResProj:Action =        ; SAC 1/18/20 (tic #1012)
      {  if (IfValidAnd( AllowPVWInputs > 0 )==0 .OR. Proj:EnableResearchMode > 0) then  UNCHANGED
         else if (IfValidAnd( PVWDCSysSize[1] > 0 ) .AND. (PVWGeomSpecMethod[1] > 0 .OR. PVWLocSpecMethod[1] > 0))
         then  PostError( "Program option (INI file) Proj:EnableResearchMode must be activated in order to simulate 3D-related PV array #1 inputs (PVWGeomSpecMethod and/or PVWLocSpecMethod)" )
         else if (IfValidAnd( PVWDCSysSize[2] > 0 ) .AND. PVWInputs > 0 .AND. (PVWGeomSpecMethod[2] > 0 .OR. PVWLocSpecMethod[2] > 0))
         then  PostError( "Program option (INI file) Proj:EnableResearchMode must be activated in order to simulate 3D-related PV array #2 inputs (PVWGeomSpecMethod and/or PVWLocSpecMethod)" )
         else if (IfValidAnd( PVWDCSysSize[3] > 0 ) .AND. PVWInputs > 0 .AND. (PVWGeomSpecMethod[3] > 0 .OR. PVWLocSpecMethod[3] > 0))
         then  PostError( "Program option (INI file) Proj:EnableResearchMode must be activated in order to simulate 3D-related PV array #3 inputs (PVWGeomSpecMethod and/or PVWLocSpecMethod)" )
         else if (IfValidAnd( PVWDCSysSize[4] > 0 ) .AND. PVWInputs > 0 .AND. (PVWGeomSpecMethod[4] > 0 .OR. PVWLocSpecMethod[4] > 0))
         then  PostError( "Program option (INI file) Proj:EnableResearchMode must be activated in order to simulate 3D-related PV array #4 inputs (PVWGeomSpecMethod and/or PVWLocSpecMethod)" )
         else if (IfValidAnd( PVWDCSysSize[5] > 0 ) .AND. PVWInputs > 0 .AND. (PVWGeomSpecMethod[5] > 0 .OR. PVWLocSpecMethod[5] > 0))
         then  PostError( "Program option (INI file) Proj:EnableResearchMode must be activated in order to simulate 3D-related PV array #5 inputs (PVWGeomSpecMethod and/or PVWLocSpecMethod)" )
         else  UNCHANGED  endif endif endif endif endif endif  }

   "Check for invalid BatteryControl options"      ; SAC 12/12/17 - alert user if invalid BattCtrl option is selected 
      ResProj:Action  = {
         if (IfValidAnd( SimulateBattery > 0 ) .AND. Proj:EnableResearchMode != 1 .AND. BatteryControl > 98)
         then  switch (BatteryControl)
                  case  99 :  PostError( "Program option (INI file) EnableResearchMode must be activated in order to simulate BatteryControl '- specify -'." )
                  case 100 :  PostError( "Program option (INI file) EnableResearchMode must be activated in order to simulate BatteryControl Best Case/Advanced Control (old)." )
                  default  :  UNCHANGED
               endswitch
         else  UNCHANGED  endif  }

   "Prevent analysis of OtherZone objects in 2019 model when BRL or RM not activated"   ResProj:Action  =            ; SAC 2/14/20 - install error check for 2019 models containing OtherZones
      {  if (IfValidAnd( AnalysisVersion >= 220000 ) .OR. 
             IfValidAnd( Proj:EnableResearchMode > 0 ) .OR. IfValidAnd( BypassRuleLimits > 0 )) then  UNCHANGED
         else if (ComponentCount( OtherZone ) < 1) then  UNCHANGED
         else  PostError( "EnableResearchMode or BypassRuleLimits program (INI) options must be activated in order to perform analsyis on OtherZone objects (%g found in this model).", ComponentCount( OtherZone ) )
         endif endif  }

   "Check to ensure all required CoolVent Zone assignments are present - Default Prescrip"   ResProj:Action  =       ; SAC 8/18/19 (tic #1115)
      {  if (IfValidAnd( EnableClVent > 0.5 )==0 .AND. IfValidAnd( LimitedClVent > 0.5 )==0) then  UNCHANGED
	      else if ( ((IsMultiFamily = 0 .AND. UnitClVentOption = 1) .OR. UnitClVentOption = 5) .AND.
                   IfValidAnd( UnitClVentCFMTot > 0 ) .AND. LocalCompAssigned( UnitClVentZone[1] ) < 1 )
         then  PostError( "Zone assignment missing for Cooling Ventilation fan." )
         else if (UnitClVentOption = 2)
         then  if (LocalCompAssigned( UnitClVentFan[1] ) > 0 .AND. ShowClVentZone > 0 .AND. LocalCompAssigned( UnitClVentZone[1] ) < 1)
               then  PostError( "Zone assignment missing for Cooling Ventilation fan #1." )
               else if (UnitClVentNumFans >= 2 .AND. LocalCompAssigned( UnitClVentFan[2] ) > 0 .AND. LocalCompAssigned( UnitClVentZone[2] ) < 1)
               then  PostError( "Zone assignment missing for Cooling Ventilation fan #2." )
               else if (UnitClVentNumFans >= 3 .AND. LocalCompAssigned( UnitClVentFan[3] ) > 0 .AND. LocalCompAssigned( UnitClVentZone[3] ) < 1)
               then  PostError( "Zone assignment missing for Cooling Ventilation fan #3." )
               else if (UnitClVentNumFans >= 4 .AND. LocalCompAssigned( UnitClVentFan[4] ) > 0 .AND. LocalCompAssigned( UnitClVentZone[4] ) < 1)
               then  PostError( "Zone assignment missing for Cooling Ventilation fan #4." )
               else if (UnitClVentNumFans >= 5 .AND. LocalCompAssigned( UnitClVentFan[5] ) > 0 .AND. LocalCompAssigned( UnitClVentZone[5] ) < 1)
               then  PostError( "Zone assignment missing for Cooling Ventilation fan #5." )
               else if (UnitClVentNumFans >= 6 .AND. LocalCompAssigned( UnitClVentFan[6] ) > 0 .AND. LocalCompAssigned( UnitClVentZone[6] ) < 1)
               then  PostError( "Zone assignment missing for Cooling Ventilation fan #6." )
               else  UNCHANGED  endif endif endif endif endif endif
         else  UNCHANGED  endif endif endif  }

; SAC 11/3/14 - added checks to ensure that all construction assignments are of the proper CanAssignTo selection for each surface in the model
;		0, ResConsAssm:CanAssignTo,  0
;		2,              0,    "Exterior Walls"  
;		2,             10,    "Interior Walls"  
;		; 2,             20,    "Underground Walls"      ; SAC 2/15/12
;		2,              1,    "Attic Roofs"  
;		2,              2,    "Cathedral Ceilings"  
;		2,              3,    "Ceilings (below attic)"  
;		2,              6,    "Interior Ceilings"        ; SAC 2/15/12 - restored by SAC 9/30/13  
;		2,              4,    "Interior Floors"  
;		2,              5,    "Exterior Floors"  
;		2,              9,    "Floors Over Crawlspace"   ; SAC 3/4/13
;		; 2,              7,    "Slab Floors"            ; SAC 2/15/12
;		; 2,              8,    "Underground Floors"     ; SAC 2/15/12

	"Prevent invalid ResAttic:Construction assignments"		ResAttic:Action	= {
						if (LocalCompAssigned( Construction ) < 0.5) then						PostError( "Attic '%s' missing its Construction reference.", Name )
						else if (IfValidAnd(   Construction:CanAssignTo ==  1 )==0) then	PostError( "Attic '%s' references incompatible construction object '%s' (CanAssignTo = '%s').", Name, Construction:Name, EnumString( Construction:CanAssignTo ) )
						else if (IfValidAnd(   Construction:DisplayInpErrMsg > 0 )) then  PostError( "Attic '%s' construction '%s':  %s", Name, Construction:Name, Construction:InputErrMsg )
						else  UNCHANGED  endif endif endif  }
	"Prevent invalid ResAttic:exConstruction assignments"		ResAttic:Action	= {
						if (IfValidAnd( FloorArea > 0.1 )==0 .OR. Status != 2 .OR. IfValidAnd( IsVerified == 1 )==0) then  UNCHANGED
						else if (LocalCompAssigned( exConstruction ) < 0.5) then				PostError( "Attic '%s' missing its existing exConstruction reference.", Name )
						else if (IfValidAnd( exConstruction:CanAssignTo ==  1 )==0) then	PostError( "Attic '%s' references incompatible construction object '%s' (CanAssignTo = '%s').", Name, Construction:Name, EnumString( Construction:CanAssignTo ) )
						else if (IfValidAnd( exConstruction:DisplayInpErrMsg > 0 )) then  PostError( "Attic '%s' existing construction '%s':  %s", Name, exConstruction:Name, exConstruction:InputErrMsg )
						else  UNCHANGED  endif endif endif endif  }

;   0, ConsAssm:CompatibleSurfType,  0
;   2,              1,    "ExteriorWall"
;   2,              2,    "Roof"
;   2,              3,    "ExteriorFloor"
;   2,              4,    "UndergroundWall"
;   2,              5,    "UndergroundFloor"
;   2,              6,    "InteriorWall"
;   2,              7,    "Ceiling"
;   2,              8,    "InteriorFloor"

	"Prevent invalid ResExtWall:Construction assignments"			ResExtWall:Action	=        ; added logic for ConsAssm - SAC 02/09/22 (MFam)
					{	if (LocalCompAssigned( Construction ) < 0.5) then						PostError( "ExtWall '%s' missing its Construction reference.", Name )
                  else if (LocalCompAssigned( Construction ) == ComponentType( "ConsAssm" ))
                  then  if (IfValidAnd(  Construction:CompatibleSurfType ==  1 )==0) then  PostError( "ExtWall '%s' references incompatible construction object '%s' (CompatibleSurfType = '%s').", Name, Construction:Name, EnumString( Construction:CompatibleSurfType ) )
                        else  UNCHANGED  endif
						else if (IfValidAnd(   Construction:CanAssignTo ==  0 )==0) then	PostError( "ExtWall '%s' references incompatible construction object '%s' (CanAssignTo = '%s').", Name, Construction:Name, EnumString( Construction:CanAssignTo ) )
						else if (IfValidAnd(   Construction:DisplayInpErrMsg > 0 )) then  PostError( "ExtWall '%s' construction '%s':  %s", Name, Construction:Name, Construction:InputErrMsg )
						else  UNCHANGED  endif endif endif endif  }
	"Prevent invalid ResExtWall:exConstruction assignments"		ResExtWall:Action	= {
						if (IfValidAnd( FloorArea > 0.1 )==0 .OR. Status != 2 .OR. IfValidAnd( IsVerified == 1 )==0) then  UNCHANGED
						else if (LocalCompAssigned( exConstruction ) < 0.5) then				PostError( "ExtWall '%s' missing its existing exConstruction reference.", Name )
                  else if (LocalCompAssigned( exConstruction ) == ComponentType( "ConsAssm" ))
                  then  if (IfValidAnd(  exConstruction:CompatibleSurfType ==  1 )==0) then  PostError( "ExtWall '%s' references incompatible construction object '%s' (CompatibleSurfType = '%s').", Name, exConstruction:Name, EnumString( exConstruction:CompatibleSurfType ) )
                        else  UNCHANGED  endif
						else if (IfValidAnd( exConstruction:CanAssignTo ==  0 )==0) then	PostError( "ExtWall '%s' references incompatible existing construction object '%s' (CanAssignTo = '%s').", Name, exConstruction:Name, EnumString( exConstruction:CanAssignTo ) )
						else if (IfValidAnd( exConstruction:DisplayInpErrMsg > 0 )) then  PostError( "ExtWall '%s' construction '%s':  %s", Name, Construction:Name, Construction:InputErrMsg )
						else  UNCHANGED  endif endif endif endif endif  }
;		"Prevent invalid ExtWall", "Exterior Wall",   "Ext Wall <pi>-<i>",      0,  0,  0, "Zone",   "Garage", "", "", "", "", "", "", "", "", "", "", "", "", "",  -1,  1,  0,  0,  0,  0,   6000
;	1,           "Construction assignments",      BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons", 0, "CanAssignTo",  6012, "Construction assembly" 
;		 CTRL, "exConstruction",    7034, TDCT_Combo,  115, 380, 300, 220, 12, FNT_STD, "Construction:",                      TA_LEFT,   -95, 4,     0, TA_LEFT, 0, 0,  None, Status = 2 And IsVerified = 1,  -100, 100,  ""
;	1,           "exConstruction assignments",    BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons", 0, "CanAssignTo",  3208, "existing construction for this (altered) wall object" 

	"Prevent invalid ResIntWall:Construction assignments"			ResIntWall:Action	= {
						if (LocalCompAssigned( Construction ) < 0.5) then						PostError( "IntWall '%s' missing its Construction reference.", Name )
						else if (IfValidAnd(   Construction:CanAssignTo == 10 )==0) then	PostError( "IntWall '%s' references incompatible construction object '%s' (CanAssignTo = '%s').", Name, Construction:Name, EnumString( Construction:CanAssignTo ) )
						else if (IfValidAnd(   Construction:DisplayInpErrMsg > 0 )) then  PostError( "IntWall '%s' construction '%s':  %s", Name, Construction:Name, Construction:InputErrMsg )
						else  UNCHANGED  endif endif endif  }
;		"Prevent invalid IntWall", "Interior Wall",   "Int Wall <pi>-<i>",     0,  0,  0, "Zone",   "Garage", "", "", "", "", "", "", "", "", "", "", "", "", "",  -1,  1,  0,  0,  0,  0,   6600
;	1,           "Construction assignments",      BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  10, "CanAssignTo",  6012, "Construction assembly" 
;		 CTRL, "exConstruction",    7034, TDCT_Combo,  115, 330, 300, 220, 12, FNT_STD, "Construction:",                      TA_LEFT,   -95, 4,     0, TA_LEFT, 0, 0,  None, ResProj:RunScope = 2 And ParCndZnAdjGarArea > 0.1 And Status = 2 And IsVerified = 1,  -100, 100,  ""
;	1,           "exConstruction assignments",    BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  10, "CanAssignTo",  3208, "existing construction for this (altered) wall object" 

;		"Prevent invalid UndWall", "Underground Wall",  "Und Wall <pi>-<i>",      0,  0,  0, "Zone",   "", "", "", "", "", "", "", "", "", "", "", "", "", "",  -1,  1,  0,  0,  0,  0,   6600
;	1,           "Construction assignments",      BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  20, "CanAssignTo",  6012, "Construction assembly" 
;	1,           "exConstruction assignments",    BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  20, "CanAssignTo",  3208, "existing construction for this (altered) wall object" 

;		"Prevent invalid CathedralCeiling",  "Cathedral Ceiling",  "Cath Clg <pi>-<i>",      0,  0,  0, "Zone",   "Garage", "", "", "", "", "", "", "", "", "", "", "", "", "",  -1,  1,  0,  0,  0,  0,   7000
;	1,           "Construction assignments",      BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",   2, "CanAssignTo",  6012, "Construction assembly" 
;		 CTRL, "exConstruction",    8215, TDCT_Combo,  145, 400, 300, 180, 12, FNT_STD, "Construction:",                      TA_LEFT,   -95, 4,     0, TA_LEFT, 0, 0,  None, Status = 2 And IsVerified = 1,  -100, 100,  ""
;	1,           "exConstruction assignments",    BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",   2, "CanAssignTo",  3208, "existing construction for this (altered) ceiling object" 

	"Prevent invalid ResCeilingBelowAttic:Construction assignments"	ResCeilingBelowAttic:Action	= {
						if (LocalCompAssigned( Construction ) < 0.5) then					PostError( "CeilingBelowAttic '%s' missing its Construction reference.", Name )
						else if (IfValidAnd(   Construction:CanAssignTo ==  3 )==0) then	PostError( "CeilingBelowAttic '%s' references incompatible construction object '%s' (CanAssignTo = '%s').", Name, Construction:Name, EnumString( Construction:CanAssignTo ) )
						else if (IfValidAnd(   Construction:DisplayInpErrMsg > 0 )) then  PostError( "CeilingBelowAttic '%s' construction '%s':  %s", Name, Construction:Name, Construction:InputErrMsg )
						else  UNCHANGED  endif endif endif  }
;		 CTRL, "exConstruction",    8213, TDCT_Combo,  145, 335, 300, 180, 12, FNT_STD, "Construction:",                      TA_LEFT,   -95, 4,     0, TA_LEFT, 0, 0,  None, Status = 2 And IsVerified = 1,  -100, 100,  ""
;	1,           "exConstruction assignments",    BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",   3, "CanAssignTo",  3208, "existing construction for this (altered) ceiling object" 

	"Prevent invalid ResIntCeiling:Construction assignments"	ResIntCeiling:Action	= {
						if (LocalCompAssigned( Construction ) < 0.5) then					PostError( "InteriorCeiling '%s' missing its Construction reference.", Name )
						else if (IfValidAnd(   Construction:CanAssignTo ==  6 )==0) then	PostError( "InteriorCeiling '%s' references incompatible construction object '%s' (CanAssignTo = '%s').", Name, Construction:Name, EnumString( Construction:CanAssignTo ) )
						else if (IfValidAnd(   Construction:DisplayInpErrMsg > 0 )) then  PostError( "InteriorCeiling '%s' construction '%s':  %s", Name, Construction:Name, Construction:InputErrMsg )
						else  UNCHANGED  endif endif endif  }
;		"Prevent invalid InteriorCeiling",   "Interior Ceiling",  "Int Clg <pi>-<i>",       0,  0,  0, "Zone",   "Garage", "", "", "", "", "", "", "", "", "", "", "", "", "",  -1,  1,  0,  0,  0,  0,   7000
;	1,           "Construction assignments",      BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  6, "CanAssignTo",  6012, "Construction assembly" 
;		 CTRL, "exConstruction",    8934, TDCT_Combo,  115, 385, 300, 210, 12, FNT_STD, "Construction:",                      TA_LEFT,   -95, 4,     0, TA_LEFT, 0, 0,  None, Status = 2 And IsVerified = 1,  -100, 100,  ""
;	1,           "exConstruction assignments",    BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  6, "CanAssignTo",  3208, "existing construction for this (altered) ceiling object" 

;		"Prevent invalid ExteriorFloor",     "Exterior Floor",  "Ext Flr <pi>-<i>",     0,  0,  0, "Zone",   "Garage", "", "", "", "", "", "", "", "", "", "", "", "", "",  -1,  1,  0,  0,  0,  0,   7000
;	1,           "Construction assignments",      BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  5, "CanAssignTo",  6012, "Construction assembly" 
;		 CTRL, "exConstruction",    8610, TDCT_Combo,  145, 340, 300, 220, 12, FNT_STD, "Construction:",                      TA_LEFT,   -95, 4,     0, TA_LEFT, 0, 0,  None, Status = 2 And IsVerified = 1,  -100, 100,  ""
;	1,           "exConstruction assignments",    BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  5, "CanAssignTo",  3208, "existing construction for this (altered) floor object" 

	"Prevent invalid ResFlrOverCrawlSpc:Construction assignments"	ResFlrOverCrawlSpc:Action	= {
						if (LocalCompAssigned( Construction ) < 0.5) then					PostError( "FloorOverCrawl '%s' missing its Construction reference.", Name )
						else if (IfValidAnd(   Construction:CanAssignTo ==  9 )==0) then	PostError( "FloorOverCrawl '%s' references incompatible construction object '%s' (CanAssignTo = '%s').", Name, Construction:Name, EnumString( Construction:CanAssignTo ) )
						else if (IfValidAnd(   Construction:DisplayInpErrMsg > 0 )) then  PostError( "FloorOverCrawl '%s' construction '%s':  %s", Name, Construction:Name, Construction:InputErrMsg )
						else  UNCHANGED  endif endif endif  }
;		 CTRL, "exConstruction",    8614, TDCT_Combo,  145, 305, 300, 180, 12, FNT_STD, "Construction:",                      TA_LEFT,   -95, 4,     0, TA_LEFT, 0, 0,  None, Status = 2 And IsVerified = 1,  -100, 100,  ""
;	1,           "exConstruction assignments",    BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  9, "CanAssignTo",  3208, "existing construction for this (altered) floor object" 

	"Prevent invalid ResIntFlr:Construction assignments"	ResIntFlr:Action	= {
						if (LocalCompAssigned( Construction ) < 0.5) then					PostError( "InteriorFloor '%s' missing its Construction reference.", Name )
						else if (IfValidAnd(   Construction:CanAssignTo ==  4 )==0) then	PostError( "InteriorFloor '%s' references incompatible construction object '%s' (CanAssignTo = '%s').", Name, Construction:Name, EnumString( Construction:CanAssignTo ) )
						else if (IfValidAnd(   Construction:DisplayInpErrMsg > 0 )) then  PostError( "InteriorFloor '%s' construction '%s':  %s", Name, Construction:Name, Construction:InputErrMsg )
						else  UNCHANGED  endif endif endif  }
;		"Prevent invalid InteriorFloor",     "Interior Floor",  "Int Flr <pi>-<i>",     0,  0,  0, "Zone",   "", "", "", "", "", "", "", "", "", "", "", "", "", "",  -1,  1,  0,  0,  0,  0,   7000
;	1,           "Construction assignments",      BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  4, "CanAssignTo",                       6012, "Construction assembly" 
;		 CTRL, "exConstruction",    8834, TDCT_Combo,  115, 385, 300, 210, 12, FNT_STD, "Construction:",                      TA_LEFT,   -95, 4,     0, TA_LEFT, 0, 0,  None, Status = 2 And IsVerified = 1,  -100, 100,  ""
;	1,           "exConstruction assignments",    BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  4, "CanAssignTo",  3208, "existing construction for this (altered) floor object" 

;		"Prevent invalid UndFloor",     "Underground Floor",   "Und Flr <pi>-<i>",     0,  0,  0, "Zone",   "", "", "", "", "", "", "", "", "", "", "", "", "", "",  -1,  1,  0,  0,  0,  0,   7000
;	1,           "Construction assignments",      BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  8, "CanAssignTo",  6012, "Construction assembly" 
;	1,           "exConstruction assignments",    BEMP_Obj,  1,  0,  0, "",                 0,  1, "Cons",  8, "CanAssignTo",  3208, "existing construction for this (altered) floor object" 

   ; moved rule posting error related to Cons assigned to surfaces of New and non-New zones up into CODECHECK rulelist so that it is triggered before sizing run(s) - SAC 06/29/23 (tic #3479)

; SAC 10/31/17 - added  (tic #917)
   "check to ensure all Cons cavity path material layers that should be assigned are"  ResConsAssm:Action = {
         if (IfValidAnd( AssignedSurfaceArea > 0 )==0 .OR. IfValidAnd( NumPaths = 2 )==0) then  UNCHANGED
         else if (IfValidAnd( NumLayerMats >= 1 ) .AND. LocalCompAssigned( CavityPathMats[1] ) < 1 .AND.
                  (CavityLayerRVal > 0 .OR.
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[1] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[1] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing cavity layer #1 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 2 ) .AND. LocalCompAssigned( CavityPathMats[2] ) < 1 .AND.
                  (CavityLayerRVal > 0 .OR.
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[2] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[2] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing cavity layer #2 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 3 ) .AND. LocalCompAssigned( CavityPathMats[3] ) < 1 .AND.
                  (CavityLayerRVal > 0 .OR.
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[3] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[3] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing cavity layer #3 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 4 ) .AND. LocalCompAssigned( CavityPathMats[4] ) < 1 .AND.
                  (CavityLayerRVal > 0 .OR.
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[4] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[4] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing cavity layer #4 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 5 ) .AND. LocalCompAssigned( CavityPathMats[5] ) < 1 .AND.
                  (CavityLayerRVal > 0 .OR.
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[5] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[5] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing cavity layer #5 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 6 ) .AND. LocalCompAssigned( CavityPathMats[6] ) < 1 .AND.
                  (CavityLayerRVal > 0 .OR.
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[6] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[6] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing cavity layer #6 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 7 ) .AND. LocalCompAssigned( CavityPathMats[7] ) < 1 .AND.
                  (CavityLayerRVal > 0 .OR.
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[7] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[7] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing cavity layer #7 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 8 ) .AND. LocalCompAssigned( CavityPathMats[8] ) < 1 .AND.
                  (CavityLayerRVal > 0 .OR.
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[8] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[8] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing cavity layer #8 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 9 ) .AND. LocalCompAssigned( CavityPathMats[9] ) < 1 .AND.
                  (CavityLayerRVal > 0 .OR.
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[9] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[9] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing cavity layer #9 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 10 ) .AND. LocalCompAssigned( CavityPathMats[10] ) < 1 .AND.
                  (CavityLayerRVal > 0 .OR.
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[10] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[10] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing cavity layer #10 material assignment", Name )
         else  UNCHANGED  endif endif endif endif endif endif endif endif endif endif endif  }
   "check to ensure all Cons frame path material layers that should be assigned are"  ResConsAssm:Action = {
         if (IfValidAnd( AssignedSurfaceArea > 0 )==0 .OR. IfValidAnd( NumPaths = 2 )==0) then  UNCHANGED
         else if (IfValidAnd( NumLayerMats >= 1 ) .AND. LocalCompAssigned( FramePathMats[1] ) < 1 .AND.
                  (UfactorCalcMethod != 3 .OR.     ; 'Modified Zone' to handle Steel Frame cons
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[1] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[1] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing frame layer #1 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 2 ) .AND. LocalCompAssigned( FramePathMats[2] ) < 1 .AND.
                  (UfactorCalcMethod != 3 .OR.     ; 'Modified Zone' to handle Steel Frame cons
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[2] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[2] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing frame layer #2 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 3 ) .AND. LocalCompAssigned( FramePathMats[3] ) < 1 .AND.
                  (UfactorCalcMethod != 3 .OR.     ; 'Modified Zone' to handle Steel Frame cons
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[3] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[3] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing frame layer #3 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 4 ) .AND. LocalCompAssigned( FramePathMats[4] ) < 1 .AND.
                  (UfactorCalcMethod != 3 .OR.     ; 'Modified Zone' to handle Steel Frame cons
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[4] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[4] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing frame layer #4 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 5 ) .AND. LocalCompAssigned( FramePathMats[5] ) < 1 .AND.
                  (UfactorCalcMethod != 3 .OR.     ; 'Modified Zone' to handle Steel Frame cons
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[5] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[5] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing frame layer #5 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 6 ) .AND. LocalCompAssigned( FramePathMats[6] ) < 1 .AND.
                  (UfactorCalcMethod != 3 .OR.     ; 'Modified Zone' to handle Steel Frame cons
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[6] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[6] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing frame layer #6 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 7 ) .AND. LocalCompAssigned( FramePathMats[7] ) < 1 .AND.
                  (UfactorCalcMethod != 3 .OR.     ; 'Modified Zone' to handle Steel Frame cons
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[7] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[7] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing frame layer #7 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 8 ) .AND. LocalCompAssigned( FramePathMats[8] ) < 1 .AND.
                  (UfactorCalcMethod != 3 .OR.     ; 'Modified Zone' to handle Steel Frame cons
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[8] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[8] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing frame layer #8 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 9 ) .AND. LocalCompAssigned( FramePathMats[9] ) < 1 .AND.
                  (UfactorCalcMethod != 3 .OR.     ; 'Modified Zone' to handle Steel Frame cons
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[9] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[9] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing frame layer #9 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 10 ) .AND. LocalCompAssigned( FramePathMats[10] ) < 1 .AND.
                  (UfactorCalcMethod != 3 .OR.     ; 'Modified Zone' to handle Steel Frame cons
                   ((IfValidAnd( FrameLayerMapIdx[1] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[10] = FrameLayerMapIdx[1] )==0) .AND.
                    (IfValidAnd( FrameLayerMapIdx[2] > 0 )==0 .OR. IfValidAnd( LayerPropertyIndex[10] = FrameLayerMapIdx[2] )==0))))
         then  PostError( "Construction object '%s' missing frame layer #10 material assignment", Name )
         else  UNCHANGED  endif endif endif endif endif endif endif endif endif endif endif  }
   "check to ensure all Cons single path material layers that should be assigned are"  ResConsAssm:Action = {
         if (IfValidAnd( AssignedSurfaceArea > 0 )==0 .OR. IfValidAnd( NumPaths = 1 )==0) then  UNCHANGED
         else if (IfValidAnd( NumLayerMats >= 1 ) .AND. LocalCompAssigned( CavityPathMats[1] ) < 1 .AND.
                  IfValidAnd( FrameCavityLayerMat[1] = 1 )==0 .AND. IfValidAnd( FrameCavityLayerMat[2] = 1 )==0)
         then  PostError( "Construction object '%s' missing layer #1 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 2 ) .AND. LocalCompAssigned( CavityPathMats[2] ) < 1 .AND.
                  IfValidAnd( FrameCavityLayerMat[1] = 2 )==0 .AND. IfValidAnd( FrameCavityLayerMat[2] = 2 )==0)
         then  PostError( "Construction object '%s' missing layer #2 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 3 ) .AND. LocalCompAssigned( CavityPathMats[3] ) < 1 .AND.
                  IfValidAnd( FrameCavityLayerMat[1] = 3 )==0 .AND. IfValidAnd( FrameCavityLayerMat[2] = 3 )==0)
         then  PostError( "Construction object '%s' missing layer #3 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 4 ) .AND. LocalCompAssigned( CavityPathMats[4] ) < 1 .AND.
                  IfValidAnd( FrameCavityLayerMat[1] = 4 )==0 .AND. IfValidAnd( FrameCavityLayerMat[2] = 4 )==0)
         then  PostError( "Construction object '%s' missing layer #4 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 5 ) .AND. LocalCompAssigned( CavityPathMats[5] ) < 1 .AND.
                  IfValidAnd( FrameCavityLayerMat[1] = 5 )==0 .AND. IfValidAnd( FrameCavityLayerMat[2] = 5 )==0)
         then  PostError( "Construction object '%s' missing layer #5 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 6 ) .AND. LocalCompAssigned( CavityPathMats[6] ) < 1 .AND.
                  IfValidAnd( FrameCavityLayerMat[1] = 6 )==0 .AND. IfValidAnd( FrameCavityLayerMat[2] = 6 )==0)
         then  PostError( "Construction object '%s' missing layer #6 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 7 ) .AND. LocalCompAssigned( CavityPathMats[7] ) < 1 .AND.
                  IfValidAnd( FrameCavityLayerMat[1] = 7 )==0 .AND. IfValidAnd( FrameCavityLayerMat[2] = 7 )==0)
         then  PostError( "Construction object '%s' missing layer #7 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 8 ) .AND. LocalCompAssigned( CavityPathMats[8] ) < 1 .AND.
                  IfValidAnd( FrameCavityLayerMat[1] = 8 )==0 .AND. IfValidAnd( FrameCavityLayerMat[2] = 8 )==0)
         then  PostError( "Construction object '%s' missing layer #8 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 9 ) .AND. LocalCompAssigned( CavityPathMats[9] ) < 1 .AND.
                  IfValidAnd( FrameCavityLayerMat[1] = 9 )==0 .AND. IfValidAnd( FrameCavityLayerMat[2] = 9 )==0)
         then  PostError( "Construction object '%s' missing layer #9 material assignment", Name )
         else if (IfValidAnd( NumLayerMats >= 10 ) .AND. LocalCompAssigned( CavityPathMats[10] ) < 1 .AND.
                  IfValidAnd( FrameCavityLayerMat[1] = 10 )==0 .AND. IfValidAnd( FrameCavityLayerMat[2] = 10 )==0)
         then  PostError( "Construction object '%s' missing layer #10 material assignment", Name )
         else  UNCHANGED  endif endif endif endif endif endif endif endif endif endif endif  }

	; SAC 3/11/14 - added logic to bypass this check for certain Library Mats (used only for reference of certain properties)
	"Check for sufficient inputs supplied for Mat(erial) objects"  ; SAC 10/17/13 - GC issue #213
			ResMat:Action		= {	if (LocalStatus( Conductivity ) .OR. LocalStatus( ConductivityQII ) .OR. (LocalStatus( Thickness ) .AND. LocalStatus( Resistance ))) then  UNCHANGED
										else if (Name == "Ceiling Insul" .OR. Name == "Other Insul") then  UNCHANGED
										else  PostError( "Either Conductivity or both Thickness and Resistance must be specified for Material '%s' prior to performing analysis.", Name )  endif endif  }

	"Check for valid Attic assigned to each Zone to handle ClVent IZXFER object(s)"
			ResZn:Action		= {	if (IfValidAnd( ClVentAirFlow[1] > 0.01 )==0 .OR. IfValidAnd( ClVentPower[1] > 0.01 )==0 .OR. IfValidAnd( ResProj:CondFloorArea > 1 )==0) then  UNCHANGED
										else if ((SumAll( ResAttic:FloorAreaOverCond ) / ResProj:CondFloorArea) < 0.1) then  UNCHANGED		; the problem of insufficient Attic area will be reported elsewhere
										else if (LocalCompAssigned( MaxClVentableAttic ) > 0.5) then  UNCHANGED								; everything should be OK
										else	PostError( "Zone '%s' has cool vent flow and power defined, but no Attic assigned (via MaxClVentableAttic) to receive the flow.", Name )  endif endif endif  }

; removed to facilitate MFam (unused in Res) - SAC 10/19/21 (MFam)
;   ; SAC 3/4/17 - added checks for valid Shade objects
;   "Check for invalid Shade objects"   Shade:Action  = {
;         if (LocalCompAssigned( ChildPolyLpRef ) == 0)
;         then  PostError( "Shade '%s' has no child PolyLp and one is required in order to simulate model.", Name )
;         else if (IfValidAnd( ChildPolyLpRef:Area > 0 )==0)
;         then  PostError( "PolyLp '%s' (child of Shade '%s') contains insufficient or invalid vertices.", ChildPolyLpRef:Name, Name )
;         else if (IfValidAnd( ChildPolyLpRef:NumOfPts > 12 ))
;         then  PostError( "PolyLp '%s' (child of Shade '%s') contains too many vertices @ %g (current CSE limit is 12).", ChildPolyLpRef:Name, Name, ChildPolyLpRef:NumOfPts )
;         else  UNCHANGED  endif endif endif  }
;
;   ; SAC 3/4/17 - check that no single PVArrayGeom object is referenced by more than 1 project PV array
;   "Check for invalid PVArrayGeom geometry and too many PVArrayGeom assignments from Project PV arrays"   PVArrayGeom:Action  = {
;         if (IfValidAnd( NumPVArrayRefs > 0 )==0) then  UNCHANGED   ; validity doesn't matter if no PV array references it
;         else if (LocalCompAssigned( ChildPolyLpRef ) == 0)
;         then  PostError( "PVArrayGeom '%s' has no child PolyLp and one is required in order to simulate model.", Name )
;         else if (IfValidAnd( ChildPolyLpRef:Area > 0 )==0)
;         then  PostError( "PolyLp '%s' (child of PVArrayGeom '%s') contains insufficient or invalid vertices.", ChildPolyLpRef:Name, Name )
;         else if (IfValidAnd( ChildPolyLpRef:NumOfPts > 12 ))
;         then  PostError( "PolyLp '%s' (child of PVArrayGeom '%s') contains too many vertices @ %g (current CSE limit is 12).", ChildPolyLpRef:Name, Name, ChildPolyLpRef:NumOfPts )
;         else if (IfValidAnd( NumPVArrayRefs > 1 ))
;         then  PostError( "PVArrayGeom '%s' is referenced by %.0f separate PV arrays, but no two arrays can be described by the same geometry.", Name, NumPVArrayRefs )
;         else  UNCHANGED  endif endif endif endif endif  }

   ; SAC 3/4/17 - added checks for valid PVArray geometry
	"Check for valid PV array #1 geometry when Shade objects present (meaning PolyLp geom for PV arrays is required)"  ResProj:Action = {
         if (IfValidAnd( HaveShadeObjects > 0 )==0 .OR. IfValidAnd( PVWDCSysSize[1] > 0 )==0 .OR.
             (EnergyCodeYearNum < 2019 .AND.
              (AllowDesignRating < 0.5 .OR. DesignRatingCalcs < 0.5))) then  UNCHANGED
         else if (PVWGeomSpecMethod[1] == 1)    ; reference PVArrayGeom object
         then  if (LocalCompAssigned( PVWGeomPolyLpRef[1] )) then  UNCHANGED
               else  PostError( "PV Array #1 missing reference to a PVArrayGeom object (required when Shade objects defined in model)." )
               endif
         else if (PVWGeomSpecMethod[1] == 0)    ; "azimuth and tilt"
         then  if (IfValidAnd( PVWLocSpecified[1] > 0 )) then  UNCHANGED
               else  PostError( "PV Array #1 missing location information (required when Shade objects defined in model)." )
               endif
         else  PostError( "Unrecognized geometry specification method for PV Array #1." )
         endif endif endif  }
	"Check for valid PV array #2 geometry when Shade objects present (meaning PolyLp geom for PV arrays is required)"  ResProj:Action = {
         if (IfValidAnd( HaveShadeObjects > 0 )==0 .OR. IfValidAnd( PVWDCSysSize[2] > 0 )==0 .OR.
             (EnergyCodeYearNum < 2019 .AND.
              (AllowDesignRating < 0.5 .OR. DesignRatingCalcs < 0.5))) then  UNCHANGED
         else if (PVWGeomSpecMethod[2] == 1)    ; reference PVArrayGeom object
         then  if (LocalCompAssigned( PVWGeomPolyLpRef[2] )) then  UNCHANGED
               else  PostError( "PV Array #2 missing reference to a PVArrayGeom object (required when Shade objects defined in model)." )
               endif
         else if (PVWGeomSpecMethod[2] == 0)    ; "azimuth and tilt"
         then  if (IfValidAnd( PVWLocSpecified[2] > 0 )) then  UNCHANGED
               else  PostError( "PV Array #2 missing location information (required when Shade objects defined in model)." )
               endif
         else  PostError( "Unrecognized geometry specification method for PV Array #2." )
         endif endif endif  }
	"Check for valid PV array #3 geometry when Shade objects present (meaning PolyLp geom for PV arrays is required)"  ResProj:Action = {
         if (IfValidAnd( HaveShadeObjects > 0 )==0 .OR. IfValidAnd( PVWDCSysSize[3] > 0 )==0 .OR.
             (EnergyCodeYearNum < 2019 .AND.
              (AllowDesignRating < 0.5 .OR. DesignRatingCalcs < 0.5))) then  UNCHANGED
         else if (PVWGeomSpecMethod[3] == 1)    ; reference PVArrayGeom object
         then  if (LocalCompAssigned( PVWGeomPolyLpRef[3] )) then  UNCHANGED
               else  PostError( "PV Array #3 missing reference to a PVArrayGeom object (required when Shade objects defined in model)." )
               endif
         else if (PVWGeomSpecMethod[3] == 0)    ; "azimuth and tilt"
         then  if (IfValidAnd( PVWLocSpecified[3] > 0 )) then  UNCHANGED
               else  PostError( "PV Array #3 missing location information (required when Shade objects defined in model)." )
               endif
         else  PostError( "Unrecognized geometry specification method for PV Array #3." )
         endif endif endif  }
	"Check for valid PV array #4 geometry when Shade objects present (meaning PolyLp geom for PV arrays is required)"  ResProj:Action = {
         if (IfValidAnd( HaveShadeObjects > 0 )==0 .OR. IfValidAnd( PVWDCSysSize[4] > 0 )==0 .OR.
             (EnergyCodeYearNum < 2019 .AND.
              (AllowDesignRating < 0.5 .OR. DesignRatingCalcs < 0.5))) then  UNCHANGED
         else if (PVWGeomSpecMethod[4] == 1)    ; reference PVArrayGeom object
         then  if (LocalCompAssigned( PVWGeomPolyLpRef[4] )) then  UNCHANGED
               else  PostError( "PV Array #4 missing reference to a PVArrayGeom object (required when Shade objects defined in model)." )
               endif
         else if (PVWGeomSpecMethod[4] == 0)    ; "azimuth and tilt"
         then  if (IfValidAnd( PVWLocSpecified[4] > 0 )) then  UNCHANGED
               else  PostError( "PV Array #4 missing location information (required when Shade objects defined in model)." )
               endif
         else  PostError( "Unrecognized geometry specification method for PV Array #4." )
         endif endif endif  }
	"Check for valid PV array #5 geometry when Shade objects present (meaning PolyLp geom for PV arrays is required)"  ResProj:Action = {
         if (IfValidAnd( HaveShadeObjects > 0 )==0 .OR. IfValidAnd( PVWDCSysSize[5] > 0 )==0 .OR.
             (EnergyCodeYearNum < 2019 .AND.
              (AllowDesignRating < 0.5 .OR. DesignRatingCalcs < 0.5))) then  UNCHANGED
         else if (PVWGeomSpecMethod[5] == 1)    ; reference PVArrayGeom object
         then  if (LocalCompAssigned( PVWGeomPolyLpRef[5] )) then  UNCHANGED
               else  PostError( "PV Array #5 missing reference to a PVArrayGeom object (required when Shade objects defined in model)." )
               endif
         else if (PVWGeomSpecMethod[5] == 0)    ; "azimuth and tilt"
         then  if (IfValidAnd( PVWLocSpecified[5] > 0 )) then  UNCHANGED
               else  PostError( "PV Array #5 missing location information (required when Shade objects defined in model)." )
               endif
         else  PostError( "Unrecognized geometry specification method for PV Array #5." )
         endif endif endif  }

   "check for invalid HRV IAQFans (missing SensRecovEff &/or AdjSensRecovEff)"      ResIAQFan:Action  =         ; SAC 2/5/20 (tic #1174)   SAC 2/7/20 - revised to use new IAQErr* (tic #1174)
      ;{  if (IAQFanType == 3 .AND. IfValidAnd( Proj:AnalysisVersion >= 190200 ) .AND. IfValidAnd( IncludesRecov > 0 ) .AND. IfValidAnd( NumAssignments > 0 ))
      ;   then  if (IfValidAnd( SensRecovEff > 0 )==0 .OR. IfValidAnd( AdjSensRecovEff > 0 )==0)
      ;         then  PostError( "IAQFan '%s' is setup to recover heat/energy, but is missing specification of SensRecovEff and/or AdjSensRecovEff.", Name )
      ;         else  UNCHANGED  endif
      {  if (IfValidAnd( NumAssignments > 0 ) .AND. IAQErrID > 0)
         then  PostError( "IAQFan '%s' error:  %s", Name, IAQErrMsg )
         else  UNCHANGED  endif  }

	; SAC 10/7/13 - augmented rule to disable SmartVent (FixedFlowOAV) in addition to NightBreeze (VarFlowOAV)
	"Check for HVAC system type (or CFI cool vent) NOT available"  ; SAC 10/3/13 - GC issue ??? - prevent system type 'Variable Outdoor Air Ventilation Central Heat/Cool System'
		ResHVACSys:Action		= {	if (FloorAreaServed[1] < 0.1) then  UNCHANGED
										else if (TypeOK < 0.5) then  PostError( "HVAC system '%s' type '%s' not currently available for analysis.", Name, EnumString( Type ) )
										else if (CFIClVentCompat > 0.5 .AND. Type != 3 .AND. CFIClVentOption > 0 .AND. ResProj:EnableFixedFlowOAV < 0.5)
										then  PostError( "HVAC system '%s' specified as supplying CFI Cool Vent, but this feature is not currently available for analysis.", Name )
										else  UNCHANGED  endif endif endif  }

	; SAC 10/20/14 - check for valid Attic assigned for use as rsOAVReliefZn when activating CFIClVent / OAV features
	"Check for valid Attic assigned as rsOAVReliefZn for OAV (CFI cool vent) HVAC system"
		ResHVACSys:Action		= {	if (FloorAreaServed[1] < 0.1 .OR. ResProj:EnableClVent < 0.5 .OR. ResProj:UnitClVentOption != 3) then  UNCHANGED
										else if (Type == 3 .OR. ((Type == 1 .OR. Type == 2) .AND. CFIClVentOption > 0))
										then	if (LocalStatus( CFIClVentFlow ) < 2 .OR. LocalStatus( CFIClVentPwr ) < 2) then  UNCHANGED
												else if (CFIClVentFlow <= 0 .OR. CFIClVentPwr < 0) then  UNCHANGED
												else if (LocalCompAssigned( CFIClVentAttic ) < 0.5)
												then  PostError( "HVAC system '%s' specified as supplying CFI Cool Vent, but has no Attic assignment (CFIClVentAttic needed to serve as OAVReliefZn).", Name )
												else  UNCHANGED  endif endif endif
										else  UNCHANGED  endif endif  }

	"Check for ducted HVAC systems including a fan"  ; SAC 6/7/13 - GC issue #103
		ResHVACSys:Action		= {	if (FloorAreaServed[1] < 0.1 .OR. LocalCompAssigned( DistribSystem ) == 0) then  UNCHANGED
										else if (DistribSystem:DuctsPresent < 0.5) then  UNCHANGED
										else if (LocalCompAssigned( Fan ) == 0)
										then  PostError( "HVAC system '%s' requires a Fan assignment since its distribution system is ducted.", Name )
										else if (Fan:Type < 0.5)
										then  PostError( "Fan '%s' assigned to HVAC system '%s' must be of a valid Type, since the corresponding distribution system is ducted.", Fan:Name, Name )
										else  UNCHANGED  endif endif endif endif  }


	"Check for heating system type availability (& other err**s)"
		ResHtgSys:Action	= {	if (FloorAreaServed > 0.1)
										then	if (IsAvailable < 0.5)
												then  PostError( "Heating system '%s' - system type %s is not yet available for compliance analysis", Name, TypeAbbrevStr )
								;				else if (DisplayCHData >= 0 .AND. CHUCndPipeLength > 10)
												else if (Type = 9 .AND. IfValidAnd(CHUCndPipeLength > 10))
												then  PostError( "Current combined hydronic system pipe (in uncond space) length limit is 10 ft (system '%s')", Name )
												else  UNCHANGED  endif endif
										else  UNCHANGED  endif  }

	"Check for heat pump system type availability"
		ResHtPumpSys:Action	= {	if (FloorAreaServed < 0.1 .OR. IsAvailable > 0.5) then  UNCHANGED
										else  PostError( "Heat pump system '%s' - system type %s is not yet available for compliance analysis", Name, TypeAbbrevStr )  endif  }

	"Check for cooling system type availability"
		ResClgSys:Action	= {	if (FloorAreaServed < 0.1 .OR. IsAvailable > 0.5) then  UNCHANGED
										else PostError( "Cooling system '%s' - system type %s is not yet available for compliance analysis", Name, TypeAbbrevStr )  endif  }

	"Check for fan type availability"
		ResFanSys:Action		= {	if (FloorAreaServed < 0.1 .OR. IsAvailable > 0.5) then  UNCHANGED
										else PostError( "Fan '%s' - fan type %s is not yet available for compliance analysis", Name, TypeAbbrevStr )  endif  }

; SAC 5/22/14 - added additional check to ensure valid ResDistSys:Type selections
; SAC 7/14/14 - added check to prevent modeling of ducts in crawl spaces where crawl space area < 10% of overall conditioned area (GC issue #324)
; revised rule logic to refer to area limit properties (DuctsInAtticMinPctArea, AtticAreaOKForDucts, DuctsInCrawlMinPctArea, CrawlAreaOKForDucts) - SAC 08/13/20 (tic #1062)
	"Check for valid distribution system type"
		ResDistSys:Action	= {	if (FloorAreaServed < 0.1 .OR. IfValidAnd( ResProj:CondFloorArea > 1 ) == 0) then  UNCHANGED
										else	switch (Type)
													case  1 :	; "Ducts located in attic (Ventilated and Unventilated)"
																	if (ComponentCount( Attic ) < 0.5 .OR. SumAll( ResAttic:FloorArea ) < 1)
																	then	PostError( "Distribution system '%s' - system type %s is not valid when no attic exists", Name, TypeAbbrevStr )
																	else if ( ResProj:AtticAreaOKForDucts < 1)
																	then	PostError( "Distribution system '%s' - system type %s is not valid when attic area above conditioned rooms < %g% of total conditioned area", Name, TypeAbbrevStr, ResProj:DuctsInAtticMinPctArea )
																	else	UNCHANGED  endif endif
													case  2 :	; "Ducts located in a crawl space"
																	if (ComponentCount( CrawlSpace ) < 0.5 .OR. SumAll( ResCrawlSpc:Area ) < 1)
																	then	PostError( "Distribution system '%s' - system type %s is not valid when no crawl spaces exist", Name, TypeAbbrevStr )
																	else if ( ResProj:CrawlAreaOKForDucts < 1)
																	then	PostError( "Distribution system '%s' - system type %s is not valid when crawl space area < %g% of total conditioned area", Name, TypeAbbrevStr, ResProj:DuctsInCrawlMinPctArea )
																	else	UNCHANGED  endif endif
													case  4 :	; "Ducts located in a garage"
																	if (ComponentCount( Garage ) < 0.5 .OR. SumAll( ResGarage:Area ) < 1)
																	then	PostError( "Distribution system '%s' - system type %s is not valid when no garages exist", Name, TypeAbbrevStr )
																	else	UNCHANGED  endif
													default :  UNCHANGED
												endswitch  endif  }

;"store BEMProc details" ResProj:Action = {  if (RunAbbrev == "s") then  StoreBEMProc( "b4 SupDuctErr", 0 ) else  UNCHANGED  endif  }
;"debugging" ResProj:Action = { if (RunAbbrev == "s") then  MessageBox( "Model stored for %s:%s run", RunID, EnumString( StandardsVersion ) )  else  UNCHANGED  endif }
   ; added check to ensure that supply & return ducts fit in the selected attic (if attic located) (tic #621) - SAC 5/31/17
   ; added run abbreviation to error messages - SAC 08/17/20 (tic #1151)
   "Check for ResDistSys:SupplyDuctArea too large for its location"    ResDistSys:Action  = {
         if (DuctsPresent > 0.5 .AND. IfValidAnd( MaxSupDuctArea > 0 ) .AND. 
             IfValidAnd( SupplyDuctArea > MaxSupDuctArea ))
         then  if (Type == 1)    ; located in attic
               then  if (DefaultSystem == 0 .AND. DuctDesign > 0)
                     then  PostError( "Supply duct area (%g) specified for distribution system '%s' is too large to fit in the attic '%s' (max area = %g) (run %s)",
                                       SupplyDuctArea, Name, SupplyDuctAttic:Name, MaxSupDuctArea, ResProj:RunAbbrev )
                     else  PostError( "Supply duct area (%g) of distribution system '%s' is too large to fit in the attic '%s' (max area = %g) (run %s)",
                                       SupplyDuctArea, Name, SupplyDuctAttic:Name, MaxSupDuctArea, ResProj:RunAbbrev )
                     endif
               else  if (DefaultSystem == 0 .AND. DuctDesign > 0)
                     then  PostError( "Supply duct area (%g) specified for distribution system '%s' is too large (max area = %g) (run %s)",
                                       SupplyDuctArea, Name, MaxSupDuctArea, ResProj:RunAbbrev )
                     else  PostError( "Supply duct area (%g) of distribution system '%s' is too large (max area = %g) (run %s)",
                                       SupplyDuctArea, Name, MaxSupDuctArea, ResProj:RunAbbrev )
                     endif
               endif
         else  UNCHANGED  endif  }
   "Check for ResDistSys:ReturnDuctArea too large for its location"    ResDistSys:Action  = {
         if (DuctsPresent > 0.5 .AND. IfValidAnd( MaxRetDuctArea > 0 ) .AND. 
             IfValidAnd( ReturnDuctArea > MaxRetDuctArea ))
         then  if (Type == 1)    ; located in attic
               then  if (DefaultSystem == 0 .AND. DuctDesign > 0)
                     then  PostError( "Return duct area (%g) specified for distribution system '%s' is too large to fit in the attic '%s' (max area = %g) (run %s)",
                                       ReturnDuctArea, Name, ReturnDuctAttic:Name, MaxRetDuctArea, ResProj:RunAbbrev )
                     else  PostError( "Return duct area (%g) of distribution system '%s' is too large to fit in the attic '%s' (max area = %g) (run %s)",
                                       ReturnDuctArea, Name, ReturnDuctAttic:Name, MaxRetDuctArea, ResProj:RunAbbrev )
                     endif
               else  if (DefaultSystem == 0 .AND. DuctDesign > 0)
                     then  PostError( "Return duct area (%g) specified for distribution system '%s' is too large (max area = %g) (run %s)",
                                       ReturnDuctArea, Name, MaxRetDuctArea, ResProj:RunAbbrev )
                     else  PostError( "Return duct area (%g) of distribution system '%s' is too large (max area = %g) (run %s)",
                                       ReturnDuctArea, Name, MaxRetDuctArea, ResProj:RunAbbrev )
                     endif
               endif
         else  UNCHANGED  endif  }

; DEBUGGING
;	"store BEMProc details"		ResProj:Action = {  StoreBEMProc( "b4 sys type chk", 0 )  }
;	"Post messagebox"				ResHVACSys:Action = {  MessageBox( "Clg: '%s', Type %g, IsHP %g -- Htg: '%s', Type %g, IsHP %g",
;																	CoolSystem:Name, CoolSystem:Type, T24RCoolingEquipment:IsHP( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", CoolSystem:TypeAbbrevStr ),
;																	HeatSystem:Name, HeatSystem:Type, T24RHeatingEquipment:IsHP( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", HeatSystem:TypeAbbrevStr ) )  }
; DEBUGGING

	"Check for valid combinations of heating/cooling system types"
		ResHVACSys:Action	= {	     if ((Type == 1 .OR. Type == 3) .AND. strlen( HeatEquipIssue   ) > 2) then  PostError( "%s for HVAC system '%s' (%s)",   HeatEquipIssue, Name, EnumString( Type ) )
									else if ((Type == 1 .OR. Type == 3) .AND. strlen( CoolEquipIssue   ) > 2) then  PostError( "%s for HVAC system '%s' (%s)",   CoolEquipIssue, Name, EnumString( Type ) )
									else if (                Type == 2  .AND. strlen( HtPumpEquipIssue ) > 2) then  PostError( "%s for HVAC system '%s' (%s)", HtPumpEquipIssue, Name, EnumString( Type ) )
									else if (Type == 1 .OR. Type == 3)
									then  if (LocalCompAssigned( HeatSystem[1] ) == 0 .AND. LocalCompAssigned( CoolSystem[1] ) == 0)
											then	PostError( "HVAC system '%s' (%s) must have heating & cooling equipment objects defined", Name, EnumString( Type ) )
											else if (LocalCompAssigned( HeatSystem[1] ) == 0)
; ??? Allow simulation of systems that exclude either/both heating &/or cooling equipment ???
											then	PostError( "HVAC system '%s' (%s) must have heating equipment defined", Name, EnumString( Type ) )
											else if (LocalCompAssigned( CoolSystem[1] ) == 0)
											then	PostError( "HVAC system '%s' (%s) must have cooling equipment defined", Name, EnumString( Type ) )
											else if (CoolSystem[1]:Type == 1  .AND.
														T24RHeatingEquipment:IsHP( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", HeatSystem[1]:TypeAbbrevStr ))
											then	PostError( "HVAC system '%s' (%s) cannot have heat pump heating & no cooling equipment", Name, EnumString( Type ) )
											else if (CoolSystem[1]:Type > 1  .AND.
														T24RCoolingEquipment:IsHP( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", CoolSystem[1]:TypeAbbrevStr ) !=
														T24RHeatingEquipment:IsHP( "CodeBase", Proj:StdDesignBase, "StdVer", ResProj:StdsVersionYr, "SysType", HeatSystem[1]:TypeAbbrevStr ))
											then	PostError( "HVAC system '%s' (%s) cannot have a mixture of heat pump & non-HP equipment", Name, EnumString( Type ) )
											else  UNCHANGED  endif endif endif endif endif
									else  UNCHANGED
									endif endif endif endif  }


;	"store BEMProc details"		ResProj:Action = {  StoreBEMProc( "b4 Duct Check", 0 )  }
;	"debugging"		ResProj:Action		= {	MessageBox( "checking HVACSys for valid duct assignments" )  }
;	"debugging"		ResHVACSys:Action		= {	MessageBox( "checking HVACSys '%s' for valid duct assignments", ResHVACSys:Name )  }
;	"debugging duct flag error"		ResHVACSys:Action		= {	MessageBox( "checking HtOrClDucted before error msg %g", ResHVACSys:HtOrClDucted )  }

; debugging
;"debugging"   ResHVACSys:Action  = {   if (strlen( DuctMsg ) < 3 .OR. FloorAreaServed < 0.1) then  UNCHANGED
;									      else if (HtOrClDucted > 0.5 .AND. LocalCompAssigned( DistribSystem ) == 0)
;									      then	PostMessageToLog( "   Ducts required but not assigned:  model '%s', HVACSys '%s', HtOrClDucted = %g", ResProj:RunID, Name, HtOrClDucted )
;									      else if (HtOrClDucted > 0.5 .AND. IfValidAnd( DistribSystem:DuctsPresent == 0 ) .AND. IfValidAnd( DistribSystem:Type != 7 ) .AND. IfValidAnd( DistribSystem:Type != 12 ))
;									      then  PostMessageToLog( "   Ducts required but not present:  model '%s', HVACSys '%s', HtOrClDucted = %g, Ducts:Type = %g", ResProj:RunID, Name, HtOrClDucted, DistribSystem:Type )
;									      else if (HtOrClDucted < 0.5 .AND. LocalCompAssigned( DistribSystem ) > 0)
;									      then	PostMessageToLog( "   Ducts NOT required but present:  model '%s', HVACSys '%s', HtOrClDucted = %g", ResProj:RunID, Name, HtOrClDucted )
;									      else  UNCHANGED  endif endif endif endif  }
;"debugging - store BEMProc details"		ResHVACSys:Action = {  if (strlen( DuctMsg ) < 3 .OR. FloorAreaServed < 0.1) then  UNCHANGED
;									      else if ( (HtOrClDucted > 0.5 .AND. LocalCompAssigned( DistribSystem ) == 0) .OR.
;									                (HtOrClDucted > 0.5 .AND. IfValidAnd( DistribSystem:DuctsPresent == 0 ) .AND. IfValidAnd( DistribSystem:Type != 7 ) .AND. IfValidAnd( DistribSystem:Type != 12 )) .OR.
;									                (HtOrClDucted < 0.5 .AND. LocalCompAssigned( DistribSystem ) > 0) )
;									      then	StoreBEMProc( "HVACSys Duct Err", 0 )
;									      else  UNCHANGED  endif endif   }
;"debugging - msgbox"	   ResHVACSys:Action	= {	if (strlen( DuctMsg ) < 3 .OR. FloorAreaServed < 0.1) then  UNCHANGED
;									      else if ( (HtOrClDucted > 0.5 .AND. LocalCompAssigned( DistribSystem ) == 0) .OR.
;									                (HtOrClDucted > 0.5 .AND. IfValidAnd( DistribSystem:DuctsPresent == 0 ) .AND. IfValidAnd( DistribSystem:Type != 7 ) .AND. IfValidAnd( DistribSystem:Type != 12 )) .OR.
;									                (HtOrClDucted < 0.5 .AND. LocalCompAssigned( DistribSystem ) > 0) )
;									      then	MessageBox( "HVACSys Duct error model written" )
;									      else  UNCHANGED  endif endif   }

; "store BEMProc details"		ResProj:Action = {  StoreBEMProc( Format( "b4 %s DistribSys chk", ResProj:RunAbbrev ), 0 )  }
; "Dbg-1"	ResProj:Action	= {	MessageBox( "b4 %s DistribSys chk", ResProj:RunAbbrev )  }

;;"store BEMProc details"		ResHVACSys:Action = {  if (strlen( DuctMsg ) < 3 .OR. FloorAreaServed < 0.1 ) then  UNCHANGED
;;									else if (HtOrClDucted > 0.5 .AND. LocalCompAssigned( DistribSystem ) == 0) then	UNCHANGED
;;									else if (HtOrClDucted > 0.5 .AND. DistribSystem:DuctsPresent == 0 .AND. DistribSystem:Type != 7 .AND. DistribSystem:Type != 12) then	UNCHANGED
;;									else if (HtOrClDucted < 0.5 .AND. LocalCompAssigned( DistribSystem ) > 0)
;;									then	if (DistribSystem:DuctsPresent > 0)
;"store BEMProc details"		ResHVACSys:Action = {  if (IfValidAnd( ResProj:RunAbbrev = "s" ) .OR. IfValidAnd( ResProj:RunAbbrev == "zb" ))
;									      then  StoreBEMProc( Format( "b4 %s DistribSys chk", ResProj:RunAbbrev ), 0 )
;									      else  UNCHANGED  endif  }
;;									      else  UNCHANGED  endif
;;									else  UNCHANGED  endif endif endif endif  }
;;"debug"	ResHVACSys:Action	= {	if (strlen( DuctMsg ) < 3 .OR. FloorAreaServed < 0.1 ) then  UNCHANGED
;;									else if (HtOrClDucted > 0.5 .AND. LocalCompAssigned( DistribSystem ) == 0) then	UNCHANGED
;;									else if (HtOrClDucted > 0.5 .AND. DistribSystem:DuctsPresent == 0 .AND. DistribSystem:Type != 7 .AND. DistribSystem:Type != 12) then	UNCHANGED
;;									else if (HtOrClDucted < 0.5 .AND. LocalCompAssigned( DistribSystem ) > 0)
;;									then	if (DistribSystem:DuctsPresent > 0)
;"debug"	ResHVACSys:Action	= {	if (IfValidAnd( ResProj:RunAbbrev = "s" ) .OR. IfValidAnd( ResProj:RunAbbrev == "zb" ))
;									      then  MessageBox( "b4 %s DistribSys chk", ResProj:RunAbbrev )
;									      else  UNCHANGED  endif  }
;;									      else  UNCHANGED  endif
;;									else  UNCHANGED  endif endif endif endif  }

;"dbg store BEMProc details"  ResProj:Action = {  StoreBEMProc( Format( "b4 DuctsType chk %s", ResProj:RunAbbrev ), 0 )  }

; SAC 9/4/13 - added logic to allow no ducts when distrib system's ResDistSys:Type = 12 ("LowLlCod - Verified low-leakage ducts in conditioned space") - GC issue 163
	"Check for existing DistribSystem not of a ducted type but assigned to an HVAC system requiring ducts (or vice-versa)"
		ResHVACSys:Action	= {	if (strlen( DuctMsg ) < 3 .OR. FloorAreaServed < 0.1 ) then  UNCHANGED
									else if (HtOrClDucted > 0.5 .AND. LocalCompAssigned( DistribSystem ) == 0)
									then	switch (HtOrClDucted)
												case  1 : PostError( "Ducts required for heating system but not defined for HVAC system '%s' (%s) ('%s' run)", Name, EnumString( Type ), ResProj:RunAbbrev )
												case  2 : PostError( "Ducts required for cooling system but not defined for HVAC system '%s' (%s) ('%s' run)", Name, EnumString( Type ), ResProj:RunAbbrev )
												default : PostError( "Ducts required for heating & cooling systems but not defined for HVAC system '%s' (%s) ('%s' run)", Name, EnumString( Type ), ResProj:RunAbbrev )
											endswitch
									else if (HtOrClDucted > 0.5 .AND. DistribSystem:DuctsPresent == 0 .AND. DistribSystem:Type != 7 .AND. DistribSystem:Type != 12)
									then	switch (HtOrClDucted)
												case  1 : PostError( "Ducts required for heating system but assigned distribution system lacks ducts for HVAC system '%s' (%s) ('%s' run)", Name, EnumString( Type ), ResProj:RunAbbrev )
												case  2 : PostError( "Ducts required for cooling system but assigned distribution system lacks ducts for HVAC system '%s' (%s) ('%s' run)", Name, EnumString( Type ), ResProj:RunAbbrev )
												default : PostError( "Ducts required for htg & clg systems but assigned distribution system lacks ducts for HVAC system '%s' (%s) ('%s' run)", Name, EnumString( Type ), ResProj:RunAbbrev )
											endswitch
									else if (HtOrClDucted < 0.5 .AND. LocalCompAssigned( DistribSystem ) > 0)
									then	if (DistribSystem:DuctsPresent > 0 .AND. (HaveHtPump < 1 .OR. (HtPumpSysType != 22 .AND. HtPumpSysType != 33 .AND. IfValidAnd( HtPumpSystem[1]:IsPackaged > 0 )==0)))    ; SAC 11/4/18 - prevent error for VCHP in 's' design model   ; SAC 6/24/20 - PTHP   ; VCHP2 - SAC 11/01/20
											then  PostError( "Ducts not required for heating or cooling but included in assigned distribution system for HVAC system '%s' (%s) ('%s' run)", Name, EnumString( Type ), ResProj:RunAbbrev )
											else  UNCHANGED  endif
									else  UNCHANGED  endif endif endif endif  }
;"store 'smf' run BEMProc details"  ResHVACSys:Action = {  if ( ResProj:RunAbbrev != "smf") then  UNCHANGED  else  StoreBEMProc( "b4 setting HVACSys-HaveHeating", 0 )  endif  }

  ; SAC 1/6/16 - removed check preventing elec equipment from serving as combined hydronic heat source (tic 374)
	"Check Combined Hydronic heating system properties"
		ResHtgSys:Action	= {	if (FloorAreaServed > 0.1 .AND. Type = 9)   ; "CombHydro - Water heating system can be storage gas/elec/ht pump"
										then	if (LocalCompAssigned( CHWHeater ) < 0.5)
												then  PostError( "Combined hydronic heating system '%s' must have an assigned water heater.", Name )
												else if (CHWHeater:CanBeCHWHeater < 0.5)
												then  PostError( "Invalid water heater type referenced by combined hydronic heating system '%s'.", Name )
												else  UNCHANGED  endif endif
										else  UNCHANGED  endif  }

   ; SAC 1/27/20 - removed checks comparing DwellUnitTypeRef:DHWSysRef[1] & *ZoneRef:DHWSys1 for *ZoneRef of type Zone, since ResZn:DHWSys1 not defined in MFam runs
   "Set error flag DwellUnit:BadDHWAssigns - Washer DHW system assignment issue"  ; (1) missing zone DHWSys assignment, (2) inconsistent DwellUnitType & central laundry systems, (3) missing Zone/OtherZone assignment"    ; SAC 1/21/20
      DwellUnit:BadDHWAssigns  =
         {  if (Proj:IsSFamResRuleset .OR. ResProj:RunScope != 1 .OR.
                IfValidAnd( TotalDHWFlrArea > 1 )==0 .OR.
                LocalCompAssigned( DwellUnitTypeRef ) < 1) then  UNDEFINED
            else if (LocalCompAssigned( DwellUnitTypeRef:DHWSysRef[1] ) < 1) then  UNDEFINED
            else if (IfValidAnd( DwellUnitTypeRef:WasherOption = 2 ))
            then  if (LocalCompAssigned( WasherZoneRef ) == ComponentType( "ResZn" )) then  UNDEFINED
                  else if (LocalCompAssigned( WasherZoneRef ) == ComponentType( "ResOtherZn" ))
                  then  if (IfValidAnd( DwellUnitTypeRef:DHWSysRef[1] = WasherZoneRef:ActiveDHWSystem )) then  UNDEFINED
                        else if (LocalCompAssigned( WasherZoneRef:ActiveDHWSystem ) < 1) then  1
                        else  2  endif endif
                  else  3  endif endif
            else  UNDEFINED  endif endif endif  }
   "Set error flag DwellUnit:BadDHWAssigns - Dryer DHW system assignment issue"  ; (1) missing zone DHWSys assignment, (2) inconsistent DwellUnitType & central laundry systems, (3) missing Zone/OtherZone assignment"    ; SAC 1/21/20
      DwellUnit:BadDHWAssigns  =
         {  if (IfValidAnd( BadDHWAssigns > 0 )) then  UNCHANGED
            else if (Proj:IsSFamResRuleset .OR. ResProj:RunScope != 1 .OR.
                     IfValidAnd( TotalDHWFlrArea > 1 )==0 .OR.
                     LocalCompAssigned( DwellUnitTypeRef ) < 1) then  UNCHANGED
            else if (LocalCompAssigned( DwellUnitTypeRef:DHWSysRef[1] ) < 1) then  UNCHANGED
            else if (IfValidAnd( DwellUnitTypeRef:DryerOption = 2 ))
            then  if (LocalCompAssigned( DryerZoneRef ) == ComponentType( "ResZn" )) then  UNCHANGED
                  else if (LocalCompAssigned( DryerZoneRef ) == ComponentType( "ResOtherZn" ))
                  then  if (IfValidAnd( DwellUnitTypeRef:DHWSysRef[1] = DryerZoneRef:ActiveDHWSystem )) then  UNCHANGED
                        else if (LocalCompAssigned( DryerZoneRef:ActiveDHWSystem ) < 1) then  1
                        else  2  endif endif
                  else  3  endif endif
            else  UNCHANGED  endif endif endif endif  }

   "Post DwellUnit DHWSys assignment error"     DwellUnit:Action =      ; SAC 1/21/20
      {  if (IfValidAnd( DwellUnit:BadDHWAssigns = 1 ))
         then  PostError( "DwellUnit '%s' missing a central laundry washer and/or dryer zone DHWSys assigment", Name )
         else if (IfValidAnd( DwellUnit:BadDHWAssigns = 2 ))
         then  PostError( "DwellUnit '%s' DHWSystem '%s' must be the same as that assigned by its central laundry washer/dryer zone", Name, DwellUnitTypeRef:DHWSysRef[1] )
         else if (IfValidAnd( DwellUnit:BadDHWAssigns = 3 ))
         then  PostError( "DwellUnit '%s' missing a central laundry washer and/or dryer Zone/OtherZone assigment", Name, DwellUnitTypeRef:DHWSysRef[1] )
         else  UNCHANGED  endif endif endif  }

  ; SAC 4/20/14 - checks for HVACSys assiged as DHW heaters being configured to do so
	"Check for HVACSys assignment #1 able to serve as a DHWHeater"
		ResDHWSys:Action	= {	if (NumDHWHeaters > 0 .AND. IfValidAnd( HeaterMultFlt[1] > 0 ) .AND. LocalCompAssigned( DHWHeater[1] ) == ComponentType( "ResHVACSys" ))
									then	if (DHWHeater[1]:CanBeDHWHtr > 0.5) then  UNCHANGED
											else  PostError( "HVACSys '%s' assigned as first DHW heater of DHWSys '%s' is not configured to serve as a DHW heater.", DHWHeater[1]:Name, Name )
											endif
									else	UNCHANGED  endif  }
	"Check for HVACSys assignment #2 able to serve as a DHWHeater"
		ResDHWSys:Action	= {	if (NumDHWHeaters > 1 .AND. IfValidAnd( HeaterMultFlt[2] > 0 ) .AND. LocalCompAssigned( DHWHeater[2] ) == ComponentType( "ResHVACSys" ))
									then	if (DHWHeater[2]:CanBeDHWHtr > 0.5) then  UNCHANGED
											else  PostError( "HVACSys '%s' assigned as second DHW heater of DHWSys '%s' is not configured to serve as a DHW heater.", DHWHeater[2]:Name, Name )
											endif
									else	UNCHANGED  endif  }
	"Check for HVACSys assignment #3 able to serve as a DHWHeater"
		ResDHWSys:Action	= {	if (NumDHWHeaters > 2 .AND. IfValidAnd( HeaterMultFlt[3] > 0 ) .AND. LocalCompAssigned( DHWHeater[3] ) == ComponentType( "ResHVACSys" ))
									then	if (DHWHeater[3]:CanBeDHWHtr > 0.5) then  UNCHANGED
											else  PostError( "HVACSys '%s' assigned as third DHW heater of DHWSys '%s' is not configured to serve as a DHW heater.", DHWHeater[3]:Name, Name )
											endif
									else	UNCHANGED  endif  }
	"Check for HVACSys assignment #4 able to serve as a DHWHeater"
		ResDHWSys:Action	= {	if (NumDHWHeaters > 3 .AND. IfValidAnd( HeaterMultFlt[4] > 0 ) .AND. LocalCompAssigned( DHWHeater[4] ) == ComponentType( "ResHVACSys" ))
									then	if (DHWHeater[4]:CanBeDHWHtr > 0.5) then  UNCHANGED
											else  PostError( "HVACSys '%s' assigned as fourth DHW heater of DHWSys '%s' is not configured to serve as a DHW heater.", DHWHeater[4]:Name, Name )
											endif
									else	UNCHANGED  endif  }
	"Check for HVACSys assignment #5 able to serve as a DHWHeater"
		ResDHWSys:Action	= {	if (NumDHWHeaters > 4 .AND. IfValidAnd( HeaterMultFlt[5] > 0 ) .AND. LocalCompAssigned( DHWHeater[5] ) == ComponentType( "ResHVACSys" ))
									then	if (DHWHeater[5]:CanBeDHWHtr > 0.5) then  UNCHANGED
											else  PostError( "HVACSys '%s' assigned as fifth DHW heater of DHWSys '%s' is not configured to serve as a DHW heater.", DHWHeater[5]:Name, Name )
											endif
									else	UNCHANGED  endif  }
	"Check for HVACSys assignment #6 able to serve as a DHWHeater"
		ResDHWSys:Action	= {	if (NumDHWHeaters > 5 .AND. IfValidAnd( HeaterMultFlt[6] > 0 ) .AND. LocalCompAssigned( DHWHeater[6] ) == ComponentType( "ResHVACSys" ))
									then	if (DHWHeater[6]:CanBeDHWHtr > 0.5) then  UNCHANGED
											else  PostError( "HVACSys '%s' assigned as sixth DHW heater of DHWSys '%s' is not configured to serve as a DHW heater.", DHWHeater[6]:Name, Name )
											endif
									else	UNCHANGED  endif  }

; SAC 5/7/14 - added logic to check for tank insulation R-value being too low to be simulated (lower limit set @ 2)
;	"Check for HVACSys-based DHW inputs having invalid tank R-value(s)"
;		ResHVACSys:Action	= {	if (CanBeDHWHtr < 0.1 .OR. DHWFloorAreaServed < 0.1) then  UNCHANGED
;									else if ((ValidOr( DHWIntInsulRVal, 0 ) + ValidOr( DHWExtInsulRVal, 0 )) < 2)
;									then	PostError( "HVACSys '%s' is referenced as a DHW heater but its DHW tank insulation R-value is below the minimum of 2 F-ft2-h/Btu", Name )
;									else	UNCHANGED  endif endif  }

	; SAC 11/10/15 - added check based on request from CEC-TF
	"Check for valid multifamily DHW distribution type for central systems"
		ResDHWSys:Action	= {	if ( CentralDHW < 0.5 .OR. MFamDistType > 0.5 .OR. IfValidAnd( NumDUsServed > 8 )==0 .OR. Status = 1) then  UNCHANGED
									else  PostError( "DHW system '%s' must be set to a distribution type other than '%s' since it serves more than 8 dwelling units (%g).", Name, EnumString( MFamDistType ), NumDUsServed )
									endif  }

;   "Check for valid central ResDHWSys:LoopHeater type"      ResDHWSys:Action	=     ; SAC 11/14/19 - add LoopHeater type check for new central DHWSystems
;      {  if ( (Proj:IsComRuleset .OR. Proj:IsComRuleset) .AND. MFamDistType > 0.5 .AND. IfValidAnd( NewCentralElecModel > 0 ) .AND.
;             LocalCompAssigned( LoopHeater ) > 0)
;         then  if (LoopHeater:TankType == 12) then  UNCHANGED
;               else  PostError( "Central DHW system '%s' loop heater must be of the type Electric Resistance / Consumer Storage (UEF).", Name )
;               endif
;         else  UNCHANGED  endif  }

  ; SAC 10/7/13 - added check to ensure that ALL REQUIRED recirculation pipe inputs are specified (iff they are to be simulated)
	"Check multifamily recirculation DHW pump HP"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. FloorAreaServed[1] < 1) then  UNCHANGED
									else if (LocalStatus( RecircPumpHP  ) < 1) then  PostError( "DHW system '%s' recirculation pump horsepower must be specified.", Name )
									else if (RecircPumpHP <= 0) then  PostError( "DHW system '%s' recirculation pump horsepower (%g) must be > 0.", Name, RecircPumpHP )
									else  UNCHANGED  endif endif endif  }
	"Check multifamily recirculation DHW pump efficiency"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. FloorAreaServed[1] < 1) then  UNCHANGED
									else if (LocalStatus( RecircPumpEff ) < 1) then  PostError( "DHW system '%s' recirculation pump efficiency must be specified.", Name )
									else if (RecircPumpEff <= 0) then  PostError( "DHW system '%s' recirculation pump efficiency (%g) must be > 0.", Name, RecircPumpEff )
									else  UNCHANGED  endif endif endif  }
	"Check multifamily recirculation DHW pipe inputs (being defined)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5) then  UNCHANGED
									else if (LocalStatus( RecircPipeLen[1] ) < 1 .OR. LocalStatus( RecircPipeLen[2] ) < 1 .OR. LocalStatus( RecircPipeLen[3] ) < 1 .OR.
											   LocalStatus( RecircPipeLen[4] ) < 1 .OR. LocalStatus( RecircPipeLen[5] ) < 1 .OR. LocalStatus( RecircPipeLen[6] ) < 1 )
									then  PostError( "All 6 DHW system '%s' recirculation pipe lengths (3 supply, 3 return) must be specified.", Name )
									else if (LocalStatus( RecircPipeDia[1] ) < 1 .OR. LocalStatus( RecircPipeDia[2] ) < 1 .OR. LocalStatus( RecircPipeDia[3] ) < 1 .OR.
											   LocalStatus( RecircPipeDia[4] ) < 1 .OR. LocalStatus( RecircPipeDia[5] ) < 1 .OR. LocalStatus( RecircPipeDia[6] ) < 1 )
									then  PostError( "All 6 DHW system '%s' recirculation pipe diameters (3 supply, 3 return) must be specified.", Name )
									else	UNCHANGED  endif endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeLen[1] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeLen[1] ) < 1) then  UNCHANGED
									else if (RecircPipeLen[1] <= 0) then  PostError( "Recirculation DHW System '%s' supply pipe #1 length (%g) must be > 0.", Name, RecircPipeLen[1] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeLen[2] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeLen[2] ) < 1) then  UNCHANGED
									else if (RecircPipeLen[2] <= 0) then  PostError( "Recirculation DHW System '%s' supply pipe #2 length (%g) must be > 0.", Name, RecircPipeLen[2] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeLen[3] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeLen[3] ) < 1) then  UNCHANGED
									else if (RecircPipeLen[3] <= 0) then  PostError( "Recirculation DHW System '%s' supply pipe #3 length (%g) must be > 0.", Name, RecircPipeLen[3] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeLen[4] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeLen[4] ) < 1) then  UNCHANGED
									else if (RecircPipeLen[4] <= 0) then  PostError( "Recirculation DHW System '%s' return pipe #1 length (%g) must be > 0.", Name, RecircPipeLen[4] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeLen[5] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeLen[5] ) < 1) then  UNCHANGED
									else if (RecircPipeLen[5] <= 0) then  PostError( "Recirculation DHW System '%s' return pipe #2 length (%g) must be > 0.", Name, RecircPipeLen[5] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeLen[6] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeLen[6] ) < 1) then  UNCHANGED
									else if (RecircPipeLen[6] <= 0) then  PostError( "Recirculation DHW System '%s' return pipe #3 length (%g) must be > 0.", Name, RecircPipeLen[6] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeDia[1] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeDia[1] ) < 1) then  UNCHANGED
									else if (RecircPipeDia[1] <= 0) then  PostError( "Recirculation DHW System '%s' supply pipe #1 diameter (%g) must be > 0.", Name, RecircPipeDia[1] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeDia[2] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeDia[2] ) < 1) then  UNCHANGED
									else if (RecircPipeDia[2] <= 0) then  PostError( "Recirculation DHW System '%s' supply pipe #2 diameter (%g) must be > 0.", Name, RecircPipeDia[2] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeDia[3] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeDia[3] ) < 1) then  UNCHANGED
									else if (RecircPipeDia[3] <= 0) then  PostError( "Recirculation DHW System '%s' supply pipe #3 diameter (%g) must be > 0.", Name, RecircPipeDia[3] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeDia[4] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeDia[4] ) < 1) then  UNCHANGED
									else if (RecircPipeDia[4] <= 0) then  PostError( "Recirculation DHW System '%s' return pipe #1 diameter (%g) must be > 0.", Name, RecircPipeDia[4] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeDia[5] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeDia[5] ) < 1) then  UNCHANGED
									else if (RecircPipeDia[5] <= 0) then  PostError( "Recirculation DHW System '%s' return pipe #2 diameter (%g) must be > 0.", Name, RecircPipeDia[5] )
									else  UNCHANGED  endif endif  }
	"Check multifamily recirculation DHW pipe inputs (RecircPipeDia[6] > 0)"
		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset .OR. MFamDistType < 0.5 .OR. UseDefaultLoops > 0.5 .OR. LocalStatus( RecircPipeDia[6] ) < 1) then  UNCHANGED
									else if (RecircPipeDia[6] <= 0) then  PostError( "Recirculation DHW System '%s' return pipe #3 diameter (%g) must be > 0.", Name, RecircPipeDia[6] )
									else  UNCHANGED  endif endif  }

; SAC 9/4/15 - new check for valid DHW solar fraction data, depending on SolFracType
	"Check for valid DHWSys solar fraction data"
		ResDHWSys:Action	= {	if (IfValidAnd( SystemType > 0 )==0 .OR. NumDHWHeaters < 1 .OR. IfValidAnd( HeaterMultFlt[1] > 0 )==0 .OR. 
											LocalCompAssigned( DHWHeater[1] ) < 1 .OR. IfValidAnd( SimDHWSys > 0 )==0)  then  UNCHANGED
									else if (SolFracType == 1 .AND. IfValidAnd( SolFracAnn >= 0 )==0)
									then	PostError( "DHW System '%s' requires specification of a valid Annual Solar Fraction (SolFracAnn).", Name )
									else if (SolFracType == 2 .AND. (IfValidAnd( SolFracMon[1] >= 0 )==0 .OR. IfValidAnd( SolFracMon[2] >= 0 )==0 .OR. IfValidAnd( SolFracMon[3] >= 0 )==0 .OR. IfValidAnd( SolFracMon[4] >= 0 )==0 .OR.
												IfValidAnd( SolFracMon[5] >= 0 )==0 .OR. IfValidAnd( SolFracMon[6] >= 0 )==0 .OR. IfValidAnd( SolFracMon[7] >= 0 )==0 .OR. IfValidAnd( SolFracMon[8] >= 0 )==0 .OR.
												IfValidAnd( SolFracMon[9] >= 0 )==0 .OR. IfValidAnd( SolFracMon[10] >= 0 )==0 .OR. IfValidAnd( SolFracMon[11] >= 0 )==0 .OR. IfValidAnd( SolFracMon[12] >= 0 )==0 ))
									then	PostError( "DHW System '%s' requires specification of all Monthly Solar Fractions (SolFracMon[1-12]).", Name )
									else	UNCHANGED  endif endif endif  }
	"Check for valid DwellUnitType DHW solar fraction data"
		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset) then  UNCHANGED
		                           else if (IfValidAnd( HtEqpUsedAsDHWHtr < 0.5 ) .OR. AssignedDUFlrArea < 1)  then  UNCHANGED
											else if (DHWSolFracType == 1 .AND. IfValidAnd( DHWSolFracAnn >= 0 )==0)
											then	PostError( "DwellUnitType '%s' requires specification of a valid Annual Solar Fraction (DHWSolFracAnn).", Name )
											else if (DHWSolFracType == 2 .AND. (IfValidAnd( DHWSolFracMon[1] >= 0 )==0 .OR. IfValidAnd( DHWSolFracMon[2] >= 0 )==0 .OR. IfValidAnd( DHWSolFracMon[3] >= 0 )==0 .OR. IfValidAnd( DHWSolFracMon[4] >= 0 )==0 .OR.
														IfValidAnd( DHWSolFracMon[5] >= 0 )==0 .OR. IfValidAnd( DHWSolFracMon[6] >= 0 )==0 .OR. IfValidAnd( DHWSolFracMon[7] >= 0 )==0 .OR. IfValidAnd( DHWSolFracMon[8] >= 0 )==0 .OR.
														IfValidAnd( DHWSolFracMon[9] >= 0 )==0 .OR. IfValidAnd( DHWSolFracMon[10] >= 0 )==0 .OR. IfValidAnd( DHWSolFracMon[11] >= 0 )==0 .OR. IfValidAnd( DHWSolFracMon[12] >= 0 )==0 ))
											then	PostError( "DwellUnitType '%s' requires specification of all Monthly Solar Fractions (DHWSolFracMon[1-12]).", Name )
											else	UNCHANGED  endif endif endif endif  }

   "Prevent sim-related DHWSolarSys issues"     DHWSolSys:Action  =      ; SAC 6/29/20 (tic #1210)
      {  if (IfValidAnd( DHWSysAssigned < 1 ) .OR.
             IfValidAnd( ErrID > 0 )==0 .OR. IfValidAnd( ErrID >= 100 )) then  UNCHANGED
         else  PostError( "DHW solar system '%s' error: %s.", Name, ErrMsg )  endif  }

	; SAC 5/12/16 - check for DwellUnitTypes w/ multiple DHWSys assignments AND ResProj:CSEDHWUseMethod NOT the older, 2013 mode
  ; LDH 7/25/2016 - removed in order to test multiple DHW system assignments.
;	"Check for valid number of DwellUnitType DHW system assignments"
;		DwellUnitType:Action	= {	if ( Proj:IsSFamResRuleset .OR. ResProj:CSEDHWUseMethod == 1 .OR. AssignedDUFlrArea < 1)  then  UNCHANGED
;											else if (IfValidAnd( NumDHWSysTypes > 1 ))
;											then	PostError( "DwellUnitType '%s' cannot have more than 1 water heating system assignment.", Name )
;											else	UNCHANGED  endif endif  }
; SAC 7/23/16 - removed constraint of only a single dwelling unit served per DHWSys (for new CSEDHWUseMethod)
;	; SAC 6/15/16 - check for Zones w/ multiple DHWSys assignments AND ResProj:CSEDHWUseMethod NOT the older, 2013 mode (tic #666)
;	"Check for no more than 1 DHW system assigned in a SFam model"
;		ResProj:Action				= {	if ( Proj:IsComRuleset .OR. ResProj:CSEDHWUseMethod == 1)  then  UNCHANGED
;											else if (SumAll( ResDHWSys:SimDHWSys ) > 1)
;											then	PostError( "No single dwelling unit can be served by more than 1 water heating system (%g assigned systems).", SumAll( ResDHWSys:SimDHWSys ) )
;											else	UNCHANGED  endif endif  }

; SAC 12/23/14 - REMOVED following check - thereby allowing SFam distribution types in MFam projects (GC issue 458)
;  	"Check for allowed dwelling unit distribution if multi-family distribution used"
;  ;		ResDHWSys:Action	= {	if ( Proj:IsComRuleset .AND. (SystemType = 3840 .OR. SystemType = 4096 .OR. SystemType = 8392704)) then UNCHANGED
;  ;									else PostError( "Dwelling Unit distribution system not applicable with multi-family system" )	endif  }
;  ; SAC 3/21/14 - first version (above) throws error for EVERY single family project - seems like the opposite logic is what was meant??
;  		ResDHWSys:Action	= {	if ( Proj:IsSFamResRuleset) then  UNCHANGED
;  									else if (SystemType = 3840 .OR. SystemType = 4096 .OR. SystemType = 8392704) then  UNCHANGED
;  									else  PostError( "Dwelling Unit distribution system not applicable with multi-family system" )  endif endif  }

; SAC 11/10/15 - removed check on DHWHeater fuel - no longer pertinent since addition of global GasType
;; SAC 5/1/15 - added code to ignore this error for 2016 standard design (and other post-Proposed) models (issue 531)
;	"Check for consistency between NatGas availability and ResWtrHtr:HeaterElementType"
;		ResWtrHtr:Action	= {	if ( Proj:StdDesignBase >= 2016 .AND. ( ResProj:RunAbbrev == "s" .OR. ResProj:RunAbbrev == "zb" .OR. ResProj:RunAbbrev == "dr")) then  UNCHANGED
;										else if ( ResProj:NatGasAvailable < 0.5 .AND. HeaterElementType = 1)   ; NatGas NOT available, but is the current selection for this DHWHeater
;										then	if (FloorAreaServed > 0.1)
;								;		then	if (	CountRefs( ResHtgSys:CHWHeater  ) > 0.5 .OR. CountRefs( ResDHWSys:DHWHeater[1] ) > 0.5 .OR.  ; only report error if this heater is actually referenced
;								;						CountRefs( ResDHWSys:DHWHeater[2] ) > 0.5 .OR. CountRefs( ResDHWSys:DHWHeater[3] ) > 0.5 .OR. CountRefs( ResDHWSys:DHWHeater[4] ) > 0.5 .OR. 
;								;						CountRefs( ResDHWSys:DHWHeater[5] ) > 0.5 .OR. CountRefs( ResDHWSys:DHWHeater[6] ) > 0.5 )
;												then  PostError( "DHW heater '%s' element type set to Natural Gas, but Natural Gas registered as not available on site.", Name )
;												else  UNCHANGED  endif
;										else  UNCHANGED  endif endif  }
; SAC 5/2/15
	"Check for models whose standard design water heating cause analysis incompatibilities"
		ResProj:Action	= {	if (IfValidAnd( StdDHWFuelErrMsg > 0 )) then  PostError( "Standard design water heating:  %s.", EnumString( StdDHWFuelErrMsg ) )
								else	UNCHANGED  endif  }

; SAC 12/30/19 - removed check that is no longer applicable (tic #862)
;   ; prevent analysis for newly added 2017 water heater types
;	"Check for selection of not yet fully implemented water heaters"
;  	ResWtrHtr:Action	= {	if ( IfValidAnd( FloorAreaServed > 0.1 ) .AND. 
;                               IfValidAnd( HeaterType > 15 ) .AND. 
;                               IfValidAnd( HeaterType < 20 ) )
;		                        then  PostError( "DHW heater '%s' is of a newly added type (%s) that is not yet implemented for compliance analysis.", Name, EnumString( TankType ) )
;		                        else  UNCHANGED  endif  }

  ; SAC 6/17/14 - added to report ResWtrHtr:TankType selections that are no longer allowed
  ; SAC 11/10/15 - added recently selectable 'Electric Mini Tank'
	"Check for selection of currently unavailable ResWtrHtr:TankType"
		ResWtrHtr:Action	= {	if (IfValidAnd( FloorAreaServed > 0.1 ) .AND. (IfValidAnd( HeaterType > 99 ) .OR. IfValidAnd( HeaterType = 8 )))
										then	switch (HeaterType)
													case  100 : PostError( "DHW heater '%s' tank type of 'Boiler' is not compatible with the currently selected heater element type '%s'.",               Name, EnumString( HeaterElementType ) )
													case  101 : PostError( "DHW heater '%s' tank type of 'Indirect' is not compatible with the currently selected heater element type '%s'.",             Name, EnumString( HeaterElementType ) )
													case  102 : PostError( "DHW heater '%s' tank type of 'Large Instantaneous' is not compatible with the currently selected heater element type '%s'.",  Name, EnumString( HeaterElementType ) )
													case  103 : PostError( "DHW heater '%s' tank type of 'Large Storage' is not compatible with the currently selected heater element type '%s'.",        Name, EnumString( HeaterElementType ) )
													case  104 : PostError( "DHW heater '%s' tank type of 'Large Tankless' is not compatible with the currently selected heater element type '%s'.",       Name, EnumString( HeaterElementType ) )
													case  105 : PostError( "DHW heater '%s' tank type of 'Small Instantaneous' is not compatible with the currently selected heater element type '%s'.",  Name, EnumString( HeaterElementType ) )
													case  107 : PostError( "DHW heater '%s' tank type of 'Unfired Storage Tank' is not compatible with the currently selected heater element type '%s'.", Name, EnumString( HeaterElementType ) )
												;	case  108 : PostError( "DHW heater '%s' tank type of 'Electric Mini Tank' is not compatible with the currently selected heater element type '%s'.",   Name, EnumString( HeaterElementType ) )
													case    8 : PostError( "DHW heater '%s' tank type issue - 'Electric Mini Tank' now implemented only as optional inputs to Gas Instantaneous heaters.", Name )
													default   : UNCHANGED
												endswitch
										else	UNCHANGED  endif  }
	"Check for selection of currently unavailable ResHVACSys:DHWTankType"
		ResHVACSys:Action	= {	if (IfValidAnd( DHWFloorAreaServed > 0.1 ) .AND. (IfValidAnd( DHWTankType > 99 ) .OR. IfValidAnd( DHWTankType = 8 )))
										then	switch (DHWTankType)
													case  100 : PostError( "HVAC system '%s' DHW tank type of 'Boiler' is not compatible with the currently selected heater element type '%s'.",               Name, EnumString( DHWHeaterElementType ) )
													case  101 : PostError( "HVAC system '%s' DHW tank type of 'Indirect' is not compatible with the currently selected heater element type '%s'.",             Name, EnumString( DHWHeaterElementType ) )
													case  102 : PostError( "HVAC system '%s' DHW tank type of 'Large Instantaneous' is not compatible with the currently selected heater element type '%s'.",  Name, EnumString( DHWHeaterElementType ) )
													case  103 : PostError( "HVAC system '%s' DHW tank type of 'Large Storage' is not compatible with the currently selected heater element type '%s'.",        Name, EnumString( DHWHeaterElementType ) )
													case  104 : PostError( "HVAC system '%s' DHW tank type of 'Large Tankless' is not compatible with the currently selected heater element type '%s'.",       Name, EnumString( DHWHeaterElementType ) )
													case  105 : PostError( "HVAC system '%s' DHW tank type of 'Small Instantaneous' is not compatible with the currently selected heater element type '%s'.",  Name, EnumString( DHWHeaterElementType ) )
													case  107 : PostError( "HVAC system '%s' DHW tank type of 'Unfired Storage Tank' is not compatible with the currently selected heater element type '%s'.", Name, EnumString( DHWHeaterElementType ) )
												;	case  108 : PostError( "HVAC system '%s' DHW tank type of 'Electric Mini Tank' is not compatible with the currently selected heater element type '%s'.",   Name, EnumString( DHWHeaterElementType ) )
													case    8 : PostError( "DHW heater '%s' tank type issue - 'Electric Mini Tank' now implemented only as optional inputs to Gas Instantaneous heaters.", Name )
													default   : UNCHANGED
												endswitch
										else	UNCHANGED  endif  }

; "Dbg-1"	ResProj:Action	= {	MessageBox( "Proj:StdDesignBase = %g / NatGasAvailable = %g / IsMultiFamily = %g / ApplDryerFuel[1] = %g",
;                                       Proj:StdDesignBase, NatGasAvailable, IsMultiFamily, ApplDryerFuel[1] )  }
	; SAC 1/14/14 - appliance fuel checks added (cooking OK to remain nat gas even when nat gas not available on site)
   ; SAC 6/14/17 - modified check on StdDesignBase to >= 2014 (from > 2015) to ensure EDR reference (2014) doesn't trigger this error (tic #844)
	"Check for consistency between NatGas availability and ResProj:ApplDryerFuel[1] options (single-family)"
		ResProj:Action	= {	if ( Proj:StdDesignBase >= 2014 .OR. NatGasAvailable > 0.5 .OR. IsMultiFamily > 0.5 .OR. ApplDryerFuel[1] != 2) then  UNCHANGED
								else  PostError( "Project's clothes dryer fuel set to Natural Gas (Project data, Appliances tab), but Natural Gas registered as not available on site." )  endif  }
	"Check for consistency between NatGas availability and ResProj:ApplDryerFuel[*] options (multi-family)"
		ResZn:Action	= {	if ( Proj:StdDesignBase >= 2014 .OR. ResProj:NatGasAvailable > 0.5 .OR. Proj:IsSFamResRuleset .OR. Appl_DryerGain[2] < 0.01) then  UNCHANGED
								else	PostError( "Clothes dryer fuel set to Natural Gas for dwelling unit(s) assigned to Zone '%s', but Natural Gas registered as not available on site.", Name )  endif  }


; SAC 11/12/14 - added checks to ensure that valid Zones are assigned for all appliances listed as present in model (GC issue 379)
	; SAC 2/4/16 - toggled OFF these checks when in Research mode
	"Check for single family Refrigerator appliance location"
		ResProj:Action		= {	if (IsMultiFamily > 0.5 .OR. IfValidAnd( Appl_HaveRefrig[1] > 0.5 )==0 .OR. AnalysisType < 1) then  UNCHANGED
									else if (LocalCompAssigned( ApplRefrigZone[1] ) < 0.5) 
									then  PostError( "Valid Zone must be selected for refrigerator location (on Appliances tab of Project tabbed dialog)." )
									else  UNCHANGED  endif endif  }
	"Check for single family Dishwasher appliance location"
		ResProj:Action		= {	if (IsMultiFamily > 0.5 .OR. IfValidAnd( Appl_HaveDish[1] > 0.5 )==0 .OR. AnalysisType < 1) then  UNCHANGED
									else if (LocalCompAssigned( ApplDishZone[1] ) < 0.5) 
									then  PostError( "Valid Zone must be selected for dishwasher location (on Appliances tab of Project tabbed dialog)." )
									else  UNCHANGED  endif endif  }
	"Check for single family Clothes Washer appliance location"
		ResProj:Action		= {	if (IsMultiFamily > 0.5 .OR. IfValidAnd( Appl_HaveWasher[1] > 0.5 )==0 .OR. AnalysisType < 1) then  UNCHANGED
									else if (LocalCompAssigned( ApplWasherZone[1] ) < 0.5) 
									then  PostError( "Valid Zone must be selected for clothes washer location (on Appliances tab of Project tabbed dialog)." )
									else  UNCHANGED  endif endif  }
	"Check for single family Clothes Dryer appliance location"
		ResProj:Action		= {	if (IsMultiFamily > 0.5 .OR. IfValidAnd( Appl_HaveDryer[1] > 0.5 )==0 .OR. AnalysisType < 1) then  UNCHANGED
									else if (LocalCompAssigned( ApplDryerZone[1] ) < 0.5) 
									then  PostError( "Valid Zone must be selected for clothes dryer location (on Appliances tab of Project tabbed dialog)." )
									else  UNCHANGED  endif endif  }
	"Check for single family Cooking appliance location"
		ResProj:Action		= {	if (IsMultiFamily > 0.5 .OR. IfValidAnd( Appl_HaveCook[1] > 0.5 )==0 .OR. AnalysisType < 1) then  UNCHANGED
									else if (LocalCompAssigned( ApplCookZone[1] ) < 0.5) 
									then  PostError( "Valid Zone must be selected for cooking appliances location (on Appliances tab of Project tabbed dialog)." )
									else  UNCHANGED  endif endif  }

END
;*************************************************************************


;*************************************************************************
RULELIST "Count_NumAlterations" 1 0 0 0
;   Generate estiamte of number of alteration categories present in building model
;*************************************************************************
	"alteration categ #1 - ceiling/wall/raised floor insulation"
		ResProj:NumAlterations	= {	SumAcrossIf( ResExtWall:IsAltered, ResExtWall:Area > 1 ) +
											SumAcrossIf( ResExtFlr:IsAltered, ResExtFlr:Area > 1 ) +
											SumAcrossIf( ResCathedralCeiling:IsAltered, ResCathedralCeiling:Area > 1 ) +
											SumAcrossIf( ResCeilingBelowAttic:IsAltered, ResCeilingBelowAttic:Area > 1 ) +
											SumAcrossIf( ResFlrOverCrawlSpc:IsAltered, ResFlrOverCrawlSpc:Area > 1 ) +
											SumAcrossIf( ResIntWall:IsAltered, ResIntWall:IsDemising > 0.5 ) +
											SumAcrossIf( ResUndgrWall:IsAltered, ResUndgrWall:Area > 1 ) +
											SumAcrossIf( ResIntFlr:IsAltered, ResIntFlr:IsDemising > 0.5 ) +
											SumAcrossIf( ResIntCeiling:IsAltered, ResIntCeiling:IsDemising > 0.5 )  }

	"alteration categ #2/3 - fenestration OR window film"
		ResProj:NumAlterations	= {	NumAlterations + SumAcrossIf( Window:IsAltered, Window:Area > 1 )  }

	"alteration categ #4 - space heating and/or cooling equip"
		ResProj:NumAlterations	= {	NumAlterations + SumAcrossIf( ResHVACSys:IsAltered, ResHVACSys:FloorAreaSrvdInclV > 1 )  }

	"alteration categ #5/6 - duct sealing OR insulation"
		ResProj:NumAlterations	= {	NumAlterations + SumAll( ResDistSys:IsAltered )  }

	"alteration categ #7 - water heating systems"
		ResProj:NumAlterations	= {	NumAlterations + SumAcrossIf( ResDHWSys:IsAltered, ResDHWSys:FloorAreaServed > 1 )  }

	"alteration categ #8 - roofing"
		ResProj:NumAlterations	= {	NumAlterations + SumAcrossIf( ResAttic:IsAltered, ResAttic:FloorArea > 1 )  }

	"alteration categ #9 - all others"
		ResProj:NumAlterations	= {	NumAlterations +	SumAcrossIf( ResUndgrFlr:IsAltered, ResUndgrFlr:Area > 1 ) +
																	SumAcrossIf( ResSlabFlr:IsAltered, ResSlabFlr:Area > 1 ) +
										;							SumAcrossIf( ResDr:IsAltered, ResDr:Area > 1 ) +
																	SumAcrossIf( ResSkylt:IsAltered, ResSkylt:Area > 1 ) +
																	SumAcrossIf( ResFanSys:IsAltered, ResFanSys:FloorAreaServed > 0.5 )  }
END
;*************************************************************************

;************************************************************************* SAC 2/17/20 - rulelists to facilitate clean-up of regression test runs - Fan Efficacy
RULELIST "FIX_2019FanEfficacy_SFam" 1 0 0 0
			"Check for SFam mandatory minimum fan system efficacy (ACM 2.2.12) - call subordinate rulelist to upate if needed"		ResHVACSys:Action	= {
					if ( FloorAreaServed[1] < 0.1 .OR. LocalCompAssigned( Fan ) == 0 .OR.
						( ResProj:RunScope == 2 .AND. Fan:Status == 2 .AND. Fan:IsVerified) .OR. (( ResProj:RunScope == 2 .OR. ResProj:IsAddAlone > 0) .AND. Fan:Status == 1) ) then  UNCHANGED
					else if (Fan:Type == 1 .AND. SDHVAreaServed == FloorAreaServed[1] 
						.AND. Fan:WperCFMCool >T24RClimateZoneCodeBase:SDHVWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ))
               then  EvalRulelist( "FIX_2019FanEfficacy_SDHV", 1 )
					else if (Fan:Type == 1 .AND. SDHVAreaServed != FloorAreaServed[1] .AND. GasFurnAreaServed == FloorAreaServed[1] 
						.AND. Fan:WperCFMCool >T24RClimateZoneCodeBase:GFurnWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ))
					then  EvalRulelist( "FIX_2019FanEfficacy_GasFurnace", 1 )
					else if (Fan:Type == 1  .AND. SDHVAreaServed != FloorAreaServed[1] .AND. GasFurnAreaServed != FloorAreaServed[1]
						.AND. Fan:WperCFMCool >T24RClimateZoneCodeBase:WperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ))
					then  EvalRulelist( "FIX_2019FanEfficacy_Other", 1 )
          else  UNCHANGED  endif endif  endif endif}
END
;*************************************************************************
RULELIST "FIX_2019FanEfficacy_SDHV" 1 0 1 0
   "Post message to log re: fan efficacy change"      ResHVACSys:Action  =
      {  PostMessageToLog( "Fan '%s' assigned to HVAC system '%s' being updated to mandatory max of %g W/CFM for SDHV system (from current setting of %g)",  Fan:name, Name, 
						                  T24RClimateZoneCodeBase:SDHVWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ), Fan:WperCFMCool)  }
	"Force update of ResHVACSys:Fan:WperCFMCool to SDHV max"    ResHVACSys:Fan:WperCFMCool  =
	   {  T24RClimateZoneCodeBase:SDHVWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )  }
END
;*************************************************************************
RULELIST "FIX_2019FanEfficacy_GasFurnace" 1 0 1 0
   "Post message to log re: fan efficacy change"      ResHVACSys:Action  =
      {  PostMessageToLog( "Fan '%s' assigned to HVAC system '%s' being updated to mandatory max of %g W/CFM for gas furnace air-handling unit (from current setting of %g)",  Fan:name, Name, 
						                  T24RClimateZoneCodeBase:GFurnWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ), Fan:WperCFMCool)  }
	"Force update of ResHVACSys:Fan:WperCFMCool to gas furnace air-handling unit max"    ResHVACSys:Fan:WperCFMCool  =
	   {  T24RClimateZoneCodeBase:GFurnWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )  }
END
;*************************************************************************
RULELIST "FIX_2019FanEfficacy_Other" 1 0 1 0
   "Post message to log re: fan efficacy change"      ResHVACSys:Action  =
      {  PostMessageToLog( "Fan '%s' assigned to HVAC system '%s' being updated to mandatory max of %g W/CFM (from current setting of %g)",  Fan:name, Name, 
						                  T24RClimateZoneCodeBase:WperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ), Fan:WperCFMCool)  }
	"Force update of ResHVACSys:Fan:WperCFMCool max"    ResHVACSys:Fan:WperCFMCool  =
	   {  T24RClimateZoneCodeBase:WperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )  }
END
;*************************************************************************

;************************************************************************* SAC 2/18/20 - rulelists to facilitate clean-up of regression test runs - Fan Efficacy for MFam models
RULELIST "FIX_2019FanEfficacy_MFam" 1 0 0 0
			"Check for MFam mandatory minimum fan system efficacy (ACM 2.2.12) - call subordinate rulelist to upate if needed"		DwellUnitType:Action	= {
					if ( AssignedDUFlrArea < 0.1 .OR. LocalCompAssigned( HVACFanRef ) == 0 .OR.
						( ResProj:RunScope == 2 .AND. IfValidAnd( HVACFanRef:Status == 2 ) .AND. IfValidAnd( HVACFanRef:IsVerified > 0 )) .OR.
						(( ResProj:RunScope == 2 .OR. ResProj:IsAddAlone > 0) .AND. IfValidAnd( HVACFanRef:Status == 1 )) ) then  UNCHANGED
					else if (HVACFanRef:Type == 1 .AND. 
					         ( (HVACSysType == 2 .AND. HtPumpEqpType == 19) .OR.
					           (HVACSysType != 2 .AND. CoolEqpType   == 18) ) 
						.AND. HVACFanRef:WperCFMCool >T24RClimateZoneCodeBase:SDHVWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ))
               then  EvalRulelist( "FIX_2019FanEfficacy_MFam_SDHV", 1 )
					else if (HVACFanRef:Type == 1 .AND. HVACSysType != 2 .AND. HeatEqpType == 1
						.AND. HVACFanRef:WperCFMCool >T24RClimateZoneCodeBase:GFurnWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ))
					then  EvalRulelist( "FIX_2019FanEfficacy_MFam_GasFurnace", 1 )
					else if (HVACFanRef:Type == 1
						.AND. HVACFanRef:WperCFMCool >T24RClimateZoneCodeBase:WperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ))
					then  EvalRulelist( "FIX_2019FanEfficacy_MFam_Other", 1 )
          else  UNCHANGED  endif endif  endif endif}
END
;*************************************************************************
RULELIST "FIX_2019FanEfficacy_MFam_SDHV" 1 0 1 0
   "Post message to log re: DwellUnitType fan efficacy change"      DwellUnitType:Action  =
      {  PostMessageToLog( "Fan '%s' assigned to DwellUnitType '%s' being updated to mandatory max of %g W/CFM for SDHV system (from current setting of %g)",  HVACFanRef:name, Name, 
						                  T24RClimateZoneCodeBase:SDHVWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ), HVACFanRef:WperCFMCool)  }
	"Force update of DwellUnitType:HVACFanRef:WperCFMCool to SDHV max"    DwellUnitType:HVACFanRef:WperCFMCool  =
	   {  T24RClimateZoneCodeBase:SDHVWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )  }
END
;*************************************************************************
RULELIST "FIX_2019FanEfficacy_MFam_GasFurnace" 1 0 1 0
   "Post message to log re: DwellUnitType fan efficacy change"      DwellUnitType:Action  =
      {  PostMessageToLog( "Fan '%s' assigned to DwellUnitType '%s' being updated to mandatory max of %g W/CFM for gas furnace air-handling unit (from current setting of %g)",  HVACFanRef:name, Name, 
						                  T24RClimateZoneCodeBase:GFurnWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ), HVACFanRef:WperCFMCool)  }
	"Force update of DwellUnitType:HVACFanRef:WperCFMCool to gas furnace air-handling unit max"    DwellUnitType:HVACFanRef:WperCFMCool  =
	   {  T24RClimateZoneCodeBase:GFurnWperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )  }
END
;*************************************************************************
RULELIST "FIX_2019FanEfficacy_MFam_Other" 1 0 1 0
   "Post message to log re: DwellUnitType fan efficacy change"      DwellUnitType:Action  =
      {  PostMessageToLog( "Fan '%s' assigned to DwellUnitType '%s' being updated to mandatory max of %g W/CFM (from current setting of %g)",  HVACFanRef:name, Name, 
						                  T24RClimateZoneCodeBase:WperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr ), HVACFanRef:WperCFMCool)  }
	"Force update of DwellUnitType:HVACFanRef:WperCFMCool max"    DwellUnitType:HVACFanRef:WperCFMCool  =
	   {  T24RClimateZoneCodeBase:WperCFM( "ClimateZone", Proj:CliZnNum, "CodeBase", Proj:StdDesignBase, "BldgType", Proj:BldgTypeTblStr )  }
END
;*************************************************************************


;************************************************************************* SAC 04/19/23 (tic #3497)
RULELIST "SetIndirectOutsideConnection_First"  1 0 0 0
;"test log" Proj:Action = {  PostMessageToLog( "    evaluating 'SetIndirectOutsideConnection_First' rules on '%s' model...", RunAbbrev )  }
   "Set ResIntWall:OutsideConnection"     ResIntWall:OutsideConnection =
      {  if (ParentComponentType() != "ResZn" .AND. ParentComponentType() != "ResOtherZn") then  1
         else if (LocalCompAssigned( Outside ) == ComponentType( "ResGarage" ) .OR.
                  LocalCompAssigned( Outside ) == ComponentType( "ResAttic"  )) then  1
         else  if (Parent( OutsideConnection ) > 0) then  1
               else if (ParentComponentType() == "ResOtherZn")
               then  if (Parent( SpcFunc ) == 355 .OR. Parent( SpcFunc ) == 356) then  1
                     else  0  endif    else  0  endif endif    endif endif  }
   "Set ResUndgrWall:OutsideConnection"   ResUndgrWall:OutsideConnection =
      {  if (ParentComponentType() != "ResZn" .AND. ParentComponentType() != "ResOtherZn") then  1
         else  if (Parent( OutsideConnection ) > 0) then  1
               else if (ParentComponentType() == "ResOtherZn")
               then  if (Parent( SpcFunc ) == 355 .OR. Parent( SpcFunc ) == 356) then  1
                     else  0  endif    else  0  endif endif    endif  }
   "Set ResIntCeiling:OutsideConnection"  ResIntCeiling:OutsideConnection =
      {  if (ParentComponentType() != "ResZn" .AND. ParentComponentType() != "ResOtherZn") then  1
         else if (LocalCompAssigned( Outside ) == ComponentType( "ResGarage" ) .OR.
                  LocalCompAssigned( Outside ) == ComponentType( "ResAttic"  )) then  1
         else  if (Parent( OutsideConnection ) > 0) then  1
               else if (ParentComponentType() == "ResOtherZn")
               then  if (Parent( SpcFunc ) == 355 .OR. Parent( SpcFunc ) == 356) then  1
                     else  0  endif    else  0  endif endif    endif endif  }
   "Set ResIntFlr:OutsideConnection"      ResIntFlr:OutsideConnection =
      {  if (ParentComponentType() != "ResZn" .AND. ParentComponentType() != "ResOtherZn") then  1
         else if (LocalCompAssigned( Outside ) == ComponentType( "ResGarage" ) .OR.
                  LocalCompAssigned( Outside ) == ComponentType( "ResAttic"  )) then  1
         else  if (Parent( OutsideConnection ) > 0) then  1
               else if (ParentComponentType() == "ResOtherZn")
               then  if (Parent( SpcFunc ) == 355 .OR. Parent( SpcFunc ) == 356) then  1
                     else  0  endif    else  0  endif endif    endif endif  }
   "Set ResUndgrFlr:OutsideConnection"    ResUndgrFlr:OutsideConnection =
      {  if (ParentComponentType() != "ResZn" .AND. ParentComponentType() != "ResOtherZn") then  1
         else  if (Parent( OutsideConnection ) > 0) then  1
               else if (ParentComponentType() == "ResOtherZn")
               then  if (Parent( SpcFunc ) == 355 .OR. Parent( SpcFunc ) == 356) then  1
                     else  0  endif    else  0  endif endif    endif  }

   "Eval SetIndirectOutsideConnection rules"    Proj:Action = {  EvalRulelist( "SetIndirectOutsideConnection" )  }
END
;*************************************************************************
RULELIST "SetIndirectOutsideConnection"  1 0 0 0
;"test log" Proj:Action = {  PostMessageToLog( "    evaluating 'SetIndirectOutsideConnection' rules on '%s' model...", RunAbbrev )  }
   "Set ResIntWall:OutsideConnection"     ResIntWall:OutsideConnection =
      {  if (IfValidAnd( OutsideConnection > 0 )) then  UNCHANGED
         else  if (Parent( OutsideConnection ) > 0) then  1
               else if (LocalCompAssigned( Outside ) == ComponentType( "ResZn"      ) .OR.
                        LocalCompAssigned( Outside ) == ComponentType( "ResOtherZn" ))
               then  if (IfValidAnd( Outside:OutsideConnection > 0 )) then  1
                     else  0  endif    else  0  endif endif    endif  }
   "Set ResUndgrWall:OutsideConnection"   ResUndgrWall:OutsideConnection =
      {  if (IfValidAnd( OutsideConnection > 0 )) then  UNCHANGED
         else  if (Parent( OutsideConnection ) > 0) then  1
         else  0  endif endif  }
   "Set ResIntCeiling:OutsideConnection"  ResIntCeiling:OutsideConnection =
      {  if (IfValidAnd( OutsideConnection > 0 )) then  UNCHANGED
         else  if (Parent( OutsideConnection ) > 0) then  1
               else if (LocalCompAssigned( Outside ) == ComponentType( "ResZn"      ) .OR.
                        LocalCompAssigned( Outside ) == ComponentType( "ResOtherZn" ))
               then  if (IfValidAnd( Outside:OutsideConnection > 0 )) then  1
                     else  0  endif    else  0  endif endif    endif  }
   "Set ResIntFlr:OutsideConnection"      ResIntFlr:OutsideConnection =
      {  if (IfValidAnd( OutsideConnection > 0 )) then  UNCHANGED
         else  if (Parent( OutsideConnection ) > 0) then  1
               else if (LocalCompAssigned( Outside ) == ComponentType( "ResZn"      ) .OR.
                        LocalCompAssigned( Outside ) == ComponentType( "ResOtherZn" ))
               then  if (IfValidAnd( Outside:OutsideConnection > 0 )) then  1
                     else  0  endif    else  0  endif endif    endif  }
   "Set ResUndgrFlr:OutsideConnection"    ResUndgrFlr:OutsideConnection =
      {  if (IfValidAnd( OutsideConnection > 0 )) then  UNCHANGED
         else  if (Parent( OutsideConnection ) > 0) then  1
         else  0  endif endif  }

   "Set ResZn:OutsideConnection via indirect"         ResZn:OutsideConnection	=
      {  if (IfValidAnd( OutsideConnection > 0 )) then  UNCHANGED
         else if ( ( SumChildren( ResIntWall:OutsideConnection   ) + SumChildren( ResIntFlr:OutsideConnection   ) + SumChildren( ResIntCeiling:OutsideConnection ) +
                     SumChildren( ResUndgrWall:OutsideConnection ) + SumChildren( ResUndgrFlr:OutsideConnection ) +
                     SumRevRef( ResIntWall:Outside,    ResIntWall:OutsideConnection    ) +
                     SumRevRef( ResIntCeiling:Outside, ResIntCeiling:OutsideConnection ) +
                     SumRevRef( ResIntFlr:Outside,     ResIntFlr:OutsideConnection     ) ) > 0 ) then  1
         else  UNCHANGED  endif endif  }
   "Set ResOtherZn:OutsideConnection via indirect"    ResOtherZn:OutsideConnection	=
      {  if (IfValidAnd( OutsideConnection > 0 )) then  UNCHANGED
         else if ( ( SumChildren( ResIntWall:OutsideConnection   ) + SumChildren( ResIntFlr:OutsideConnection   ) + SumChildren( ResIntCeiling:OutsideConnection ) +
                     SumChildren( ResUndgrWall:OutsideConnection ) + SumChildren( ResUndgrFlr:OutsideConnection ) +
                     SumRevRef( ResIntWall:Outside,    ResIntWall:OutsideConnection    ) +
                     SumRevRef( ResIntCeiling:Outside, ResIntCeiling:OutsideConnection ) +
                     SumRevRef( ResIntFlr:Outside,     ResIntFlr:OutsideConnection     ) ) > 0 ) then  1
         else  UNCHANGED  endif endif  }
END
;*************************************************************************




;*************************************************************************
;*************************************************************************

ENDFILE
