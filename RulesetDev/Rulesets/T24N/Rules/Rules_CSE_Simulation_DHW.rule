; -------------------------------------------------------------------------
; Rules pertaining to:   Prep For and Clean-up After each CSE Energy Simulation
; CEC Title-24 Residential Energy Code
; -------------------------------------------------------------------------
; Copyright (c) 2012-2017, California Energy Commission
; Copyright (c) 2012-2017, Wrightsoft Corporation
; All rights reserved.
; Redistribution and use in source and binary forms, with or without modification,
; are permitted provided that the following conditions are met:
; - Redistributions of source code must retain the above copyright notice, this
;   list of conditions and the following disclaimer.
; - Redistributions in binary form must reproduce the above copyright notice, this
;   list of conditions, the following disclaimer in the documentation and/or other
;   materials provided with the distribution.
; - Neither the name of the California Energy Commission nor the names of its
;   contributors may be used to endorse or promote products derived from this
;   software without specific prior written permission.
; DISCLAIMER: THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
; "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
; THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
; NON-INFRINGEMENT ARE DISCLAIMED. IN NO EVENT SHALL CALIFORNIA ENERGY COMMISSION,
; WRIGHTSOFT CORPORATION, ITRON, INC. OR ANY OTHER AUTHOR OR COPYRIGHT HOLDER OF
; THIS SOFTWARE (COLLECTIVELY, THE "AUTHORS") BE LIABLE FOR ANY DIRECT, INDIRECT,
; INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
; LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
; OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
; LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
; OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
; ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.  EACH LICENSEE AND SUBLICENSEE OF THE
; SOFTWARE AGREES NOT TO ASSERT ANY CLAIM AGAINST ANY OF THE AUTHORS RELATING TO
; THIS SOFTWARE, WHETHER DUE TO PERFORMANCE ISSUES, TITLE OR INFRINGEMENT ISSUES,
; STRICT LIABILITY OR OTHERWISE.
; -------------------------------------------------------------------------


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW" 1 0 0 1
;   Rules which are executed immediately prior to performing a CSE simulation - covering DHW objects only
;*************************************************************************

	"Delete all cseDHWLOOPPUMP components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPPUMP   )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPBRANCH components"		Proj:Action = {	DeleteAllComps( cseDHWLOOPBRANCH )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPSEG components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPSEG    )  }	; SAC 10/21/15
	"Delete all cseDHWLOOP components"				Proj:Action = {	DeleteAllComps( cseDHWLOOP       )  }	; SAC 10/21/15
	"Delete all cseDHWHEATER components"			Proj:Action = {	DeleteAllComps( cseDHWHEATER     )  }
	"Delete all cseDHWLOOPHEATER components"		Proj:Action = {	DeleteAllComps( cseDHWLOOPHEATER )  }  ; SAC 1/10/20 (Com tic #3156)
	"Delete all cseDHWHEATREC components"			Proj:Action = {	DeleteAllComps( cseDHWHEATREC    )  }  ; SAC 1/7/19
	"Delete all cseDHWSYS components"				Proj:Action = {	DeleteAllComps( cseDHWSYS        )  }
	"Delete all cseDHWSOLARCOLLECTOR components" Proj:Action = {	DeleteAllComps( cseDHWSOLARCOLLECTOR )  }    ; SAC 1/15/20
	"Delete all cseDHWSOLARSYS components"			Proj:Action = {	DeleteAllComps( cseDHWSOLARSYS       )  }    ; SAC 1/15/20
	"Delete all DwellUnitDHW components"			Proj:Action = {	DeleteAllComps( DwellUnitDHW     )  }	; SAC 5/11/16


   "Create and setup cseDHWSOLARSYS & cseDHWSOLARCOLLECTOR objects"  DHWSolarSys:Action  =      ; SAC 1/15/20 (Res tic #1013)   - SAC 2/2/20 (Com tic #3157)
      {  if (IfValidAnd( ErrID > 0 )==0 .AND. IfValidAnd( FloorAreaServed > 0.1 ))
         then  EvalRulelist( "CSE_SimulationPrep_DHW_SolarSys", 1 )
         else  UNCHANGED  endif  }
   "Set ResDHWSys:CSESolarSysSimValid"    ResDHWSys:CSESolarSysSimValid  =    ; SAC 1/15/20 (Res tic #1013)
      {  if (LocalCompAssigned( DHWSolarSysRef ) < 1) then  0
         else if (IfValidAnd( DHWSolarSysRef:CSESimValid > 0 )) then  1
         else  0  endif endif  }


	; SAC 4/25/16 - added creation of DHWMETER obejcts
	"Create site-wide FXHwDHWMETER"		Proj:CSE_FXHwDHWMETER	= {	if (CSE_DHWUseMthd == "Old (via wsUse)") then  UNDEFINED
																							else  CreateComp( cseDHWMETER, "DHWMtrFXMix" )  endif  }
	"Create site-wide WHHwDHWMETER"		Proj:CSE_WHHwDHWMETER	= {	if (CSE_DHWUseMthd == "Old (via wsUse)") then  UNDEFINED
																							else  CreateComp( cseDHWMETER, "DHWMtrWH" )  endif  }

;	Descriptions of DHW system types defined in the Res ACM, appendix E, section E1:
;	--------------------------------------------------------------------------------------------------------------------
;		1	One distribution system with one or multiple water heaters serving a single dwelling unit. The system might include
;			recirculation loops within the dwelling unit.  
;		2	Two water heaters with independent distribution systems serving a single dwelling unit. One or more of the
;			distribution systems may include a recirculation loop within the dwelling unit.  
;		3	One distribution system without recirculation loop and with one or multiple water heaters serving multiple
;			dwelling units.  
;		4	One distribution system with one or multiple recirculation loops and with one or multiple water heaters serving
;			multiple units.  
;	--------------------------------------------------------------------------------------------------------------------

  ; CSE DHWSYS creation & setup
	; SAC 10/26/15 - revised to create cseDHWSYS by ResDHWSys only for SFam, and (potentially multiple) cseDHWSys objects for each DwellUnitType for MFam
	"Create a CSE DHWSYS for each ResDHWSys"		ResDHWSys:cseDHWSYSRef					= {	if (IfValidAnd( SysFlrArea > 0.5 )==0 .OR. CentralSys < 0.5) then  UNCHANGED
																												else  CreateComp( cseDHWSYS, "dhwsys-" + Local( Name ) )  endif  }
; MFAM Incompat
;	"Set ResDHWSys:cseDHWSYSRef:SourceDHWSys"		ResDHWSys:cseDHWSYSRef:SourceDHWSys	= {	Local( Name )  }

	"Call subordinate rulelist to setup MFam DHWSYS objects"		Proj:Action		= {	if (CSE_DHWUseMthd == "Old (via wsUse)")
																												then	EvalRulelist( "CSE_SimulationPrep_DHW_MFam_wsUse" )
																												else	EvalRulelist( "CSE_SimulationPrep_DHW_MFam_wsDayUse" )    endif  }

	"Call subordinate rulelist to complete setup of DHW objects"	Proj:Action	= {	EvalRulelist( "CSE_SimulationPrep_DHW_part2" )  }
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_Cleanup_DHW" 1 0 0 1
;*************************************************************************
	"Blast site-wide FXHwDHWMETER"		Proj:CSE_FXHwDHWMETER	= {	if (LocalCompAssigned( CSE_FXHwDHWMETER )) then  DeleteComp()  else  UNCHANGED  endif  }	; SAC 4/25/16
	"Blast site-wide WHHwDHWMETER"		Proj:CSE_WHHwDHWMETER	= {	if (LocalCompAssigned( CSE_WHHwDHWMETER )) then  DeleteComp()  else  UNCHANGED  endif  }

	"Delete all cseDHWLOOPPUMP components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPPUMP   )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPBRANCH components"		Proj:Action = {	DeleteAllComps( cseDHWLOOPBRANCH )  }	; SAC 10/21/15
	"Delete all cseDHWLOOPSEG components"			Proj:Action = {	DeleteAllComps( cseDHWLOOPSEG    )  }	; SAC 10/21/15
	"Delete all cseDHWLOOP components"				Proj:Action = {	DeleteAllComps( cseDHWLOOP )  }	; SAC 10/21/15
	"Delete all cseDHWHEATER components"			Proj:Action = {	DeleteAllComps( cseDHWHEATER )  }	; SAC 7/6/15
	"Delete all cseDHWHEATREC components"			Proj:Action = {	DeleteAllComps( cseDHWHEATREC    )  }  ; SAC 1/7/19
	"Delete all cseDHWSYS components"				Proj:Action = {	DeleteAllComps( cseDHWSYS )  }
	"Delete all cseDHWSOLARCOLLECTOR components" Proj:Action = {	DeleteAllComps( cseDHWSOLARCOLLECTOR )  }    ; SAC 1/15/20
	"Delete all cseDHWSOLARSYS components"			Proj:Action = {	DeleteAllComps( cseDHWSOLARSYS       )  }    ; SAC 1/15/20
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_SetDHWUseInclude" 1 0 0 1
	"Set Proj:CSE_DefineName[11]"		Proj:CSE_DefineName[11]		= { "ShwrFLOWF"		 }
	"Set Proj:CSE_DefineName[12]"		Proj:CSE_DefineName[12]		= { "ShwrDRAINHREFF"	 }
	"Set Proj:CSE_DefineName[13]"		Proj:CSE_DefineName[13]		= { "CwshHOTF"			 }
	"Set Proj:CSE_DefineName[14]"		Proj:CSE_DefineName[14]		= { "CwshUSEF"			 }
	"Set Proj:CSE_DefineName[15]"		Proj:CSE_DefineName[15]		= { "FaucHOTF"			 }
	"Set Proj:CSE_DefineName[16]"		Proj:CSE_DefineName[16]		= { "FaucFlowF"		 }
	"Set Proj:CSE_DefineName[17]"		Proj:CSE_DefineName[17]		= { "BathFLOWF"		 }
	"Set Proj:CSE_DefineName[18]"		Proj:CSE_DefineName[18]		= { "BathDRAINHREFF"	 }
	"Set Proj:CSE_DefineName[19]"		Proj:CSE_DefineName[19]		= { "DwshFLOWF"		 }
	"Set Proj:CSE_DefineName[20]"		Proj:CSE_DefineName[20]		= { "NumCntrlWHtrs( s)" }     ; SAC 1/13/20 - to facilitate central electric DHWSys heater autosizing (Com tic #3156)
	"Set Proj:CSE_DefineName[21]"		Proj:CSE_DefineName[21]		= { "RunFileName" }           ; SAC 2/2/20 (Com tic #3157)
	"Set Proj:CSE_DefineName[22]"		Proj:CSE_DefineName[22]		= { UNDEFINED  }			; add next here
	"Set Proj:CSE_DefineName[23]"		Proj:CSE_DefineName[23]		= { UNDEFINED  }

	"Set Proj:CSE_DefineFloat[11]"	Proj:CSE_DefineFloat[11]	= { 1.0  }	; Proj:ShwrFLOWF		}
	"Set Proj:CSE_DefineFloat[12]"	Proj:CSE_DefineFloat[12]	= { 0    }
	                                                            ; SAC 1/24/19 - FORCE OLD ShowerDrainHtRcvry OFF
	                                                            ;    if (SumAll( ResDHWSys:HaveShowerDrainHtRcvry ) > 0.5)
	                                                            ;    then SumAcrossIf( ResDHWSys:ShowerDrainHtRcvryEff, ResDHWSys:HaveShowerDrainHtRcvry > 0.5 ) /
																					;	      SumAll( ResDHWSys:HaveShowerDrainHtRcvry )
																					;	 else  0  endif    }	; Proj:ShwrDRAINHREFF           ; SAC 8/8/18 (Res tic #978)
	"Set Proj:CSE_DefineFloat[13]"	Proj:CSE_DefineFloat[13]	= { 0.22 }	; Proj:CwshHOTF			}
	"Set Proj:CSE_DefineFloat[14]"	Proj:CSE_DefineFloat[14]	= { 2.03 }	; Proj:CwshUSEF			}
	"Set Proj:CSE_DefineFloat[15]"	Proj:CSE_DefineFloat[15]	= { 0.5  }	; Proj:FaucHOTF			}
	"Set Proj:CSE_DefineFloat[16]"	Proj:CSE_DefineFloat[16]	= { 1    }	; Proj:FaucFlowF		}
	"Set Proj:CSE_DefineFloat[17]"	Proj:CSE_DefineFloat[17]	= { 1    }	; Proj:BathFLOWF		}
	"Set Proj:CSE_DefineFloat[18]"	Proj:CSE_DefineFloat[18]	= { 0    }	; Proj:BathDRAINHREFF	}
	"Set Proj:CSE_DefineFloat[19]"	Proj:CSE_DefineFloat[19]	= { 1    }	; Proj:DwshFLOWF		}
	"Set Proj:CSE_DefineFloat[20]"	Proj:CSE_DefineFloat[20]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[21]"	Proj:CSE_DefineFloat[21]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[22]"	Proj:CSE_DefineFloat[22]	= { UNDEFINED  }
	"Set Proj:CSE_DefineFloat[23]"	Proj:CSE_DefineFloat[23]	= { UNDEFINED  }

	"Set Proj:CSE_DefineString[20]"	Proj:CSE_DefineString[20]	= {	"tofloat( 1+fix(@DHWSYS[ s].loadMax / (15400. * @DHWSYS[ s].loadMaxDur)))" }     ; SAC 1/13/20 - to facilitate central electric DHWSys heater autosizing (Com tic #3156)
	"Set Proj:CSE_DefineString[21]"	Proj:CSE_DefineString[21]  = { ValidOr( ProjFileNameNoExt, "" ) + " - " + ValidOr( RunAbbrev, "" ) + "-cse"  }    ; SAC 2/2/20 (Com tic #3157)

	"Set Proj:CSE_DefineType[11]"		Proj:CSE_DefineType[11]		= {	1  }
	"Set Proj:CSE_DefineType[12]"		Proj:CSE_DefineType[12]		= {	1  }
	"Set Proj:CSE_DefineType[13]"		Proj:CSE_DefineType[13]		= {	1  }
	"Set Proj:CSE_DefineType[14]"		Proj:CSE_DefineType[14]		= {	1  }
	"Set Proj:CSE_DefineType[15]"		Proj:CSE_DefineType[15]		= {	1  }
	"Set Proj:CSE_DefineType[16]"		Proj:CSE_DefineType[16]		= {	1  }
	"Set Proj:CSE_DefineType[17]"		Proj:CSE_DefineType[17]		= {	1  }
	"Set Proj:CSE_DefineType[18]"		Proj:CSE_DefineType[18]		= {	1  }
	"Set Proj:CSE_DefineType[19]"		Proj:CSE_DefineType[19]		= {	1  }
	"Set Proj:CSE_DefineType[20]"		Proj:CSE_DefineType[20]		= {	3  }
	"Set Proj:CSE_DefineType[21]"		Proj:CSE_DefineType[21]		= {	3  }
	"Set Proj:CSE_DefineType[22]"		Proj:CSE_DefineType[22]		= {	UNDEFINED  }
	"Set Proj:CSE_DefineType[23]"		Proj:CSE_DefineType[23]		= {	UNDEFINED  }
END

RULELIST "CSE_BlastDHWUseInclude" 1 0 0 1
	"Blast Proj:CSE_DefineName[11]"		Proj:CSE_DefineName[11]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[12]"		Proj:CSE_DefineName[12]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[13]"		Proj:CSE_DefineName[13]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[14]"		Proj:CSE_DefineName[14]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[15]"		Proj:CSE_DefineName[15]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[16]"		Proj:CSE_DefineName[16]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[17]"		Proj:CSE_DefineName[17]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[18]"		Proj:CSE_DefineName[18]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[19]"		Proj:CSE_DefineName[19]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[20]"		Proj:CSE_DefineName[20]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[21]"		Proj:CSE_DefineName[21]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[22]"		Proj:CSE_DefineName[22]		= { UNDEFINED  }
	"Blast Proj:CSE_DefineName[23]"		Proj:CSE_DefineName[23]		= { UNDEFINED  }

	"Blast Proj:CSE_DefineFloat[11]"		Proj:CSE_DefineFloat[11]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[12]"		Proj:CSE_DefineFloat[12]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[13]"		Proj:CSE_DefineFloat[13]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[14]"		Proj:CSE_DefineFloat[14]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[15]"		Proj:CSE_DefineFloat[15]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[16]"		Proj:CSE_DefineFloat[16]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[17]"		Proj:CSE_DefineFloat[17]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[18]"		Proj:CSE_DefineFloat[18]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[19]"		Proj:CSE_DefineFloat[19]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[20]"		Proj:CSE_DefineFloat[20]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[21]"		Proj:CSE_DefineFloat[21]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[22]"		Proj:CSE_DefineFloat[22]	= { UNDEFINED  }
	"Blast Proj:CSE_DefineFloat[23]"		Proj:CSE_DefineFloat[23]	= { UNDEFINED  }

	"Blast Proj:CSE_DefineType[11]"		Proj:CSE_DefineType[11]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[12]"		Proj:CSE_DefineType[12]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[13]"		Proj:CSE_DefineType[13]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[14]"		Proj:CSE_DefineType[14]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[15]"		Proj:CSE_DefineType[15]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[16]"		Proj:CSE_DefineType[16]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[17]"		Proj:CSE_DefineType[17]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[18]"		Proj:CSE_DefineType[18]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[19]"		Proj:CSE_DefineType[19]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[20]"		Proj:CSE_DefineType[20]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[21]"		Proj:CSE_DefineType[21]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[22]"		Proj:CSE_DefineType[22]		= {	UNDEFINED  }
	"Blast Proj:CSE_DefineType[23]"		Proj:CSE_DefineType[23]		= {	UNDEFINED  }
END
;*************************************************************************


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_MFam_wsUse" 1 0 0 1
;   Rules to setup DHWSYS objects using old (2013 and earlier) DHW use & gains mechanism
;*************************************************************************
	; unlike in 2016/wsDayUse mode, we create only a single DwellUnitDHW per Spc/DUBedrm combination, since there is no need to vary DHW use schedules across <count> of Spc/DUBedrm DHW systems
	; SAC 8/18/16 - revised logic to NOT create Spc DwellUnitDHW children when the Spc is served by a central ResDHWSys
	"Create Studio DwellUnitDHW child for each Spc"		Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[1] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 1] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU0", "Setup_DwellUnitDHW_Studio" )  endif  }
	"Create 1-Bedrm DwellUnitDHW child for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[2] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 2] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU1", "Setup_DwellUnitDHW_1Bedroom" )  endif  }
	"Create 2-Bedrm DwellUnitDHW child for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[3] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 3] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU2", "Setup_DwellUnitDHW_2Bedroom" )  endif  }
	"Create 3-Bedrm DwellUnitDHW child for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[4] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 4] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU3", "Setup_DwellUnitDHW_3Bedroom" )  endif  }
	"Create 4-Bedrm DwellUnitDHW child for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[5] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 5] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU4", "Setup_DwellUnitDHW_4Bedroom" )  endif  }
	"Create 5-Bedrm DwellUnitDHW child for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[6] > 0 )==0 .OR.
																																  IfValidAnd( DwellingUnitTypeCnt[ 6] > 0 )==0 .OR.
																																  IfValidAnd( ResDHWSysRef:CentralSys = 0 )==0) then  UNCHANGED
																								else	  CreateChildren( DwellUnitDHW, 1, Name + " DU5", "Setup_DwellUnitDHW_5Bedroom" )  endif  }

	"Create a CSE DHWSYS for each DwellUnitDHW"				DwellUnitDHW:cseDHWSYSRef								= {	CreateComp( cseDHWSYS, "dhwsys-" + Local( Name ) )  }
; MFAM Incompat
;	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitType"	DwellUnitDHW:cseDHWSYSRef:SourceSpc					= {	Parent( Name )  }
;; SAC 5/11/16 - DISALLOW multiple ResDHWSys objects per DwellUnitType
;	"Set DwellUnitDHW:cseDHWSYSRef:SourceDHWSys"				DwellUnitDHW:cseDHWSYSRef:SourceDHWSys				= {	ParentRef( ResDHWSysRef:Name )  }
;	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW"		DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW		= {	Name  }
;
;	"Set DwellUnitDHW:cseDHWSYSRef:wsMult"						DwellUnitDHW:cseDHWSYSRef:wsMult						= {	Mult  }
;	"Set DwellUnitDHW:cseDHWSYSRef:DHWDailyConsPerSys"		DwellUnitDHW:cseDHWSYSRef:DHWDailyConsPerSys		= {	UsePerDay  }
	"Set DwellUnitDHW:cseDHWSYSRef:CFAk"						DwellUnitDHW:cseDHWSYSRef:CFAk						= {	Area  }

; SAC 7/7/16 - replaced below w/ above to fix problem where cseDHWHEATER objects not being created for 2013/wsUse models
;	
;	;	"Create a CSE DHWSYS for each DwellUnitType-1"		DwellUnitType:cseDHWSYSRefs[1]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 1 .OR.
;	;																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[1] ) < 1) then  UNCHANGED
;	;																															else  CreateComp( cseDHWSYS, "dhwsys1-" + Local( Name ) )  endif  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[1]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[1]:SourceDwellUnitType	= {	Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[1]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[1]:SourceDHWSys			= {	DHWSysRef[1]:Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[1]:wsMult"					DwellUnitType:cseDHWSYSRefs[1]:wsMult					= {	NumAssigningDUs  }
;		"Create a CSE DHWSYS for each Spc-Studio"			Spc:CSE_DHWSYSRefs[1]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[1] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 1] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys0-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[1]:SourceSpc"				Spc:CSE_DHWSYSRefs[1]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[1]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[1]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[1]:wsMult"					Spc:CSE_DHWSYSRefs[1]:wsMult					= {	DwellingUnitTypeCnt[1] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[1]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[1]:DHWDailyConsPerSys	= {	DwellingUnit1GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[1]:CFAk"						Spc:CSE_DHWSYSRefs[1]:CFAk						= {	DwellingUnitTypeArea[1]  }
;	
;	;	"Create a CSE DHWSYS for each DwellUnitType-2"		DwellUnitType:cseDHWSYSRefs[2]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 2 .OR.
;	;																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[2] ) < 0.5) then  UNCHANGED
;	;																															else  CreateComp( cseDHWSYS, "dhwsys2-" + Local( Name ) )  endif  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[2]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[2]:SourceDwellUnitType	= {	Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[2]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[2]:SourceDHWSys			= {	DHWSysRef[2]:Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[2]:wsMult"					DwellUnitType:cseDHWSYSRefs[2]:wsMult					= {	NumAssigningDUs  }
;		"Create a CSE DHWSYS for each Spc-1 Bedrm"		Spc:CSE_DHWSYSRefs[2]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[2] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 2] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys1-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[2]:SourceSpc"				Spc:CSE_DHWSYSRefs[2]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[2]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[2]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[2]:wsMult"					Spc:CSE_DHWSYSRefs[2]:wsMult					= {	DwellingUnitTypeCnt[2] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[2]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[2]:DHWDailyConsPerSys	= {	DwellingUnit2GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[2]:CFAk"						Spc:CSE_DHWSYSRefs[2]:CFAk						= {	DwellingUnitTypeArea[2]  }
;	
;	;	"Create a CSE DHWSYS for each DwellUnitType-3"		DwellUnitType:cseDHWSYSRefs[3]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 3 .OR.
;	;																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[3] ) < 0.5) then  UNCHANGED
;	;																															else  CreateComp( cseDHWSYS, "dhwsys3-" + Local( Name ) )  endif  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[3]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[3]:SourceDwellUnitType	= {	Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[3]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[3]:SourceDHWSys			= {	DHWSysRef[3]:Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[3]:wsMult"					DwellUnitType:cseDHWSYSRefs[3]:wsMult					= {	NumAssigningDUs  }
;		"Create a CSE DHWSYS for each Spc-2 Bedrm"		Spc:CSE_DHWSYSRefs[3]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[3] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 3] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys2-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[3]:SourceSpc"				Spc:CSE_DHWSYSRefs[3]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[3]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[3]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[3]:wsMult"					Spc:CSE_DHWSYSRefs[3]:wsMult					= {	DwellingUnitTypeCnt[3] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[3]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[3]:DHWDailyConsPerSys	= {	DwellingUnit3GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[3]:CFAk"						Spc:CSE_DHWSYSRefs[3]:CFAk						= {	DwellingUnitTypeArea[3]  }
;	
;	;	"Create a CSE DHWSYS for each DwellUnitType-4"		DwellUnitType:cseDHWSYSRefs[4]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 4 .OR.
;	;																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[4] ) < 0.5) then  UNCHANGED
;	;																															else  CreateComp( cseDHWSYS, "dhwsys4-" + Local( Name ) )  endif  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[4]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[4]:SourceDwellUnitType	= {	Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[4]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[4]:SourceDHWSys			= {	DHWSysRef[4]:Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[4]:wsMult"					DwellUnitType:cseDHWSYSRefs[4]:wsMult					= {	NumAssigningDUs  }
;		"Create a CSE DHWSYS for each Spc-3 Bedrm"		Spc:CSE_DHWSYSRefs[4]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[4] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 4] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys3-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[4]:SourceSpc"				Spc:CSE_DHWSYSRefs[4]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[4]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[4]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[4]:wsMult"					Spc:CSE_DHWSYSRefs[4]:wsMult					= {	DwellingUnitTypeCnt[4] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[4]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[4]:DHWDailyConsPerSys	= {	DwellingUnit4GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[4]:CFAk"						Spc:CSE_DHWSYSRefs[4]:CFAk						= {	DwellingUnitTypeArea[4]  }
;	
;	;	"Create a CSE DHWSYS for each DwellUnitType-5"		DwellUnitType:cseDHWSYSRefs[5]	= {	if (NumDUsCntrlDHW > 0.5 .OR. ServedByDHWSys < 0.5 .OR. NumDHWSysTypes < 5 .OR.
;	;																																	NumAssigningDUs < 0.1 .OR. LocalCompAssigned( DHWSysRef[5] ) < 0.5) then  UNCHANGED
;	;																															else  CreateComp( cseDHWSYS, "dhwsys5-" + Local( Name ) )  endif  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[5]:SourceDwellUnitType"	DwellUnitType:cseDHWSYSRefs[5]:SourceDwellUnitType	= {	Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[5]:SourceDHWSys"			DwellUnitType:cseDHWSYSRefs[5]:SourceDHWSys			= {	DHWSysRef[5]:Name  }
;	;	"Set DwellUnitType:cseDHWSYSRefs[5]:wsMult"					DwellUnitType:cseDHWSYSRefs[5]:wsMult					= {	NumAssigningDUs  }
;		"Create a CSE DHWSYS for each Spc-4 Bedrm"		Spc:CSE_DHWSYSRefs[5]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[5] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 5] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys4-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[5]:SourceSpc"				Spc:CSE_DHWSYSRefs[5]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[5]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[5]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[5]:wsMult"					Spc:CSE_DHWSYSRefs[5]:wsMult					= {	DwellingUnitTypeCnt[5] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[5]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[5]:DHWDailyConsPerSys	= {	DwellingUnit5GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[5]:CFAk"						Spc:CSE_DHWSYSRefs[5]:CFAk						= {	DwellingUnitTypeArea[5]  }
;	
;		"Create a CSE DHWSYS for each Spc-5 Bedrm"		Spc:CSE_DHWSYSRefs[6]		= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( ResDHWSysRef:CentralSys > 0.5 ) .OR.
;																														 IfValidAnd( DwellingUnitTypeArea[6] > 0 )==0 .OR.
;																														 IfValidAnd( DwellingUnitTypeCnt[ 6] > 0 )==0) then  UNCHANGED
;																													else  CreateComp( cseDHWSYS, "dhwsys5-" + Local( Name ) )  endif  }
;		"Set Spc:CSE_DHWSYSRefs[6]:SourceSpc"				Spc:CSE_DHWSYSRefs[6]:SourceSpc				= {	Name  }
;		"Set Spc:CSE_DHWSYSRefs[6]:SourceDHWSys"			Spc:CSE_DHWSYSRefs[6]:SourceDHWSys			= {	ResDHWSysRef:Name  }
;		"Set Spc:CSE_DHWSYSRefs[6]:wsMult"					Spc:CSE_DHWSYSRefs[6]:wsMult					= {	DwellingUnitTypeCnt[6] * Mult  }
;		"Set Spc:CSE_DHWSYSRefs[6]:DHWDailyConsPerSys"	Spc:CSE_DHWSYSRefs[6]:DHWDailyConsPerSys	= {	DwellingUnit6GalPerDay  }
;		"Set Spc:CSE_DHWSYSRefs[6]:CFAk"						Spc:CSE_DHWSYSRefs[6]:CFAk						= {	DwellingUnitTypeArea[6]  }
END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_MFam_wsDayUse" 1 0 0 1
;   Rules to setup DHWSYS objects using new (2016 and later) DHW use & gains mechanism
;*************************************************************************
   "Set Proj:DHWDUShuffleNum (MFam)"      Proj:DHWDUShuffleNum =     ; SAC 02/23/21
      {  if (IfValidAnd( MFamDHWDUShuffleNum >= 1)) then  MFamDHWDUShuffleNum
         else  0  endif  }
;	"Create DwellUnitDHW children for each DwellUnit"	DwellUnit:Action	= {	if (LocalCompAssigned( DwellUnitTypeRef ) < 1 .OR. Count < 1 .OR.
;																											 LocalCompAssigned( DwellUnitTypeRef:DHWSysRef[1] ) < 1) then  UNCHANGED
;																										else	CreateChildren( DwellUnitDHW, Count, Name + " DU" )  endif  }
;																					;					else	CreateChildren( DwellUnitDHW, Count, Name + " DU", "Setup_DwellUnitDHW", 1 )  endif  }
; SAC 9/17/16 - removed condition "IfValidAnd( ResDHWSysRef:CentralSys > 0 )" preventing creation of DwellUnitDHW for spaces served by central DHW systems
	"Create Studio DwellUnitDHW children for each Spc"		Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[1] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 1] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 1] * Mult, Name + " DU0", "Setup_DwellUnitDHW_Studio" )  endif  }
	"Create 1-Bedrm DwellUnitDHW children for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[2] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 2] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 2] * Mult, Name + " DU1", "Setup_DwellUnitDHW_1Bedroom" )  endif  }
	"Create 2-Bedrm DwellUnitDHW children for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[3] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 3] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 3] * Mult, Name + " DU2", "Setup_DwellUnitDHW_2Bedroom" )  endif  }
	"Create 3-Bedrm DwellUnitDHW children for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[4] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 4] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 4] * Mult, Name + " DU3", "Setup_DwellUnitDHW_3Bedroom" )  endif  }
	"Create 4-Bedrm DwellUnitDHW children for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[5] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 5] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 5] * Mult, Name + " DU4", "Setup_DwellUnitDHW_4Bedroom" )  endif  }
	"Create 5-Bedrm DwellUnitDHW children for each Spc"	Spc:Action	= {	if (HaveResDHW < 0.5 .OR. IfValidAnd( DwellingUnitTypeArea[6] > 0 )==0 .OR.
																																	  IfValidAnd( DwellingUnitTypeCnt[ 6] > 0 )==0) then  UNCHANGED
																									else	  CreateChildren( DwellUnitDHW, DwellingUnitTypeCnt[ 6] * Mult, Name + " DU5", "Setup_DwellUnitDHW_5Bedroom" )  endif  }

	"Create a CSE DHWSYS for each DwellUnitDHW"				DwellUnitDHW:cseDHWSYSRef								= {	CreateComp( cseDHWSYS, "dhwsys-" + Local( Name ) )  }
; MFAM Incompat
;	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitType"	DwellUnitDHW:cseDHWSYSRef:SourceSpc					= {	Parent( Name )  }
;; SAC 5/11/16 - DISALLOW multiple ResDHWSys objects per DwellUnitType
;	"Set DwellUnitDHW:cseDHWSYSRef:SourceDHWSys"				DwellUnitDHW:cseDHWSYSRef:SourceDHWSys				= {	ParentRef( ResDHWSysRef:Name )  }
;	"Set DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW"		DwellUnitDHW:cseDHWSYSRef:SourceDwellUnitDHW		= {	Name  }
;
;	"Set DwellUnitDHW:cseDHWSYSRef:wsCentralDHWSYS"			DwellUnitDHW:cseDHWSYSRef:wsCentralDHWSYS			= {	if (IfValidAnd( cseDHWSYSRef:SourceDHWSys:CentralSys > 0.5 ))
;																																					then	cseDHWSYSRef:SourceDHWSys:cseDHWSYSRef
;																																					else	UNDEFINED  endif  }
END

;*************************************************************************
RULELIST "Setup_DwellUnitDHW_Studio" 1 0 0 0
; MFAM Incompat
;	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	0  }	; SAC 5/30/16 - added .._Init properties to ensure DHWProfileLetter set properly
;	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[1] )  }
;	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[1] ) * Parent( Mult )  else  UNDEFINED  endif  }
;	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit1GalPerDay )  else  UNDEFINED  endif  }
;   "Set DwellUnitDHW:CompactFactor"    DwellUnitDHW:CompactFactor    = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[1] ))
;         then  if (IfValidAnd( ResSpcDHWFeaturesRef[1]:CompactFactor > 0 ))
;               then  ResSpcDHWFeaturesRef[1]:CompactFactor
;               else  UNDEFINED  endif
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ compact distribution
;   "Set DwellUnitDHW:ResSpcDHWFeaturesRef"   DwellUnitDHW:ResSpcDHWFeaturesRef  = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[1] ))
;         then  Parent( ResSpcDHWFeaturesRef[1] )
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ DWHR
;;   "Set load-sharing DwellUnitDHW-2 DUTypeDWHRIndex"  DwellUnitDHW:LoadShareDUDHWRef[1]:DUTypeDWHRIndex  = {
;;      if (IfValidAnd( DwellUnitTypeRef:NumDWHRSysDevices[2] > 0 )) then  2  else  UNDEFINED  endif  }   ; SAC 1/7/19
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
RULELIST "Setup_DwellUnitDHW_1Bedroom" 1 0 0 0
; MFAM Incompat
;	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	1  }
;	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[2] )  }
;	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[2] ) * Parent( Mult )  else  UNDEFINED  endif  }
;	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit2GalPerDay )  else  UNDEFINED  endif  }
;   "Set DwellUnitDHW:CompactFactor"    DwellUnitDHW:CompactFactor    = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[2] ))
;         then  if (IfValidAnd( ResSpcDHWFeaturesRef[2]:CompactFactor > 0 ))
;               then  ResSpcDHWFeaturesRef[2]:CompactFactor
;               else  UNDEFINED  endif
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ compact distribution
;   "Set DwellUnitDHW:ResSpcDHWFeaturesRef"   DwellUnitDHW:ResSpcDHWFeaturesRef  = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[2] ))
;         then  Parent( ResSpcDHWFeaturesRef[2] )
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ DWHR
;;   "Set load-sharing DwellUnitDHW-2 DUTypeDWHRIndex"  DwellUnitDHW:LoadShareDUDHWRef[1]:DUTypeDWHRIndex  = {
;;      if (IfValidAnd( DwellUnitTypeRef:NumDWHRSysDevices[2] > 0 )) then  2  else  UNDEFINED  endif  }   ; SAC 1/7/19
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
RULELIST "Setup_DwellUnitDHW_2Bedroom" 1 0 0 0
; MFAM Incompat
;	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	2  }
;	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[3] )  }
;	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[3] ) * Parent( Mult )  else  UNDEFINED  endif  }
;	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit3GalPerDay )  else  UNDEFINED  endif  }
;   "Set DwellUnitDHW:CompactFactor"    DwellUnitDHW:CompactFactor    = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[3] ))
;         then  if (IfValidAnd( ResSpcDHWFeaturesRef[3]:CompactFactor > 0 ))
;               then  ResSpcDHWFeaturesRef[3]:CompactFactor
;               else  UNDEFINED  endif
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ compact distribution
;   "Set DwellUnitDHW:ResSpcDHWFeaturesRef"   DwellUnitDHW:ResSpcDHWFeaturesRef  = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[3] ))
;         then  Parent( ResSpcDHWFeaturesRef[3] )
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ DWHR
;;   "Set load-sharing DwellUnitDHW-2 DUTypeDWHRIndex"  DwellUnitDHW:LoadShareDUDHWRef[1]:DUTypeDWHRIndex  = {
;;      if (IfValidAnd( DwellUnitTypeRef:NumDWHRSysDevices[2] > 0 )) then  2  else  UNDEFINED  endif  }   ; SAC 1/7/19
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
RULELIST "Setup_DwellUnitDHW_3Bedroom" 1 0 0 0
; MFAM Incompat
;	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	3  }
;	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[4] )  }
;	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[4] ) * Parent( Mult )  else  UNDEFINED  endif  }
;	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit4GalPerDay )  else  UNDEFINED  endif  }
;   "Set DwellUnitDHW:CompactFactor"    DwellUnitDHW:CompactFactor    = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[4] ))
;         then  if (IfValidAnd( ResSpcDHWFeaturesRef[4]:CompactFactor > 0 ))
;               then  ResSpcDHWFeaturesRef[4]:CompactFactor
;               else  UNDEFINED  endif
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ compact distribution
;   "Set DwellUnitDHW:ResSpcDHWFeaturesRef"   DwellUnitDHW:ResSpcDHWFeaturesRef  = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[4] ))
;         then  Parent( ResSpcDHWFeaturesRef[4] )
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ DWHR
;;   "Set load-sharing DwellUnitDHW-2 DUTypeDWHRIndex"  DwellUnitDHW:LoadShareDUDHWRef[1]:DUTypeDWHRIndex  = {
;;      if (IfValidAnd( DwellUnitTypeRef:NumDWHRSysDevices[2] > 0 )) then  2  else  UNDEFINED  endif  }   ; SAC 1/7/19
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
RULELIST "Setup_DwellUnitDHW_4Bedroom" 1 0 0 0
; MFAM Incompat
;	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	4  }
;	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[5] )  }
;	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[5] ) * Parent( Mult )  else  UNDEFINED  endif  }
;	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit5GalPerDay )  else  UNDEFINED  endif  }
;   "Set DwellUnitDHW:CompactFactor"    DwellUnitDHW:CompactFactor    = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[5] ))
;         then  if (IfValidAnd( ResSpcDHWFeaturesRef[5]:CompactFactor > 0 ))
;               then  ResSpcDHWFeaturesRef[5]:CompactFactor
;               else  UNDEFINED  endif
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ compact distribution
;   "Set DwellUnitDHW:ResSpcDHWFeaturesRef"   DwellUnitDHW:ResSpcDHWFeaturesRef  = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[5] ))
;         then  Parent( ResSpcDHWFeaturesRef[5] )
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ DWHR
;;   "Set load-sharing DwellUnitDHW-2 DUTypeDWHRIndex"  DwellUnitDHW:LoadShareDUDHWRef[1]:DUTypeDWHRIndex  = {
;;      if (IfValidAnd( DwellUnitTypeRef:NumDWHRSysDevices[2] > 0 )) then  2  else  UNDEFINED  endif  }   ; SAC 1/7/19
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
RULELIST "Setup_DwellUnitDHW_5Bedroom" 1 0 0 0
; MFAM Incompat
;	"Set DwellUnitDHW:NumBedrooms_Init"	DwellUnitDHW:NumBedrooms_Init	= {	5  }
;	"Set DwellUnitDHW:Area"					DwellUnitDHW:Area					= {	Parent( DwellingUnitTypeArea[6] )  }
;	"Set DwellUnitDHW:Mult"					DwellUnitDHW:Mult					= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnitTypeCnt[6] ) * Parent( Mult )  else  UNDEFINED  endif  }
;	"Set DwellUnitDHW:UsePerDay"			DwellUnitDHW:UsePerDay			= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  Parent( DwellingUnit6GalPerDay )  else  UNDEFINED  endif  }
;   "Set DwellUnitDHW:CompactFactor"    DwellUnitDHW:CompactFactor    = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[6] ))
;         then  if (IfValidAnd( ResSpcDHWFeaturesRef[6]:CompactFactor > 0 ))
;               then  ResSpcDHWFeaturesRef[6]:CompactFactor
;               else  UNDEFINED  endif
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ compact distribution
;   "Set DwellUnitDHW:ResSpcDHWFeaturesRef"   DwellUnitDHW:ResSpcDHWFeaturesRef  = {
;         if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND. ParentCompAssigned( ResSpcDHWFeaturesRef[6] ))
;         then  Parent( ResSpcDHWFeaturesRef[6] )
;         else  UNDEFINED  endif  }  ; SAC 1/24/19 - added to model 2019+ DWHR
;;   "Set load-sharing DwellUnitDHW-2 DUTypeDWHRIndex"  DwellUnitDHW:LoadShareDUDHWRef[1]:DUTypeDWHRIndex  = {
;;      if (IfValidAnd( DwellUnitTypeRef:NumDWHRSysDevices[2] > 0 )) then  2  else  UNDEFINED  endif  }   ; SAC 1/7/19
	"Setup DwellUnitDHW objects"			DwellUnitDHW:Action				= {	EvalRulelist( "Setup_DwellUnitDHW", 1 )  }
END
;*************************************************************************

;*************************************************************************
RULELIST "Setup_DwellUnitDHW" 1 0 0 0
;   Rules to setup newly created DwellUnitDHW objects
;	"Set DwellUnitDHW:DwellUnitTypeRef"		DwellUnitDHW:DwellUnitTypeRef		= {	Parent( DwellUnitTypeRef )  }
;	"Set DwellUnitDHW:NumBedrooms"			DwellUnitDHW:NumBedrooms			= {	if (     IfValidAnd( DwellUnitTypeRef:NumBedrooms > 4.5 )) then  5
;																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 3.5 )) then  4
;																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 2.5 )) then  3
;																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 1.5 )) then  2
;																											else if (IfValidAnd( DwellUnitTypeRef:NumBedrooms > 0.5 )) then  1
;																											else	0  endif endif endif endif endif  }
; MFAM Incompat
;	"Set DwellUnitDHW:NumBedrooms"			DwellUnitDHW:NumBedrooms			= {	NumBedrooms_Init  }

   "Set DwellUnitDHW:NumDHWSchShuffles - # draw sched shuffles by # bedrooms"    DwellUnitDHW:NumDHWSchShuffles =       ; SAC 02/25/21
      {  if (     NumBedrooms >= 4) then  10
         else if (NumBedrooms == 3) then  20
         else                             50   endif endif  }

;	"Set DwellUnitDHW:DHWProfileLetter"		DwellUnitDHW:DHWProfileLetter		= {	switch ( mod( CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ), 5 ) )
;																												case  1 :  "a"
;																												case  2 :  "b"
;																												case  3 :  "c"
;																												case  4 :  "d"
;																												default :  "e"
;																											endswitch  }
; SAC 1/24/19 - switch from 5 to 10 MFam DHW draw profile shufflings
   ; SAC 4/29/19 - restored use of 5 MFam DHW draw profile shufflings for PRE-2019 analysis
	"Set DwellUnitDHW:DHWProfileLetter"		DwellUnitDHW:DHWProfileLetter		=        ; updated for new DHWDU.txt w/ many more shufflings - SAC 02/25/21
   {  if (IfValidAnd( Proj:EngyCodeYearNum >= 2019 ))
      then  if (                    mod( (CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ) + Proj:DHWDUShuffleNum), NumDHWSchShuffles ) > 0)
            then  Format( "%02.0f", mod( (CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ) + Proj:DHWDUShuffleNum), NumDHWSchShuffles ) )
            else  Format( "%02.0f", NumDHWSchShuffles )  endif
      else  switch ( mod( CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ), 5 ) )
               case  1 :  "a"       case  2 :  "b"       case  3 :  "c"
               case  4 :  "d"       default :  "e"
            endswitch  endif  }
   ; prior >= 2019 logic
   ;   then  switch ( mod( CountOccurrences( DwellUnitDHW:NumBedrooms, NumBedrooms ), 10 ) )
   ;            case  1 :  "a"       case  2 :  "b"       case  3 :  "c"
   ;            case  4 :  "d"       case  5 :  "e"       case  6 :  "f"
   ;            case  7 :  "g"       case  8 :  "h"       case  9 :  "i"
   ;            default :  "j"
   ;         endswitch
;	"Set DwellUnitDHW:CSEDayUseName"			DwellUnitDHW:CSEDayUseName			= {	Format( "DHW%.0fBR", NumBedrooms )  }								; PRIOR to MFam central DHW fixes ~5/12/16
;	"Set DwellUnitDHW:CSEDayUseName"			DwellUnitDHW:CSEDayUseName			= {	Format( "DHW%.0fBR%s", NumBedrooms, DHWProfileLetter )  }	; PRIOR to MFam central DHW fixes ~5/12/16
	"Set DwellUnitDHW:CSEDayUseName"			DwellUnitDHW:CSEDayUseName			= {	Format( "DHWMF%.0fBR%s", NumBedrooms, DHWProfileLetter )  }	; revised DHWDU w/ more shufflings - SAC 02/25/21
END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHW_part2" 1 0 0 1
;   Rules which are executed immediately prior to performing a CSE simulation - covering DHW objects only
;*************************************************************************

  "Setup ResWtrHtr UEF data"   ResWtrHtr:Action = {
      if (IfValidAnd( IsUEFRtdSim > 0 )) then  EvalRulelist( "ResWtrHtr_UEF", 1 )
      else  UNCHANGED  endif  }

	"Set ResDHWSys:HWSupplyTemp"			ResDHWSys:HWSupplyTemp		= {	; based on Res ACM App E, Eqn RE-3 description of HW supply temp, combined w/ ACM system types described above
																				;		if (Proj:IsMultiFamily > 0.5 .AND. CentralDHW > 0.5)		; SAC 5/20/16 - removed MFam central dependence (per BAW 
																				;		then  130  else
																						if (Proj:CSE_DHWUseMthd == "Old (via wsUse)")
																						then	124  else  115  endif  }		; SAC 4/6/16 - non-MFam/central switched from 124 to 115		; SAC 4/15/16 - restored 124 for old/2013 models (tic #641)

   "Set ResDHWSys:HaveLpHtr"     ResDHWSys:HaveLpHtr  =      ; SAC 1/10/20 (Com tic #3156)
      {  if (IfValidAnd( NewCentralModel > 0 )==0) then  0
         else if (LocalCompAssigned( ResLpTankHtrRef ) > 0 .AND.
                  IfValidAnd( ResLpTankHtrMult > 0 )) then  1
         else  0  endif endif  }

	"Setup cseDHWSYS meters and temperatures"		cseDHWSYS:Action	= {	if (LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
																								else	EvalRulelist( "Setup_cseDHWSYS_MetersAndTemperatures", 1 )  endif  }

; THE FOLLOWING RULE SERVES TO RE-DISTRIBUTE ALL PROJECT HW CONSUMPTION EVENLY ACROSS ALL SIMULATED ResDHWSys OBJECTS
; REMOVE THIS RULE TO SIMULATE HW CONSUMPTION BY ResDHWSys BASED ON Zone/DwellUnitType SIZES/COUNTS
; SAC 10/24/15 - removed this rule to split DHW load based on dwelling units & area served
; SAC 10/26/15 - following rule WILL NOT WORK AGAIN for MFam, non-central systems, as these systems don't rely on this global parameter
;				"Re-allocate ResDHWSys:DailyHWConsumption"	ResDHWSys:DailyHWConsumption	= {	if (SumAll( ResDHWSys:SimDHWSys ) < 0.5)	then  UNCHANGED
;																													else	Proj:DailyHWConsumption / SumAll( ResDHWSys:SimDHWSys )  endif  }
; SAC 8/18/16 - new rule setting same parameter as above in order to calculate total load on CENTRAL systems only
   "Set ResDHWSys:DailyHWConsumption"	ResDHWSys:DailyHWConsumption	= {
      if (IfValidAnd( CentralSys > 0.5 )==0)	then  UNDEFINED
      else  SumRevRef( Spc:ResDHWSysRef, Spc:ResSpcHtWtrTotGalPerDayXMult )  endif  }

; MFAM Incompat
;	"Set cseDHWSYS:HWUse - HW use"		cseDHWSYS:HWUse		= {	if (IfValidAnd( DHWDailyConsPerSys > 0 ))
;																						then	DHWDailyConsPerSys
;																						else if (LocalCompAssigned( SourceDHWSys ) > 0.5 .AND.
;																						         IfValidAnd( SourceDHWSys:DailyHWConsumption > 0 ))
;																						then	SourceDHWSys:DailyHWConsumption
;																						else	0  endif endif  }
	;; SAC 9/1/15 - adjustment added per input from Chip:
	;; 		Hot Water Factor for 2013 RACM modifies gallons/day                                        ;
	;; 		 accounts for reduced waste for single-family recirculating systems                        ;
	;; 		 per Marc Hoeshele 22 Oct 2012                                                             ;
	;; 		HWF = 1.0 for non-recirculating or 0.9 for single-family recirculating                     ;
	;			"Adjust cseDHWSYS:HWUse for single family recirculation"
	;					cseDHWSYS:HWUse	= {	if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNCHANGED
	;													else	switch ( SourceDHWSys:SystemType )
	;																case    4992 :  HWUse * 0.9		; "Recirculation, Non-Demand Control"                          
	;																case    5248 :  HWUse * 0.9		; "Recirculation, Demand Control Push Button"                  
	;																case    5504 :  HWUse * 0.9		; "Recirculation, Demand Control Occupancy/Motion"             
	;																case 8393856 :  HWUse * 0.9		; "(HERS req'd) Recirculation, Demand Control Push Button"     
	;																case 8394112 :  HWUse * 0.9		; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion"
	;																default      :  UNCHANGED
	;															endswitch  endif  }
	; SAC 3/17/16 - replaced above rule which applied waste factor to HWUSE with below that passes that factor directly into the DHWSYS via the new wsWF property

      ; SAC 1/9/20 - new central CSE modeling (Com tic #3156)    - SAC 3/10/20 - activated to esnure proper central recirc branch loss modeling
   "Set cseDHWSYS:wsBranchModel - Model used to simulate DHW branch losses: T24DHW / DayWaste / DrawWaste"       ; SAC 11/6/19
        cseDHWSYS:wsBranchModel            = {  if (IfValidAnd( SourceDHWSys:NewCentralModel > 0 )==0 .OR.
                                                    LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNDEFINED
                                                else  "DayWaste"  endif  }
                                             ;   else  switch (SourceDHWSys:BranchLossModel)
                                             ;            case  1 :  "DayWaste"
                                             ;            case  2 :  "DrawWaste"
                                             ;            default :  "T24DHW"
                                             ;         endswitch   endif  }

   "Set cseDHWSYS:wsShowerDayWasteF - used to determine ratio of Shower/Faucet water waste"       ; SAC 11/06/19
        cseDHWSYS:wsShowerDayWasteF        = {  if (IfValidAnd( wsBranchModel = "DayWaste" )==0) then  UNDEFINED
                                                else  3  endif  }
   "Set cseDHWSYS:wsFaucetDayWasteF - used to determine ratio of Shower/Faucet water waste"       ; SAC 11/06/19
        cseDHWSYS:wsFaucetDayWasteF        = {  if (IfValidAnd( wsShowerDayWasteF > 0 )) then  1  else  UNDEFINED  endif  }
; MFAM Incompat
;   "Set cseDHWSYS:wsDayWasteBranchVolF_x - Number of branch volumes discarded per day (wsBranchModel = DayWaste) (expression)"       ; SAC 11/06/19
;        cseDHWSYS:wsDayWasteBranchVolF_x   = {  if (IfValidAnd( wsShowerDayWasteF > 0 )==0 .OR. IfValidAnd( SourceDHWSys:SysStoryCnt > 0 )==0) then  UNDEFINED
;                                                else  Format( "1.4 * 19.84 * exp( -0.554 * %g/2)", SourceDHWSys:SysStoryCnt )  endif  }
   ;"Set cseDHWSYS:wsDayWasteBranchVolF_x - #2 (replace '#Flrs' w/ SourceDHWSys:NumFloorsServed)"       ; SAC 11/06/19
   ;     cseDHWSYS:wsDayWasteBranchVolF_x   = {  if (LocalStatus( wsDayWasteBranchVolF_x ) < 1 .OR. IfValidAnd(  SourceDHWSys:NumFloorsServed > 0 )==0) then  UNCHANGED
   ;                                             else   ReplaceInString( "#Flrs", Format( "%g", SourceDHWSys:NumFloorsServed ) )  endif  }

   ; REMOVED 1/5/20 mod preventing PreRuns for new Central... (per e-mail from CB 5/6/20) - SAC 5/6/20     SAC 7/2/20 - ported from Res
   ; SAC 1/5/20 - added logic to prevent PreRuns for new Central HPWH that is not AutoSized (tic #862)  - SAC 3/9/20 - removed dependence on EnableResearchMode
   "Set cseDHWSYS:CSEPreRunRequired"     cseDHWSYS:CSEPreRunRequired  =        ; SAC 11/6/19   ; SAC 12/2/19 - switched logic from negative to positive & added UseMaxDurNumHtrs logic
     ;        (IfValidAnd( SourceDHWSys:CentralDHWTypeVal = 2 )==0 .OR. IfValidAnd( SourceDHWSys:CHPWHAutosize = 0 )==0)) then  1         - SAC 2/4/20 - CHPWHAutosize removed (tic #1197)
      {  if (EnumValue( SourceDHWSys:DistType ) > 0 .AND. LocalCompAssigned( wsCentralDHWSYS ) < 1) then  1
         else  UNDEFINED  endif  }

; MFAM Incompat
;				"Set cseDHWSYS:wsWF (waste factor)"
;						cseDHWSYS:wsWF		= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  UNDEFINED			; SAC 4/15/16 - prevent specification for old/2013 models (tic #641)
;														else if (IfValidAnd( SourceDHWSys:CentralSys > 0.5 ) .AND.
;																	LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSE_DHWUseMthd != "Old (via wsUse)") then  UNDEFINED		; SAC 5/12/16 - no wsWF for DayUse central DHWSYSs
;														else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  1.0
;														else	switch ( SourceDHWSys:Type )
;                                                   ; SAC 7/19/17 - switch case elements from numeric to strings due to difference in data model vs. procedural rulesets (tic #2348)
;																	case "Recirculation, Non-Demand Control"                           :  0.9	
;																	case "Recirculation, Demand Control Push Button"                   :  0.9	
;																	case "Recirculation, Demand Control Occupancy/Motion"              :  0.9	
;																	case "(HERS req'd) Recirculation, Demand Control Push Button"      :  0.9	
;																	case "(HERS req'd) Recirculation, Demand Control Occupancy/Motion" :  0.9	
;																	default      :  1.0
;																endswitch  endif endif endif  }

      ; SAC 1/9/20 - new central CSE modeling (Com tic #3156)
; only applicable to EnableReserchMode in Res
;   "Set cseDHWSYS:wsFaucetDrawWaste - Faucet water usage waste factor (applies to both old and new style use/profiles)"       ; SAC 10/31/19
;        cseDHWSYS:wsFaucetDrawWaste = {   if (IfValidAnd( SourceDHWSys:CSEFaucetDrawWaste >= 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) > 0)
;                                          then            SourceDHWSys:CSEFaucetDrawWaste    else  UNDEFINED  endif  }
;   "Set cseDHWSYS:wsShowerDrawWaste - Shower water usage waste factor (applies to both old and new style use/profiles)"    
;        cseDHWSYS:wsShowerDrawWaste = {   if (IfValidAnd( SourceDHWSys:CSEShowerDrawWaste >= 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) > 0)
;                                          then            SourceDHWSys:CSEShowerDrawWaste    else  UNDEFINED  endif  }
;   "Set cseDHWSYS:wsBathDrawWaste   - Bath water usage waste factor (applies to both old and new style use/profiles)"    
;        cseDHWSYS:wsBathDrawWaste   = {   if (IfValidAnd( SourceDHWSys:CSEBathDrawWaste   >= 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) > 0)
;                                          then            SourceDHWSys:CSEBathDrawWaste      else  UNDEFINED  endif  }
;   "Set cseDHWSYS:wsCWashrDrawWaste - Clothes washer water usage waste factor (applies to both old and new style use/profiles)"    
;        cseDHWSYS:wsCWashrDrawWaste = {   if (IfValidAnd( SourceDHWSys:CSECWashrDrawWaste >= 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) > 0)
;                                          then            SourceDHWSys:CSECWashrDrawWaste    else  UNDEFINED  endif  }
;   "Set cseDHWSYS:wsDWashrDrawWaste - Dish washer water usage waste factor (applies to both old and new style use/profiles)"    
;        cseDHWSYS:wsDWashrDrawWaste = {   if (IfValidAnd( SourceDHWSys:CSEDWashrDrawWaste >= 0 ) .AND. LocalCompAssigned( wsCentralDHWSYS ) > 0)
;                                          then            SourceDHWSys:CSEDWashrDrawWaste    else  UNDEFINED  endif  }

	;; SAC 9/1/15 - adjustment added per input from Chip:
	; SAC 8/16/16 - RESTORE adjustment (after being removed 3/17/16) of HW use when simulating DHW use via wsUse (old/2013 method):
	; 		Hot Water Factor for 2013 RACM modifies gallons/day                                        ;
	; 		 accounts for reduced waste for single-family recirculating systems                        ;
	; 		 per Marc Hoeshele 22 Oct 2012                                                             ;
	; 		HWF = 1.0 for non-recirculating or 0.9 for single-family recirculating                     ;
; MFAM Incompat
;				"Adjust cseDHWSYS:HWUse for single family recirculation (when Proj:CSEDHWUseMethod == 'Old (via wsUse)')"
;						cseDHWSYS:HWUse	= {	if (Proj:CSE_DHWUseMthd != "Old (via wsUse)") then  UNCHANGED
;														else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNCHANGED
;														else	switch ( SourceDHWSys:Type )
;                                                   ; SAC 7/19/17 - switch case elements from numeric to strings due to difference in data model vs. procedural rulesets (tic #2348)
;																	case "Recirculation, Non-Demand Control"                           :  HWUse * 0.9	
;																	case "Recirculation, Demand Control Push Button"                   :  HWUse * 0.9	
;																	case "Recirculation, Demand Control Occupancy/Motion"              :  HWUse * 0.9	
;																	case "(HERS req'd) Recirculation, Demand Control Push Button"      :  HWUse * 0.9	
;																	case "(HERS req'd) Recirculation, Demand Control Occupancy/Motion" :  HWUse * 0.9	
;																	default      :  UNCHANGED
;																endswitch  endif endif  }

	; SAC 3/17/16 - added logic for Proj:CSE_DHWUseMthd
	"Set cseDHWSYS:wsUse_x"				cseDHWSYS:wsUse_x	= {	if (Proj:CSE_DHWUseMthd != "Old (via wsUse)") then  UNDEFINED
																				else	Format( "%g * select( $isWeekend, HWUSEF_WE, default HWUSEF_WD )", HWUse )  endif  }
	; SAC 3/17/16 - new wsDayUse property
	"Set cseDHWSYS:wsDayUse_x"			cseDHWSYS:wsDayUse_x	= {	if (Proj:CSE_DHWUseMthd == "Old (via wsUse)") then  UNDEFINED
																					else if (LocalCompAssigned( SourceDwellUnitDHW ) > 0) then  SourceDwellUnitDHW:CSEDayUseName
																;					else if (Proj:IsMultiFamily < 0.5)
																;					then	if (     Proj:SimNumBedrooms < 1.5) then "DHW1BR"
																;							else if (Proj:SimNumBedrooms < 2.5) then "DHW2BR"
																;							else if (Proj:SimNumBedrooms < 3.5) then "DHW3BR"
																;							else if (Proj:SimNumBedrooms < 4.5) then "DHW4BR"
																;							else                                     "DHW5BR"
																;							endif endif endif endif
																					else	UNDEFINED  endif endif  }
																		; SAC 5/12/16 - ALL MFam DayUse assignments handled via DwellUnitDHW assignment above
																		;			else if (LocalCompAssigned( SourceDwellUnitType ) > 0.5)
																		;			then	if (     SourceDwellUnitType:NumBedrooms < 0.5) then "DHW0BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 1.5) then "DHW1BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 2.5) then "DHW2BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 3.5) then "DHW3BR"
																		;					else if (SourceDwellUnitType:NumBedrooms < 4.5) then "DHW4BR"
																		;					else                                                 "DHW5BR"
																		;					endif endif endif endif endif
																		;			else	UNDEFINED  endif endif endif  }

  ; delta-T and other formulas related to calculation of (simulation) energy factor by water heater
;	"Set Proj:InletMainsWtrTemp"		Proj:InletMainsWtrTemp	= {	CAClimateZoneInletMainsTemp:InletTemp( "ClimateZone", Proj:CliZnNum )  }
;	"Set ResDHWSys:HWDeltaTemp"		ResDHWSys:HWDeltaTemp	= {	if (IfValidAnd( Proj:InletMainsWtrTemp > 0 )==0) then  10		; ERROR
;																						else  HWSupplyTemp - Proj:InletMainsWtrTemp  endif  }
	"Set ResDHWSys:HWDeltaTemp"		ResDHWSys:HWDeltaTemp	= {	if (IfValidAnd( Proj:CliZnNum >= 1 )==0 .OR. IfValidAnd( Proj:CliZnNum <= 16 )==0) then  10		; ERROR
																						else  HWSupplyTemp - CAClimateZoneInletMainsTemp:InletTemp( "ClimateZone", Proj:CliZnNum )  endif  }

;	; SAC 10/27/15 - fix problem where ResDHWSys:NumAssignedDUFracs not taking into account number of assigned DwellUnits of each DwellUnitType
;	"Set DwellUnitType:NumDUsSrvdPerDHWSys"	DwellUnitType:NumDUsSrvdPerDHWSys	= {	DHWSysAssignFrac * NumAssigningDUs  }
;	"Set ResDHWSys:NumAssignedDUFracs"		ResDHWSys:NumAssignedDUFracs	= {	;if (Proj:IsMultiFamily < 0.5) then  Proj:NumDwellingUnits
;																										SumRevRef( DwellUnitType:DHWSysRef[1], DwellUnitType:NumDUsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[2], DwellUnitType:NumDUsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[3], DwellUnitType:NumDUsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[4], DwellUnitType:NumDUsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[5], DwellUnitType:NumDUsSrvdPerDHWSys ) 
;																								endif  }

; SAC 1/24/19 - for HPWHSIZE functionality - will replicate in budget conversion rules
;   ; SAC 1/2/19 - added to facilitate standard design HPWH sizing (HPWHSIZE)
;	"Set DwellUnitType:NumBRsSrvdPerDHWSys"	DwellUnitType:NumBRsSrvdPerDHWSys	= {	NumDUsSrvdPerDHWSys * ValidOr( NumBedrooms, 0 )  }
;	"Set DHWSys:NumAssignedBRFracs"		DHWSys:NumAssignedBRFracs	= {	if (Proj:IsMultiFamily < 0.5)
;	                                                                     then  if (Proj:RunScope = 1 .AND. Proj:IsAddAlone > 0.5)
;	                                                                           then  Proj:NumBedrooms + Proj:NumAddBedrooms
;	                                                                           else  Proj:NumBedrooms
;	                                                                           endif
;																								else	SumRevRef( DwellUnitType:DHWSysRef[1], DwellUnitType:NumBRsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[2], DwellUnitType:NumBRsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[3], DwellUnitType:NumBRsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[4], DwellUnitType:NumBRsSrvdPerDHWSys ) +
;																										SumRevRef( DwellUnitType:DHWSysRef[5], DwellUnitType:NumBRsSrvdPerDHWSys ) 
;																								endif  }

; REVISE THIS RULE TO REFERENCE SERVED CFA, # HEATERS & # DWELLING UNITS FOR MORE SYSTEM-SPECIFIC CFAk VALUE
	; SAC 10/12/15 - revised rule to remove dependence on # DHW heaters and add dependence on # systems (serving same area)
; MFAM Incompat
;	"Set cseDHWSYS:CFAk - defined in Res ACM, equation RE-5, used to calc SDLMk (std distrib loss mult)"
;																cseDHWSYS:CFAk		= {	if (IfValidAnd( SourceDHWSys:CentralSys > 0 ) .AND.
;																									 IfValidAnd( SourceDHWSys:SysFlrArea > 0 ) .AND.
;																									 LocalCompAssigned( wsCentralDHWSYS ) < 1)			; should cover all Central systems
;																								then	SourceDHWSys:SysFlrArea
;																								else if (IfValidAnd( SourceDwellUnitDHW:Area > 0 ))	; covers non-central, 2016 (wsDayUse) systems
;																								then	SourceDwellUnitDHW:Area
;																								else if (LocalStatus( CFAk ) > 0)		; for non-central, 2013 (wsUse) systems, this is set above in CSE_SimulationPrep_DHW_MFam_wsUse
;																								then	UNCHANGED
;																								else	0  endif endif endif  }
																				;				if (LocalCompAssigned( SourceDwellUnitType ) > 0.5)
																				;				then	SourceDwellUnitType:CondFlrArea
																				;				else if (LocalCompAssigned( SourceDHWSys ) > 0.5)
																				;				then	if (IfValidAnd( SourceDHWSys:NumAssignedDUFracs > 0 ))
                                                            ;;                  then  SourceDHWSys:FloorAreaServed[1] / SourceDHWSys:NumAssignedDUFracs
                                                            ;; SAC 7/27/16 - replaced above w/ below to ensure consistent wsSDLM for DHYSYS objects where multiple systems serve SFam home (tic #711)
                                                            ;                  then  SumAll( Zone:DHWFloorArea )
																				;						else	0  endif
																				;				else	0  endif endif  }		; error if = 0
																						; was (prior to 10/26/15):
																						;						else if (Proj:IsMultiFamily > 0.5 .AND. CentralDHW > 0.5 .AND. Proj:NumDwellingUnits > 0)
																						;						then	SumAll( ResDHWSys:FloorAreaServed[1] ) / Proj:NumDwellingUnits
																						;				;		else if (SumAcrossIf( ResDHWSys:NumDHWHeaters, ResDHWSys:SimDHWSys > 0.5 ) > 0.5)
																						;				;		then	SumAll( ResDHWSys:FloorAreaServed[1] ) / SumAcrossIf( ResDHWSys:NumDHWHeaters, ResDHWSys:SimDHWSys > 0.5 )
																						;						else if (IfValidAnd( ResDHWSys:FloorAreaServed[1] > 0.5 ) .AND. SumAll( ResDHWSys:SimDHWSys ) > 0.5)
																						;						then	SumAll( ResDHWSys:FloorAreaServed[1] ) / SumAll( ResDHWSys:SimDHWSys )
																						;						else	0  endif endif  }		; error if = 0

	; SAC 10/12/15 - added 'min( ..., 2500 )' to forumla (based on e-mail from BAW)
	"Set cseDHWSYS:wsSDLM - Standard distribution loss multiplier (refer to Res ACM App E, eqn RE-5)"
										cseDHWSYS:wsSDLM		= {	if (IfValidAnd( SourceDHWSys:CentralSys > 0.5 ) .AND.
																				 LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSE_DHWUseMthd != "Old (via wsUse)") then  UNDEFINED		; SAC 5/12/16 - no wsSDLM for central DHWSYSs
																			else	1.0032 + (0.0001864 * min( CFAk, 2500 )) -
																							   (0.0000000215 * min( CFAk, 2500 ) * min( CFAk, 2500 ))    endif  }
                                          ; SAC 7/19/17 - following formula replaced with above, proposed for 2017 (Res tic #737 - consistent w/ DEG_2017_PipeInsulationUpdateMemo_082616 document)
														;					else	1.004 + (0.000202 * min( CFAk, 2500 )) -
														;									  (0.0000000231 * min( CFAk, 2500 ) * min( CFAk, 2500 ))    endif  }
;										ResDHWSys:cseDHWSYSRef:wsSDLM		= {	1.1829  }  ; DEBUGGING  1.004 + (0.000202 * cseDHWSYSRef:CFAk) - (0.0000000231 * cseDHWSYSRef:CFAk * cseDHWSYSRef:CFAk)  }
                                                            
; MFAM Incompat
;	"Set cseDHWSYS:HrlyStdEndUse"		cseDHWSYS:HrlyStdEndUse		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5)
;																							then	8.345 * HWUse * SourceDHWSys:HWDeltaTemp / 24
;																							else	0  endif  }


	; SAC 9/1/15 - updated DSMs for single family recirculation systems per Marc Hoeschle 22 October 2013     ;
	; Recirculation non-demand control                      9.00   was 7.0                              ;
	; Recirculation demand control, push button             1.60   was 1.15                             ;
	; Recirculation demand control, occupancy/motion        2.40   was 1.3                              ;
	; Recirculation demand control, push button HERS        1.45   was 1.05                             ;
	; Recirculation demand control, occupancy/motion HERS   2.20   was 1.2                              ;
	; SAC 2/15/18 - added 0.7 setting for new '2019 Basic Compact Distribution System' system (tic #983)
	"Set ResDHWSys:DistribSysMult - Distribution system multiplier (ACM App R, Table B-2)"
		ResDHWSys:DistribSysMult	= {	switch (Type)
         ; SAC 7/19/17 - switch case elements from numeric to strings due to difference in data model vs. procedural rulesets (tic #2348)
				case  "Standard"                                                :	1.0	; %WHDIST2013_STD =       
			;	case  "Pipe Insulation, All Lines"                              :	0.9	; %WHDIST2013_PIA =      - mods made to wsSDLM sim input to address benefit of pipe insul for what we now refer to as 'Standard' distr type  - SAC 6/20/18
			;	case  "Insulated and Protected Pipe Below Grade"                :	1.4	; %WHDIST2013_IPBG =      
				case  "Parallel Piping"                                         :	1.10	; %WHDIST2013_PP =        
			  case  "Point of use"                                            :	0.3	; SAC 8/27/16 - (Res tic #736)
				case  "Recirculation, Non-Demand Control"                       :	9.8	; %WHDIST2013_RND =       
				case  "Recirculation, Demand Control Push Button"               :	1.75	; %WHDIST2013_RDMan =     
				case  "Recirculation, Demand Control Occupancy/Motion"          :	2.6	; %WHDIST2013_RDAuto =    
     ;       case  "2019 Basic Compact Distribution System"                  : 0.7   ; new option for 2019 std design HPWH systems - SAC 8/8/18     SAC 1/24/19 - removed
			;	case  8388608 :	0.0	                                          ; %HERS_REQUIRED =        
				case  "(HERS req'd) Pipe Insulation, All Lines"                 :	0.85	; %WHDIST2013_HERSPIA =   
			;	case  "(HERS req'd) Insulated and Protected Pipe Below Grade"   :	0.0	; %WHDIST2013_HERSIPBG =  
				case  "(HERS req'd) Parallel Piping"                            :	1.0	; %WHDIST2013_HERSPP =    
			;	case  "(HERS req'd) Recirculation, Non-Demand Control"          :	0.0	; %WHDIST2013_HERSRND =   
				case  "(HERS req'd) Recirculation, Demand Control Push Button"      :	1.6	; %WHDIST2013_HERSRDMan = 
				case  "(HERS req'd) Recirculation, Demand Control Occupancy/Motion" :	2.4	; %WHDIST2013_HERSRDAuto =
				case  "(HERS req'd) Point of Use"                                   :	0.3	; %WHDIST2013_HERSPOU =   
				case  "(HERS req'd) Compact Distribution System"                    :	0.7	; %WHDIST2013_HERSCDS =   
			;	case  "Multi-Family Central Recirc Non-Demand Control"              :	0.0	; %WHDIST2013_CRND =      
			;	case  "Multi-Family Central Recirc Monitoring"                      :	0.0	; %WHDIST2013_CRM =       
			;	case  "Multi-Family Central Demand Recirc (new cons std design)"    :	0.0	; %WHDIST2013_CRD =       
				default       :	1.0
			endswitch  }
                           ; SAC 7/19/17 - replaced following w/ above to implement proposed 2017 DSM (Res tic #737)
									;								case     3840 :	1.0	; "Standard"                                                    ; %WHDIST2013_STD =       
									;								case     4096 :	0.9	; "Pipe Insulation, All Lines"                                  ; %WHDIST2013_PIA =       
									;								case     4352 :	1.4	; "Insulated and Protected Pipe Below Grade"                    ; %WHDIST2013_IPBG =      
									;								case     4608 :	1.05	; "Parallel Piping"                                             ; %WHDIST2013_PP =        
									;								case     4992 :	9.0	; "Recirculation, Non-Demand Control"                           ; %WHDIST2013_RND =       
									;								case     5248 :	1.6	; "Recirculation, Demand Control Push Button"                   ; %WHDIST2013_RDMan =     
									;								case     5504 :	2.4	; "Recirculation, Demand Control Occupancy/Motion"              ; %WHDIST2013_RDAuto =    
									;					;			case  8388608 :	0.0	; ""                                                            ; %HERS_REQUIRED =        
									;								case  8392704 :	0.8	; "(HERS req'd) Pipe Insulation, All Lines"                     ; %WHDIST2013_HERSPIA =   
									;					;			case  8392960 :	0.0	; "(HERS req'd) Insulated and Protected Pipe Below Grade"       ; %WHDIST2013_HERSIPBG =  
									;								case  8393216 :	0.95	; "(HERS req'd) Parallel Piping"                                ; %WHDIST2013_HERSPP =    
									;					;			case  8393600 :	0.0	; "(HERS req'd) Recirculation, Non-Demand Control"              ; %WHDIST2013_HERSRND =   
									;								case  8393856 :	1.45	; "(HERS req'd) Recirculation, Demand Control Push Button"      ; %WHDIST2013_HERSRDMan = 
									;								case  8394112 :	2.2	; "(HERS req'd) Recirculation, Demand Control Occupancy/Motion" ; %WHDIST2013_HERSRDAuto =
									;								case  8394240 :	0.3	; "(HERS req'd) Point of Use"                                   ; %WHDIST2013_HERSPOU =   
									;								case  8394496 :	0.7	; "(HERS req'd) Compact Distribution System"                    ; %WHDIST2013_HERSCDS =   
									;					;			case     5056 :	0.0	; "Multi-Family Central Recirc Non-Demand Control"              ; %WHDIST2013_CRND =      
									;					;			case     6336 :	0.0	; "Multi-Family Central Recirc Monitoring"                      ; %WHDIST2013_CRM =       
									;					;			case     6592 :	0.0	; "Multi-Family Central Demand Recirc (new cons std design)"    ; %WHDIST2013_CRD =       
									;								default       :	1.0
									;							endswitch  }
   ; SAC 12/5/18 - apply new DHWSys:CompactFactor for 2019 Compact Distribution credit (tic #975)
   ; SAC 1/7/19 - added logic to reference SourceDwellUnitDHW:CompactFactor for MFam models (tic #975)
; MFAM Incompat
;	"Set cseDHWSYS:wsDSM - Distribution system multiplier (ACM App R, Table B-2)"
;		cseDHWSYS:wsDSM	= {
;         if (IfValidAnd( SourceDHWSys:CentralSys > 0.5 ) .AND.
;             LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. Proj:CSE_DHWUseMthd != "Old (via wsUse)")
;         then  UNDEFINED		; SAC 5/12/16 - no wsDSM for central DHWSYSs
;         else if (LocalCompAssigned( SourceDHWSys ) > 0.5)
;         then  if (IfValidAnd( SourceDwellUnitDHW:CompactFactor < 1.0 ))
;               then  SourceDHWSys:DistribSysMult * SourceDwellUnitDHW:CompactFactor
;               else  SourceDHWSys:DistribSysMult
;               endif
;         else  1.0  endif endif  }

;	"Set cseDHWSYS:DistribLossMult"		cseDHWSYS:DistribLossMult		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5 .AND. LocalStatus( wsSDLM ) > 0)
;																									then	1 + ((wsSDLM - 1) * SourceDHWSys:DistribSysMult)
;																									else	1.0  endif  }

// TO DO - account for Monthly solar fractions ??
// TO DO - add in HRDLk (hourly recirculation distribution loss (btu))
;	"Set cseDHWSYS:HrlyAdjRecovLoad"		cseDHWSYS:HrlyAdjRecovLoad		= {	if (LocalCompAssigned( SourceDHWSys ) > 0.5)
;																									then	if (IfValidAnd( SourceDHWSys:SolFracType > 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracAnnRpt > 0)==0)
;																											then	(HrlyStdEndUse * DistribLossMult) 
;																											else	(HrlyStdEndUse * DistribLossMult) -
;																													(HrlyStdEndUse * SourceDHWSys:SolFracAnnRpt) 
;																											endif
;																									else	0  endif  }		; 0 => error

	; electrical parasitic power representing recirculation pump energy use - only when DHWCalcMethod = "CSE"
	; SAC 10/29/15 - revised logic to INSTALL wsParElec in T24-match mode (was previsouly turned OFF) - but do so w/ a 0.1 multiplier, since T24DHW DLL seems to calculate pump elec @ only 10% of what it should be
   ; SAC 7/29/18 - removed all logic pertaining to DHWCalcMethod (related to transition from T24DHW DLLs to CSE)
	"Set cseDHWSYS:wsParElec"		cseDHWSYS:wsParElec		= {	UNDEFINED  }  ; if (Proj:IsMultiFamily > 0.5 .OR. IfValidAnd( SourceDHWSys:Type = 4992 )==0) then  UNDEFINED
															;						else 	40			; 40 Watts continual use for SFam where Type = "Recirculation, Non-Demand Control"
															;						endif  }
	"Set cseDHWSYS:wsParElec_x"	cseDHWSYS:wsParElec_x	= {	UNDEFINED  }  ; if (Proj:IsMultiFamily > 0.5 .OR.
															;								(IfValidAnd( SourceDHWSys:Type = 5248 )==0 .AND. IfValidAnd( SourceDHWSys:Type = 8393856 )==0 .AND.
															;								 IfValidAnd( SourceDHWSys:Type = 5504 )==0 .AND. IfValidAnd( SourceDHWSys:Type = 8394112 )==0)) then  UNDEFINED
															;	else 	"hourval( 1.0, 0.5, 0.6, 0.6, 1.2, 2.4, 4.5, 5.7, 5.4, 4.5, 3.7, 2.8, 2.5, 2.3, 2.1, 1.9, 2.8, 3.2, 3.3, 3.1, 2.7, 2.5, 2.3, 1.5 )"
															;	endif  }		; scheduled use for SFam where Type = any demand-controlled recirculation

	; SAC 4/29/19 - revised logic to cause output of wsParElec_x for non-central MFam systems
	;"Set cseDHWSYS:wsParElec_x"	cseDHWSYS:wsParElec_x	= {	UNDEFINED  }  ; if (Proj:IsMultiFamily > 0.5 .OR.
	"Set cseDHWSYS:wsParElec_x"	cseDHWSYS:wsParElec_x	= {	if ( IfValidAnd( SourceDHWSys:CentralSys > 0.5 ) .OR.
																							(IfValidAnd( SourceDHWSys:Type = "Recirculation, Demand Control Push Button" )==0 .AND.
																							 IfValidAnd( SourceDHWSys:Type = "(HERS req'd) Recirculation, Demand Control Push Button" )==0 .AND.
																							 IfValidAnd( SourceDHWSys:Type = "Recirculation, Demand Control Occupancy/Motion" )==0 .AND.
																							 IfValidAnd( SourceDHWSys:Type = "(HERS req'd) Recirculation, Demand Control Occupancy/Motion" )==0)) then  UNDEFINED
																else	"hourval( 1.0, 0.5, 0.6, 0.6, 1.2, 2.4, 4.5, 5.7, 5.4, 4.5, 3.7, 2.8, 2.5, 2.3, 2.1, 1.9, 2.8, 3.2, 3.3, 3.1, 2.7, 2.5, 2.3, 1.5 )"
																endif  }		; scheduled use for SFam where SystemType = any demand-controlled recirculation

;   "wsFaucetCount",  "Total number of faucets served by this DHWSYS"  ; SAC 4/29/19 - faucets always evenly split across all DHWSys objects
; MFAM Incompat
;   "Set cseDHWSYS:wsShowerCount"    cseDHWSYS:wsShowerCount  = {
;         if (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:TotShowersServed >= 0 ))
;         then  SourceDwellUnitDHW:ResSpcDHWFeaturesRef:TotShowersServed
;         else  UNDEFINED  endif  }
;   "Set cseDHWSYS:wsBathCount"    cseDHWSYS:wsBathCount  = {
;         if (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:TotBathsServed[1] >= 0 ))
;         then  SourceDwellUnitDHW:ResSpcDHWFeaturesRef:TotBathsServed[1]
;         else  UNDEFINED  endif  }
; TO DO
;           "wsCWashrCount",  "Total number of clothes washers served by this DHWSYS"  ; SAC 4/1/19
;           "wsDWashrCount",  "Total number of dish washers served by this DHWSYS"  ; SAC 4/1/19

   "Set ResDHWSys:NumSpcClothesWashers"      ResDHWSys:NumSpcClothesWashers =       ; SAC 05/31/21 (tic #3262)
      {  SumRevRef( Spc:ResDHWSysRef, Spc:IncludesResClothesWashers )  }
   "Set ResDHWSys:NumSpcDishWashers"         ResDHWSys:NumSpcDishWashers    = 
      {  SumRevRef( Spc:ResDHWSysRef, Spc:IncludesResDishWashers    )  }

;     "wsFaucetDrawDurF",  BEMP_Flt,  1,  0,  1,  NInp,  "mult",   "wsFaucetDrawDurF", ""  ; added to toggle OFF certain DHW loads (draws) - SAC 05/31/21 (tic #3262)
;     "wsShowerDrawDurF",  BEMP_Flt,  1,  0,  1,  NInp,  "mult",   "wsShowerDrawDurF", ""  ;
;     "wsBathDrawDurF",    BEMP_Flt,  1,  0,  1,  NInp,  "mult",   "wsBathDrawDurF",   ""  ;
; MFAM Incompat
;   "Set cseDHWSYS:wsCWashrDrawDurF"    cseDHWSYS:wsCWashrDrawDurF =        ; SAC 05/31/21 (tic #3262)
;      {  if (IfValidAnd( SourceDHWSys:NumSpcClothesWashers = 0 ))
;         then  0
;         else  UNDEFINED  endif  }
;   "Set cseDHWSYS:wsDWashrDurF"        cseDHWSYS:wsDWashrDurF =
;      {  if (IfValidAnd( SourceDHWSys:NumSpcDishWashers = 0 ))
;         then  0
;         else  UNDEFINED  endif  }
;
;   ; SAC 1/7/19 - separate SFam vs. MFam cseDHWHEATREC creation & setup
;   "Setup cseDHWHEATRECs for cseDHWSYS"   cseDHWSYS:Action  = {
;         if (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:TotShowersServed > 0 )==0) then  UNCHANGED
;         else  EvalRulelist( "Setup_cseDHWHEATREC_MFam", 1 )
;         endif  }
   "Setup remaining cseDHWHEATREC properties"      Proj:Action  = {
         if (SumAll( cseDHWSYS:wsShowerCount ) > 0)
         then  EvalRulelist( "Setup_cseDHWHEATREC" )
         else  UNCHANGED  endif  }
	; end of - cseDHWHEATREC setup

   ; SAC 10/24/19 - added writing of new DHWLOOPHEATER for 'new' CSE central electric system model
   ; SAC 10/28/19 - moved DHWLOOPHEATER creation & population here, ABOVE DHWHEATER, to ensure proper placement (above loops) in CSE input
   ; SAC 1/11/20 - ported from Res to Com (Com tic #3156)
   ; SAC 5/27/20 - added logic to create & populate loop heater via latest SourceDHWSys inputs   - ported to Com - SAC 7/1/20
; MFAM Incompat
;	"Create Child cseDHWLOOPHEATER"		cseDHWSYS:ChildcseDHWLOOPHEATER	=
;      {  if ( IfValidAnd( SourceDHWSys:NewCentralModel > 0 )==0 .OR.
;              LocalCompAssigned( wsCentralDHWSYS ) > 0 ) then  UNCHANGED
;         else if (IfValidAnd( SourceDHWSys:CentralSysTypeVal = 2 ) .AND. EnumValue( SourceDHWSys:CentralHPWHSysDesc ) > 0 .AND.
;                  EnumValue( SourceDHWSys:CentralHPWHLpTankType ) > 0 .AND. IfValidAnd( SourceDHWSys:ValidAnalysisCentralHPWH > 0 ))
;         then  CreateComp( cseDHWLOOPHEATER, "dhwlphtr-" + LocalRef( SourceDHWSys:Name ) )
;         else if (IfValidAnd( SourceDHWSys:CentralSysTypeVal = 2 )==0 .AND. LocalCompAssigned( SourceDHWSys:ResLpTankHtrRef ) > 0)
;         then  CreateComp( cseDHWLOOPHEATER, "dhwlphtr-" + LocalRef( SourceDHWSys:ResLpTankHtrRef:Name ) )
;         else  UNCHANGED  endif endif endif  }
;
;   "Set cseDHWSYS:ChildcseDHWLOOPHEATER:SourceDHWLoopTankSys"     cseDHWSYS:ChildcseDHWLOOPHEATER:SourceDHWLoopTankSys =      ; SAC 7/1/20
;      {  if (IfValidAnd( SourceDHWSys:CentralSysTypeVal = 2 ) .AND. EnumValue( SourceDHWSys:CentralHPWHSysDesc ) > 0 .AND.
;             EnumValue( SourceDHWSys:CentralHPWHLpTankType ) > 0 .AND. IfValidAnd( SourceDHWSys:ValidAnalysisCentralHPWH > 0 ))
;         then  SourceDHWSys  else  UNDEFINED  endif  }
;
;	"Set cseDHWSYS:ChildcseDHWLOOPHEATER:SourceResLpTankHtr"
;				cseDHWSYS:ChildcseDHWLOOPHEATER:SourceResLpTankHtr		=
;      {  if (LocalCompAssigned( ChildcseDHWLOOPHEATER:SourceDHWLoopTankSys ) > 0) then  UNDEFINED
;         else if (LocalCompAssigned( SourceDHWSys:ResLpTankHtrRef ) == ComponentType( "ResLpTankHtr" ))
;         then	SourceDHWSys:ResLpTankHtrRef  else  UNDEFINED  endif endif  }
;	"Set cseDHWSYS:ChildcseDHWLOOPHEATER:whMult"		cseDHWSYS:ChildcseDHWLOOPHEATER:whMult		=
;      {  if (IfValidAnd( ChildcseDHWLOOPHEATER:SourceDHWLoopTankSys:CentralHPWHLpTankCprsrCnt > 0 ))
;         then  ChildcseDHWLOOPHEATER:SourceDHWLoopTankSys:CentralHPWHLpTankCprsrCnt
;         else  SourceDHWSys:ResLpTankHtrMult  endif  }
;	"Call subordinate rulelist to setup remaining cseDHWLOOPHEATER properties"
;;				cseDHWLOOPHEATER:Action	= {	if (LocalCompAssigned( SourceDHWHeater ) > 0.5)
;				cseDHWLOOPHEATER:Action	= {	if (LocalCompAssigned( SourceDHWLoopTankSys ) > 0.5)
;				                              then  EvalRulelist( "CSE_SimulationPrep_DHWLoopHtr_DHWSys",  1 )
;				                              else if (LocalCompAssigned( SourceResLpTankHtr ) > 0.5)
;													   then  EvalRulelist( "CSE_SimulationPrep_DHWLoopHtr_DHWHtr",  1 )
;													   else  UNCHANGED  endif endif  }

	; cseDHWHEATER & cseDHWTANK setup
;	"Create Child cseDHWHEATER - 1"		cseDHWSYS:ChildcseDHWHEATERs[1]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) < 1 .OR.
;																											 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																										else	CreateComp( cseDHWHEATER, "dhwhtr1-" + LocalRef( SourceDHWSys:DHWHeater[1]:Name ) )   endif  }
;	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:SourceDHWHeater"
;				cseDHWSYS:ChildcseDHWHEATERs[1]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "ResWtrHtr" ))
;																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
;;	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:SourceHVACSys"
;;				cseDHWSYS:ChildcseDHWHEATERs[1]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
;;																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
;	"Set cseDHWSYS:ChildcseDHWHEATERs[1]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[1]:whMult		= {	SourceDHWSys:HeaterMult[1]  }
;
;	; SAC 9/11/15 - revised logic to create cseDHWTANK objects for heaters of all types except large & small storage (as long as tank vol > 0)
;   ; SAC 5/10/17 - added logic to prevent DHWTANK modeling of small instantaneous water heaters (since minimal tank integrated into EF) (tic #838)
;   ; LH 170717 - added logic to prevent DHWTank modeling for all 2017 UEF rated equipment
;	"Create Child cseDHWTANK - 1"			cseDHWSYS:ChildcseDHWTANKs[1]		= {
;         if ( IfValidAnd( SourceDHWSys:SimDHWSys > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[1] )==0 .OR.
;         	    LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;         else if ( LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "DHWHeater" ))
;         then	if ( IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 3 ) .OR. 
;                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 6 ) .OR.
;                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 5 ) .OR.
;                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 10 ) .OR.
;                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 12 ) .OR.
;                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 13 ) .OR.
;                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 14 ) .OR.
;                   IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 15 ) .OR.
;         			     ( IfValidAnd( SourceDHWSys:DHWHeater[1]:TankVolume > 0.001 )==0 .AND. 
;                     IfValidAnd( SourceDHWSys:DHWHeater[1]:HeaterType = 1 )==0)) 
;            then  UNCHANGED
;         		else	CreateComp( cseDHWTANK, "dhwtnk1-" + LocalRef( SourceDHWSys:DHWHeater[1]:Name ) )   
;            endif
;         else if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
;         then	if ( IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 3 ) .OR.
;                   IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 6 ) .OR.
;                   IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 5 ) .OR.
;         			     ( IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankVolume > 0.001 )==0 .AND. 
;                     IfValidAnd( SourceDHWSys:DHWHeater[1]:DHWTankType = 1 )==0)) 
;            then  UNCHANGED
;         		else	CreateComp( cseDHWTANK, "dhwtnk1-" + LocalRef( SourceDHWSys:DHWHeater[1]:Name ) )   
;            endif
;         else	UNCHANGED  endif endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[1]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[1]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[1]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[1]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[1] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[1]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[1]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[1]:wtMult		= {	SourceDHWSys:HeaterMult[1]  }


	; Com cseDHWHEATER/cseDHWTANK for CENTRAL DHW systems
	"Create cseDHWHEATER children of Central ResDHWSys systems"
			ResWtrHtr:cseDHWHEATERRef	= {	if (IfValidAnd( ResDHWSys:SysFlrArea > 0.5 )==0 .OR. ResDHWSys:CentralSys < 0.5) then  UNCHANGED
														else	CreateComp( cseDHWHEATER, "dhwhtr-" + Name )  endif  }
	"Set ResWtrHtr:cseDHWHEATERRef Parent"					ResWtrHtr:cseDHWHEATERRef:Parent				= {	ParentRef( cseDHWSYSRef:Name )  }
; MFAM Incompat
;	"Set ResWtrHtr:cseDHWHEATERRef:SourceDHWHeater"		ResWtrHtr:cseDHWHEATERRef:SourceDHWHeater	= {	Name  }
	"Create cseDHWTANK children of Central ResDHWSys systems"
			ResWtrHtr:cseDHWTANKRef		= {	if (IfValidAnd( ResDHWSys:SysFlrArea > 0.5 )==0 .OR. ResDHWSys:CentralSys < 0.5 .OR.
															 IfValidAnd( CSE_SimulateTank > 0.5 )==0) then  UNCHANGED
														else	CreateComp( cseDHWTANK, "dhwtnk-" + Name )  endif  }
	"Set ResWtrHtr:cseDHWTANKRef Parent"					ResWtrHtr:cseDHWTANKRef:Parent				= {	ParentRef( cseDHWSYSRef:Name )  }
; MFAM Incompat
;	"Set ResWtrHtr:cseDHWTANKRef:SourceDHWHeater"		ResWtrHtr:cseDHWTANKRef:SourceDHWHeater	= {	Name  }
;
;	; Com cseDHWHEATER/cseDHWTANK for NON-CENTRAL DHW systems
;	"Create cseDHWHEATER children of Non-Central ResDHWSys systems"
;			DwellUnitDHW:Action	= {	if (IfValidAnd( cseDHWSYSRef:SourceDHWSys:CentralSys < 0.5 )==0) then  UNCHANGED
;												else	CreateDwellUnitDHWHeaters()  endif  }
;				; CreateDwellUnitDHWHeaters( DwellUnitDHWName )
;				;		loop over all cseDHWSYS objects and for each where cseDHWSYS:SourceDwellUnitDHW = DwellUnitDHWName...
;				;			grab cseDHWSYS:SourceDHWSys
;				;			loop over all ResWtrHtr children of cseDHWSYS:SourceDHWSys, creating a cseDHWHEATER for each, named "dhwhtr-<ResWtrHtr:Name> - <DwellUnitDHWName>"
;				;			set:	cseDHWHEATER:Parent = cseDHWSYS
;				;					cseDHWHEATER:SourceDHWHeater = ResWtrHtr:Name
;	"Set cseDHWHEATER:whMult"		cseDHWHEATER:whMult		= {	SourceDHWHeater:Cnt  }
;	"Set cseDHWTANK:wtMult"			cseDHWTANK:wtMult			= {	SourceDHWHeater:Cnt  }


;		"Create Child cseDHWHEATER - 2"		cseDHWSYS:ChildcseDHWHEATERs[2]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) < 1 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else	CreateComp( cseDHWHEATER, "dhwhtr2-" + LocalRef( SourceDHWSys:DHWHeater[2]:Name ) )   endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[2]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWHEATERs[2]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWHEATERs[2]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWHEATERs[2]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[2]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[2]:whMult		= {	SourceDHWSys:HeaterMult[2]  }
;	
;		"Create Child cseDHWTANK - 2"			cseDHWSYS:ChildcseDHWTANKs[2]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[2] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[2]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[2]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[2]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[2]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk2-" + LocalRef( SourceDHWSys:DHWHeater[2]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[2]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk2-" + LocalRef( SourceDHWSys:DHWHeater[2]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[2]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[2]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[2]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[2]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[2] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[2]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[2]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[2]:wtMult		= {	SourceDHWSys:HeaterMult[2]  }
;	
;		"Create Child cseDHWHEATER - 3"		cseDHWSYS:ChildcseDHWHEATERs[3]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) < 1 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else	CreateComp( cseDHWHEATER, "dhwhtr3-" + LocalRef( SourceDHWSys:DHWHeater[3]:Name ) )   endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[3]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWHEATERs[3]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWHEATERs[3]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWHEATERs[3]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[3]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[3]:whMult		= {	SourceDHWSys:HeaterMult[3]  }
;	
;		"Create Child cseDHWTANK - 3"			cseDHWSYS:ChildcseDHWTANKs[3]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[3] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[3]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[3]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[3]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[3]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk3-" + LocalRef( SourceDHWSys:DHWHeater[3]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[3]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk3-" + LocalRef( SourceDHWSys:DHWHeater[3]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[3]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[3]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[3]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[3]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[3] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[3]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[3]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[3]:wtMult		= {	SourceDHWSys:HeaterMult[3]  }
;	
;		"Create Child cseDHWHEATER - 4"		cseDHWSYS:ChildcseDHWHEATERs[4]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) < 1 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else	CreateComp( cseDHWHEATER, "dhwhtr4-" + LocalRef( SourceDHWSys:DHWHeater[4]:Name ) )   endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[4]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWHEATERs[4]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWHEATERs[4]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWHEATERs[4]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[4]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[4]:whMult		= {	SourceDHWSys:HeaterMult[4]  }
;	
;		"Create Child cseDHWTANK - 4"			cseDHWSYS:ChildcseDHWTANKs[4]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[4] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[4]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[4]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[4]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[4]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk4-" + LocalRef( SourceDHWSys:DHWHeater[4]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[4]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk4-" + LocalRef( SourceDHWSys:DHWHeater[4]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[4]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[4]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[4]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[4]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[4] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[4]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[4]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[4]:wtMult		= {	SourceDHWSys:HeaterMult[4]  }
;	
;		"Create Child cseDHWHEATER - 5"		cseDHWSYS:ChildcseDHWHEATERs[5]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) < 1 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else	CreateComp( cseDHWHEATER, "dhwhtr5-" + LocalRef( SourceDHWSys:DHWHeater[5]:Name ) )   endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[5]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWHEATERs[5]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWHEATERs[5]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWHEATERs[5]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[5]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[5]:whMult		= {	SourceDHWSys:HeaterMult[5]  }
;	
;		"Create Child cseDHWTANK - 5"			cseDHWSYS:ChildcseDHWTANKs[5]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[5] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[5]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[5]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[5]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[5]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk5-" + LocalRef( SourceDHWSys:DHWHeater[5]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[5]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk5-" + LocalRef( SourceDHWSys:DHWHeater[5]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[5]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[5]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[5]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[5]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[5] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[5]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[5]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[5]:wtMult		= {	SourceDHWSys:HeaterMult[5]  }
;	
;		"Create Child cseDHWHEATER - 6"		cseDHWSYS:ChildcseDHWHEATERs[6]	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) < 1 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else	CreateComp( cseDHWHEATER, "dhwhtr6-" + LocalRef( SourceDHWSys:DHWHeater[6]:Name ) )   endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[6]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWHEATERs[6]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWHEATERs[6]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWHEATERs[6]:SourceHVACSys		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWHEATERs[6]:whMult"		cseDHWSYS:ChildcseDHWHEATERs[6]:whMult		= {	SourceDHWSys:HeaterMult[6]  }
;	
;		"Create Child cseDHWTANK - 6"			cseDHWSYS:ChildcseDHWTANKs[6]		= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. LocalCompAssigned( SourceDHWSys:DHWHeater[6] )==0 .OR.
;																												 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																											else if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "ResWtrHtr" ))
;																											then	if (IfValidAnd( SourceDHWSys:DHWHeater[6]:TankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[6]:TankType = 6 ) .OR.
;																														(IfValidAnd( SourceDHWSys:DHWHeater[6]:TankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[6]:TankType = 1 )==0)) then  UNCHANGED
;																													else	CreateComp( cseDHWTANK, "dhwtnk6-" + LocalRef( SourceDHWSys:DHWHeater[6]:Name ) )   endif
;																						;					else if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
;																						;					then	if (IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 3 ) .OR. IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 6 ) .OR.
;																						;								(IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankVolume > 0.001 )==0 .AND. IfValidAnd( SourceDHWSys:DHWHeater[6]:DHWTankType = 1 )==0)) then  UNCHANGED
;																						;							else	CreateComp( cseDHWTANK, "dhwtnk6-" + LocalRef( SourceDHWSys:DHWHeater[6]:Name ) )   endif
;																											else	UNCHANGED  endif endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[6]:SourceDHWHeater"
;					cseDHWSYS:ChildcseDHWTANKs[6]:SourceDHWHeater		= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "ResWtrHtr" ))
;																								then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
;	;	"Set cseDHWSYS:ChildcseDHWTANKs[6]:SourceHVACSys"
;	;				cseDHWSYS:ChildcseDHWTANKs[6]:SourceHVACSys			= {	if (LocalCompAssigned( SourceDHWSys:DHWHeater[6] ) == ComponentType( "HVACSys" ))
;	;																							then	SourceDHWSys:DHWHeater[6]  else  UNDEFINED  endif  }
;		"Set cseDHWSYS:ChildcseDHWTANKs[6]:wtMult"		cseDHWSYS:ChildcseDHWTANKs[6]:wtMult		= {	SourceDHWSys:HeaterMult[6]  }


	; SAC 10/21/15 - added DHWLOOP creation
	; SAC 11/10/15 - added check to ensure no loops for MFamDistType = No Loops/Pumps - was causing HUGE elec use in this scenario
	; SAC 8/3/16 - removed check for SourceDHWSys:MFamDistType > 0.5 in order to create a DHWLoop for central systems where MFamDistType = "Multi-family: No loops or recirc pump"
; MFAM Incompat
;	"Create Child cseDHWLOOP"		cseDHWSYS:ChildcseDHWLOOP	= {	if (IfValidAnd( SourceDHWSys:SysFlrArea > 0.5 )==0 .OR. IfValidAnd( SourceDHWSys:CentralSys > 0.5 )==0 .OR.
;																							 LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNCHANGED
;																						else	CreateComp( cseDHWLOOP, "dhwlp-" + LocalRef( SourceDHWSys:Name ) )   endif  }

	"Set cseDHWSYS:NumWaterHeaters"		cseDHWSYS:NumWaterHeaters	= {	SumChildren( cseDHWHEATER:whMult )  }		; SAC 7/18/15
;	"Set cseDHWHEATER:HrlyAdjRecovLoad - hourly adjusted recovery load (HARLj in ACM DHW docu)"		; SAC 7/17/15   
;					cseDHWHEATER:HrlyAdjRecovLoad	= {	if (cseDHWSYS:NumWaterHeaters < 1) then  0
;																	else	cseDHWSYS:HrlyAdjRecovLoad / cseDHWSYS:NumWaterHeaters  endif  }

;"store BEMProc details"		Proj:Action = {  StoreBEMProc( "b4 ResWtrHtrCSEprep", 0 )  }
;"debugging"		Proj:Action		= {	MessageBox( "About to eval CSE_SimulationPrep_DHWHtr_DHWHtr rules" )  }

  ; SAC 12/31/15 - revised logic of following rules to accommodate special handling of DHW heater & tank used to model HVACSys-based air-to-water heat pump DHW heating (tic 560)
  ; SAC 1/13/16 - similar revision as above comment for ResWtrHtr-source DHW when HeaterElementType = "Heat Pump" and IsHydronic flag set (should only happen in MFam) (tic 560)
; MFAM Incompat
;	"Call subordinate rulelist to setup remaining cseDHWHEATER properties"
;				cseDHWHEATER:Action	= {	     if (LocalCompAssigned( SourceDHWHeater ) > 0.5)
;								;					then  if (IfValidAnd( SourceDHWHeater:HeaterElementType == 3 ) .AND. IfValidAnd( SourceDHWHeater:IsHydronic > 0.5 ))
;								;							then	EvalRulelist( "CSE_SimulationPrep_DHWHtr_AWHP",  1 )
;															then	EvalRulelist( "CSE_SimulationPrep_DHWHtr_DHWHtr",  1 )
;								;							endif
;										;			else if (LocalCompAssigned( SourceHVACSys   ) > 0.5)
;										;			then	if (IfValidAnd( SourceHVACSys:Type = 2 ) .AND. IfValidAnd( SourceHVACSys:HtPumpSysType = 11 ))
;										;					then  EvalRulelist( "CSE_SimulationPrep_DHWHtr_AWHP", 1 )
;										;					else	EvalRulelist( "CSE_SimulationPrep_DHWHtr_HVACSys", 1 )  endif
;													else  UNCHANGED  endif  }

      ; SAC 1/9/20 - new central CSE modeling (Com tic #3156)
; only applicable to EnableReserchMode in Res
;	"Set cseDHWSYS:wsLoadMaxDur - # of hours for tracking the maximum load (default = 12)"    cseDHWSYS:wsLoadMaxDur =   ; SAC 12/2/19
;	   {  if (LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. IfValidAnd( Proj:AnalysisVersion > 190101 ) .AND.
;	          IfValidAnd( SourceDHWSys:UseMaxDurNumHtrs > 0 ) .AND. IfValidAnd( SourceDHWSys:LoadMaxNumHrs > 0 ) .AND.
;	          LocalStatus( SourceDHWSys:LoadMaxNumHrs ) > 5)
;	      then  SourceDHWSys:LoadMaxNumHrs  else  UNDEFINED  endif  }
;	"Set cseDHWSYS:wsDrawMaxDur - # of hours for tracking the maximum draw (default = 4)"     cseDHWSYS:wsDrawMaxDur =
;	   {  if (LocalCompAssigned( wsCentralDHWSYS ) < 1 .AND. IfValidAnd( Proj:AnalysisVersion > 190101 ) .AND.
;	          IfValidAnd( SourceDHWSys:UseMaxDurNumHtrs > 0 ) .AND. IfValidAnd( SourceDHWSys:DrawMaxNumHrs > 0 ) .AND.
;	          LocalStatus( SourceDHWSys:DrawMaxNumHrs ) > 5)
;	      then  SourceDHWSys:DrawMaxNumHrs  else  UNDEFINED  endif  }

  ; SAC 3/22/16 - set new property indicating whether or not a CSE pre-run is required for each cseDHWHEATER
  ;						based on e-mail from CSB: "PreRun is needed ONLY for SmallStorage, non-ASHPX.  (Supposedly) harmless for all other types"
  ; SAC 8/13/19 - added logic to prevent use of PreRun for ResistanceX heaters (per call w/ BW during testing of new CSE tank model)
	"Set cseDHWHEATER:CSEPreRunRequired"	cseDHWHEATER:CSEPreRunRequired	=
      {  if (IfValidAnd( whType == "SmallStorage" ) .AND.
             IfValidAnd( whHeatSrc != "ASHPX" ) .AND.
             IfValidAnd( whHeatSrc != "ResistanceX" ))
         then  1  else  0  endif  }
  ; SAC 3/22/16 - set cseDHWSYS:wsCalcMode based on whether or not any child heaters require pre-run
	"Set cseDHWSYS:wsCalcMode based on child cseDHWHEATER objects"		cseDHWSYS:wsCalcMode	=        ; SAC 1/9/20 - revised for cseDHWSYS::CSEPreRunRequired (Com tic #3156)
      {  if (IfValidAnd( CSEPreRunRequired > 0 )) then  "PreRun"
         else if (LocalCompAssigned( wsCentralDHWSYS ) > 0) then  UNDEFINED
         else if (SumChildren( cseDHWHEATER:CSEPreRunRequired ) > 0.5 .OR.
                  SumChildren( cseDHWLOOPHEATER:CSEPreRunRequired ) > 0.5)
         then  "PreRun"  else  "Simulate"  endif endif endif  }

	"Set Proj:CSE_DHWPreRunReqd"	Proj:CSE_DHWPreRunReqd	=        ; SAC 1/9/20 - added logic to include checks for cseDHWSYS: & cseDHWLOOPHEATER: CSEPreRunRequired (Com tic #3156)
      {  if (SumAll( cseDHWHEATER:CSEPreRunRequired ) > 0.5 .OR.
             SumAll( cseDHWLOOPHEATER:CSEPreRunRequired ) > 0.5 .OR.
             SumAll( cseDHWSYS:CSEPreRunRequired ) > 0.5) then  1  else  0  endif  }		; SAC 3/22/16

; MFAM Incompat
;	"Call subordinate rulelist to setup remaining cseDHWTANK properties"
;				cseDHWTANK:Action		= {	     if (LocalCompAssigned( SourceDHWHeater ) > 0.5) then  EvalRulelist( "CSE_SimulationPrep_DHWTank_DHWHtr",  1 )
;										;			else if (LocalCompAssigned( SourceHVACSys   ) > 0.5) then  EvalRulelist( "CSE_SimulationPrep_DHWTank_HVACSys", 1 )
;												   else  UNCHANGED  endif  }

	"Call subordinate rulelist to setup remaining cseDHWLOOP properties"
				Proj:Action				= {	if (ComponentCount( cseDHWLOOP ) < 1) then  UNCHANGED
													else	EvalRulelist( "CSE_SimulationPrep_DHWLoop" )  endif  }		; default all via one call

; SAC 8/21/15 - REMOVED rule-based LDEF adjustment - this now happening inside CSE
;	"Call subordinate rulelist to revise whEF of cseDHWHEATER to a Load Dependent Energy Factor (LDEF) - ONLY for Small Storage water heaters"
;				cseDHWHEATER:Action	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc > 0 ) .AND. IfValidAnd( whEF > 0 ))
;													then  EvalRulelist( "CSE_SimulationPrep_DHWHtr_LDEF",  1 )
;													else  UNCHANGED  endif  }
END

;*************************************************************************
RULELIST "Setup_cseDHWHEATREC"  1 0 0 0
; MFAM Incompat
;   "Set cseDHWHEATREC:wrType"        cseDHWHEATREC:wrType        = {
;         if (LocalCompAssigned( SourceDWHRSys )) then  SourceDWHRSys:Type         else  UNCHANGED  endif  }   ; enum strings identical...
;   "Set cseDHWHEATREC:wrCSARatedEF"  cseDHWHEATREC:wrCSARatedEF  = {
;         if (LocalCompAssigned( SourceDWHRSys )) then  int( (10*SourceDWHRSys:CSARtdEff)+0.5 ) / 1000  else  UNCHANGED  endif  }
   ; SAC 1/8/19 - revised rule to round to nearest tenth of % and post to CSE as fraction (not %)
   ;      if (LocalCompAssigned( SourceDWHRSys )) then  SourceDWHRSys:CSARatedEff  else  UNCHANGED  endif  }
END

;*************************************************************************
RULELIST "Setup_cseDHWSYS_MetersAndTemperatures" 1 0 0 0
	"Set cseDHWSYS:wsElecMtr"			cseDHWSYS:wsElecMtr		= {	Proj:CSE_ElecMETER  }
	"Set cseDHWSYS:wsFuelMtr"			cseDHWSYS:wsFuelMtr		=     ; replaced dependence on Proj:GasType (since that is not valid for Std design models) w/ checks for meter presence - SAC 10/09/20
      {  if (     GlobalCompAssigned( Proj:CSE_NatGasMETER    )) then  Proj:CSE_NatGasMETER
			else if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then  Proj:CSE_OtherFuelMETER
			else  UNDEFINED  endif endif  }
	"Set cseDHWSYS:wsFXHwMtr"			cseDHWSYS:wsFXHwMtr		= {	if (GlobalCompAssigned( Proj:CSE_FXHwDHWMETER ) < 1) then  UNDEFINED		; SAC 4/25/16
																						else	Proj:CSE_FXHwDHWMETER  endif  }
	"Set cseDHWSYS:wsWHHwMtr"			cseDHWSYS:wsWHHwMtr		= {	if (GlobalCompAssigned( Proj:CSE_WHHwDHWMETER ) < 1) then  UNDEFINED
																						else	Proj:CSE_WHHwDHWMETER  endif  }

; MFAM Incompat
;	"Set cseDHWSYS:wsTUse"				cseDHWSYS:wsTUse			=           ; SAC 1/9/20 - hardwire 'new' CSE central electric system model wsTUse to 125 (Com tic #3156)
;      {  if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
;         else if (IfValidAnd( SourceDHWSys:NewCentralModel > 0 )) then  125
;         else	SourceDHWSys:HWSupplyTemp  endif endif  }

; SAC 8/7/18 - enable in Com for demand responsive DHW (if/when allowed for 2019+ analysis)
;	; SAC 3/28/17 - added in conjunction w/ latest demand response CSE HPWH model
;   ; SAC 6/14/17 - added logic to ensure proper SourceDHWSys:DemandResponseFlag (to help facilitate toggling off demand response)
;   "Set cseDHWSYS:wsTSetpoint_x"    cseDHWSYS:wsTSetpoint_x  = {
;	      if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
;         else if (IfValidAnd( SourceDHWSys:NewCentralModel > 0 )) then  UNDEFINED
;	      else if (strlen( SourceDHWSys:TSetpoint_x ) < 2) then  UNDEFINED
;	      else if (IfValidAnd( SourceDHWSys:DemandResponseFlag = 2 )==0) then  UNDEFINED
;	      else  SourceDHWSys:TSetpoint_x
;	      endif endif endif endif  }

	; SAC 4/6/16 - added in conjunction w/ CSE 0.796 - related to new HPWH model
; MFAM Incompat
;	"Set cseDHWSYS:wsTSetpoint"		cseDHWSYS:wsTSetpoint	=           ; SAC 1/10/20 - hardwire 'new' CSE central electric system model wsTSetpoint to 135 (Com tic #3156)   ; SAC 5/27/20   ; SAC 6/2/20 - removed dependence on SourceDHWSys:NewCentralElecModel
;      {  if (Proj:CSE_DHWUseMthd == "Old (via wsUse)" .OR. LocalStatus( wsTSetpoint_x ) > 0) then  UNDEFINED
;         else if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
;         else if (IfValidAnd( SourceDHWSys:CentralElecDHW > 0 ))
;         then  if (IfValidAnd( SourceDHWSys:CentralSysTypeVal = 2 ) .AND. EnumValue( SourceDHWSys:CentralHPWHSysDesc ) > 0 .AND.
;                   IfValidAnd( SourceDHWSys:CentralHPWHTankSetpt > 0 )) then  SourceDHWSys:CentralHPWHTankSetpt
;               else  135  endif
;         else	125  endif endif endif  }		; SAC 5/20/16 - removed MFam-Central dependence (e-mailed request from BAW)
;   ;     else if (SourceDHWSys:CentralSys > 0.5)		; SAC 4/13/16 - revised to 130 for central systems
;   ;     then  130  else  125  endif endif endif  }
;
;; 1,           "wsTSetPointLH",     BEMP_Flt,  1,  0,  1, "F",               0,  0,                          3208, "Setpoint temperature for loop heater"    
;	"Set cseDHWSYS:wsTSetPointLH"	   cseDHWSYS:wsTSetPointLH			=           ; SAC 1/10/20 - fix to incorporate wsTSetPointLH into new central DHWSYS objects (Com tic #3156)   ; SAC 5/27/20   ; SAC 6/2/20 - removed dependence on SourceDHWSys:NewCentralElecModel & MFamDistType
;      {  if (LocalCompAssigned( SourceDHWSys ) < 0.5) then  UNDEFINED
;         else if (IfValidAnd( SourceDHWSys:CentralElecDHW > 0 ))
;         then  if (IfValidAnd( SourceDHWSys:CentralSysTypeVal = 2 ) .AND. EnumValue( SourceDHWSys:CentralHPWHSysDesc ) > 0 .AND.
;                   EnumValue( SourceDHWSys:CentralHPWHLpTankType ) > 0 .AND. IfValidAnd( SourceDHWSys:CentralHPWHLpTankSetpt > 0 ))
;               then  SourceDHWSys:CentralHPWHLpTankSetpt
;               else if (IfValidAnd( SourceDHWSys:HaveLpHtr > 0 ))
;               then  136
;               else  UNDEFINED  endif endif
;         else	UNDEFINED  endif endif  }

	; Solar savings fraction inputs
	"Set cseDHWSYS:wsSSF"		cseDHWSYS:wsSSF		=
	   {  UNDEFINED  }
; SAC 2/2/20 - remove simulation of wsSSF (Com tic #3157)
;	   {	if (SourceDHWSys:SolFracType != 1 .OR. IfValidAnd( SourceDHWSys:AnnualSolFrac >= 0 )==0 .OR. ) 
;	      then  UNDEFINED  else  SourceDHWSys:AnnualSolFrac  endif  }
;	"Set cseDHWSYS:wsSSF_x"		cseDHWSYS:wsSSF_x		= {
;												if (SourceDHWSys:SolFracType != 2 .OR.
;														IfValidAnd( SourceDHWSys:SolFracMon[1]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[2]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[3]  >= 0 )==0 .OR.
;														IfValidAnd( SourceDHWSys:SolFracMon[4]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[5]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[6]  >= 0 )==0 .OR.
;														IfValidAnd( SourceDHWSys:SolFracMon[7]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[8]  >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[9]  >= 0 )==0 .OR.
;														IfValidAnd( SourceDHWSys:SolFracMon[10] >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[11] >= 0 )==0 .OR. IfValidAnd( SourceDHWSys:SolFracMon[12] >= 0 )==0 ) then  UNDEFINED
;												else	Format( "choose1( $month, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g, %g )", SourceDHWSys:SolFracMon[1], SourceDHWSys:SolFracMon[2], SourceDHWSys:SolFracMon[3],
;																					SourceDHWSys:SolFracMon[4], SourceDHWSys:SolFracMon[5], SourceDHWSys:SolFracMon[6], SourceDHWSys:SolFracMon[7], SourceDHWSys:SolFracMon[8],
;																					SourceDHWSys:SolFracMon[9], SourceDHWSys:SolFracMon[10], SourceDHWSys:SolFracMon[11], SourceDHWSys:SolFracMon[12] )
;												endif  }

; MFAM Incompat
;	"Set cseDHWSYS:wsSolarSys"		cseDHWSYS:wsSolarSys	=     ; SAC 1/15/20 (Res tic #1013)  - SAC 2/2/20 (Com tic #3157)
;      {  if (IfValidAnd( SourceDHWSys:CSESolarSysSimValid > 0 )==0) then  UNDEFINED
;         else  SourceDHWSys:DHWSolarSysRef:cseDHWSOLARSYSRef:Name  endif  }

END

;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWHtr_DHWHtr" 1 0 0 1
;*************************************************************************
; MFAM Incompat
;	"Set cseDHWHEATER:whType"
;			cseDHWHEATER:whType		= {	if (IfValidAnd( SourceDHWHeater:IsBuiltUp > 0 )) then  6 ; "BuiltUp"  SAC 5/28/20
;                                       else if (SourceDHWHeater:ElementTypeNum == 5) then  1		; "Heat Pump (2016)" -> "Small Storage"
;			                              else if (IfValidAnd( SourceDHWHeater:ElementType = "Gas" ) .AND. IfValidAnd( Proj:EngyCodeYearNum >= 2019 ) .AND.
;																IfValidAnd( SourceDHWHeater:HtrTypeNum = 9 ))
;													then  5  ; "InstantaneousUEF"   - need in Com BEFORE switch (TankType) since there is no string for TankType = 9
;													else	switch ( SourceDHWHeater:TankType )
;																case  "Boiler"              :	4		; "Boiler"    -> "LargeInstantaneous"
;																case  "Commercial Packaged Boiler" : 4	 ; "Commercial Packaged Boiler" -> "LargeInstantaneous"   ; SAC 1/10/20 (Com tic #3156)
;																case  "Indirect"            :	4		; "Indirect"  -> "LargeInstantaneous"
;																case  "Large Instantaneous" :	4	 	; "Large Instantaneous" 
;																case  "Large Storage"       :	2		; "Large Storage"   
;																case  "Small Instantaneous" :	3		; "Small Instantaneous" 
;																case  "Small Storage"       :	1		; "Small Storage"     
;                                case "Consumer Instantaneous (UEF)"  :  if (IfValidAnd( SourceDHWHeater:ElementType = "Gas" ) .AND. IfValidAnd( Proj:EngyCodeYearNum >= 2019 ))
;                                                                        then  5  ; 2019 "Consumer Instantaneous (UEF)" -> "InstantaneousUEF"
;                                                                        else  3  ;  "Consumer Instantaneous (UEF)"   ->   SmallInstantaneous
;                                                                        endif
;                                case "Commercial Instantaneous (TE)" : 4  ;  "Commercial Instantaneous (TE)   ->   LargeInstantaneous
;                                case "Consumer Storage (UEF)"        : 1  ;  "Consumer Storage (UEF)"   ->   SmallStorage
;                                case "Commercial Storage (TE & SBL)" : 2  ;  "Commercial Storage (TE & SBL)   ->   Large Storage
;                                case "Residential-Duty Commercial Storage (UEF)"       : 2  ;  "Residential-Duty Commercial Storage (UEF)"   ->   LargeStorage
;                                case "Residential-Duty Commercial Instantaneous (UEF)" : 4  ;  Residential-Duty Commercial Instantaneous (UEF)   ->   LargeInstantaneous
;																default :	PostError( "Unable to translate ResWtrHtr:TankType (%s) to cseDHWHEATER:whType", ValidOr( SourceDHWHeater:TankType, "unknown" ) )
;															endswitch  endif endif endif  }
;
;	"Set cseDHWHEATER:whHeatSrc"
;			cseDHWHEATER:whHeatSrc	= {	switch ( SourceDHWHeater:ElementTypeNum )
;														case  0 :	if (IfValidAnd( SourceDHWHeater:TankZnDisp > 0.5 ))
;																		then  5		; "Electric Resistance"  -> ResistanceX - switched from Res - SAC 4/14/16
;																		else  2		; "Resistance"
;																		endif
;														case  1 :	1		; "Natural Gas"          -> Fuel
;												;		case  2 :	1		; "Propane"              -> Fuel 
;														case  3 :	3		; "Heat Pump"            -> ASHP
;												;		case  4 :	1		; "Oil"                  -> Fuel
;														case  5 :	4		; "Heat Pump (2016)"     -> ASHPX		; SAC 3/19/16
;														default :	PostError( "Unable to translate ResWtrHtr:ElementTypeNum = 'unrecognized' (%g) to cseDHWHEATER:whHeatSrc", SourceDHWHeater:ElementTypeNum )
;													endswitch  }
;;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
;	"Set cseDHWHEATER:whFuelMtr"     ; removed dependence on Proj:GasType since that is not valid for Std design models (presence of meter is sufficient) - SAC 10/09/20
;			cseDHWHEATER:whFuelMtr	= {;	if (Proj:StandardsVersion > 2016 .OR. Proj:DRtgRefRunID == 2014)		; SAC 11/9/15  - SAC 4/7/16 - added in RESNET here (tic #631)
;												;	then	switch ( SourceDHWHeater:ElementType )		; SAC 3/24/16 - revised logic to prevent specifying FuelMtr for Elec heaters
;															switch ( SourceDHWHeater:ElementType )		; SAC 3/24/16 - revised logic to prevent specifying FuelMtr for Elec heaters
;																case  "Electric Resistance" :	UNDEFINED		; "Electric Resistance"  
;																case  "Heat Pump"           :	UNDEFINED		; "Heat Pump" 
;												;				case  3 :	UNDEFINED		; "Heat Pump (2013)" 
;												;				case  5 :	UNDEFINED		; "Heat Pump (2016)" 
;																default :	if (     GlobalCompAssigned( Proj:CSE_NatGasMETER    )) then  Proj:CSE_NatGasMETER
;																				else if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then  Proj:CSE_OtherFuelMETER
;																				else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - expected Proj:*METER not found.", Name )  endif endif
;															endswitch  }
;												;	else	switch ( SourceDHWHeater:ElementType )
;												;				case  "Electric Resistance" :	UNDEFINED		; "Electric Resistance"   
;												;				case  "Gas" :	if (GlobalCompAssigned( Proj:CSE_NatGasMETER )) then		Proj:CSE_NatGasMETER			; "Natural Gas" 
;												;									else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - ResWtrHtr:ElementType = 'Natural Gas' (1) but Proj:CSE_NatGasMETER not defined.", Name )  endif
;												;				case  2 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Propane"   
;												;								else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - ResWtrHtr:ElementType = 'Propane' (2) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
;												;				case  3 :	UNDEFINED		; "Heat Pump (2013)" 
;												;				case  4 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Oil" 
;												;								else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - ResWtrHtr:ElementType = 'Oil' (4) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
;												;				case  5 :	UNDEFINED		; "Heat Pump (2016)" 
;												;				default :	UNDEFINED
;												;			endswitch  endif  }
;
;	"Set cseDHWHEATER:whVol"   cseDHWHEATER:whVol	= 	                           ; SAC 9/10/15   ; SAC 1/10/20 - added use of NonStdTankVolume (Sanden HPWHs in elec central systems only) (Com tic #3156)   ; SAC 3/12/20 - revise logic for multiple central compressor types (Colmac)   ; SAC 7/2/20   ; SAC 03/02/21
;   {  if (SourceDHWHeater:ElementTypeNum == 5 .AND.
;          IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEARtd > 0 ) .AND.
;          EnumValue( SourceDHWHeater:CentralHPWHCprsrType ) > 0 .AND.
;          IfValidAnd( SourceDHWSys:NewCentralModel > 0 ) .AND.
;          IfValidAnd( SourceDHWHeater:IsElecCentralHtr > 0 ) .AND.
;          IfValidAnd( SourceDHWHeater:NonStdTankVol > 0 ))
;      then  SourceDHWHeater:NonStdTankVol
;      else if (IfValidAnd( SourceDHWHeater:TankVolume > 0 ) .AND. 
;                           SourceDHWHeater:ElementTypeNum == 5 .AND. 
;               IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEARtd > 0.5 )==0 .AND.
;               IfValidAnd( SourceDHWHeater:HPWHCommProd        > 0.5 )==0) 
;      then  SourceDHWHeater:TankVolume                                            ; Heat Pump WH including UEF rated
;      else if ( ( IfValidAnd( SourceDHWHeater:TankType = "Large Storage" ) == 0 .AND.           ; Not Large Storage AND
;               IfValidAnd( SourceDHWHeater:TankType = "Small Storage" ) == 0 .AND.           ; Not Consumer Storage (UEF) 
;               IfValidAnd( SourceDHWHeater:TankType = "Consumer Storage (UEF)"        ) == 0 .AND.          ; Not Small Storage
;               IfValidAnd( SourceDHWHeater:TankType = "Commercial Storage (TE & SBL)" ) == 0 .AND.          ; Not Commercial Storage
;               IfValidAnd( SourceDHWHeater:TankType = "Residential-Duty Commercial Storage (UEF)" ) == 0 ) .OR.         ; Not Residential-Duty Commercial Storage (UEF)
;		 				IfValidAnd( SourceDHWHeater:TankVolume >= 0 )== 0 .OR.             ; No Tank Vol Defined
;             SourceDHWHeater:ElementTypeNum == 5 )                           ; NEAA Rated or Commercial HP
;   then  UNDEFINED 
;	 else  SourceDHWHeater:TankVolume  
;   endif endif endif  }
;
;	"Set cseDHWHEATER:whEF"  cseDHWHEATER:whEF		= {	
;    if ( IfValidAnd( SourceDHWHeater:EF > 0 ) .AND. 
;        SourceDHWHeater:ElementTypeNum == 5 )                               ; LH 170717 - UEF Rated Heat Pump Water Heater
;    then if( SourceDHWHeater:IsUEFRtdSim .AND. 
;             IfValidAnd( SourceDHWHeater:UEFModelCalcEF > 0 ) )
;      then SourceDHWHeater:UEFModelCalcEF                                     
;      else if( SourceDHWHeater:HtPumpWtrHtrNEEARtd < 0.5 .AND.              ; LH 170717 - EF Rated Heat Pump Water Heater
;               SourceDHWHeater:HPWHCommProd < 0.5 )                         ; SAC 03/02/21
;      then SourceDHWHeater:EF                                        
;      else UNDEFINED
;      endif endif
;    else if ( SourceDHWHeater:ElementTypeNum != 5 .AND. 
;						( IfValidAnd( whType = "SmallStorage" ) .OR. IfValidAnd( whType = "SmallInstantaneous" ) ) )       ; SAC 8/21/15 - only for small instantaneous & storage		
;    then if( IfValidAnd( SourceDHWHeater:TankType = "Consumer Instantaneous (UEF)" )  .AND.                ; LH 170717 - Consumer Storage (UEF)
;             IfValidAnd( SourceDHWHeater:UEFModelCalcRE > 0 ) )                ; LH 170717 - Consumer Instantaneous (UEF) - RE translated to whEF
;      then if( SourceDHWHeater:ElementTypeNum = 1 )
;        then 0.9734*SourceDHWHeater:UEFModelCalcRE + 0.01835                   ; LH 170718 - Gas RE to EF Eqn provided by Jim Lutz and CEC
;        else SourceDHWHeater:UEFModelCalcRE                                    ; LH 170718 - Electric RE to EF equivalence provided by Jim Lutz and CEC
;        endif
;      else if( IfValidAnd( SourceDHWHeater:TankType = "Consumer Storage (UEF)" ) .AND.               ; LH 170717 - Consumer Storage (UEF)
;               IfValidAnd( SourceDHWHeater:UEFModelCalcEF > 0 ) )
;      then SourceDHWHeater:UEFModelCalcEF                                      
;      else if( IfValidAnd( SourceDHWHeater:EF > 0 ) )
;      then  SourceDHWHeater:EF  
;      else UNDEFINED
;      endif endif endif
;    else  UNDEFINED  
;    endif endif  }
;
;	"Set cseDHWHEATER:whUEF"      cseDHWHEATER:whUEF  = {
;         if (IfValidAnd( whType = "InstantaneousUEF" ) .AND. IfValidAnd( SourceDHWHeater:EF > 0 ))
;         then  SourceDHWHeater:EF  else  UNDEFINED  endif  }
;         ; UEF -> whHeatSrc = Fuel  (required when whType = INSTANTANEOUSUEF (5))
;
;	"Set cseDHWHEATER:whEff" cseDHWHEATER:whEff	= {	
;    if ( SourceDHWHeater:ElementTypeNum != 5 .AND. 
;				 ( IfValidAnd( whType = "LargeStorage" ) .OR.                                       ; SAC 8/21/15 - only for boiler & large instantaneous & storage
;           IfValidAnd( whType = "LargeInstantaneous" ) ) )		                                     
;    then if( IfValidAnd( SourceDHWHeater:TankType = "Residential-Duty Commercial Storage (UEF)" ) .AND.                 ; LH 170717 - Residential-Duty Commercial Storage (UEF)   
;             IfValidAnd( SourceDHWHeater:RcvryEff > 0 ) )
;      then SourceDHWHeater:RcvryEff/100                                       
;      else if( IfValidAnd( SourceDHWHeater:TankType = "Residential-Duty Commercial Instantaneous (UEF)" ) .AND.               ; LH 170717 - Residential-Duty Commercial Instantaneous (UEF)
;               IfValidAnd( SourceDHWHeater:UEFModelCalcTE > 0 ) )
;      then SourceDHWHeater:UEFModelCalcTE                                     
;      else if( IfValidAnd( SourceDHWHeater:ThrmlEff > 0 ) )                ; LH 170718 - Commercial Instantaneous (TE) and Commercial Storage (TE & SBL) covered under this cat
;      then SourceDHWHeater:ThrmlEff
;      else UNDEFINED
;      endif endif endif
;
;		else if (IfValidAnd( whType = "InstantaneousUEF" ) .AND. IfValidAnd( SourceDHWHeater:RcvryEff > 0 ))
;		then  SourceDHWHeater:RcvryEff / 100
;		else  UNDEFINED  
;    endif endif }
; Code Snippet for rule above:
;    else if( IfValidAnd( whType = 3 ) .AND. 
;             IfValidAnd( SourceDHWHeater:TankType = 10 ) .AND.                 LH 170718 - Consumer Instantaneous (UEF)
;             IfValidAnd( SourceDHWHeater:UEFModelCalcRE > 0 ) )
;    then SourceDHWHeater:UEFModelCalcRE  

   ; SAC 5/25/17 - UEF-rated Instantaneous properties
   ; LH 170717 - Not modified for 2016 UEF Rated Mods - relates to new whType = 5
; MFAM Incompat
;   "Set cseDHWHEATER:whRatedFlow"      cseDHWHEATER:whRatedFlow   = {
;         if (IfValidAnd( whType = "InstantaneousUEF" ) .AND. IfValidAnd( SourceDHWHeater:RtdFlow > 0 ))
;         then  SourceDHWHeater:RtdFlow  else  UNDEFINED  endif  }
;   "Set cseDHWHEATER:whAnnualFuel"     cseDHWHEATER:whAnnualFuel  = {
;         if (IfValidAnd( whType = "InstantaneousUEF" ) .AND. IfValidAnd( SourceDHWHeater:AnnualFuelUse > 0 ))
;         then  SourceDHWHeater:AnnualFuelUse  else  UNDEFINED  endif  }
;   "Set cseDHWHEATER:whAnnualElec"     cseDHWHEATER:whAnnualElec  = {
;         if (IfValidAnd( whType = "InstantaneousUEF" ) .AND. IfValidAnd( SourceDHWHeater:AnnualElecUse > 0 ))
;         then  SourceDHWHeater:AnnualElecUse  else  UNDEFINED  endif  }
;   "Set cseDHWHEATER:whStbyElec"       cseDHWHEATER:whStbyElec    = {
;         if (IfValidAnd( whType = "InstantaneousUEF" ) .AND. IfValidAnd( SourceDHWHeater:StdbyElec > 0 ))
;         then  SourceDHWHeater:StdbyElec  else  UNDEFINED  endif  }
;
;   "Set cseDHWHEATER:whTankCount (tanks per htr/compressor)"   cseDHWHEATER:whTankCount  =      ; SAC 5/28/20
;      {  if (IfValidAnd( SourceDHWHeater:TankCntSim > 0 ))
;         then  SourceDHWHeater:TankCntSim
;         else  UNDEFINED  endif  }
;   "Set cseDHWHEATER:whInsulR"      cseDHWHEATER:whInsulR  =         ; SAC 5/28/20
;      {  if (IfValidAnd( SourceDHWHeater:InsRValSim >= 0 ))
;         then  SourceDHWHeater:InsRValSim
;         else  UNDEFINED  endif  }

; unused in Res
;   "Set cseDHWHEATER:whResHtPwr (upper)"     cseDHWHEATER:whResHtPwr  =    ; SAC 5/29/20
;      {  if (IfValidAnd( SourceDHWHeater:ResHtPwrSim[1] >= 0 ))
;         then  SourceDHWHeater:ResHtPwrSim[1]
;         else  UNDEFINED  endif  }
;   "Set cseDHWHEATER:whResHtPwr2 (lower)"    cseDHWHEATER:whResHtPwr2 = 
;      {  if (IfValidAnd( SourceDHWHeater:ResHtPwrSim[2] >= 0 ))
;         then  SourceDHWHeater:ResHtPwrSim[2]
;         else  UNDEFINED  endif  }

; whHPAF removed from CSE by CB - SAC 2/2/20
;	"Set cseDHWHEATER:whHPAF"
;			cseDHWHEATER:whHPAF	= {	if (IfValidAnd( whType = "SmallStorage" ) .AND. IfValidAnd( whHeatSrc = "ASHP" ))		; SAC 8/21/15 - only for small storage, ASHP
;												then  CAClimateZoneDHWASHPAdj:HPAdj( "ClimateZone", Proj:CliZnNum )  else  UNDEFINED  endif  }
; MFAM Incompat
;	"Set cseDHWHEATER:whSBL"  cseDHWHEATER:whSBL	= {	
;    if( IfValidAnd( whType = "LargeStorage" ) )		                                         ; SAC 8/21/15 - only for large storage		
;    then if( IfValidAnd( SourceDHWHeater:TankType = "Residential-Duty Commercial Storage (UEF)" ) .AND.                 ; LH 170717 - Residential-Duty Commercial Storage (UEF)            
;             IfValidAnd( SourceDHWHeater:UEFModelCalcSL > 0 ) )
;      then SourceDHWHeater:UEFModelCalcSL                                      
;      else if( IfValidAnd( SourceDHWHeater:StdbyLossFrac > 0 ) .AND.          ; LH 170718 - Commercial Storage (TE & SBL) covered under this line item
;               IfValidAnd( SourceDHWHeater:StdbyLossFrac < 1 ) .AND.
;				       IfValidAnd( SourceDHWHeater:TankVolume > 0 ) )
;      then                                                                     ; SAC 9/8/15 - revised to be based on TankVolume
;        SourceDHWHeater:StdbyLossFrac * 8.25 * SourceDHWHeater:TankVolume * 70
;						; no whSBL modeled for any whType other than LargeStorage - this setting moved to whPilotPwr below
;						;						else if (IfValidAnd( whType = 4 ) .AND. IfValidAnd( SourceDHWHeater:StdbyLossFrac > 0 ))
;						;						then	SourceDHWHeater:StdbyLossFrac		; SAC 11/10/15 - entered by user as pilot energy in Btuh
;						;						else  UNDEFINED  endif endif  }
;			else  UNDEFINED  
;      endif endif
;
;									;				 IfValidAnd( SourceDHWHeater:InputRating > 0 ) .AND. IfValidAnd( SourceDHWHeater:TankType = 3 ))		; SAC 8/21/15 - only for large storage
;									;			then  SourceDHWHeater:InputRating * SourceDHWHeater:StdbyLossFrac  else  UNDEFINED  endif  }
;    else UNDEFINED
;    endif }
;
;
;	"Set cseDHWHEATER:whPilotPwr"
;			cseDHWHEATER:whPilotPwr	= {	if (IfValidAnd( whType = "LargeInstantaneous" ) .AND. IfValidAnd( SourceDHWHeater:StdbyLossFrac > 0 ) .AND. IfValidAnd( whHeatSrc = "Fuel" ))
;													then	SourceDHWHeater:StdbyLossFrac		; SAC 11/10/15 - entered by user as pilot energy in Btuh
;													else  UNDEFINED  endif  }
;
;	; SAC 11/10/15 - added whParElec to model Elec Mini Tank elec use
;	"Set cseDHWHEATER:whParElec"
;			cseDHWHEATER:whParElec	= {	if (IfValidAnd( SourceDHWHeater:TankCat = "Instantaneous" ) .OR. IfValidAnd( SourceDHWHeater:TankCat = "Commercial Instantaneous (TE)" ) .AND. IfValidAnd( SourceDHWHeater:ElecMiniTank > 0 ) .AND.
;														 IfValidAnd( SourceDHWHeater:ElecMiniTankPwr > 0 ) .AND. IfValidAnd( SourceDHWHeater:HtPumpDisp = 0 ))
;													then  SourceDHWHeater:ElecMiniTankPwr  else  UNDEFINED  endif  }

	"Set cseDHWHEATER:whElecMtr"		cseDHWHEATER:whElecMtr		= {	if (IfValidAnd( whParElec > 0 )) then  Proj:CSE_ElecMETER  else  UNCHANGED  endif  }

; SAC 3/19/16 - DHW input generation for new ASHP detailed model   ; SAC 8/15/17 - updated mapping w/ latest CSE ASHP options in Res  ; SAC 8/17/17 - revise logic to ensure whASHPType set based on AirSrcHtPumpType  ; SAC 03/02/21
; MFAM Incompat
;	"Set cseDHWHEATER:whASHPType"		cseDHWHEATER:whASHPType		= {	if (SourceDHWHeater:ElementTypeNum != 5) then  UNDEFINED
;																							else if (IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEARtd > 0.5 )==0 .AND.
;                                                                              IfValidAnd( SourceDHWHeater:HPWHCommProd        > 0.5 )==0) then  "Generic"
;																							else if (IfValidAnd( SourceDHWHeater:AirSrcHtPumpType != "- select HPWH type -" ))
;																							then	SourceDHWHeater:AirSrcHtPumpType
;																							else  UNDEFINED  endif endif endif  }
;
;   ; SAC 6/21/18 - updated InputRating property name to InputRatingSim to accommodate InputRating being ignored for most heater types (Res tic #940)
;   ; increased min whResHtPwr* to 0.1 (consistent w/ CSE) - SAC 09/04/20
;	"Set cseDHWHEATER:whResHtPwr"		cseDHWHEATER:whResHtPwr		= {	if (SourceDHWHeater:ElementTypeNum != 0 .OR. IfValidAnd( SourceDHWHeater:TankZnDisp > 0 )==0 .OR.
;																								 IfValidAnd( SourceDHWHeater:InpRatingElecSim >= 0.1 )==0) then  UNDEFINED
;																							else	SourceDHWHeater:InpRatingElecSim  endif  }
;
;;	"Set cseDHWHEATER:whZone"			cseDHWHEATER:whZone			= {	if (SourceDHWHeater:TankZnDisp < 1 .OR.
;;																								 IfValidAnd( SourceDHWHeater:TankZn = "Outside or in Exterior Closet" ) .OR.
;;																								 LocalCompAssigned( SourceDHWHeater:TankZone ) < 1) then  UNDEFINED
;;																							else if (LocalCompAssigned( SourceDHWHeater:TankZone:CSE_ZONE ) < 1) then  UNDEFINED
;;																							else	SourceDHWHeater:TankZone:CSE_ZONE  endif endif  }
;	"Set cseDHWHEATER:whTEx_x"			cseDHWHEATER:whTEx_x			= {	if (IfValidAnd( SourceDHWHeater:TankZnDisp > 0 )==0 .OR.
;																									LocalStatus( SourceDHWHeater:TankZn ) < 1) then  UNDEFINED
;																						;		 LocalCompAssigned( whZone ) > 0) then  UNDEFINED
;																							else	switch ( SourceDHWHeater:TankZn )
;																										case "Conditioned"                   :  "70" 
;																										case "Unconditioned"                 :  "($tDbO + 70) / 2"
;																										case "Outside or in Exterior Closet" :  "$tDbO"
;																										default :  UNDEFINED
;																									endswitch  endif  }
;;	"Set cseDHWHEATER:whASHPSrcZn"	cseDHWHEATER:whASHPSrcZn	= {	if (SourceDHWHeater:ElementTypeNum != 5 .OR.
;;																								 (IfValidAnd( SourceDHWHeater:AirSrcHtPumpType != "- select HPWH type -" )==0 .AND. SourceDHWHeater:HtPumpWtrHtrNEEARtd > 0.5) .OR.
;;																								 IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .OR.
;;																								 IfValidAnd( SourceDHWHeater:ASHPTSrcOutside > 0 ) .OR.
;;																								 LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone ) < 1) then  UNDEFINED
;;																							else if (LocalCompAssigned( SourceDHWHeater:ASHPTSrcZone:CSE_ZONE ) < 1) then  UNDEFINED
;;																							else	SourceDHWHeater:ASHPTSrcZone:CSE_ZONE  endif endif  }
;	"Set cseDHWHEATER:whASHPSrcT_x"	cseDHWHEATER:whASHPSrcT_x	=     ; SAC 3/12/20 (Colmac)     ; SAC 7/1/20  ; SAC 03/02/21
;      {  if (IfValidAnd( SourceDHWHeater:IsCentralHPWH > 0 ) .AND.
;             EnumValue( SourceDHWHeater:AirSrcHtPumpTempSrc ) > 0)
;         then  switch (SourceDHWHeater:AirSrcHtPumpTempSrc)
;                  case  "Outside"            :  "$tDbO"
;                  case  "Unconditioned Zone" :  "($tDbO + 70) / 2"
;                  case  "Conditioned Zone"   :  "70"
;                  default :  UNDEFINED
;               endswitch
;         else if ( SourceDHWHeater:ElementType = "Heat Pump" .AND.
;                   ( ( IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEARtd > 0 ) .AND.
;                       ( EnumValue( SourceDHWHeater:HPWHBrand ) > 0  .OR.
;                         EnumValue( SourceDHWHeater:CentralHPWHCprsrType ) > 0 ) ) .OR.
;                     ( IfValidAnd( SourceDHWHeater:HPWHCommProd > 0 ) .AND.
;                       EnumValue( SourceDHWHeater:HPWHCommModel ) > 1 ) ) )
;         then  switch ( SourceDHWHeater:CprsrZn )
;                  case "Conditioned"                   :  "70" 
;                  case "Unconditioned"                 :  "($tDbO + 70) / 2"
;                  case "Outside or in Exterior Closet" :  "$tDbO"
;                  default :  UNDEFINED
;               endswitch
;         else  UNDEFINED  endif endif  }
																	; was:				if (SourceDHWHeater:ElementTypeNum != 5 .OR.
																	;							 (IfValidAnd( SourceDHWHeater:AirSrcHtPumpType != "- select HPWH type -" )==0 .AND.
																	;							  IfValidAnd( SourceDHWHeater:HtPumpWtrHtrNEEARtd > 0.5 )))
																	;						then	UNDEFINED
                                                   ;                  else if (IfValidAnd( SourceDHWHeater:CprsrZnDisp = 1 ))
																	;						then	switch ( SourceDHWHeater:CprsrZn )
																	;									case "Conditioned"                   :  "70" 
																	;									case "Unconditioned"                 :  "($tDbO + 70) / 2"
																	;									case "Outside or in Exterior Closet" :  "$tDbO"
																	;									default :  UNDEFINED
																	;								endswitch
																	;						else  UNDEFINED  endif endif  }
																					;			 IfValidAnd( SourceDHWHeater:ASHPSplit < 1 ) .OR.
																					;			 LocalCompAssigned( whASHPSrcZn ) > 0) then  UNDEFINED
																					;		else	"$tDbO"  endif  }

; SAC 8/6/18 - holding off on port of DHW heater standby loss multiplier (and corresponding cseDHWHEATER:whUAMult - for simulating insulation blanket on HPWHs)
;   "Set cseDHWHEATER:whUAMult"  ; SAC 10/18/17
;      cseDHWHEATER:whUAMult  = {
;         if (LocalStatus( SourceDHWHeater:StandbyLossMult ) < 1 .OR. IfValidAnd( SourceDHWHeater:StandbyLossMult = 1 )) then  UNDEFINED
;         else if ((SourceDHWHeater:HeaterElementType == 5 .OR. (SourceDHWHeater:HeaterElementType == 0 .AND. SourceDHWHeater:ShowTankLocation > 0.5)) .AND.
;                  Proj:EnergyCodeYearNum >= 2019)
;         then  SourceDHWHeater:StandbyLossMult
;         else  UNDEFINED  endif endif  }

   "Set cseDHWHEATER:whXBUEndUse to 'User2' for ALL types"   cseDHWHEATER:whXBUEndUse  =  ;  {  "User2"  }   ; SAC 1/24/19
      {  if (Proj:EngyCodeYearNum >= 2019) then  "User2"
         else  UNDEFINED  endif  }   ; SAC 1/8/19   / SAC 4/29/19 - added logic to prevent specification for PRE-2019 analysis (where no whXBUEndUse proeprty exists yet in CSE)

; SAC 2/6/20 - removed CentralHPWHAutosize
;   "Set cseDHWHEATER:alter_whMult_x to facilitate autosizing of elec central DHW heater"     cseDHWHEATER:alter_whMult_x  =      ; SAC 1/10/20 (Com tic #3156)
;      {  if (IfValidAnd( SourceDHWHeater:CentralSysTypeVal = 2 ) .AND. IfValidAnd( SourceDHWSys:CentralHPWHAutosize > 0 ))
;	      then  Format( "NumCntrlWHtrs( %c%s%c)", 34, Parent( Name ), 34 )
;	      else  UNDEFINED  endif  }
; remove whVol alter
;   "Set cseDHWHEATER:alter_whVol_x to facilitate autosizing of elec central DHW heater"      cseDHWHEATER:alter_whVol_x  = 
;      {  if (LocalStatus( alter_whMult_x ) > 0)
;	      then  Format( "max( 80, @DHWSYS[ %c%s%c].drawMax / NumCntrlWHtrs( %c%s%c))", 34, Parent( Name ), 34,  34, Parent( Name ), 34 )
;	      else  UNDEFINED  endif  }

; LH - 170708 Debug Message - disable prior to release
; "Post Message Regarding Simulation Inputs" cseDHWHeater:Action = {
;   switch( SourceDHWHeater:HeaterType )
;   case  10 :  MessageBox( "Consumer Instantaneous (UEF) 
;                            whType = '%s'
;                            whHeatSrc = '%s'
;                            whEF = '%s'
;                            whEff = '%s'", 
;                            EnumString( whType ), EnumString( whHeatSrc ), whEF, whEff )
;   case  12 :  MessageBox( "Consumer Storage (UEF) 
;                            whType = '%s'
;                            whHeatSrc = '%s'
;                            whVol = '%.1f'
;                            whEF = '%.2f'", 
;                            EnumString( whType ), EnumString( whHeatSrc ), whVol, whEF )
;   case  14 :  MessageBox( "Residential-Duty Commercial Storage (UEF) 
;                            whType = '%s'
;                            whHeatSrc = '%s'
;                            whVol = '%.1f'
;                            whEff = '%f'", 
;                            EnumString( whType ), EnumString( whHeatSrc ), whVol, whEff )
;   case  15 :   MessageBox( "Residential-Duty Commercial Instantaneous (UEF)
;                            whType = '%s'
;                            whHeatSrc = '%s'
;                            whEff = '%f'", 
;                            EnumString( whType ), EnumString( whHeatSrc ), whEff )
;   default  : UNCHANGED
;   endswitch }


END


;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWTank_DHWHtr" 1 0 0 1
;*************************************************************************
;	"Set cseDHWTANK:SurfaceArea"
;			cseDHWTANK:SurfaceArea	= {	    DHWTankAreaCoefs:CoefE( "Fuel", SourceDHWHeater:ElementTypeNum, "TankType", SourceDHWHeater:TankType ) *
;													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceDHWHeater:ElementTypeNum, "TankType", SourceDHWHeater:TankType ) * pow( SourceDHWHeater:TankVolume, 0.33 ) ) + 
;													    DHWTankAreaCoefs:CoefG( "Fuel", SourceDHWHeater:ElementTypeNum, "TankType", SourceDHWHeater:TankType ) ) *
;													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceDHWHeater:ElementTypeNum, "TankType", SourceDHWHeater:TankType ) * pow( SourceDHWHeater:TankVolume, 0.33 ) ) + 
;													    DHWTankAreaCoefs:CoefG( "Fuel", SourceDHWHeater:ElementTypeNum, "TankType", SourceDHWHeater:TankType ) )  }
;	"Set cseDHWTANK:wtUA"
;			cseDHWTANK:wtUA			= {	if (IfValidAnd( SourceDHWHeater:ExtInsulRVal > 0 )==0 .AND. IfValidAnd( SourceDHWHeater:IntInsulRVal > 0 )==0) then  UNDEFINED
;													else	SurfaceArea / (ValidOr( SourceDHWHeater:ExtInsulRVal, 0 ) + ValidOr( SourceDHWHeater:IntInsulRVal, 0 ))
;													endif  }
; SAC 9/10/15 - replace specification of wtUA (above) with wtVol & wtInsulR
; MFAM Incompat
;	"Set cseDHWTANK:wtVol"			cseDHWTANK:wtVol			= {	if (IfValidAnd( SourceDHWHeater:TankVol >= 0 ))
;																					then  SourceDHWHeater:TankVol
;																					else	UNDEFINED  endif  }
;	; SAC 9/11/15 - define minimum wtInsulR as 12
;	"Set cseDHWTANK:wtInsulR"		cseDHWTANK:wtInsulR		= {	if (ValidOr( SourceDHWHeater:TankExtInsR, 0 ) + ValidOr( SourceDHWHeater:TankIntInsR, 0 ) > 12)
;																					then	ValidOr( SourceDHWHeater:TankExtInsR, 0 ) + ValidOr( SourceDHWHeater:TankIntInsR, 0 )
;																					else	12  endif  }
;	; SAC 9/11/15 - added rules for wtTEx, wtTTank & wtXLoss
;	"Set cseDHWTANK:wtTEx"  		cseDHWTANK:wtTEx  		= {	if (IfValidAnd( SourceDHWHeater:AmbCond = "Conditioned"   )) then    75     else  UNDEFINED  endif  }		; if Conditioned
;   ; SAC 1/10/20 - switched Uncond wtTEx_x from "$tDbO" to "($tDbO + 70) / 2" (Com tic #3156)
;	"Set cseDHWTANK:wtTEx_x"		cseDHWTANK:wtTEx_x		= {	if (IfValidAnd( SourceDHWHeater:AmbCond = "Unconditioned" )) then  "($tDbO + 70) / 2"  else  UNDEFINED  endif  }		; if Unconditioned
	"Set cseDHWTANK:wtTTank"		cseDHWTANK:wtTTank		= {	Parent( wsTUse )  }
	"Set cseDHWTANK:wtXLoss"		cseDHWTANK:wtXLoss		= {	61.4  }
END


;;*************************************************************************
;RULELIST "CSE_SimulationPrep_DHWHtr_HVACSys" 1 0 0 1
;;*************************************************************************
;	"Set cseDHWHEATER:whType"
;			cseDHWHEATER:whType		= {	switch ( SourceHVACSys:DHWTankType )
;														case  0 :	4		; "Boiler"    -> "LargeInstantaneous"
;														case  1 :	4		; "Indirect"  -> "LargeInstantaneous"
;														case  2 :	4	 	; "Large Instantaneous" 
;														case  3 :	;if (Proj:DHWCalcMethod = 2 .AND. SourceHVACSys:DHWHeaterElementType = 0)	; => "CSE (T24 match)" & Elec fuel
;																		;then	1				; kludge to simulate Elec Large storage as Elec Small Storage when DHW mode is "CSE (T24 match)"
;																		2		; "Large Storage"   
;													;	case  4 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Large Tankless' (4) to cseDHWHEATER:whType" ) 		; "Large Tankless" 
;														case  5 :	3		; "Small Instantaneous" 
;														case  6 :	1		; "Small Storage"     
;													;	case  7 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Unfired Storage Tank' (7) to cseDHWHEATER:whType" ) ; "Unfired Storage Tank" 
;														case  8 :	PostError( "Unable to translate HVACSys:DHWTankType = 'Electric Mini Tank' (8) to cseDHWHEATER:whType" ) 	; "Electric Mini Tank" 
;														default :	PostError( "Unable to translate HVACSys:DHWTankType = 'unrecognized' (%g) to cseDHWHEATER:whType", SourceHVACSys:DHWTankType )
;													endswitch  }
;	"Set cseDHWHEATER:whHeatSrc"
;			cseDHWHEATER:whHeatSrc	= {	switch ( SourceHVACSys:DHWHeaterElementType )
;														case  0 :	2		; "Electric Resistance"   
;														case  1 :	1		; "Natural Gas"   -> Fuel
;														case  2 :	1		; "Propane"       -> Fuel 
;														case  3 :	3		; "Heat Pump"     -> ASHP
;														case  4 :	1		; "Oil"           -> Fuel
;														default :	PostError( "Unable to translate SourceHVACSys:DHWHeaterElementType = 'unrecognized' (%g) to cseDHWHEATER:whHeatSrc", SourceHVACSys:DHWHeaterElementType )
;													endswitch  }
;;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
;	"Set cseDHWHEATER:whFuelMtr"
;			cseDHWHEATER:whFuelMtr	= {	switch ( SourceHVACSys:DHWHeaterElementType )
;														case  0 :	UNDEFINED		; "Electric Resistance"   
;														case  1 :	if (GlobalCompAssigned( Proj:CSE_NatGasMETER )) then		Proj:CSE_NatGasMETER			; "Natural Gas" 
;																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Natural Gas' (1) but Proj:CSE_NatGasMETER not defined.", Name )  endif
;														case  2 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Propane"   
;																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Propane' (2) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
;														case  3 :	UNDEFINED		; "Heat Pump" 
;														case  4 :	if (GlobalCompAssigned( Proj:CSE_OtherFuelMETER )) then	Proj:CSE_OtherFuelMETER		; "Oil" 
;																		else	PostError( "Unable to set cseDHWHEATER '%s' whFuelMtr - HVACSys:DHWHeaterElementType = 'Oil' (4) but Proj:CSE_OtherFuelMETER not defined.", Name )  endif
;														default :	UNDEFINED
;													endswitch  }
;
;	"Set cseDHWHEATER:whVol"			; SAC 9/10/15
;			cseDHWHEATER:whVol	= {	if ((IfValidAnd( SourceHVACSys:DHWTankType = 3 )==0 .AND. IfValidAnd( SourceHVACSys:DHWTankType = 6 )==0) .OR. IfValidAnd( SourceHVACSys:DHWTankVolume >= 0 )==0) then  UNDEFINED
;												else  SourceHVACSys:DHWTankVolume  endif  }
;
;	"Set cseDHWHEATER:whEF"
;			cseDHWHEATER:whEF		= {	if (IfValidAnd( SourceHVACSys:DHWEnergyFactor > 0 ) .AND.
;													(IfValidAnd( whType = 1 ) .OR. IfValidAnd( whType = 3 )))		; SAC 8/21/15 - only for small instantaneous & storage
;												then  SourceHVACSys:DHWEnergyFactor  else  UNDEFINED  endif  }
;	"Set cseDHWHEATER:whEff"
;			cseDHWHEATER:whEff	= {	if (IfValidAnd( SourceHVACSys:DHWEnergyFactor > 0 ) .AND.
;													(IfValidAnd( whType = 2 ) .OR. IfValidAnd( whType = 4 )))		; SAC 8/21/15 - only for large instantaneous & storage
;												then  SourceHVACSys:DHWEnergyFactor  else  UNDEFINED  endif  }
;	"Set cseDHWHEATER:whHPAF"
;			cseDHWHEATER:whHPAF	= {	if (IfValidAnd( whType = 1 ) .AND. IfValidAnd( whHeatSrc = 3 ))		; SAC 8/21/15 - only for small storage, ASHP
;												then  CAClimateZoneDHWASHPAdj:HPAdj( "ClimateZone", Proj:CliZnNum )  else  UNDEFINED  endif  }
;	"Set cseDHWHEATER:whSBL"
;			cseDHWHEATER:whSBL	= {	if (IfValidAnd( SourceHVACSys:DHWStandbyLossFrac > 0 ) .AND. IfValidAnd( SourceHVACSys:DHWStandbyLossFrac < 1 ) .AND.
;													 IfValidAnd( SourceHVACSys:DHWTankVolume > 0 ) .AND. IfValidAnd( whType = 2 ))		; SAC 8/21/15 - only for large storage		; SAC 9/8/15 - revised to be based on TankVolume
;												then  SourceHVACSys:DHWStandbyLossFrac * 8.25 * SourceHVACSys:DHWTankVolume * 70  else  UNDEFINED  endif  }
;									;				 IfValidAnd( SourceHVACSys:DHWInputRating > 0 ) .AND. IfValidAnd( SourceHVACSys:DHWTankType = 3 ))		; SAC 8/21/15 - only for large storage
;									;			then  SourceHVACSys:DHWInputRating * SourceHVACSys:DHWStandbyLossFrac  else  UNDEFINED  endif  }
;
;   "Set cseDHWHEATER:whXBUEndUse to 'User2' for ALL types"   cseDHWHEATER:whXBUEndUse  = {  "User2"  }   ; SAC 1/24/19
;END
;
;;*************************************************************************
;RULELIST "CSE_SimulationPrep_DHWTank_HVACSys" 1 0 0 1
;;*************************************************************************
;	"Set cseDHWTANK:SurfaceArea"
;			cseDHWTANK:SurfaceArea	= {	    DHWTankAreaCoefs:CoefE( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) *
;													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) * pow( SourceHVACSys:DHWTankVolume, 0.33 ) ) + 
;													    DHWTankAreaCoefs:CoefG( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) ) *
;													( ( DHWTankAreaCoefs:CoefF( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) * pow( SourceHVACSys:DHWTankVolume, 0.33 ) ) + 
;													    DHWTankAreaCoefs:CoefG( "Fuel", SourceHVACSys:DHWHeaterElementType, "TankType", SourceHVACSys:DHWTankType ) )  }
;;	"Set cseDHWTANK:wtUA"
;;			cseDHWTANK:wtUA			= {	if (IfValidAnd( SourceHVACSys:DHWExtInsulRVal > 0 )==0 .AND. IfValidAnd( SourceHVACSys:DHWIntInsulRVal > 0 )==0) then  UNDEFINED
;;													else	SurfaceArea / (ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 ))
;;													endif  }
;; SAC 9/10/15 - replace specification of wtUA (above) with wtVol & wtInsulR
;	"Set cseDHWTANK:wtVol"			cseDHWTANK:wtVol			= {	if (IfValidAnd( SourceHVACSys:DHWTankVolume >= 0 ))
;																					then  SourceHVACSys:DHWTankVolume
;																					else	UNDEFINED  endif  }
;	; SAC 9/11/15 - define minimum wtInsulR as 12
;	"Set cseDHWTANK:wtInsulR"		cseDHWTANK:wtInsulR		= {	if (ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 ) > 12)
;																					then	ValidOr( SourceHVACSys:DHWExtInsulRVal, 0 ) + ValidOr( SourceHVACSys:DHWIntInsulRVal, 0 )
;																					else	12  endif  }
;	; SAC 9/11/15 - added rules for wtTEx, wtTTank & wtXLoss
;	"Set cseDHWTANK:wtTEx"  		cseDHWTANK:wtTEx  		= {	if (IfValidAnd( SourceHVACSys:DHWAmbientCond = -1 )) then    75     else  UNDEFINED  endif  }		; if Conditioned
;	"Set cseDHWTANK:wtTEx_x"		cseDHWTANK:wtTEx_x		= {	if (IfValidAnd( SourceHVACSys:DHWAmbientCond =  1 )) then  "$tDbO"  else  UNDEFINED  endif  }		; if Unconditioned
;	"Set cseDHWTANK:wtTTank"		cseDHWTANK:wtTTank		= {	Parent( wsTUse )  }
;	"Set cseDHWTANK:wtXLoss"		cseDHWTANK:wtXLoss		= {	61.4  }
;END

; SAC 12/31/15 - DHW input generation kludge to setup CSE DHW inputs for HVACSys-based AirToWater heat pumps
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWHtr_AWHP" 1 0 0 1
;*************************************************************************
	"Set cseDHWHEATER:whType"			cseDHWHEATER:whType		= {	"SmallStorage"	}		; "Small Storage"     
	"Set cseDHWHEATER:whHeatSrc"		cseDHWHEATER:whHeatSrc	= {	"ASHP"	}		; ASHP
;       "whElecMtr",         BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseMETER",    0, "",    3201, "Electric use meter"   --  allow to default to parent meter
;	"Set cseDHWHEATER:whFuelMtr"		cseDHWHEATER:whFuelMtr	= {	
;	"Set cseDHWHEATER:whVol"			cseDHWHEATER:whVol		= {	
;	"Set cseDHWHEATER:whEF"				cseDHWHEATER:whEF			= {	
;	"Set cseDHWHEATER:whEff"			cseDHWHEATER:whEff		= {	
; whHPAF removed from CSE by CB - SAC 2/2/20
;	"Set cseDHWHEATER:whHPAF"			cseDHWHEATER:whHPAF		= {	1  }
;	"Set cseDHWHEATER:whSBL"			cseDHWHEATER:whSBL		= {	
	"Set cseDHWHEATER:whLDEF"			cseDHWHEATER:whLDEF		= {	3.4  }
   "Set cseDHWHEATER:whXBUEndUse to 'User2' for ALL types"   cseDHWHEATER:whXBUEndUse  =   ; {  "User2"  }   ; SAC 1/24/19
      {  if (Proj:EngyCodeYearNum >= 2019) then  "User2"
         else  UNDEFINED  endif  }   ; SAC 1/8/19   / SAC 4/29/19 - added logic to prevent specification for PRE-2019 analysis (where no whXBUEndUse proeprty exists yet in CSE)
END


;*************************************************************************          ; SAC 7/1/20
RULELIST "CSE_SimulationPrep_DHWLoopHtr_DHWSys" 1 0 0 1
;*************************************************************************
; MFAM Incompat
;   "Set cseDHWLOOPHEATER:whType"       cseDHWLOOPHEATER:whType =
;      {  if (EnumValue( SourceDHWLoopTankSys:CentralHPWHLpTankType ) == 10)   ; Large HPWH/Compressor    - SAC 03/09/21
;         then  6     ; BuiltUp
;         else  1     ; Small Storage
;         endif  }
;   "Set cseDHWLOOPHEATER:whHeatSrc"    cseDHWLOOPHEATER:whHeatSrc =
;      {  if (EnumValue( SourceDHWLoopTankSys:CentralHPWHLpTankType ) == 1)   ; Electric Resistance
;         then  5     ; ResistanceX
;         else  4     ; ASHPX
;         endif  }
;   "Set cseDHWLOOPHEATER:whASHPType"   cseDHWLOOPHEATER:whASHPType =
;      {  if (EnumValue( whHeatSrc ) != 4) then  UNDEFINED
;         else if (EnumValue( SourceDHWLoopTankSys:CentralHPWHLpTankAirSrcHtPumpType ) > 0)
;         then  SourceDHWLoopTankSys:CentralHPWHLpTankAirSrcHtPumpType
;         else  UNDEFINED  endif endif  }

   "Set cseDHWLOOPHEATER:whEF"         cseDHWLOOPHEATER:whEF =
      {  if (EnumValue( whType ) == 1 .AND. EnumValue( whHeatSrc ) == 5)     ; Small Storge / ResistanceX
         then  0.97  else  UNDEFINED  endif  }
; MFAM Incompat
;   "Set cseDHWLOOPHEATER:whMult"       cseDHWLOOPHEATER:whMult       = {  SourceDHWLoopTankSys:CentralHPWHLpTankCprsrCnt  }
;
;   ; prevent output of whVol OR whTankCount for NEEA HPWHs - SAC 09/04/20
;   "Set cseDHWLOOPHEATER:whVol"        cseDHWLOOPHEATER:whVol        =
;      {  if (SourceDHWLoopTankSys:CentralHPWHLpTankType == "NEEA HPWH" .OR.
;             SourceDHWLoopTankSys:CentralHPWHLpTankType == "Commercial HPWH") then  UNDEFINED
;         else  SourceDHWLoopTankSys:CentralHPWHLpTankVol     / SourceDHWLoopTankSys:CentralHPWHLpTankCprsrCnt
;         endif  }
;   "Set cseDHWLOOPHEATER:whTankCount"  cseDHWLOOPHEATER:whTankCount  =
;      {  if (SourceDHWLoopTankSys:CentralHPWHLpTankType == "NEEA HPWH" .OR.
;             SourceDHWLoopTankSys:CentralHPWHLpTankType == "Commercial HPWH") then  UNDEFINED
;         else  ValidOr( SourceDHWLoopTankSys:CentralHPWHLpTankCnt, 1 ) / SourceDHWLoopTankSys:CentralHPWHLpTankCprsrCnt
;         endif  }
;   "Set cseDHWLOOPHEATER:whInsulR"     cseDHWLOOPHEATER:whInsulR     =
;      {  if (IfValidAnd( SourceDHWLoopTankSys:CentralHPWHLpTankRVal > 0 )==0 .OR.
;             SourceDHWLoopTankSys:CentralHPWHLpTankType == "NEEA HPWH" .OR.
;             SourceDHWLoopTankSys:CentralHPWHLpTankType == "Commercial HPWH") then  UNDEFINED
;         else            SourceDHWLoopTankSys:CentralHPWHLpTankRVal    endif  }

   "Set cseDHWLOOPHEATER:whReshtPwr"   cseDHWLOOPHEATER:whReshtPwr   =     ; SAC 5/28/20 - from today's DHW dev team call   ; SAC 6/1/20 - revised to prevent for BuiltUp ASHPX   ; min whVol - SAC 09/04/20
      {  if (IfValidAnd( whVol >= 0.001 )==0 .OR. (EnumValue( whType ) == 6 .AND. EnumValue( whHeatSrc ) == 4)) then  UNDEFINED   ; BuiltUp / ASHPX
         else  1000 * whVol / 10  endif  }
   "Set cseDHWLOOPHEATER:whReshtPwr2"  cseDHWLOOPHEATER:whReshtPwr2  = {  whReshtPwr  }

;   ; SAC 11/18/19
;   "Set cseDHWLOOPHEATER:whZone"       cseDHWLOOPHEATER:whZone       =
;      {  if (IfValidAnd( SourceDHWLoopTankSys:CentralHPWHLpTankLctn = 1 ) .OR.
;             LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankZone ) < 1) then  UNDEFINED
;         else if (LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankZone:CSE_ZONE ) < 1) then  UNDEFINED
;         else   SourceDHWLoopTankSys:CHPWHLoopTankZone:CSE_ZONE
;         endif endif  }
   ; SAC 1/4/20 - added distinction between TankOutside ($tDbO) & zone unassigned (uncond => ($tDbO + 70) / 2) (tic #862)
; MFAM Incompat
;   "Set cseDHWLOOPHEATER:whTEx_x"      cseDHWLOOPHEATER:whTEx_x      =
;      {  switch (EnumValue( SourceDHWLoopTankSys:CentralHPWHLpTankLctn ))
;            case  1 :  "$tDbO"               ; "Outside"           
;            case  2 :  "($tDbO + 70) / 2"    ; "Unconditioned Zone"
;            case  3 :  "70"                  ; "Conditioned Zone"  
;            default :  UNDEFINED
;         endswitch  }
;
;;   "Set cseDHWLOOPHEATER:whASHPSrcZn"  cseDHWLOOPHEATER:whASHPSrcZn  =        ; SAC 6/3/20
;;      {  if (IfValidAnd( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirLoc = 1 ) .OR.
;;             LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirZone ) < 1) then  UNDEFINED
;;         else if (LocalCompAssigned( SourceDHWLoopTankSys:CHPWHLoopTankSrcAirZone:CSE_ZONE ) < 1) then  UNDEFINED
;;         else   SourceDHWLoopTankSys:CHPWHLoopTankSrcAirZone:CSE_ZONE
;;         endif endif  }
;   "Set cseDHWLOOPHEATER:whASHPSrcT_x" cseDHWLOOPHEATER:whASHPSrcT_x =        ; SAC 6/3/20
;      {  switch (EnumValue( SourceDHWLoopTankSys:CentralHPWHLpTankAirSrc ))
;            case  1 :  "$tDbO"               ; "Outside"           
;            case  2 :  "($tDbO + 70) / 2"    ; "Unconditioned Zone"
;            case  3 :  "70"                  ; "Conditioned Zone"  
;            default :  UNDEFINED
;         endswitch  }

   "Set cseDHWLOOPHEATER:whXBUEndUse"  cseDHWLOOPHEATER:whXBUEndUse      = {   "User2"  }
END

;*************************************************************************          ; SAC 1/10/20 (Com tic #3156)
RULELIST "CSE_SimulationPrep_DHWLoopHtr_DHWHtr" 1 0 0 1
;*************************************************************************
	"Set cseDHWLOOPHEATER:whType"
			cseDHWLOOPHEATER:whType		= {	"SmallStorage"  }   ; Small Storage
	"Set cseDHWLOOPHEATER:whHeatSrc"
			cseDHWLOOPHEATER:whHeatSrc	= {	"ResistanceX"	}   ; ResistanceX

; MFAM Incompat
;	"Set cseDHWLOOPHEATER:whVol"   cseDHWLOOPHEATER:whVol	= {	SourceResLpTankHtr:whVol  }
;	"Set cseDHWLOOPHEATER:whEF"  cseDHWLOOPHEATER:whEF		= {	SourceResLpTankHtr:whEF   }
;   ; added min whResHtPwr* to 0.1 (consistent w/ CSE) - SAC 09/04/20
;	"Set cseDHWLOOPHEATER:whReshtPwr"   cseDHWLOOPHEATER:whReshtPwr	=
;      {	if (IfValidAnd( SourceResLpTankHtr:whReshtPwr >= 0.1 )) then  SourceResLpTankHtr:whReshtPwr  else  UNDEFINED  endif  }
;
;;   ; SAC 11/18/19
;;	"Set cseDHWLOOPHEATER:whZone"	      cseDHWLOOPHEATER:whZone			= {	if (IfValidAnd( SourceResLpTankHtr:TankOutside > 0 ) .OR.
;;	                                                                            LocalCompAssigned( SourceResLpTankHtr:TankZone ) < 1) then  UNDEFINED
;;																							      else if (LocalCompAssigned( SourceResLpTankHtr:TankZone:CSE_ZONE ) < 1) then  UNDEFINED
;;																							      else	SourceResLpTankHtr:TankZone:CSE_ZONE
;;																							      endif endif  }
;;	; SAC 1/4/20 - added distinction between TankOutside ($tDbO) & zone unassigned (uncond => ($tDbO + 70) / 2) (tic #862)
;;	"Set cseDHWLOOPHEATER:whTEx_x"		cseDHWLOOPHEATER:whTEx_x	   = {	if (LocalCompAssigned( whZone ) > 0) then  UNDEFINED
;;      	                                                                  else if (IfValidAnd( SourceResLpTankHtr:TankOutside > 0 )) then  "$tDbO"
;;																							      else	"($tDbO + 70) / 2"  endif endif  }
;	"Set cseDHWLOOPHEATER:whTEx_x"	   cseDHWLOOPHEATER:whTEx_x		= {	switch ( SourceResLpTankHtr:TankZn )
;																										case "Conditioned"                   :  "70" 
;																										case "Unconditioned"                 :  "($tDbO + 70) / 2"
;																										case "Outside or in Exterior Closet" :  "$tDbO"
;																										default :  UNDEFINED
;																									endswitch  }

	"Set cseDHWLOOPHEATER:whXBUEndUse"  cseDHWLOOPHEATER:whXBUEndUse		= {	"User2"  }
END

; SAC 10/21/15 - added DHWLOOP
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoop" 1 0 0 1
;*************************************************************************
; SAC 8/3/16 - revised several rules to properly setup DHWLOOP for when SourceDHWSys:MFamDistType = "Multi-family: No loops or recirc pump"
;              => single no-flow loop, no pump, single loop segment w/ length of 0 and a regular/complete DHWLOOPBRANCH object
; MFAM Incompat
;   "Set cseDHWLOOP:wlMult"     cseDHWLOOP:wlMult    = {
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  1
;         else if (IfValidAnd( SourceDHWSys:LpCnt >= 1 ) .AND.
;                  IfValidAnd( SourceDHWSys:CentralSys = 1 ))
;         then  SourceDHWSys:LpCnt
;         else  UNDEFINED  endif endif  }
;   ; SAC 1/10/20 - modified logic for 'new' CSE central electric system model (Com tic #3156)
;   "Set cseDHWLOOP:wlFlow"     cseDHWLOOP:wlFlow    = {
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  0
;         else if (IfValidAnd( SourceDHWSys:NewCentralModel > 0 ) .AND.
;                  IfValidAnd( SourceDHWSys:NumDUsServed > 0 ))
;         then  0.17 * SourceDHWSys:NumDUsServed
;         else  6  endif endif  }
   "Set cseDHWLOOP:wlFUA"      cseDHWLOOP:wlFUA     = {  2.0  }

   ; based on Res ACm table B-3
; MFAM Incompat
;   "Set cseDHWLOOP:wlTIn1"     cseDHWLOOP:wlTIn1    = {
;         if (ParentStatus( SourceDHWSys:DistType ) < 1) then  UNDEFINED
;         else if (IfValidAnd( SourceDHWSys:NewCentralModel > 0 )) then  UNDEFINED    ; SAC 1/10/20 - prevent output for NewCentralElecModel (Com tic #3156)
;         else  switch ( SourceDHWSys:DistType )
;                     case "No loops or central system pump"  :  130      ; "Multi-family: No loops or recirc pump"
;                     case "No Control (continuous pumping)"  :  130      ; "No Control"
;                     case "Demand Control"                   :  130      ; "Multi-family: Recirculation demand control"
;         ;            case 8393664 :  130      ; "No Control with HERS verification"
;         ;            case 8394944 :  130      ; "Demand Control with HERS verification"
;                     default      :  UNDEFINED      ; others set via expression below
;               endswitch  endif endif  }
;   "Set cseDHWLOOP:wlTIn1_x"   cseDHWLOOP:wlTIn1_x  = {
;         if (ParentStatus( SourceDHWSys:DistType ) < 1) then  UNDEFINED
;         else if (SourceDHWSys:DistType == "Temperature modulation" )  ; ||   ; "Temperature modulation"
;      ;            SourceDHWSys:DistType == 8395200 )    ; "Temperature modulation with HERS verification"
;         then  "hourval( 120, 120, 120, 120, 120, 125, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 130, 125)"
;         else if (SourceDHWSys:DistType == "Temperature modulation and monitoring" )  ; ||   ; "Temperature modulation & monitoring"
;      ;            SourceDHWSys:DistType == 8395456 )    ; "Temperature modulation & monitoring with HERS verification"
;         then  "hourval( 115, 115, 115, 115, 115, 120, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 125, 120)"
;         else  UNDEFINED  endif endif endif  }
;
;   ; based on Res ACM table B-3
;   "Set cseDHWLOOP:wlRunF"     cseDHWLOOP:wlRunF    = {
;         if (ParentStatus( SourceDHWSys:DistType ) < 1) then  UNDEFINED
;         else  switch ( SourceDHWSys:DistType )
;                  case "Demand Control" :  0.2      ; "Multi-family: Recirculation demand control"
;            ;      case 8394944 :  0.2      ; "Demand Control with HERS verification"
;                  default      :  1.0      ; all others
;               endswitch  endif  }
;
;   ; SAC 10/28/15 - added DHWLOOPPUMP creation
;   "Create Child cseDHWLOOPPUMP"          cseDHWLOOP:ChildcseDHWLOOPPUMP            =     ; SAC 2/11/20 - added logic to trigger creation for either old and new Pump inputs (Res tic #862)
;      {  if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" ) .OR.
;             ( IfValidAnd( SourceDHWSys:NewCentralModel > 0 ) .AND.
;               IfValidAnd( SourceDHWSys:RecircPumpPwr > 0 )==0 ) .OR.
;             ( IfValidAnd( SourceDHWSys:NewCentralModel > 0 )==0 .AND.
;               ( IfValidAnd( SourceDHWSys:PumpBHP > 0 )==0 .OR.
;                 IfValidAnd( SourceDHWSys:PumpEff > 0 )==0 ) )) then  UNCHANGED
;         else   CreateComp( cseDHWLOOPPUMP, "dhwlppmp-" + ParentRef( SourceDHWSys:Name ) )  endif  }
;
;   "Set ChildcseDHWLOOPPUMP:wlpMult"      cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpMult    = {
;         UNDEFINED  }
;   "Set ChildcseDHWLOOPPUMP:wlpPwr"       cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpPwr     =     ; SAC 1/10/20 - use RecircPumpPwr for 'new' CSE central electric system model (Com tic #3156)
;      {  if (IfValidAnd( SourceDHWSys:NewCentralModel > 0 ))
;         then  SourceDHWSys:RecircPumpPwr
;         else  746 * SourceDHWSys:PumpBHP / SourceDHWSys:PumpEff
;         endif  }
   "Set ChildcseDHWLOOPPUMP:wlpElecMtr"   cseDHWLOOP:ChildcseDHWLOOPPUMP:wlpElecMtr = {
         Proj:CSE_ElecMETER  }

   ; SAC 10/22/15 - added DHWLOOPSEG creation
; MFAM Incompat
;   "Create Child cseDHWLOOPSEG-1"               cseDHWLOOP:ChildcseDHWLOOPSEGs[1]      = {   
;         CreateComp( cseDHWLOOPSEG, "dhwlpseg1-" + ParentRef( SourceDHWSys:Name ) )  }
;   "Set ChildcseDHWLOOPSEGs[1]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[1]:SegmentIndex  = {  1  }
;   "Create Child cseDHWLOOPSEG-2"               cseDHWLOOP:ChildcseDHWLOOPSEGs[2]      = {   
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  UNDEFINED
;         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg2-" + ParentRef( SourceDHWSys:Name ) )  endif  }
;   "Set ChildcseDHWLOOPSEGs[2]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[2]:SegmentIndex  = {  2  }
;   "Create Child cseDHWLOOPSEG-3"               cseDHWLOOP:ChildcseDHWLOOPSEGs[3]      = {   
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  UNDEFINED
;         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg3-" + ParentRef( SourceDHWSys:Name ) )  endif  }
;   "Set ChildcseDHWLOOPSEGs[3]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[3]:SegmentIndex  = {  3  }
;   "Create Child cseDHWLOOPSEG-4"               cseDHWLOOP:ChildcseDHWLOOPSEGs[4]      = {   
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  UNDEFINED
;         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg4-" + ParentRef( SourceDHWSys:Name ) )  endif  }
;   "Set ChildcseDHWLOOPSEGs[4]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[4]:SegmentIndex  = {  4  }
;   "Create Child cseDHWLOOPSEG-5"               cseDHWLOOP:ChildcseDHWLOOPSEGs[5]      = {   
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  UNDEFINED
;         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg5-" + ParentRef( SourceDHWSys:Name ) )  endif  }
;   "Set ChildcseDHWLOOPSEGs[5]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[5]:SegmentIndex  = {  5  }
;   "Create Child cseDHWLOOPSEG-6"               cseDHWLOOP:ChildcseDHWLOOPSEGs[6]      = {   
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  UNDEFINED
;         else  CreateComp( cseDHWLOOPSEG, "dhwlpseg6-" + ParentRef( SourceDHWSys:Name ) )  endif  }
   "Set ChildcseDHWLOOPSEGs[6]:SegmentIndex"    cseDHWLOOP:ChildcseDHWLOOPSEGs[6]:SegmentIndex  = {  6  }

   ; cseDHWLOOPSEG defaulting done all at once, not called for each individual 
   "Call subordinate rulelist to setup remaining cseDHWLOOPSEG properties"
            Proj:Action      = {   EvalRulelist( "CSE_SimulationPrep_DHWLoopSeg" )  }
END

; SAC 10/22/15 - added DHWLOOPSEG
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoopSeg" 1 0 0 1
;*************************************************************************
; SAC 8/3/16 - revised several rules to properly setup DHWLOOPSEG for when SourceDHWSys:MFamDistType = "Multi-family: No loops or recirc pump"
;              => single no-flow loop, no pump, single loop segment w/ length of 0 and a regular/complete DHWLOOPBRANCH object
   ; SegmentIndex must already set
   "Set cseDHWLOOPSEG:wgTy"
      cseDHWLOOPSEG:wgTy = {
         if (IfValidAnd( SegmentIndex > 3 ))
         then   2      ; demand
         else   1      ; supply
         endif  }
   ; based on Res ACM method WH-LOOPSZ
; MFAM Incompat
;   "Set cseDHWLOOPSEG:NUnitThisSeg"
;      cseDHWLOOPSEG:NUnitThisSeg = {
;         if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0 .OR. IfValidAnd( wlMult > 0 )==0)
;         then  -1  ; ERROR
;         else if (IfValidAnd( SegmentIndex < 4 )==0)
;         then  0      ; no NUnit... for segments 4-6
;         else if (IfValidAnd( SegmentIndex < 3 ))
;         then   SourceDHWSys:NumDUsServed / wlMult
;         else   SourceDHWSys:NumDUsServed / wlMult / 2
;         endif endif endif  }
;   "Set cseDHWLOOPSEG:wgSize"
;      cseDHWLOOPSEG:wgSize = {
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  2.0
;         else if (IfValidAnd( SegmentIndex > 3 ))
;         then   ; RETURN pipe segments
;               if (IfValidAnd( SourceDHWSys:SysStoryCnt > 4 ))
;               then   1.0
;               else   0.75
;               endif
;         else   ; SUPPLY pipe segments
;               if (IfValidAnd( NUnitThisSeg > 0 ))
;               then   CAResDHW_LoopPipeSize:PipeDiam( "CodeBase", Proj:StdsYr,
;                                                      "NUnit", NUnitThisSeg, "IsBranch", "No" )
;               else   UNDEFINED      ; error
;               endif
;         endif endif  }
;   ; based on Res ACM method WH-LOOPLEN
;; SAC 8/16/16 - no need for addiitonal Res rules to calculate # flrs served and avg flr height, since # flrs a user input and avg flr ht already calculated (minus plenums)
;   "Set cseDHWLOOPSEG:AvgDULen"
;      cseDHWLOOPSEG:AvgDULen = {
;         if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0) then  0      ; error
;         else   sqrt( ValidOr( SourceDHWSys:SysFlrArea, 0 ) / SourceDHWSys:NumDUsServed )
;         endif  }
;   "Set cseDHWLOOPSEG:wgLength"
;      cseDHWLOOPSEG:wgLength = {
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" )) then  0
;         else if (IfValidAnd( SegmentIndex = 1 ) .OR. IfValidAnd( SegmentIndex = 6 ))
;         then      8 + ( SourceDHWSys:AvgFlrHgt * ValidOr( SourceDHWSys:SysStoryCnt, 1 ) / 2 )
;         else   ; segment index not 1 or 6
;               if (  IfValidAnd( SourceDHWSys:NumDUsServed >  0 )==0 .OR. 
;                     IfValidAnd( SourceDHWSys:LpCnt        >= 1 )==0 .OR.
;                     IfValidAnd( SourceDHWSys:SysStoryCnt  >  0 )==0 ) then  UNDEFINED      ; error
;               else   AvgDULen * SourceDHWSys:NumDUsServed /
;                     (4 * SourceDHWSys:LpCnt * SourceDHWSys:SysStoryCnt)
;               endif
;         endif endif  }
;   "Set cseDHWLOOPSEG:wgInsulThk"
;      cseDHWLOOPSEG:wgInsulThk    = {   SourceDHWSys:LpPipeInsThkns  }
   "Set cseDHWLOOPSEG:wgInsulK"
      cseDHWLOOPSEG:wgInsulK      = {   0.02167  }
   "Set cseDHWLOOPSEG:wgFNoDraw"
      cseDHWLOOPSEG:wgFNoDraw     = {   if (IfValidAnd( SegmentIndex > 0 )==0) then  UNDEFINED
                                        else   switch ( SegmentIndex )
                                                 case  1 :  0.2
                                                 case  2 :  0.4
                                                 case  3 :  0.6
                                                 default :  1.0
                                              endswitch  endif  }
; MFAM Incompat
;   "Set cseDHWLOOPSEG:wgExT"
;      cseDHWLOOPSEG:wgExT    = {;   if (IfValidAnd( SourceDHWSys:RecircPipeLoc[1] >= 0 )==0) then  UNDEFINED
;                                ;   else  switch ( SourceDHWSys:RecircPipeLoc[1] )
;                                         switch ( SourceDHWSys:PipeLctn[1] )  
;                                            case  "Conditioned"      :  70		; Conditioned
;                                            case  "Semi-Conditioned" :  70		; Semi-Conditioned
;                                            default :  UNDEFINED
;                                         endswitch  }
;   "Set cseDHWLOOPSEG:wgExT_x"
;      cseDHWLOOPSEG:wgExT_x  = {;   if (IfValidAnd( SourceDHWSys:RecircPipeLoc[1] >= 0 )==0) then  UNDEFINED
;                                ;   else   switch ( SourceDHWSys:RecircPipeLoc[1] )
;                                         switch ( SourceDHWSys:PipeLctn[1] )
;                                            case  "Unconditioned" :  "$TdbO"            ; Unconditioned (outdoor)
;                                            case  "Underground"   :  "@Weather.tgrnd"   ; Underground (ground)
;                                            default :  UNDEFINED
;                                         endswitch  }
   "Set cseDHWLOOPSEG:wgExH"
      cseDHWLOOPSEG:wgExH    = {   1.5  }

   ; SAC 10/22/15 - added DHWLOOPSEG creation
   ; SAC 8/1/16 - modified to create branches for loop segs #2 & 3 (rather than only #1)
; MFAM Incompat
;   "Create Child cseDHWLOOPBRANCH"
;      cseDHWLOOPSEG:ChildcseDHWLOOPBRANCH = {
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" ) .AND. IfValidAnd( SegmentIndex = 1 ))
;         then  CreateComp( cseDHWLOOPBRANCH, "dhwlpbr1-" + Parent2Ref( SourceDHWSys:Name ) )
;         else if (IfValidAnd( SegmentIndex = 2 ))
;         then  CreateComp( cseDHWLOOPBRANCH, "dhwlpbr2-" + Parent2Ref( SourceDHWSys:Name ) )
;         else if (IfValidAnd( SegmentIndex = 3 ))
;         then  CreateComp( cseDHWLOOPBRANCH, "dhwlpbr3-" + Parent2Ref( SourceDHWSys:Name ) )
;         else  UNDEFINED  endif endif endif  }
   "Call subordinate rulelist to setup remaining cseDHWLOOPBRANCH properties (all at once, not by branch)"
      Proj:Action = {   EvalRulelist( "CSE_SimulationPrep_DHWLoopBranch" )  }
END

; SAC 10/22/15 - added DHWLOOPBRANCH
;*************************************************************************
RULELIST "CSE_SimulationPrep_DHWLoopBranch" 1 0 0 1
;*************************************************************************
; SAC 8/3/16 - revised several rules to properly setup DHWLOOPBRANCH for when SourceDHWSys:MFamDistType = "Multi-family: No loops or recirc pump"
;              => single no-flow loop, no pump, single loop segment w/ length of 0 and a regular/complete DHWLOOPBRANCH object
   ; based on Res ACM method WH-BRNU
; MFAM Incompat
;   "Set cseDHWLOOPBRANCH:NUnitThisBranch"   
;      cseDHWLOOPBRANCH:NUnitThisBranch = {
;         if (IfValidAnd( SourceDHWSys:SysStoryCnt > 0 )==0) then  -1  ; ERROR
;         else  max( (SourceDHWSys:SysStoryCnt / 2), 1 )  endif  }
;   ; based on Res ACM method WH-BRN
;   ; SAC 8/1/16 - revised expression based on loop segment branch fixes - replaced NUnitThisBranch in denominator w/ ()
;   "Set cseDHWLOOPBRANCH:wbMult"
;      cseDHWLOOPBRANCH:wbMult = {
;         if (IfValidAnd( SourceDHWSys:DistType = "No loops or central system pump" ) .AND. NUnitThisBranch > 0 .AND.
;             IfValidAnd( SourceDHWSys:NumDUsServed > 0 ))
;         then  SourceDHWSys:NumDUsServed /  NUnitThisBranch
;         else if (IfValidAnd( SourceDHWSys:NumDUsServed > 0 )==0 .OR. NUnitThisBranch <= 0 .OR.
;             IfValidAnd( SourceDHWSys:LpCnt > 0 )==0) then  UNDEFINED
;         else  SourceDHWSys:NumDUsServed / (NUnitThisBranch * SourceDHWSys:LpCnt * 2)  endif endif  }

   ; based on Res ACM method WH-BRSZ
   "Set cseDHWLOOPBRANCH:wbSize"
      cseDHWLOOPBRANCH:wbSize = {
         if (IfValidAnd( NUnitThisBranch > 0 ))
         then   CAResDHW_LoopPipeSize:PipeDiam( "CodeBase", Proj:StdsYr,
                                                "NUnit", NUnitThisBranch, "IsBranch", "Yes" )
         else   UNDEFINED      ; error
         endif  }
   ; based on Res ACM method WH-BRLEN
; MFAM Incompat
;   "Set cseDHWLOOPBRANCH:wbLength"
;      cseDHWLOOPBRANCH:wbLength = {
;         4 + ( SourceDHWSys:AvgFlrHgt * ValidOr( SourceDHWSys:SysStoryCnt, 1 ) / 2 )  }

   "Set cseDHWLOOPBRANCH:wbFlow"       cseDHWLOOPBRANCH:wbFlow       = {   2        }
; MFAM Incompat
;   "Set cseDHWLOOPBRANCH:wbInsulThk"   cseDHWLOOPBRANCH:wbInsulThk   = {   SourceDHWSys:LpPipeInsThkns  }
   "Set cseDHWLOOPBRANCH:wbInsulK"     cseDHWLOOPBRANCH:wbInsulK     = {   0.02167  }
   "Set cseDHWLOOPBRANCH:wbExH"        cseDHWLOOPBRANCH:wbExH        = {   1.5      }
   "Set cseDHWLOOPBRANCH:wbExT"        cseDHWLOOPBRANCH:wbExT        = {   70       }

   ;   wbFWaste is based on Res ACM method WH-BRWF
   ;      wbFWaste = Nwaste * SCHwaste * fVol
   ;      NWaste = 19.84 * exp( -0.544 * Nunit,b)               Nunit,b = Nfloor/2
   ;      SCHwaste per Table B-4
   ;      fVol = 1.4
   ;      So 
   "Set cseDHWLOOPBRANCH:wbFWaste_x"   cseDHWLOOPBRANCH:wbFWaste_x  = {   
      Format( "1.4 * 19.84 * exp( -0.544 * %g ) * hourval( 0.01, 0.02, 0.05, 0.22, 0.25, 0.22, 0.06, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01)", NUnitThisBranch )  }

END
;*************************************************************************


; SAC 12/18/18 - setup cseDHWSYS for HPWH Sizing run(s) (HPWHSIZE)
;*************************************************************************
RULELIST "CSE_DHWSystem_SetupHPWHSizingRun" 1 0 0 1
   "Store cseDHWSYS:wsFuelMtr"      cseDHWSYS:StoreWSFuelMtr   = {
         if (LocalStatus( wsFuelMtr ) < 1) then  UNDEFINED
         else  wsFuelMtr  endif  }
   "Store cseDHWSYS:wsFXHwMtr"      cseDHWSYS:StoreWSFXHwMtr   = {
         if (LocalStatus( wsFXHwMtr ) < 1) then  UNDEFINED
         else  wsFXHwMtr  endif  }
   "Store cseDHWSYS:wsWHHwMtr"      cseDHWSYS:StoreWSWHHwMtr   = {
         if (LocalStatus( wsWHHwMtr ) < 1) then  UNDEFINED
         else  wsWHHwMtr  endif  }
;   "Store cseDHWSYS:wsSSF"          cseDHWSYS:StoreWSSSF       = {     - SAC 1/3/19 - retain wsSSF input in sizing runs
;         if (LocalStatus( wsSSF   ) < 1) then  UNDEFINED
;         else  wsSSF    endif  }
;   "Store cseDHWSYS:wsSSF_x"        cseDHWSYS:StoreWSSSF_x     = {
;         if (LocalStatus( wsSSF_x ) < 1) then  UNDEFINED
;         else  wsSSF_x  endif  }

; MFAM Incompat
;   "Blast cseDHWSYS:wsFuelMtr (if necessary)"   cseDHWSYS:wsFuelMtr  = {
;         if (LocalStatus( wsFuelMtr ) < 1 .OR.
;             LocalCompAssigned( SourceDHWSys ) < 1) then  UNCHANGED
;         else if (IfValidAnd( SourceDHWSys:NumGasHtrs > 0 ))
;         then  UNCHANGED
;         else  UNDEFINED  endif endif  }
   "Blast cseDHWSYS:wsFXHwMtr"                  cseDHWSYS:wsFXHwMtr  = {
         if (LocalStatus( wsFXHwMtr ) < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
   "Blast cseDHWSYS:wsWHHwMtr"                  cseDHWSYS:wsWHHwMtr  = {
         if (LocalStatus( wsWHHwMtr ) < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
;   "Blast cseDHWSYS:wsSSF"                      cseDHWSYS:wsSSF      = {     - SAC 1/3/19 - retain wsSSF input in sizing runs
;         if (LocalStatus( wsSSF   ) < 1) then  UNCHANGED
;         else  UNDEFINED  endif  }
;   "Blast cseDHWSYS:wsSSF_x"                    cseDHWSYS:wsSSF_x    = {
;         if (LocalStatus( wsSSF_x ) < 1) then  UNCHANGED
;         else  UNDEFINED  endif  }

   "Store cseDHWSYS:wsSolarSys"     cseDHWSYS:StoreWSSolarSys  =           ; SAC 2/11/20 (Res tic #862)
      {  if (LocalStatus( wsSolarSys ) < 1 .OR.
             IfValidAnd( Proj:CSE_HPWHSizUseSSF > 0 )==0) then  UNDEFINED
         else  wsSolarSys  endif  }
   "Blast cseDHWSYS:wsSolarSys (if needed)"  cseDHWSYS:wsSolarSys  =
      {  if (LocalStatus( StoreWSSolarSys ) < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
; MFAM Incompat
;   "Set cseDHWSYS:wsSSF"      cseDHWSYS:wsSSF  =
;      {  if (LocalStatus( StoreWSSolarSys ) < 1 .OR. IfValidAnd( SourceDHWSys:AnnualSolFrac > 0 )==0) then  UNCHANGED
;         else  SourceDHWSys:AnnualSolFrac  endif  }
END
;*************************************************************************
RULELIST "CSE_DHWSystem_RestoreFollowingHPWHSizingRun" 1 0 0 1
   "Restore cseDHWSYS:wsFuelMtr"       cseDHWSYS:wsFuelMtr   = {
         if (LocalStatus( StoreWSFuelMtr ) < 1) then  UNDEFINED
         else  StoreWSFuelMtr  endif  }
   "Restore cseDHWSYS:wsFXHwMtr"       cseDHWSYS:wsFXHwMtr   = {
         if (LocalStatus( StoreWSFXHwMtr ) < 1) then  UNDEFINED
         else  StoreWSFXHwMtr  endif  }
   "Restore cseDHWSYS:wsWHHwMtr"       cseDHWSYS:wsWHHwMtr   = {
         if (LocalStatus( StoreWSWHHwMtr ) < 1) then  UNDEFINED
         else  StoreWSWHHwMtr  endif  }
;   "Restore cseDHWSYS:wsSSF"           cseDHWSYS:wsSSF       = {     - SAC 1/3/19 - retain wsSSF input in sizing runs
;         if (LocalStatus( StoreWSSSF   ) < 1) then  UNDEFINED
;         else  StoreWSSSF    endif  }
;   "Restore cseDHWSYS:wsSSF_x"         cseDHWSYS:wsSSF_x     = {
;         if (LocalStatus( StoreWSSSF_x ) < 1) then  UNDEFINED
;         else  StoreWSSSF_x  endif  }

   "Blast cseDHWSYS:wsSSF"             cseDHWSYS:wsSSF  =                  ; SAC 2/11/20 (Res tic #862)
      {  if (LocalStatus( StoreWSSolarSys ) < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
   "Restore cseDHWSYS:wsSolarSys"      cseDHWSYS:wsSolarSys  =
      {  if (LocalStatus( StoreWSSolarSys ) < 1) then  UNCHANGED
         else  StoreWSSolarSys  endif  }
END
;*************************************************************************

; SAC 12/11/18 - setup cseDHWHEATER for HPWH Sizing run(s) (HPWHSIZE)
;*************************************************************************
RULELIST "CSE_DHWHeater_SetupHPWHSizingRun" 1 0 0 1
;   "Store cseDHWHEATER:whZone"      cseDHWHEATER:StoreWHZone   = {
;         if (LocalStatus( whZone ) < 1) then  UNDEFINED
;         else  whZone  endif  }
   "Store cseDHWHEATER:whTEx_x"     cseDHWHEATER:StoreWHTEx_x  = {
         if (LocalStatus( whTEx_x ) < 1) then  UNDEFINED
         else  whTEx_x  endif  }
   "Store cseDHWHEATER:whMult"      cseDHWHEATER:StoreWHMult   = {  whMult  }

; MFAM Incompat
;   "Set cseDHWHEATER:whTEx_x for HPWH sizing run"  cseDHWHEATER:whTEx_x  = {
;         if (IfValidAnd( SourceDHWHeater:TankZnDisp > 0 )==0 .OR.
;             LocalStatus( SourceDHWHeater:TankZn ) < 1) then  UNDEFINED
;         else  switch ( SourceDHWHeater:TankZn )
;                  case "Conditioned"                   :  "70" 
;                  case "Unconditioned"                 :  "($tDbO + 70) / 2"
;                  case "Outside or in Exterior Closet" :  "$tDbO"
;                  default :  UNDEFINED
;               endswitch  endif  }
      ;   if (IfValidAnd( whZone:znModel = 3 ))   ; "CZM"
      ;   then  "70"
      ;   else  "$tDbO"  endif  }
;   "Blast cseDHWHEATER:whZone for HPWH sizing run"    cseDHWHEATER:whZone       = {  UNDEFINED   }
   "Set cseDHWHEATER:whMult_x for HPWH sizing run"    cseDHWHEATER:whMult_x     = {  Format( "%g * HPWHSIZE", whMult )  }
   "Blast cseDHWHEATER:whMult for HPWH sizing run"    cseDHWHEATER:whMult       = {  UNDEFINED   }
;   "Set cseDHWHEATER:whXBUEndUse for HPWH sizing run" cseDHWHEATER:whXBUEndUse  = {  "User2"     }
END
;*************************************************************************
RULELIST "CSE_DHWHeater_RestoreFollowingHPWHSizingRun" 1 0 0 1
;   "Restore cseDHWHEATER:whZone"      cseDHWHEATER:whZone   = {
;         if (LocalStatus( StoreWHZone ) < 1) then  UNDEFINED
;         else  StoreWHZone  endif  }
   "Restore cseDHWHEATER:whTEx_x"     cseDHWHEATER:whTEx_x  = {
         if (LocalStatus( StoreWHTEx_x ) < 1) then  UNDEFINED
         else  StoreWHTEx_x  endif  }

   "Blast cseDHWHEATER:whMult_x following HPWH sizing run"     cseDHWHEATER:whMult_x     = {  UNDEFINED  }
;   "Blast cseDHWHEATER:whXBUEndUse following HPWH sizing run"  cseDHWHEATER:whXBUEndUse  = {  UNDEFINED  }
   "Set cseDHWHEATER:whMult following HPWH sizing run"      cseDHWHEATER:whMult = {
         StoreWHMult * ValidOr( CentralWHMult, 1 )  }
END
;*************************************************************************

;************************************************************************* SAC 12/17/18 - rulelists for Proj-level HPWHSIZE prep and clean-up
RULELIST "CSE_Project_SetupHPWHSizingRun" 1 0 0 1
   "Create Proj:CSE_HPWHSizExport prior to performing HPWHSIZE run"
      Proj:CSE_HPWHSizExport  = {
         if (LocalCompAssigned( CSE_HPWHSizExport ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORT, "HPWH Sizing Export" )  endif  }
   "Set Proj:CSE_HPWHSizExport:exType  (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exType   = {  "MTR"      }
;   "Set Proj:CSE_HPWHSizExport:exFreq  (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exFreq   = {  "Year"     }
   "Set Proj:CSE_HPWHSizExport:exFreq  (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exFreq   = {  "HOUR"     }
   "Set Proj:CSE_HPWHSizExport:exMeter (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exMeter  = {  "MtrElec"  }
;   "Set Proj:CSE_HPWHSizExport:exBtuSf (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exBtuSf  = {  3413       }  ; kWh
   "Set Proj:CSE_HPWHSizExport:exBtuSf (for HPWHSIZE run)"   Proj:CSE_HPWHSizExport:exBtuSf  = {  1000       }  ; kBtu
	"Set Proj:CSE_HPWHSizExport:exDayBeg_x (for HPWHSIZE)"    Proj:CSE_HPWHSizExport:exDayBeg_x  = {  "Jan 1"   }
	"Set Proj:CSE_HPWHSizExport:exDayEnd_x (for HPWHSIZE)"    Proj:CSE_HPWHSizExport:exDayEnd_x  = {  "Dec 31"  }

   "Create Proj:CSE_HPWHSizReport prior to performing HPWHSIZE run"
      Proj:CSE_HPWHSizReport  = {
         if (LocalCompAssigned( CSE_HPWHSizReport ) > 0) then  UNCHANGED
         else  CreateComp( cseREPORT, "HPWH Sizing Report" )  endif  }
   "Set Proj:CSE_HPWHSizReport:rpType_x (for HPWHSIZE run)"  Proj:CSE_HPWHSizReport:rpType_x = {  "MTR"      }
   "Set Proj:CSE_HPWHSizReport:rpFreq  (for HPWHSIZE run)"   Proj:CSE_HPWHSizReport:rpFreq   = {  "MONTH"    }
   "Set Proj:CSE_HPWHSizReport:rpMeter (for HPWHSIZE run)"   Proj:CSE_HPWHSizReport:rpMeter  = {  "MtrElec"  }
   "Set Proj:CSE_HPWHSizReport:rpBtuSf (for HPWHSIZE run)"   Proj:CSE_HPWHSizReport:rpBtuSf  = {  3413       }
END
;*************************************************************************
RULELIST "CSE_Project_RestoreHPWHSizingRun" 1 0 0 1
   "Blast (if present) Proj:CSE_HPWHSizExport following HPWHSIZE run"
      Proj:CSE_HPWHSizExport  = {   if (LocalCompAssigned( CSE_HPWHSizExport ) < 1) then  UNCHANGED
                                    else  DeleteComp()  endif  }
   "Blast (if present) Proj:CSE_HPWHSizReport following HPWHSIZE run"
      Proj:CSE_HPWHSizReport  = {   if (LocalCompAssigned( CSE_HPWHSizReport ) < 1) then  UNCHANGED
                                    else  DeleteComp()  endif  }
END
;*************************************************************************


;************************************************************************* SAC 2/2/20 (StdSolarSys) (Com tic #3157)
RULELIST "CSE_DHWSolarSys_SetupSolarSysSizingRun" 1 0 0 1
   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult"
        Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult  =
            {  ValidOr( StdDHWSolarSysRef:StdDsgnCntFloat[1], 2 )  }
   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult"
        Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult  =
            {  ValidOr( StdDHWSolarSysRef:StdDsgnCntFloat[2], 10 )  }

   "Remove Proj:StdDHWSolarSysRef:cseDHWSOLARSYSRef:swTankVol"          ; SAC 2/19/20 - remove swTankVol to ensure that CSE can autosize it (needed when varying multipliers)
           Proj:StdDHWSolarSysRef:cseDHWSOLARSYSRef:swTankVol  = {  UNDEFINED  }

   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARSYSRef:CSEPreRunRequired"
        Proj:StdDHWSolarSysRef:cseDHWSOLARSYSRef:CSEPreRunRequired  = {  1  }
   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:CSEPreRunRequired"
        Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:CSEPreRunRequired  = {  1  }

   "Store for later restoration Proj:CSE_DHWPreRunReqd via CSE_DHWPreRunReqdsv"
      Proj:CSE_DHWPreRunReqdSv = {  CSE_DHWPreRunReqd  }
   "Toggle Proj:CSE_DHWPreRunReqd OFF"       Proj:CSE_DHWPreRunReqd  = {  0  }
   "Toggle Proj:CSE_DHWSolarPreRunReqd ON"   Proj:CSE_DHWSolarPreRunReqd  = {  1  }
END
;*************************************************************************
RULELIST "CSE_DHWSolarSys_RestoreFollowingSolarSysSizingRun" 1 0 0 1
   ; assumption - DHWSolarSys:StdDsgnSSFCalced[1-2] populated from sizing run source code
   "Set Proj:StdDHWSolarSysRef:RequiredSSF"
        Proj:StdDHWSolarSysRef:RequiredSSF  =
            {  if (Proj:CliZnNum < 10) 
               then  0.2  
               else  0.35  endif  }
   "Set Proj:StdDHWSolarSysRef:CntFlt"
        Proj:StdDHWSolarSysRef:CntFlt  =
   {  if (IfValidAnd( StdDHWSolarSysRef:StdDsgnSSFCalced[1] > 0 ) .AND.
          IfValidAnd( StdDHWSolarSysRef:StdDsgnSSFCalced[2] > 0 ))
      then  StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult +
            ( ( StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult - StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult ) *
              ( StdDHWSolarSysRef:RequiredSSF         - StdDHWSolarSysRef:StdDsgnSSFCalced[1] ) /
              ( StdDHWSolarSysRef:StdDsgnSSFCalced[2] - StdDHWSolarSysRef:StdDsgnSSFCalced[1] ) )
      else  StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult  endif  }
   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult"
        Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:scMult  =
            {  ValidOr( StdDHWSolarSysRef:CntFlt, 2 )  }
   "Set Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult"
        Proj:StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:alter_scMult  =
            {  UNDEFINED  }

   "Restore original Proj:CSE_DHWPreRunReqd (via CSE_DHWPreRunReqdsv)"
      Proj:CSE_DHWPreRunReqd = {  CSE_DHWPreRunReqdSv  }
   "Toggle Proj:CSE_DHWSolarPreRunReqd OFF"  Proj:CSE_DHWSolarPreRunReqd  = {  0  }

   "Delete Proj:CSE_SolarSysSizExport (and child ExportCols)"
      Proj:CSE_SolarSysSizExport  = {  DeleteComp()  }
; de-referencing the StdDHWSolarSysRef prevents us from identifiying which DHWSolarSys results to store as the official Std design - SAC 1/29/20
;   "DE-Reference Proj:StdDHWSolarSysRef"
;      Proj:StdDHWSolarSysRef  = {  UNDEFINED  }
END
;*************************************************************************

;************************************************************************* SAC 2/2/20 (StdSolarSys) (Com tic #3157)
RULELIST "CSE_Project_SetupSolarSysSizingExport" 1 0 0 1
   "Setup Proj:StdDHWSolarSysRef counts for sizing run"     Proj:Action  =
      {  EvalRulelist( "CSE_DHWSolarSys_SetupSolarSysSizingRun" )  }

   "Create Proj:CSE_SolarSysSizExport to export data to CSV for use in DHWSolarSys sizing"
      Proj:CSE_SolarSysSizExport  = {
         if (LocalCompAssigned( CSE_SolarSysSizExport ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORT, "DHWSolarSys Sizing Export" )  endif  }
   "Set Proj:CSE_SolarSysSizExport:exType"   Proj:CSE_SolarSysSizExport:exType    = {  "UDT"      }
   "Set Proj:CSE_SolarSysSizExport:exFreq"   Proj:CSE_SolarSysSizExport:exFreq    = {  "YEAR"     }
   "Set Proj:CSE_SolarSysSizExport:exHeader" Proj:CSE_SolarSysSizExport:exHeader  = {  "YESIFNEW"  }
   "Set Proj:CSE_SolarSysSizExport:exFooter" Proj:CSE_SolarSysSizExport:exFooter  = {  "NO"     }

   "Create Proj:CSE_SolarSysSizExpCol[1] - timestamp"     Proj:CSE_SolarSysSizExpCol[1]  = {
         if (LocalCompAssigned( CSE_SolarSysSizExpCol[1] ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-1" )  endif  }
   "Set Proj:CSE_SolarSysSizExpCol[1]:Parent"      Proj:CSE_SolarSysSizExpCol[1]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:CSE_SolarSysSizExpCol[1]:colhead"     Proj:CSE_SolarSysSizExpCol[1]:colhead   = {  "TimeStamp"  }
   "Set Proj:CSE_SolarSysSizExpCol[1]:colVal_x"    Proj:CSE_SolarSysSizExpCol[1]:colVal_x  = {  "@Top.runDateTime"  }

   "Create Proj:CSE_SolarSysSizExpCol[2] - Wthr"      Proj:CSE_SolarSysSizExpCol[2]  = {
         if (LocalCompAssigned( CSE_SolarSysSizExpCol[2] ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-2" )  endif  }
   "Set Proj:CSE_SolarSysSizExpCol[2]:Parent"      Proj:CSE_SolarSysSizExpCol[2]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:CSE_SolarSysSizExpCol[2]:colhead"     Proj:CSE_SolarSysSizExpCol[2]:colhead   = {  "Wthr"  }
   "Set Proj:CSE_SolarSysSizExpCol[2]:colVal_x"    Proj:CSE_SolarSysSizExpCol[2]:colVal_x  = {  "@Top.wfName"  }

   "Create Proj:CSE_SolarSysSizExpCol[3] - CZ"        Proj:CSE_SolarSysSizExpCol[3]  = {
         if (LocalCompAssigned( CSE_SolarSysSizExpCol[3] ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-3" )  endif  }
   "Set Proj:CSE_SolarSysSizExpCol[3]:Parent"      Proj:CSE_SolarSysSizExpCol[3]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:CSE_SolarSysSizExpCol[3]:colhead"     Proj:CSE_SolarSysSizExpCol[3]:colhead   = {  "CZ"  }
   "Set Proj:CSE_SolarSysSizExpCol[3]:colVal_x"    Proj:CSE_SolarSysSizExpCol[3]:colVal_x  = {  "ClimateZone"  }


   ; exportCol colhead="SCMult" colVal=@DHWSolarCollector["dhwsc-dhwss-Solar1"].mult
   "Create Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1] - SCMult" Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]  = {
         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-4" )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:Parent"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:colhead"     Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:colhead   = {  "SCMult"  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:colVal_x"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[1]:colVal_x  = {  Format( "@DHWSolarCollector[%c%s%c].mult", 34, StdDHWSolarSysRef:cseDHWSOLARCOLLECTORRef:Name, 34 )  }

   ; exportCol colhead="Area" colVal=@DhwSolarSys["dhwss-dhwss-Solar1"].scAreaTot colDec=1
   "Create Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2] - Area"   Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]  = {
         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-5" )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:Parent"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colhead"     Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colhead   = {  "Area"  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colVal_x"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colVal_x  = {  Format( "@DhwSolarSys[%c%s%c].scAreaTot", 34, StdDHWSolarSysRef:cseDHWSOLARSYSRef:Name, 34 )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colDec"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[2]:colDec    = {  1  }

   ; exportCol colhead="Vol" colVal=@DhwSolarSys["dhwss-dhwss-Solar1"].tankVol colDec=1
   "Create Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3] - Vol"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]  = {
         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-6" )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:Parent"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colhead"     Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colhead   = {  "Vol"  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colVal_x"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colVal_x  = {  Format( "@DhwSolarSys[%c%s%c].tankVol", 34, StdDHWSolarSysRef:cseDHWSOLARSYSRef:Name, 34 )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colDec"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[3]:colDec    = {  1  }

   ; exportCol colhead="SSF" colVal=@DhwSys["dhwsys-DHWGas"].SSFAnnual
   "Create Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4] - SSF"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]  = {
         CreateComp( cseEXPORTCOL, "ExpCol SlrSysSz-7" )  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:Parent"      Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:Parent    = {  CSE_SolarSysSizExport:Name  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:colhead"     Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:colhead   = {  "SSF"  }
   "Set Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:colVal_x"    Proj:StdDHWSolarSysRef:SolarSysSzExpCol[4]:colVal_x  = {  Format( "@DhwSolarSys[%c%s%c].SSFAnnual", 34, StdDHWSolarSysRef:cseDHWSOLARSYSRef:Name, 34 )  }
END

;************************************************************************* - to report hourly DHW usage by draw type (faucets, shower, clothes washer, etc.) - SAC 05/20/21
RULELIST "CSE_Project_SetupHourlyDHWMeterExport" 1 0 0 1
;*************************************************************************
   "Create Proj:CSE_DHWMtrHrlyExportFile"  Proj:CSE_DHWMtrHrlyExportFile  = {   CreateComp( cseEXPORTFILE, "xf-dhwMtr-Hrly" )  }
   "Set Proj:CSE_DHWMtrHrlyExportFile:xfFileName"   Proj:CSE_DHWMtrHrlyExportFile:xfFileName  =
      {  ValidOr( ProjFileNameNoExt, "" ) + " - " + ValidOr( RunAbbrev, "" ) + "-cse" + "-DHWMtrHrly.csv"  }

   "Create Proj:CSE_DHWMtrHrlyExport"           Proj:CSE_DHWMtrHrlyExport  = {   CreateComp( cseEXPORT, "x-dhwMtr-Hrly" )  }
   "Set Proj:CSE_DHWMtrHrlyExport:exExportfile" Proj:CSE_DHWMtrHrlyExport:exExportfile  = {  CSE_DHWMtrHrlyExportFile:Name  }
   "Set Proj:CSE_DHWMtrHrlyExport:exType"       Proj:CSE_DHWMtrHrlyExport:exType     = {  "DHWMTR"   }
   "Set Proj:CSE_DHWMtrHrlyExport:exDHWMeter"   Proj:CSE_DHWMtrHrlyExport:exDHWMeter = {  CSE_WHHwDHWMETER:Name   }
   "Set Proj:CSE_DHWMtrHrlyExport:exFreq"       Proj:CSE_DHWMtrHrlyExport:exFreq     = {  "HOUR"  }
;   "Set Proj:CSE_DHWMtrHrlyExport:exHeader"     Proj:CSE_DHWMtrHrlyExport:exHeader   = {  "COLUMNSONLY"    }
;   "Set Proj:CSE_DHWMtrHrlyExport:exHeader"     Proj:CSE_DHWMtrHrlyExport:exHeader   = {  "YESIFNEW"    }
;   "Set Proj:CSE_DHWMtrHrlyExport:exFooter"     Proj:CSE_DHWMtrHrlyExport:exFooter   = {  "NO"     }
	"Set Proj:CSE_DHWMtrHrlyExport:exDayBeg_x"	Proj:CSE_DHWMtrHrlyExport:exDayBeg_x = {	"Jan 1"   }
	"Set Proj:CSE_DHWMtrHrlyExport:exDayEnd_x"	Proj:CSE_DHWMtrHrlyExport:exDayEnd_x = {	"Dec 31"  }
END

;************************************************************************* SAC 2/2/20 (StdSolarSys) (Com tic #3157)
RULELIST "CSE_Project_SetupSolarSysSSFExport" 1 0 0 1
;*************************************************************************
   "Create Proj:CSE_PropSSFExportFile"  Proj:CSE_PropSSFExportFile  = {   CreateComp( cseEXPORTFILE, "xf-dhwSolarSys-SSF" )  }
   "Set Proj:CSE_PropSSFExportFile:xfFileName"   Proj:CSE_PropSSFExportFile:xfFileName  =
      {  ValidOr( ProjFileNameNoExt, "" ) + " - " + ValidOr( RunAbbrev, "" ) + "-cse" + "-SSF.csv"  }

   "Create Proj:CSE_PropSSFExport"           Proj:CSE_PropSSFExport  = {   CreateComp( cseEXPORT, "x-dhwSolarSys-SSF" )  }
   "Set Proj:CSE_PropSSFExport:exExportfile" Proj:CSE_PropSSFExport:exExportfile  = {  CSE_PropSSFExportFile:Name  }
   "Set Proj:CSE_PropSSFExport:exType"       Proj:CSE_PropSSFExport:exType    = {  "UDT"   }
   "Set Proj:CSE_PropSSFExport:exFreq"       Proj:CSE_PropSSFExport:exFreq    = {  "YEAR"  }
;   "Set Proj:CSE_PropSSFExport:exHeader"     Proj:CSE_PropSSFExport:exHeader  = {  "COLUMNSONLY"    }
   "Set Proj:CSE_PropSSFExport:exHeader"     Proj:CSE_PropSSFExport:exHeader  = {  "YESIFNEW"    }
   "Set Proj:CSE_PropSSFExport:exFooter"     Proj:CSE_PropSSFExport:exFooter  = {  "NO"     }

   "Create Proj:CSE_PropSSFExpCol[1] - timestamp"     Proj:CSE_PropSSFExpCol[1]  = {
         if (LocalCompAssigned( CSE_PropSSFExpCol[1] ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORTCOL, "xc-dhwSolarSys-SSF-1" )  endif  }
   "Set Proj:CSE_PropSSFExpCol[1]:Parent"    Proj:CSE_PropSSFExpCol[1]:Parent    = {  CSE_PropSSFExport:Name  }
   "Set Proj:CSE_PropSSFExpCol[1]:colhead"   Proj:CSE_PropSSFExpCol[1]:colhead   = {  "TimeStamp"  }
   "Set Proj:CSE_PropSSFExpCol[1]:colVal_x"  Proj:CSE_PropSSFExpCol[1]:colVal_x  = {  "@Top.runDateTime"  }

   "Create Proj:CSE_PropSSFExpCol[2] - CZ"      Proj:CSE_PropSSFExpCol[2]  = {
         if (LocalCompAssigned( CSE_PropSSFExpCol[2] ) > 0) then  UNCHANGED
         else  CreateComp( cseEXPORTCOL, "xc-dhwSolarSys-SSF-2" )  endif  }
   "Set Proj:CSE_PropSSFExpCol[2]:Parent"    Proj:CSE_PropSSFExpCol[2]:Parent    = {  CSE_PropSSFExport:Name  }
   "Set Proj:CSE_PropSSFExpCol[2]:colhead"   Proj:CSE_PropSSFExpCol[2]:colhead   = {  "CZ"  }
   "Set Proj:CSE_PropSSFExpCol[2]:colVal_x"  Proj:CSE_PropSSFExpCol[2]:colVal_x  = {  "ClimateZone"  }

   "Create sets of columns for each DHWSolarSys"      DHWSolarSys:Action  =
      {  if (LocalCompAssigned( cseDHWSOLARSYSRef ) < 1 .OR.
             LocalCompAssigned( CSE_PropSSFExpCol[1] ) > 0) then  UNCHANGED
         else  EvalRulelist( "CSE_DHWSolarSys_SetupSolarSysSSFExport", 1 )  endif  }
END
;************************************************************************* SAC 2/2/20 - (Res tic #1013) (Com tic #3157)
RULELIST "CSE_DHWSolarSys_SetupSolarSysSSFExport" 1 0 0 1
;*************************************************************************
   "Create DHWSolarSys:CSE_PropSSFExpCol[1] - Name" DHWSolarSys:CSE_PropSSFExpCol[1]  = {
         CreateComp( cseEXPORTCOL, "xc-dhwSolarSys-SSF-3" )  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[1]:Parent"      DHWSolarSys:CSE_PropSSFExpCol[1]:Parent    = {  Proj:CSE_PropSSFExport:Name  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[1]:colhead"     DHWSolarSys:CSE_PropSSFExpCol[1]:colhead   = {  "Name"  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[1]:colVal_x"    DHWSolarSys:CSE_PropSSFExpCol[1]:colVal_x  = {  Format( "%c%s%c", 34, Name, 34 )  }

   ; exportCol colhead="Area" colVal=@DhwSolarSys["dhwss-dhwss-Solar1"].scAreaTot colDec=1
   "Create DHWSolarSys:CSE_PropSSFExpCol[2] - SSF"   DHWSolarSys:CSE_PropSSFExpCol[2]  = {
         CreateComp( cseEXPORTCOL, "xc-dhwSolarSys-SSF-4" )  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[2]:Parent"      DHWSolarSys:CSE_PropSSFExpCol[2]:Parent    = {  Proj:CSE_PropSSFExport:Name  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[2]:colhead"     DHWSolarSys:CSE_PropSSFExpCol[2]:colhead   = {  "SSF"  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[2]:colVal_x"    DHWSolarSys:CSE_PropSSFExpCol[2]:colVal_x  = {  Format( "@DhwSolarSys[%c%s%c].SSFAnnual", 34, cseDHWSOLARSYSRef:Name, 34 )  }
   "Set DHWSolarSys:CSE_PropSSFExpCol[2]:colDec"      DHWSolarSys:CSE_PropSSFExpCol[2]:colDec    = {  3  }
END
;*************************************************************************


;************************************************************************* SAC 09/03/20 (tic #3218)
RULELIST "CSE_Project_SetupDHWMinusSolarSysRun" 1 0 0 1
   ; store and then remove any SolarSys or SSF settings for each cseDHWSYS
   "Store cseDHWSYS:wsSolarSys"     cseDHWSYS:StoreWSSolarSys  =  
      {  if (LocalStatus( wsSolarSys ) < 1) then  UNDEFINED
         else  wsSolarSys  endif  }
   "Store cseDHWSYS:wsSSF"          cseDHWSYS:StoreWSSSF  =  
      {  if (LocalStatus( wsSSF ) < 1) then  UNDEFINED
         else  wsSSF  endif  }
   "Store cseDHWSYS:wsSSF_x"        cseDHWSYS:StoreWSSSF_x  =  
      {  if (LocalStatus( wsSSF_x ) < 1) then  UNDEFINED
         else  wsSSF_x  endif  }

   "Blast cseDHWSYS:wsSolarSys (if needed)"  cseDHWSYS:wsSolarSys  =
      {  if (LocalStatus( StoreWSSolarSys ) < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
   "Blast cseDHWSYS:wsSSF (if needed)"       cseDHWSYS:wsSSF  =
      {  if (LocalStatus( StoreWSSSF )      < 1) then  UNCHANGED
         else  UNDEFINED  endif  }
   "Blast cseDHWSYS:wsSSF_x (if needed)"     cseDHWSYS:wsSSF_x  =
      {  if (LocalStatus( StoreWSSSF_x )    < 1) then  UNCHANGED
         else  UNDEFINED  endif  }

   ; for COM only - report error if any PVARRAYs exist and create one to be scaled and reported as req'd PV - SAC 09/03/20
   "throw error if any PVARRAYs exist"    Proj:Action =
      {  if (ComponentCount( csePVARRAY ) > 0)
         then  PostError( "Error in prep for NoSolarThermal run to calc flexibility credit - %g PVARRAY objects exist - should be none.", ComponentCount( csePVARRAY ) )
         else  UNCHANGED  endif  }
   "Create Proj:StdNoSlrPVArrayRef"             Proj:StdNoSlrPVArrayRef  = {  CreateComp( csePVARRAY, "abFlexPVarray" )  }
   "Set Proj:StdNoSlrPVArrayRef:pvDCSysSize"    Proj:StdNoSlrPVArrayRef:pvDCSysSize    = {  1               }     ; generic CFI1 settings
   "Set Proj:StdNoSlrPVArrayRef:pvModuleType"   Proj:StdNoSlrPVArrayRef:pvModuleType   = {  "Standard"      }
   "Set Proj:StdNoSlrPVArrayRef:pvArrayType"    Proj:StdNoSlrPVArrayRef:pvArrayType    = {  "FixedOpenRack" }
   "Set Proj:StdNoSlrPVArrayRef:pvTilt"         Proj:StdNoSlrPVArrayRef:pvTilt         = {  22.619884       }    
   "Set Proj:StdNoSlrPVArrayRef:pvAzm"          Proj:StdNoSlrPVArrayRef:pvAzm          = {  170             }    
   "Set Proj:StdNoSlrPVArrayRef:pvInverterEff"  Proj:StdNoSlrPVArrayRef:pvInverterEff  = {  0.96            }
   "Set Proj:StdNoSlrPVArrayRef:pvElecMtr"      Proj:StdNoSlrPVArrayRef:pvElecMtr      = {  "MtrElec"       }

   ; setup EXPORT(s) to output hourly DHW results (if needed)

END
;************************************************************************* SAC 09/03/20 (tic #3218)
RULELIST "CSE_Project_RestoreFollowingDHWMinusSolarSysRun" 1 0 0 1
   ; restore all SolarSys & SSF settings following the no-solar run
   "Restore cseDHWSYS:wsSolarSys"   cseDHWSYS:wsSolarSys  =
      {  if (LocalStatus( StoreWSSolarSys ) < 1) then  UNCHANGED
         else  StoreWSSolarSys  endif  }
   "Restore cseDHWSYS:wsSSF"        cseDHWSYS:wsSSF  =
      {  if (LocalStatus( StoreWSSSF      ) < 1) then  UNCHANGED
         else  StoreWSSSF  endif  }
   "Restore cseDHWSYS:wsSSF_x"      cseDHWSYS:wsSSF_x  =
      {  if (LocalStatus( StoreWSSSF_x    ) < 1) then  UNCHANGED
         else  StoreWSSSF_x  endif  }

   "Delete Proj:StdNoSlrPVArrayRef"    Proj:StdNoSlrPVArrayRef  = {  DeleteComp()  }
END
;*************************************************************************


; SAC 8/15/18 - split out a couple of initial rules for reference by BudgetConversion_DHW rules
;*************************************************************************
RULELIST "ResWtrHtr_UEF_Init" 1 0 0 1
;*************************************************************************
  "Look Up UEF Model Draw Variable"   ResWtrHtr:UEFModelDrawVar = {
    if( IsUEFRtdSim )
    then if( ElementTypeNum = 5 )
      then CAUEFConvCat:DrawVarIdx( "HeaterElementTypeIdx",ElementTypeNum, 
                                  "TankTypeSym","*" )
      else CAUEFConvCat:DrawVarIdx( "HeaterElementTypeIdx",ElementTypeNum, 
                                  "TankTypeSym",TankType )
      endif
    else 0
    endif }

  "Set UEF Conv Draw Pattern"   ResWtrHtr:UEFModelDrawPattern = {
    if( IfValidAnd( UEFModelDrawVar = "FHR" ) )
    then if ( LocalStatus( FirstHrRating ) < 1 )  then 0 else
         if ( FirstHrRating < 18 ) then 1 else
         if ( FirstHrRating < 51 ) then 2 else
         if ( FirstHrRating < 75 ) then 3 else 4
         endif endif endif endif
    else
    if( IfValidAnd( UEFModelDrawVar = "MaxGPM" ) )
    then if ( LocalStatus( FlowRate ) < 1  ) then 0 else
         if ( FlowRate < 1.7 ) then 1 else
         if ( FlowRate < 2.8 ) then 2 else
         if ( FlowRate < 4 ) then 3 else 4
         endif endif endif endif
    else "na"
    endif endif }
END
;*************************************************************************
; SAC 8/21/17 - ported Res UEF rules authored by LDH to Com
;*************************************************************************
RULELIST "ResWtrHtr_UEF" 1 0 0 1
;*************************************************************************
  "Setup initial two ResWtrHtr UEF properties UEF data"   ResWtrHtr:Action = {
      EvalRulelist( "ResWtrHtr_UEF_Init", 1 )  }

  "Set Heat Pump UEF Model Drawn Volume" ResWtrHtr:UEFModelHPDrawnVolume = {
    if( IsUEFRtdSim .AND.
        ElementTypeNum = 5 )
    then switch( UEFModelDrawPattern )
      case "Very Small" :   ;VerySmall
        10
      case "Low"        :   ;Low
        38
      case "Medium"     :   ;Medium
        55
      case "High"       :   ;High
        84
      default: 
        0   
      endswitch
    else 0
    endif }

  "Look Up UEFNew Coef1"  ResWtrHtr:UEFNewCoef1 = {
    if( IsUEFRtdSim )
    then CAUEFConvCat:UEFNewCoef1( "HeaterElementTypeIdx",ElementTypeNum, 
                                 "TankTypeSym",TankType )
    else 0
    endif }

  "Look Up UEFNew Coef2"  ResWtrHtr:UEFNewCoef2 = {
    if( IsUEFRtdSim )
    then CAUEFConvCat:UEFNewCoef2( "HeaterElementTypeIdx",ElementTypeNum, 
                                 "TankTypeSym",TankType )
    else 0
    endif }

  "Look Up UEFNew Coef3"  ResWtrHtr:UEFNewCoef3 = {
    if( IsUEFRtdSim )
    then CAUEFConvCat:UEFNewCoef3( "HeaterElementTypeIdx",ElementTypeNum, 
                                 "TankTypeSym",TankType )
    else 0
    endif }

  "Calculate UEF Model from UEF New"  ResWtrHtr:UEFModel = {
     if( IsUEFRtdSim .AND.
         LocalStatus( EF ) > 0.5 )
     then ( EF - UEFNewCoef2 - 
            UEFModelHPDrawnVolume * UEFNewCoef3 ) / UEFNewCoef1
     else 0
     endif }

  "Look Up UEF Model Type"   ResWtrHtr:UEFModelType = {
    if( IsUEFRtdSim )
    then CAUEFConvCat:ModelTypeIdx( "HeaterElementTypeIdx",ElementTypeNum, 
                                   "TankTypeSym",TankType )
    else 0
    endif }

  "Look Up UEF Conv Coef 1"   ResWtrHtr:UEFModelCoef1 = {
    if( IsUEFRtdSim .AND. 
        LocalStatus( UEFModelType ) > 0.5 .AND.
        LocalStatus( UEFModelDrawPattern ) > 0.5 .AND. 
        LocalStatus( ElementTypeNum ) > 0.5 )
    then CAUEFModelCoef:Coef1("ModelType",UEFModelType,
                            "DrawPattern",UEFModelDrawPattern,
                            "HeaterElementTypeIdx",ElementTypeNum )
    else 0
    endif }

  "Look Up UEF Conv Coef 2"   ResWtrHtr:UEFModelCoef2 = {
    if( IsUEFRtdSim .AND. 
        LocalStatus( UEFModelType ) > 0.5 .AND.
        LocalStatus( UEFModelDrawPattern ) > 0.5 .AND. 
        LocalStatus( ElementTypeNum ) > 0.5 )
    then CAUEFModelCoef:Coef2("ModelType",UEFModelType,
                            "DrawPattern",UEFModelDrawPattern,
                            "HeaterElementTypeIdx",ElementTypeNum )
    else 0
    endif }

  "Look Up UEF Conv Coef 3"   ResWtrHtr:UEFModelCoef3 = {
    if( IsUEFRtdSim .AND. 
        LocalStatus( UEFModelType ) > 0.5 .AND.
        LocalStatus( UEFModelDrawPattern ) > 0.5 .AND. 
        LocalStatus( ElementTypeNum ) > 0.5 )
    then CAUEFModelCoef:Coef3("ModelType",UEFModelType,
                            "DrawPattern",UEFModelDrawPattern,
                            "HeaterElementTypeIdx",ElementTypeNum )
    else 0
    endif }

  "Look Up UEF Conv Coef 4"   ResWtrHtr:UEFModelCoef4 = {
    if( IsUEFRtdSim .AND. 
        LocalStatus( UEFModelType ) > 0.5 .AND.
        LocalStatus( UEFModelDrawPattern ) > 0.5 .AND. 
        LocalStatus( ElementTypeNum ) > 0.5 )
    then CAUEFModelCoef:Coef4("ModelType",UEFModelType,
                            "DrawPattern",UEFModelDrawPattern,
                            "HeaterElementTypeIdx",ElementTypeNum )
    else 0
    endif }

  "Calculate Energy Factor from UEFModel"  ResWtrHtr:UEFModelCalcEF = {
    if( IsUEFRtdSim )
    then if( IfValidAnd( UEFModelType = "WHAM" ) )  ;WHAM
      then switch ( ElementTypeNum )
        case 0:   ;Electric Resistance 6/29/2018 NK modified InpRating to InpRatingSim*3.412 for electric WH passed from COM
          -( ( RcvryEff/100 * UEFModel * UEFModelCoef2 ) - 
             ( RcvryEff/100 * RcvryEff/100 * InpRatingElecSim * 3.412 * UEFModel * UEFModelCoef1 ) ) /
           ( ( ( UEFModel - RcvryEff/100 ) * UEFModelCoef4 ) + 
             ( ( RcvryEff/100 * RcvryEff/100 * InpRatingElecSim * 3.412 - RcvryEff/100 * InpRatingElecSim * 3.412 * UEFModel ) * UEFModelCoef3 ) -
             ( UEFModel * UEFModelCoef2 ) + 
             ( RcvryEff/100 * InpRatingElecSim *3.412 * UEFModel * UEFModelCoef1 ) )
        case 1:   ;Gas
          -( ( RcvryEff/100 * UEFModel * UEFModelCoef2 ) - 
             ( RcvryEff/100 * RcvryEff/100 * InpRatingSim * UEFModel * UEFModelCoef1 ) ) /
           ( ( ( UEFModel - RcvryEff/100 ) * UEFModelCoef4 ) + 
             ( ( RcvryEff/100 * RcvryEff/100 * InpRatingSim - RcvryEff/100 * InpRatingSim * UEFModel ) * UEFModelCoef3 ) -
             ( UEFModel * UEFModelCoef2 ) + 
             ( RcvryEff/100 * InpRatingSim * UEFModel * UEFModelCoef1 ) )
        default: 0
        endswitch
      else if( IfValidAnd( UEFModelType = "DV" ) )  ;DV - UEF Heat Pump
        then ( EF - UEFNewCoef2 - UEFModelHPDrawnVolume * UEFNewCoef3 ) /
             ( UEFNewCoef1 )
      else 0
      endif endif
    else 0
    endif }

  "Calculate Recovery Efficiency from UEFModel"  ResWtrHtr:UEFModelCalcRE = {
    if( IsUEFRtdSim )
    then if( IfValidAnd( UEFModelType = "MODEL" ) )  ; MODEL
      then -( UEFModel ) / ( UEFModelCoef1 * UEFModel - 1 )
      else 0
      endif
    else 0
    endif }

  "Calculate Standby Loss from UEFModel"  ResWtrHtr:UEFModelCalcSL = {
    if( IsUEFRtdSim )
    then if( IfValidAnd( UEFModelType = "RD" ) )  ; RD
      then -( InpRatingSim * UEFModel - InpRatingSim * RcvryEff/100 ) /
            ( ( UEFModelCoef1 * UEFModelCoef2 * InpRatingSim * RcvryEff/100 - UEFModelCoef1 ) * UEFModel )
      else 0
      endif
    else 0
    endif }

  "Calculate Thermal Efficiency from UEFModel"  ResWtrHtr:UEFModelCalcTE = {
    if( IsUEFRtdSim )
    then if( IfValidAnd( UEFModelType = "RD_MODEL" ) ) ; MODEL_RD
      then -( UEFModel ) / ( UEFModelCoef1 * UEFModel - 1 )
      else 0
      endif
    else 0
    endif }

END
;*************************************************************************





;*************************************************************************  - SAC 1/24/19
RULELIST "Setup_cseDHWHEATREC_MFam" 1 0 0 1
	; cseDHWHEATREC setup
	   ; SAC 4/29/19 - updates for consistency w/ latest Res rules (tic #2553)
; MFAM Incompat
;   "Create Child cseDHWHEATREC - 1"    cseDHWSYS:ChildcseDHWHEATRECs[1]  = {
;      if (LocalCompAssigned( SourceDwellUnitDHW:ResSpcDHWFeaturesRef ) < 1) then  UNCHANGED
;      else if (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[1]:CSARtdEff > 0 ) .AND.
;               IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[1] > 0 ) .AND.
;               ( (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR > 0 ) .AND. IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[1] > 0 )) .OR.
;                 IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[1] > 0 )))
;      then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + LocalRef( Name ) )
;      else  UNCHANGED  endif endif  }

;      switch (DUTypeDWHRIndex)
;         case 1 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef1[1] ) < 1 .OR. IfValidAnd( SourceDwellUnitType:DWHRSysConfig1[1] > 0 )==0) then  UNCHANGED
;                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef1[1]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers1[1] > 0 ))
;                  then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + LocalRef( Name ) )
;                  else  UNCHANGED  endif endif
;         case 2 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef1[2] ) < 1 .OR. IfValidAnd( SourceDwellUnitType:DWHRSysConfig1[2] > 0 )==0) then  UNCHANGED
;                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef1[2]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers1[2] > 0 ))
;                  then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + LocalRef( Name ) )
;                  else  UNCHANGED  endif endif
;         case 3 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef1[3] ) < 1 .OR. IfValidAnd( SourceDwellUnitType:DWHRSysConfig1[3] > 0 )==0) then  UNCHANGED
;                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef1[3]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers1[3] > 0 ))
;                  then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + LocalRef( Name ) )
;                  else  UNCHANGED  endif endif
;         case 4 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef1[4] ) < 1 .OR. IfValidAnd( SourceDwellUnitType:DWHRSysConfig1[4] > 0 )==0) then  UNCHANGED
;                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef1[4]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers1[4] > 0 ))
;                  then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + LocalRef( Name ) )
;                  else  UNCHANGED  endif endif
;         case 5 : if (LocalCompAssigned( SourceDwellUnitType:DWHRSysRef1[5] ) < 1 .OR. IfValidAnd( SourceDwellUnitType:DWHRSysConfig1[5] > 0 )==0) then  UNCHANGED
;                  else if (IfValidAnd( SourceDwellUnitType:DWHRSysRef1[5]:CSARatedEff > 0 ) .AND. IfValidAnd( SourceDwellUnitType:DWHRSysShowers1[5] > 0 ))
;                  then  CreateComp( cseDHWHEATREC, "dwhrsys1-" + LocalRef( Name ) )
;                  else  UNCHANGED  endif endif
;         default : UNCHANGED
;      endswitch  }
; MFAM Incompat
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[1]:SourceDWHRSys  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[1]  }
;
;; SAC 4/29/19 - removed wrConfig, replaced wrFxServed w/ wrCountFXDrain and added wrCountFXCold & wrFeedsWH (tic #2553)
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXDrain  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[1]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[1]:wrCountFXCold   = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR < 1) then  UNCHANGED
;      else  SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[1]  endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[1]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[1]:wrFeedsWH       = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[1] != 0) then  "Yes"  else  "No"  endif  }
;
;   "Create Child cseDHWHEATREC - 2"    cseDHWSYS:ChildcseDHWHEATRECs[2]  = {
;      if (LocalCompAssigned( SourceDwellUnitDHW:ResSpcDHWFeaturesRef ) < 1) then  UNCHANGED
;      else if (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[2]:CSARtdEff > 0 ) .AND.
;               IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[2] > 0 ) .AND.
;               ( (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR > 0 ) .AND. IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[2] > 0 )) .OR.
;                 IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[2] > 0 )))
;      then  CreateComp( cseDHWHEATREC, "dwhrsys2-" + LocalRef( Name ) )
;      else  UNCHANGED  endif endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[2]:SourceDWHRSys  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[2]  }
;
;; SAC 4/29/19 - removed wrConfig, replaced wrFxServed w/ wrCountFXDrain and added wrCountFXCold & wrFeedsWH (tic #2553)
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXDrain  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[2]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[2]:wrCountFXCold   = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR < 1) then  UNCHANGED
;      else  SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[2]  endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[2]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[2]:wrFeedsWH       = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[2] != 0) then  "Yes"  else  "No"  endif  }
;
;   "Create Child cseDHWHEATREC - 3"    cseDHWSYS:ChildcseDHWHEATRECs[3]  = {
;      if (LocalCompAssigned( SourceDwellUnitDHW:ResSpcDHWFeaturesRef ) < 1) then  UNCHANGED
;      else if (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[3]:CSARtdEff > 0 ) .AND.
;               IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[3] > 0 ) .AND.
;               ( (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR > 0 ) .AND. IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[3] > 0 )) .OR.
;                 IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[3] > 0 )))
;      then  CreateComp( cseDHWHEATREC, "dwhrsys3-" + LocalRef( Name ) )
;      else  UNCHANGED  endif endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[3]:SourceDWHRSys  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[3]  }
;
;; SAC 4/29/19 - removed wrConfig, replaced wrFxServed w/ wrCountFXDrain and added wrCountFXCold & wrFeedsWH (tic #2553)
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXDrain  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[3]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[3]:wrCountFXCold   = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR < 1) then  UNCHANGED
;      else  SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[3]  endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[3]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[3]:wrFeedsWH       = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[3] != 0) then  "Yes"  else  "No"  endif  }
;
;   "Create Child cseDHWHEATREC - 4"    cseDHWSYS:ChildcseDHWHEATRECs[4]  = {
;      if (LocalCompAssigned( SourceDwellUnitDHW:ResSpcDHWFeaturesRef ) < 1) then  UNCHANGED
;      else if (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[4]:CSARtdEff > 0 ) .AND.
;               IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[4] > 0 ) .AND.
;               ( (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR > 0 ) .AND. IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[4] > 0 )) .OR.
;                 IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[4] > 0 )))
;      then  CreateComp( cseDHWHEATREC, "dwhrsys4-" + LocalRef( Name ) )
;      else  UNCHANGED  endif endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[4]:SourceDWHRSys  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[4]  }
;
;; SAC 4/29/19 - removed wrConfig, replaced wrFxServed w/ wrCountFXDrain and added wrCountFXCold & wrFeedsWH (tic #2553)
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXDrain  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[4]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[4]:wrCountFXCold   = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR < 1) then  UNCHANGED
;      else  SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[4]  endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[4]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[4]:wrFeedsWH       = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[4] != 0) then  "Yes"  else  "No"  endif  }
;
;   "Create Child cseDHWHEATREC - 5"    cseDHWSYS:ChildcseDHWHEATRECs[5]  = {
;      if (LocalCompAssigned( SourceDwellUnitDHW:ResSpcDHWFeaturesRef ) < 1) then  UNCHANGED
;      else if (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[5]:CSARtdEff > 0 ) .AND.
;               IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[5] > 0 ) .AND.
;               ( (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR > 0 ) .AND. IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[5] > 0 )) .OR.
;                 IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[5] > 0 )))
;      then  CreateComp( cseDHWHEATREC, "dwhrsys5-" + LocalRef( Name ) )
;      else  UNCHANGED  endif endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[5]:SourceDWHRSys  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[5]  }
;
;; SAC 4/29/19 - removed wrConfig, replaced wrFxServed w/ wrCountFXDrain and added wrCountFXCold & wrFeedsWH (tic #2553)
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXDrain  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[5]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[5]:wrCountFXCold   = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR < 1) then  UNCHANGED
;      else  SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[5]  endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[5]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[5]:wrFeedsWH       = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[5] != 0) then  "Yes"  else  "No"  endif  }
;
;   "Create Child cseDHWHEATREC - 6"    cseDHWSYS:ChildcseDHWHEATRECs[6]  = {
;      if (LocalCompAssigned( SourceDwellUnitDHW:ResSpcDHWFeaturesRef ) < 1) then  UNCHANGED
;      else if (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[6]:CSARtdEff > 0 ) .AND.
;               IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[6] > 0 ) .AND.
;               ( (IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR > 0 ) .AND. IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[6] > 0 )) .OR.
;                 IfValidAnd( SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[6] > 0 )))
;      then  CreateComp( cseDHWHEATREC, "dwhrsys6-" + LocalRef( Name ) )
;      else  UNCHANGED  endif endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:SourceDWHRSys"  cseDHWSYS:ChildcseDHWHEATRECs[6]:SourceDWHRSys  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysRef[6]  }
;
;; SAC 4/29/19 - removed wrConfig, replaced wrFxServed w/ wrCountFXDrain and added wrCountFXCold & wrFeedsWH (tic #2553)
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXDrain"     cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXDrain  = {
;      SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysShowers[6]  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXCold"      cseDHWSYS:ChildcseDHWHEATRECs[6]:wrCountFXCold   = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:AllowShowerDWHR < 1) then  UNCHANGED
;      else  SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysTakeCold[6]  endif  }
;   "Set cseDHWSYS:ChildcseDHWHEATRECs[6]:wrFeedsWH"          cseDHWSYS:ChildcseDHWHEATRECs[6]:wrFeedsWH       = {
;      if (SourceDwellUnitDHW:ResSpcDHWFeaturesRef:ResDWHRSysFeedHeater[6] != 0) then  "Yes"  else  "No"  endif  }
END
;*************************************************************************



;*************************************************************************   - SAC 1/3/19 - rules to 
RULELIST  "CSE_DHWSystem_CalculateHPWHMultiplier" 1 0 0 1
   ;  x = # of water heaters
   ;  y = energy or TDV or whatever
   ;  Results from 3 runs are (x1, y1), (x2, y2), and (x3, y3).  x1, x2, and x3 must all have different values (else divide by 0, see below).
   ;  Fitted parabola is y = Ax^2 + Bx + C
   ;  Find A, B, C from 3 points --
   ;  A = (x3 * (y2 - y1) + x2 * (y1 - y3) + x1 * (y3 - y2))
   ;  B = (x3^2 * (y1 - y2) + x2^2 * (y3 - y1) + x1^2 * (y2 - y3))
   ;  Now find x for minimum y ... slope is 0 at minimum.
   ;  0 = 2Ax + B
   ;  x = -B / 2A    - SAC 1/3/19 - added min val of 1.0
   ;
   ;  FullA = A(above) / (x1 - x2)(x1 - x3)(x2 - x3)
   ;  Note 1: if FullA < 0, then the parabola opens *down* and the runs are not behaving as expected.
   ;  Note 2: A, B, and C can also be found with simple matrix operations ... if those are available, this could be done with less code.

; MFAM Incompat
;   ; SAC 1/4/19 - added separate calc of Coef A w/ error message when it goes negative (inverted parabola) and also lowered min CentralWHMult from 1 to 0.2
;   "Set cseDHWSYS:CentralWHMultCoefA based on sizing run results"    cseDHWSYS:CentralWHMultCoefA  = {
;         (SourceDHWSys:StdHPWHSizingRunMults[3] * (StdHPWHSzRunUse[2] - StdHPWHSzRunUse[1]) +
;          SourceDHWSys:StdHPWHSizingRunMults[2] * (StdHPWHSzRunUse[1] - StdHPWHSzRunUse[3]) + 
;          SourceDHWSys:StdHPWHSizingRunMults[1] * (StdHPWHSzRunUse[3] - StdHPWHSzRunUse[2])) /
;         ((SourceDHWSys:StdHPWHSizingRunMults[1] - SourceDHWSys:StdHPWHSizingRunMults[2]) *
;          (SourceDHWSys:StdHPWHSizingRunMults[1] - SourceDHWSys:StdHPWHSizingRunMults[3]) *
;          (SourceDHWSys:StdHPWHSizingRunMults[2] - SourceDHWSys:StdHPWHSizingRunMults[3]))  }
;   "Post error if cseDHWSYS:CentralWHMult parabola is inverted or flat"    cseDHWSYS:Action  = {
;         if (IfValidAnd( CentralWHMultCoefA > 0 )) then  UNCHANGED
;         else if (LocalStatus( CentralWHMultCoefA ) < 1)
;         then  PostError( "Unable to determine standard design HPWH size for DHWSys '%s', cseDHWSYS '%s':  CentralWHMultCoefA undefined", SourceDHWSys:Name, Name )
;         else  PostError( "Unable to determine standard design HPWH size for DHWSys '%s', cseDHWSYS '%s':  CentralWHMultCoefA = %g", SourceDHWSys:Name, Name, CentralWHMultCoefA )
;         endif endif  }
;
;   "Set cseDHWSYS:CentralWHMult based on sizing run results"      cseDHWSYS:CentralWHMult  = {
;      if (IfValidAnd( CentralWHMultCoefA > 0 )==0) then  SourceDHWSys:StdHPWHSizingRunMults[2]  ; initial guess
;      else
;         max( 0.2,
;            -( SourceDHWSys:StdHPWHSizingRunMults[3]*SourceDHWSys:StdHPWHSizingRunMults[3] * (StdHPWHSzRunUse[1] - StdHPWHSzRunUse[2]) +
;               SourceDHWSys:StdHPWHSizingRunMults[2]*SourceDHWSys:StdHPWHSizingRunMults[2] * (StdHPWHSzRunUse[3] - StdHPWHSzRunUse[1]) +
;               SourceDHWSys:StdHPWHSizingRunMults[1]*SourceDHWSys:StdHPWHSizingRunMults[1] * (StdHPWHSzRunUse[2] - StdHPWHSzRunUse[3]) ) /
;             (2 * (SourceDHWSys:StdHPWHSizingRunMults[3] * (StdHPWHSzRunUse[2] - StdHPWHSzRunUse[1]) +
;                   SourceDHWSys:StdHPWHSizingRunMults[2] * (StdHPWHSzRunUse[1] - StdHPWHSzRunUse[3]) + 
;                   SourceDHWSys:StdHPWHSizingRunMults[1] * (StdHPWHSzRunUse[3] - StdHPWHSzRunUse[2]))) )
;      endif  }

   "Round cseDHWSYS:CentralWHMult to nearest tenth"      cseDHWSYS:CentralWHMult  = {
      if (IfValidAnd( CentralWHMult > 0 )==0) then  UNCHANGED
      else  int( (CentralWHMult*10)+0.5 ) / 10
      endif  }
END
;*************************************************************************


;************************************************************************* SAC 2/2/20 (Res tic #1013) (Com tic #3157)
RULELIST "CSE_SimulationPrep_DHW_SolarSys" 1 0 0 1
;   Rules to setup DHWSOLARSYS & DHWSOLARCOLLECTOR objects 
;*************************************************************************
   "Create a CSE DHWSOLARSYS for this DHWSolarSys"    DHWSolarSys:cseDHWSOLARSYSRef  =
      {  CreateComp( cseDHWSOLARSYS, "dhwss-" + Local( Name ) )  }
   "Set DHWSolarSys:cseDHWSOLARSYSRef:swElecMtr"      DHWSolarSys:cseDHWSOLARSYSRef:swElecMtr  = {  Proj:CSE_ElecMETER  }
;           "swEndUse",          BEMP_Str,  1,  0,  1, "",                 0,  0,                          3208, "enduse to accumulate solar water heating to (default to DHW)"
;           "swParElec",         BEMP_Flt,  1,  0,  1, "W",                0,  0,                          3208, "electrical parasitic power to represent recirculation pumps or other system-level electrical devices" 
;           "swTankMult",        BEMP_Flt,  1,  0,  1, "",                 0,  0,                          3201, "tank multiplier" 
   "Set DHWSolarSys:cseDHWSOLARSYSRef:swTankVol"      DHWSolarSys:cseDHWSOLARSYSRef:swTankVol     =      ; SAC 1/28/20 (StdSolarSys)
      {  if (IfValidAnd( TankVol > 0 )) then  TankVol
         else  UNDEFINED  endif  }
   "Set DHWSolarSys:cseDHWSOLARSYSRef:swTankInsulR"   DHWSolarSys:cseDHWSOLARSYSRef:swTankInsulR  = {  12  }
;           "swTankUA",          BEMP_Flt,  1,  0,  0, "",                 0,  0,                          8005, "tank UA"  
;           "swTankZone",        BEMP_Obj,  1,  0,  1, "",                 0,  1, "cseZONE",    0, "",     3201, "Zone tank located in"
;           "swTankTEx",         BEMP_Flt,  1,  0,  1, "F",               0,  0,                          3208, "temperature surrounding tank" 
   "Set DHWSolarSys:cseDHWSOLARSYSRef:swTankTEx_x"    DHWSolarSys:cseDHWSOLARSYSRef:swTankTEx_x   = {  "($tDbO + 70) / 2"  }  ; SAC 2/24/20 - equivalent to unconditioned

   "Create a CSE DHWSOLARCOLLECTOR for this DHWSolarSys"    DHWSolarSys:cseDHWSOLARCOLLECTORRef  =
      {  CreateComp( cseDHWSOLARCOLLECTOR, "dhwsc-" + Local( Name ) )  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:Parent"      DHWSolarSys:cseDHWSOLARCOLLECTORRef:Parent  = {  cseDHWSOLARSYSRef:Name  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scArea"      DHWSolarSys:cseDHWSOLARCOLLECTORRef:scArea  = {  Area  }  ; 25  }

   "Force DHWSolarSys:CntFlt to (int) Count if not EnableResearchMode"   DHWSolarSys:CntFlt  =       ; SAC 1/25/20 - added only for EnableResearchMode (per BAW request)
      {  ValidOr( Cnt, 1 )  }
;      {  if (IfValidAnd( Proj:EnableResearchMode > 0 )) then  UNCHANGED
;         else  ValidOr( Count, 1 )  endif  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scMult"      DHWSolarSys:cseDHWSOLARCOLLECTORRef:scMult  = {  CntFlt  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scTilt"      DHWSolarSys:cseDHWSOLARCOLLECTORRef:scTilt  = {  Tilt  }  ; 30  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scAzm"       DHWSolarSys:cseDHWSOLARCOLLECTORRef:scAzm   = {  Az  }
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scFRUL_x"    DHWSolarSys:cseDHWSOLARCOLLECTORRef:scFRUL_x ={  Format( "%g * 0.17611", EffCurveSlope )  }   ; testing: "-0.7"    ; conversion of SRCC slope units (W/m2-C) to CSE IP (Btuh/ft2-F) - per e-mail from CB 1/15/20
   "Set DHWSolarSys:cseDHWSOLARCOLLECTORRef:scFRTA"      DHWSolarSys:cseDHWSOLARCOLLECTORRef:scFRTA  = {  EffCurveYInt  }  ; testing: 0.6
;           "scPumpPwr",         BEMP_Flt,  1,  0,  1, "W",                0,  0,                          3201, "pump power (watts)" 
;           "scPumpFlow",        BEMP_Flt,  1,  0,  1, "GPM",              0,  0,                          3208, "pump flow" 
;           "scPumpLiqHeatF",    BEMP_Flt,  1,  0,  1, "",                 0,  0,                          3208, "pump liquid HeatF" 

   "Set DHWSolarSys:CSESimValid"    DHWSolarSys:CSESimValid  =
      {  if (LocalCompAssigned( cseDHWSOLARSYSRef ) > 0 .AND.
             IfValidAnd( cseDHWSOLARCOLLECTORRef:scArea > 0 )) then  1
         else  UNDEFINED  endif  }
END
;*************************************************************************


;*************************************************************************
;*************************************************************************

ENDFILE
