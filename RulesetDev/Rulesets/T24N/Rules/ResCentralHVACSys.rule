// Residential Central HVAC Systems
// For ResZn and ResOthZn
//
// -------------------------------------------------------------------------
//  Copyright (c) 2012-2018, California Energy Commission
//  All rights reserved.
//  Redistribution and use in source and binary forms, with or without
//  modification, are permitted provided that the following conditions are
//  met:
// 
//    * Redistributions of source code must retain the above copyright
//  notice, this list of conditions and the following disclaimer.
//    * Redistributions in binary form must reproduce the above copyright
//  notice, this list of conditions and the following disclaimer in
//  the documentation and/or other materials provided with the
//  distribution.
//    * Neither the name of the California Energy Commission nor the names of its
//  contributors may be used to endorse or promote products
//  derived from this software without specific prior written
//  permission.
//
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
//  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
//  TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
//  PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL CALIFORNIA ENERGY COMMISSION
//  BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
//  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
//  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
//  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
//  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
//  OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
//  ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
// -------------------------------------------------------------------------
//  


// -----------------------------------------------------------------------------
// --------------------- Central Htg Clg Sys -------------------------------
// -----------------------------------------------------------------------------
RULE ResCentralHtgClgSys:HWFluidSegInRef
  CHECKSIM
    if( Type = "Four-pipe fan coil" .OR. Type = "Hydronic heating only" )
    then if( LocalCompAssigned( HWFluidSegInRef ) = 0 )
         then PostError("The hot water inlet fluid segment of central system '%s' must be defined", Name)
         else if( HWFluidSegInRef:ParentFluidSysType != "HotWater" .AND.
                  HWFluidSegInRef:ParentFluidSysType != "ServiceHotWater" )
              then PostError("The inlet fluid segment of coil '%s' must belong to a 
                              HotWater or ServiceHotWater system.", Name) 
              else UNCHANGED
         endif endif
    else UNCHANGED
    endif
  SIZING_PROPOSED
    if( Type = "Water source heat pump" .OR. Type = "Variable refrigerant flow" )
    then UNDEFINED // Purge reference for when not applicable
    else UNCHANGED
    endif
ENDRULE

RULE ResCentralHtgClgSys:HWFluidSegOutRef
  CHECKSIM
    if( Type = "Four-pipe fan coil" .OR. Type = "Hydronic heating only" )
    then if( LocalCompAssigned( HWFluidSegOutRef ) = 0 )
         then PostError("The hot water inlet fluid segment of central system '%s' must be defined", Name)
         else if( HWFluidSegOutRef:ParentFluidSysType != "HotWater" .AND.
                  HWFluidSegOutRef:ParentFluidSysType != "ServiceHotWater" )
              then PostError("The inlet fluid segment of coil '%s' must belong to a 
                              HotWater or ServiceHotWater system.", Name) 
              else UNCHANGED
         endif endif
    else UNCHANGED
    endif
  SIZING_PROPOSED
    if( Type = "Water source heat pump" .OR. Type = "Variable refrigerant flow" )
    then UNDEFINED // Purge reference for when not applicable
    else UNCHANGED
    endif
ENDRULE

RULE NEW ResCentralHtgClgSys:HWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( ( Type = "Four-pipe fan coil" .OR. Type = "Hydronic heating only" ) .AND. LocalCompAssigned( HWFluidSegInRef ) )
    then HWFluidSegInRef:ParentFluidSysRef
    else UNDEFINED endif
ENDRULE

RULE ResCentralHtgClgSys:ChWFluidSegInRef
  CHECKSIM
    if( Type = "Four-pipe fan coil" )
    then if( LocalCompAssigned( ChWFluidSegInRef ) = 0 )
         then PostError("The chill water inlet fluid segment of central system '%s' must be defined", Name)
         else if( ChWFluidSegInRef:ParentFluidSysType != "ChilledWater" )
              then PostError("The inlet fluid segment of coil '%s' must belong to a 
                              ChilledWater system.", Name) 
              else UNCHANGED
         endif endif
    else UNCHANGED
    endif
  SIZING_PROPOSED
    if( Type = "Water source heat pump" .OR. Type = "Hydronic heating only" .OR. Type = "Variable refrigerant flow" )
    then UNDEFINED // Purge reference for when not applicable
    else UNCHANGED
    endif
ENDRULE

RULE ResCentralHtgClgSys:ChWFluidSegOutRef
  CHECKSIM
    if( Type = "Four-pipe fan coil" )
    then if( LocalCompAssigned( ChWFluidSegOutRef ) = 0 )
         then PostError("The chill water inlet fluid segment of central system '%s' must be defined", Name)
         else if( ChWFluidSegOutRef:ParentFluidSysType != "ChilledWater" )
              then PostError("The inlet fluid segment of coil '%s' must belong to a 
                              ChilledWater system.", Name) 
              else UNCHANGED
         endif endif
    else UNCHANGED
    endif
  SIZING_PROPOSED
    if( Type = "Water source heat pump" .OR. Type = "Hydronic heating only" .OR. Type = "Variable refrigerant flow" )
    then UNDEFINED // Purge reference for when not applicable
    else UNCHANGED
    endif
ENDRULE

RULE NEW ResCentralHtgClgSys:ChWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Four-pipe fan coil" .AND. LocalCompAssigned( ChWFluidSegInRef ) )
    then ChWFluidSegInRef:ParentFluidSysRef
    else UNDEFINED endif
ENDRULE

RULE ResCentralHtgClgSys:CWFluidSegInRef
  CHECKSIM
    if( Type = "Water source heat pump" )
    then if( LocalCompAssigned( CWFluidSegInRef ) = 0 )
         then PostError("The condenser water inlet fluid segment of central system '%s' must be defined", Name)
         else if( CWFluidSegInRef:ParentFluidSysType != "CondenserWater" )
              then PostError("The inlet fluid segment of coil '%s' must belong to a 
                              CondenserWater system.", Name) 
              else UNCHANGED
         endif endif
    else UNCHANGED
    endif
  SIZING_PROPOSED
    if( Type = "Water source heat pump" )
    then UNCHANGED 
    else UNDEFINED // Purge reference for when not applicable
    endif
ENDRULE

RULE ResCentralHtgClgSys:CWFluidSegOutRef
  CHECKSIM
    if( Type = "Water source heat pump" )
    then if( LocalCompAssigned( CWFluidSegOutRef ) = 0 )
         then PostError("The condenser water inlet fluid segment of central system '%s' must be defined", Name)
         else if( CWFluidSegOutRef:ParentFluidSysType != "CondenserWater" )
              then PostError("The inlet fluid segment of coil '%s' must belong to a 
                              CondenserWater system.", Name) 
              else UNCHANGED
         endif endif
    else UNCHANGED
    endif
  SIZING_PROPOSED
    if( Type = "Water source heat pump" )
    then UNCHANGED 
    else UNDEFINED // Purge reference for when not applicable
    endif
ENDRULE

RULE NEW ResCentralHtgClgSys:CWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Water source heat pump" .AND. LocalCompAssigned( CWFluidSegInRef ) )
    then CWFluidSegInRef:ParentFluidSysRef
    else UNDEFINED endif
ENDRULE

RULE ResCentralHtgClgSys:HtgSizingFactor
  DEFAULT
    2
ENDRULE

RULE ResCentralHtgClgSys:ClgSizingFactor
  DEFAULT
    1.1
ENDRULE

RULE ResCentralHtgClgSys:COP47
  DEFAULT
    if( Type = "Water source heat pump" )
    then 2.9
    else UNDEFINED
    endif
ENDRULE

RULE ResCentralHtgClgSys:EER
  DEFAULT
    if( Type = "Water source heat pump" )
    then 10
    else UNDEFINED
    endif
ENDRULE

// ---------- DwellUnitType ----------

RULE DwellUnitType:NumCentralEquipTypes
  DEFAULT
    1
  CHECKSIM
    if ( HVACSysType = "Central Heating and Cooling System" )
    then if( NumCentralEquipTypes > 0 .AND. LocalCompAssigned( HVACCentralRef[1] ) == 0 ) then  PostError( "All central equipment assignments in DwellUnitType '%s' must be specified (first is excluded)", Name )
			   else if( NumCentralEquipTypes > 1 .AND. LocalCompAssigned( HVACCentralRef[2] ) == 0 ) then  PostError( "All central equipment assignments in DwellUnitType '%s' must be specified (second is excluded)", Name )
			   else if( NumCentralEquipTypes > 2 .AND. LocalCompAssigned( HVACCentralRef[3] ) == 0 ) then  PostError( "All central equipment assignments in DwellUnitType '%s' must be specified (third is excluded)", Name )
			   else if( NumCentralEquipTypes > 3 .AND. LocalCompAssigned( HVACCentralRef[4] ) == 0 ) then  PostError( "All central equipment assignments in DwellUnitType '%s' must be specified (fourth is excluded)", Name )
			   else if( NumCentralEquipTypes > 4 .AND. LocalCompAssigned( HVACCentralRef[5] ) == 0 ) then  PostError( "All central equipment assignments in DwellUnitType '%s' must be specified (fifth is excluded)", Name )
			   else UNCHANGED endif endif endif endif endif
		else UNCHANGED endif
ENDRULE

RULE DwellUnitType:CentralEquipCount[1]
  DEFAULT
    1
ENDRULE
RULE DwellUnitType:CentralEquipCount[2]
  DEFAULT
    1
ENDRULE
RULE DwellUnitType:CentralEquipCount[3]
  DEFAULT
    1
ENDRULE
RULE DwellUnitType:CentralEquipCount[4]
  DEFAULT
    1
ENDRULE
RULE DwellUnitType:CentralEquipCount[5]
  DEFAULT
    1
ENDRULE

RULE DwellUnitType:CentralEqpType
  DEFAULT
  // all central htg clg system in a dwell unit type must be of same type
    if( HVACSysType = "Central Heating and Cooling System" .AND. LocalCompAssigned( HVACCentralRef[1] ) )
    then ValidOr( HVACCentralRef[1]:Type, "" )
    else UNDEFINED
    endif
  CHECKSIM
    if( HVACSysType = "Central Heating and Cooling System" )
    then if( NumCentralEquipTypes > 1 .AND. ValidOr( HVACCentralRef[2]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must be of the same type", Name )
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr( HVACCentralRef[3]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must be of the same type", Name )
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr( HVACCentralRef[4]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must be of the same type", Name )
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr( HVACCentralRef[5]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must be of the same type", Name )
				 else UNCHANGED endif endif endif endif 
		else UNCHANGED endif
ENDRULE

RULE DwellUnitType:ServesAsDHWHtr
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System" )
    then 0 else UNCHANGED endif
ENDRULE

RULE DwellUnitType:HtEqpUsedAsDHWHtr
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System" )
    then 0 else UNCHANGED endif
ENDRULE
    
RULE NEW DwellUnitType:HWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:HWFluidSysRef, "" )
    else UNDEFINED
    endif
  CHECKSIM
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then if ( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:HWFluidSysRef, "") != HWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same hot water fluid system", Name )
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:HWFluidSysRef, "") != HWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same hot water fluid system", Name )
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:HWFluidSysRef, "") != HWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same hot water fluid system", Name )
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:HWFluidSysRef, "") != HWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same hot water fluid system", Name )
				 else UNCHANGED endif endif endif endif 
		else UNCHANGED endif
ENDRULE

RULE NEW DwellUnitType:HWFluidSegInRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:HWFluidSegInRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnitType:HWFluidSegOutRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:HWFluidSegOutRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnitType:ChWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:ChWFluidSysRef, "" )
    else UNDEFINED
    endif
  CHECKSIM
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same chilled water fluid system", Name )
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same chilled water fluid system", Name )
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same chilled water fluid system", Name )
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same chilled water fluid system", Name )
				 else UNCHANGED endif endif endif endif 
		else UNCHANGED endif
ENDRULE

RULE NEW DwellUnitType:ChWFluidSegInRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:ChWFluidSegInRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnitType:ChWFluidSegOutRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:ChWFluidSegOutRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnitType:CWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then ValidOr( HVACCentralRef[1]:CWFluidSysRef, "" )
    else UNDEFINED
    endif
  CHECKSIM
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same condenser water fluid system", Name )
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same condenser water fluid system", Name )
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same condenser water fluid system", Name )
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same condenser water fluid system", Name )
				 else UNCHANGED endif endif endif endif 
		else UNCHANGED endif
ENDRULE

RULE NEW DwellUnitType:CWFluidSegInRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then ValidOr( HVACCentralRef[1]:CWFluidSegInRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnitType:CWFluidSegOutRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then ValidOr( HVACCentralRef[1]:CWFluidSegOutRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnitType:WSHPEER
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System" .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then if( NumCentralEquipTypes = 1 ) then ValidOr( HVACCentralRef[1]:EER, 0 )
    else if( NumCentralEquipTypes = 2 ) then min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) )
    else if( NumCentralEquipTypes = 3 ) then min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) )
    else if( NumCentralEquipTypes = 4 ) then min( min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) ), ValidOr( HVACCentralRef[4]:EER, 0 ) )
    else if( NumCentralEquipTypes > 4 ) then min( min( min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) ), ValidOr( HVACCentralRef[4]:EER, 0 ) ), ValidOr( HVACCentralRef[5]:EER, 0 ) )
    else UNDEFINED endif endif endif endif endif
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnitType:WSHPCOP47
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    if( HVACSysType = "Central Heating and Cooling System" .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then if( NumCentralEquipTypes = 1 ) then ValidOr( HVACCentralRef[1]:COP47, 0 )
    else if( NumCentralEquipTypes = 2 ) then min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) )
    else if( NumCentralEquipTypes = 3 ) then min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) )
    else if( NumCentralEquipTypes = 4 ) then min( min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) ), ValidOr( HVACCentralRef[4]:COP47, 0 ) )
    else if( NumCentralEquipTypes > 4 ) then min( min( min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) ), ValidOr( HVACCentralRef[4]:COP47, 0 ) ), ValidOr( HVACCentralRef[5]:COP47, 0 ) )
    else UNDEFINED endif endif endif endif endif
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnitType:VRFSysRef
  DATATYPE
    VRFSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( IfValidAnd( CentralEqpType = "Water source heat pump" ) .AND. LocalCompAssigned( HVACCentralRef[1] ) )
    then ValidOr( HVACCentralRef[1]:VRFSysRef, "")
    else UNDEFINED
    endif
  CHECKSIM
    if( HVACSysType = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Variable refrigerant flow" ) )
    then if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same VRF system", Name )
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same VRF system", Name )
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same VRF system", Name )
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in DwellUnitType '%s' must connect to the same VRF system", Name )
				 else UNCHANGED endif endif endif endif 
		else UNCHANGED endif
ENDRULE

// ---------- ResHVACSys ----------

RULE ResHVACSys:NumCentralEquipTypes
  DEFAULT
    1
  CHECKSIM
    if ( Type = "Central Heating and Cooling System" )
    then if( NumCentralEquipTypes > 0 .AND. LocalCompAssigned( HVACCentralRef[1] ) == 0 ) then  PostError( "All central equipment assignments in ResHVACSys '%s' must be specified (first is excluded)", Name )
			   else if( NumCentralEquipTypes > 1 .AND. LocalCompAssigned( HVACCentralRef[2] ) == 0 ) then  PostError( "All central equipment assignments in ResHVACSys '%s' must be specified (second is excluded)", Name )
			   else if( NumCentralEquipTypes > 2 .AND. LocalCompAssigned( HVACCentralRef[3] ) == 0 ) then  PostError( "All central equipment assignments in ResHVACSys '%s' must be specified (third is excluded)", Name )
			   else if( NumCentralEquipTypes > 3 .AND. LocalCompAssigned( HVACCentralRef[4] ) == 0 ) then  PostError( "All central equipment assignments in ResHVACSys '%s' must be specified (fourth is excluded)", Name )
			   else if( NumCentralEquipTypes > 4 .AND. LocalCompAssigned( HVACCentralRef[5] ) == 0 ) then  PostError( "All central equipment assignments in ResHVACSys '%s' must be specified (fifth is excluded)", Name )
			   else if( NumCentralEquipTypes > 5 .AND. LocalCompAssigned( HVACCentralRef[6] ) == 0 ) then  PostError( "All central equipment assignments in ResHVACSys '%s' must be specified (sixth is excluded)", Name )
			   else if( NumCentralEquipTypes > 6 .AND. LocalCompAssigned( HVACCentralRef[7] ) == 0 ) then  PostError( "All central equipment assignments in ResHVACSys '%s' must be specified (seventh is excluded)", Name )
			   else if( NumCentralEquipTypes > 7 .AND. LocalCompAssigned( HVACCentralRef[8] ) == 0 ) then  PostError( "All central equipment assignments in ResHVACSys '%s' must be specified (eighth is excluded)", Name )
			   else if( NumCentralEquipTypes > 8 .AND. LocalCompAssigned( HVACCentralRef[9] ) == 0 ) then  PostError( "All central equipment assignments in ResHVACSys '%s' must be specified (ninth is excluded)", Name )
			   else if( NumCentralEquipTypes > 9 .AND. LocalCompAssigned( HVACCentralRef[10] ) == 0 ) then  PostError( "All central equipment assignments in ResHVACSys '%s' must be specified (tenth is excluded)", Name )
			   else UNCHANGED endif endif endif endif endif endif endif endif endif endif
		else UNCHANGED endif
ENDRULE

RULE ResHVACSys:CentralEquipCount[1]
  DEFAULT
    1
ENDRULE
RULE ResHVACSys:CentralEquipCount[2]
  DEFAULT
    1
ENDRULE
RULE ResHVACSys:CentralEquipCount[3]
  DEFAULT
    1
ENDRULE
RULE ResHVACSys:CentralEquipCount[4]
  DEFAULT
    1
ENDRULE
RULE ResHVACSys:CentralEquipCount[5]
  DEFAULT
    1
ENDRULE
RULE ResHVACSys:CentralEquipCount[6]
  DEFAULT
    1
ENDRULE
RULE ResHVACSys:CentralEquipCount[7]
  DEFAULT
    1
ENDRULE
RULE ResHVACSys:CentralEquipCount[8]
  DEFAULT
    1
ENDRULE
RULE ResHVACSys:CentralEquipCount[9]
  DEFAULT
    1
ENDRULE
RULE ResHVACSys:CentralEquipCount[10]
  DEFAULT
    1
ENDRULE

RULE ResHVACSys:CentralEqpType
  DEFAULT
  // all central htg clg system in a HVAC system must be of same type
    if( Type = "Central Heating and Cooling System" .AND. LocalCompAssigned( HVACCentralRef[1] ) )
    then ValidOr( HVACCentralRef[1]:Type, "" )
    else UNDEFINED
    endif
  CHECKSIM
    if( Type = "Central Heating and Cooling System" )
    then if( NumCentralEquipTypes > 1 .AND. ValidOr( HVACCentralRef[2]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must be of the same type", Name )
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr( HVACCentralRef[3]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must be of the same type", Name )
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr( HVACCentralRef[4]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must be of the same type", Name )
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr( HVACCentralRef[5]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must be of the same type", Name )
				 else if( NumCentralEquipTypes > 5 .AND. ValidOr( HVACCentralRef[6]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must be of the same type", Name )
				 else if( NumCentralEquipTypes > 6 .AND. ValidOr( HVACCentralRef[7]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must be of the same type", Name )
				 else if( NumCentralEquipTypes > 7 .AND. ValidOr( HVACCentralRef[8]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must be of the same type", Name )
				 else if( NumCentralEquipTypes > 8 .AND. ValidOr( HVACCentralRef[9]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must be of the same type", Name )
				 else if( NumCentralEquipTypes > 9 .AND. ValidOr( HVACCentralRef[10]:Type, "" ) != CentralEqpType ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must be of the same type", Name )
				 else UNCHANGED endif endif endif endif endif endif endif endif endif
		else UNCHANGED endif
ENDRULE

RULE NEW ResHVACSys:HWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:HWFluidSysRef, "" )
    else UNDEFINED
    endif
  CHECKSIM
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then if ( NumCentralEquipTypes > 1 .AND. ValidOr( HVACCentralRef[2]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same hot water fluid system", Name )
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr( HVACCentralRef[3]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same hot water fluid system", Name )
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr( HVACCentralRef[4]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same hot water fluid system", Name )
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr( HVACCentralRef[5]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same hot water fluid system", Name )
				 else if( NumCentralEquipTypes > 5 .AND. ValidOr( HVACCentralRef[6]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same hot water fluid system", Name )
				 else if( NumCentralEquipTypes > 6 .AND. ValidOr( HVACCentralRef[7]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same hot water fluid system", Name )
				 else if( NumCentralEquipTypes > 7 .AND. ValidOr( HVACCentralRef[8]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same hot water fluid system", Name )
				 else if( NumCentralEquipTypes > 8 .AND. ValidOr( HVACCentralRef[9]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same hot water fluid system", Name )
				 else if( NumCentralEquipTypes > 9 .AND. ValidOr( HVACCentralRef[10]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same hot water fluid system", Name )
				 else UNCHANGED endif endif endif endif endif endif endif endif endif
		else UNCHANGED endif
ENDRULE

RULE NEW ResHVACSys:HWFluidSegInRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:HWFluidSegInRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:HWFluidSegOutRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:HWFluidSegOutRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:ChWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:ChWFluidSysRef, "" )
    else UNDEFINED
    endif
  CHECKSIM
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same chilled water fluid system", Name )
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same chilled water fluid system", Name )
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same chilled water fluid system", Name )
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same chilled water fluid system", Name )
				 else if( NumCentralEquipTypes > 5 .AND. ValidOr(HVACCentralRef[6]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same chilled water fluid system", Name )
				 else if( NumCentralEquipTypes > 6 .AND. ValidOr(HVACCentralRef[7]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same chilled water fluid system", Name )
				 else if( NumCentralEquipTypes > 7 .AND. ValidOr(HVACCentralRef[8]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same chilled water fluid system", Name )
				 else if( NumCentralEquipTypes > 8 .AND. ValidOr(HVACCentralRef[9]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same chilled water fluid system", Name )
				 else if( NumCentralEquipTypes > 9 .AND. ValidOr(HVACCentralRef[10]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same chilled water fluid system", Name )
				 else UNCHANGED endif endif endif endif endif endif endif endif endif
		else UNCHANGED endif
ENDRULE

RULE NEW ResHVACSys:ChWFluidSegInRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:ChWFluidSegInRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:ChWFluidSegOutRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
    then ValidOr( HVACCentralRef[1]:ChWFluidSegOutRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:CWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System" .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then ValidOr( HVACCentralRef[1]:CWFluidSysRef, "" )
    else UNDEFINED
    endif
  CHECKSIM
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same condenser water fluid system", Name )
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same condenser water fluid system", Name )
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same condenser water fluid system", Name )
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same condenser water fluid system", Name )
				 else if( NumCentralEquipTypes > 5 .AND. ValidOr(HVACCentralRef[6]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same condenser water fluid system", Name )
				 else if( NumCentralEquipTypes > 6 .AND. ValidOr(HVACCentralRef[7]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same condenser water fluid system", Name )
				 else if( NumCentralEquipTypes > 7 .AND. ValidOr(HVACCentralRef[8]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same condenser water fluid system", Name )
				 else if( NumCentralEquipTypes > 8 .AND. ValidOr(HVACCentralRef[9]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same condenser water fluid system", Name )
				 else if( NumCentralEquipTypes > 9 .AND. ValidOr(HVACCentralRef[10]:CWFluidSysRef, "") != CWFluidSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same condenser water fluid system", Name )
				 else UNCHANGED endif endif endif endif endif endif endif endif endif
		else UNCHANGED endif
ENDRULE

RULE NEW ResHVACSys:CWFluidSegInRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then ValidOr( HVACCentralRef[1]:CWFluidSegInRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:CWFluidSegOutRef
  DATATYPE
    FluidSeg
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then ValidOr( HVACCentralRef[1]:CWFluidSegOutRef, "" )
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:WSHPEER
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System" .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then if( NumCentralEquipTypes = 1 ) then ValidOr( HVACCentralRef[1]:EER, 0 )
    else if( NumCentralEquipTypes = 2 ) then min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) )
    else if( NumCentralEquipTypes = 3 ) then min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) )
    else if( NumCentralEquipTypes = 4 ) then min( min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) ), ValidOr( HVACCentralRef[4]:EER, 0 ) )
    else if( NumCentralEquipTypes = 5 ) then min( min( min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) ), ValidOr( HVACCentralRef[4]:EER, 0 ) ), ValidOr( HVACCentralRef[5]:EER, 0 ) )
    else if( NumCentralEquipTypes = 6 ) then min( min( min( min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) ), ValidOr( HVACCentralRef[4]:EER, 0 ) ), ValidOr( HVACCentralRef[5]:EER, 0 ) ),
                                             ValidOr( HVACCentralRef[6]:EER, 0 ) )
    else if( NumCentralEquipTypes = 7 ) then min( min( min( min( min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) ), ValidOr( HVACCentralRef[4]:EER, 0 ) ), ValidOr( HVACCentralRef[5]:EER, 0 ) ),
                                             ValidOr( HVACCentralRef[6]:EER, 0 ) ), ValidOr( HVACCentralRef[7]:EER, 0 ) )
    else if( NumCentralEquipTypes = 8 ) then min( min( min( min( min( min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) ), ValidOr( HVACCentralRef[4]:EER, 0 ) ), ValidOr( HVACCentralRef[5]:EER, 0 ) ),
                                             ValidOr( HVACCentralRef[6]:EER, 0 ) ), ValidOr( HVACCentralRef[7]:EER, 0 ) ), ValidOr( HVACCentralRef[8]:EER, 0 ) )
    else if( NumCentralEquipTypes = 9 ) then min( min( min( min( min( min( min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) ), ValidOr( HVACCentralRef[4]:EER, 0 ) ), ValidOr( HVACCentralRef[5]:EER, 0 ) ),
                                             ValidOr( HVACCentralRef[6]:EER, 0 ) ), ValidOr( HVACCentralRef[7]:EER, 0 ) ), ValidOr( HVACCentralRef[8]:EER, 0 ) ), ValidOr( HVACCentralRef[9]:EER, 0 ) )
    else if( NumCentralEquipTypes > 9 ) then min( min( min( min( min( min( min( min( min( ValidOr( HVACCentralRef[1]:EER, 0 ), ValidOr( HVACCentralRef[2]:EER, 0 ) ), ValidOr( HVACCentralRef[3]:EER, 0 ) ), ValidOr( HVACCentralRef[4]:EER, 0 ) ), ValidOr( HVACCentralRef[5]:EER, 0 ) ),
                                             ValidOr( HVACCentralRef[6]:EER, 0 ) ), ValidOr( HVACCentralRef[7]:EER, 0 ) ), ValidOr( HVACCentralRef[8]:EER, 0 ) ), ValidOr( HVACCentralRef[9]:EER, 0 ) ), ValidOr( HVACCentralRef[10]:EER, 0 ) )
    else UNDEFINED endif endif endif endif endif endif endif endif endif endif
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:WSHPCOP47
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    if( Type = "Central Heating and Cooling System" .AND. IfValidAnd( CentralEqpType = "Water source heat pump" ) )
    then if( NumCentralEquipTypes = 1 ) then ValidOr( HVACCentralRef[1]:COP47, 0 )
    else if( NumCentralEquipTypes = 2 ) then min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) )
    else if( NumCentralEquipTypes = 3 ) then min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) )
    else if( NumCentralEquipTypes = 4 ) then min( min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) ), ValidOr( HVACCentralRef[4]:COP47, 0 ) )
    else if( NumCentralEquipTypes = 5 ) then min( min( min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) ), ValidOr( HVACCentralRef[4]:COP47, 0 ) ), ValidOr( HVACCentralRef[5]:COP47, 0 ) )
    else if( NumCentralEquipTypes = 6 ) then min( min( min( min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) ), ValidOr( HVACCentralRef[4]:COP47, 0 ) ), ValidOr( HVACCentralRef[5]:COP47, 0 ) ),
                                             ValidOr( HVACCentralRef[6]:COP47, 0 ) )
    else if( NumCentralEquipTypes = 7 ) then min( min( min( min( min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) ), ValidOr( HVACCentralRef[4]:COP47, 0 ) ), ValidOr( HVACCentralRef[5]:COP47, 0 ) ),
                                             ValidOr( HVACCentralRef[6]:COP47, 0 ) ), ValidOr( HVACCentralRef[7]:COP47, 0 ) )
    else if( NumCentralEquipTypes = 8 ) then min( min( min( min( min( min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) ), ValidOr( HVACCentralRef[4]:COP47, 0 ) ), ValidOr( HVACCentralRef[5]:COP47, 0 ) ),
                                             ValidOr( HVACCentralRef[6]:COP47, 0 ) ), ValidOr( HVACCentralRef[7]:COP47, 0 ) ), ValidOr( HVACCentralRef[8]:COP47, 0 ) )
    else if( NumCentralEquipTypes = 9 ) then min( min( min( min( min( min( min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) ), ValidOr( HVACCentralRef[4]:COP47, 0 ) ), ValidOr( HVACCentralRef[5]:COP47, 0 ) ),
                                             ValidOr( HVACCentralRef[6]:COP47, 0 ) ), ValidOr( HVACCentralRef[7]:COP47, 0 ) ), ValidOr( HVACCentralRef[8]:COP47, 0 ) ), ValidOr( HVACCentralRef[9]:COP47, 0 ) )
    else if( NumCentralEquipTypes > 9 ) then min( min( min( min( min( min( min( min( min( ValidOr( HVACCentralRef[1]:COP47, 0 ), ValidOr( HVACCentralRef[2]:COP47, 0 ) ), ValidOr( HVACCentralRef[3]:COP47, 0 ) ), ValidOr( HVACCentralRef[4]:COP47, 0 ) ), ValidOr( HVACCentralRef[5]:COP47, 0 ) ),
                                             ValidOr( HVACCentralRef[6]:COP47, 0 ) ), ValidOr( HVACCentralRef[7]:COP47, 0 ) ), ValidOr( HVACCentralRef[8]:COP47, 0 ) ), ValidOr( HVACCentralRef[9]:COP47, 0 ) ), ValidOr( HVACCentralRef[10]:COP47, 0 ) )
    else UNDEFINED endif endif endif endif endif endif endif endif endif endif
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:VRFSysRef
  DATATYPE
    VRFSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( LocalCompAssigned( HVACCentralRef[1] ) .AND. IfValidAnd( CentralEqpType = "Variable refrigerant flow" ) )
    then ValidOr( HVACCentralRef[1]:VRFSysRef, "")
    else UNDEFINED
    endif
  CHECKSIM
    if( Type = "Central Heating and Cooling System"  .AND. IfValidAnd( CentralEqpType = "Variable refrigerant flow" ) )
    then if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same VRF system", Name )
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same VRF system", Name )
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same VRF system", Name )
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same VRF system", Name )
				 else if( NumCentralEquipTypes > 5 .AND. ValidOr(HVACCentralRef[6]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same VRF system", Name )
				 else if( NumCentralEquipTypes > 6 .AND. ValidOr(HVACCentralRef[7]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same VRF system", Name )
				 else if( NumCentralEquipTypes > 7 .AND. ValidOr(HVACCentralRef[8]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same VRF system", Name )
				 else if( NumCentralEquipTypes > 8 .AND. ValidOr(HVACCentralRef[9]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same VRF system", Name )
				 else if( NumCentralEquipTypes > 9 .AND. ValidOr(HVACCentralRef[10]:VRFSysRef, "") != VRFSysRef ) then  PostError( "All assigned central equipment in ResHVACSys '%s' must connect to the same VRF system", Name )
				 else UNCHANGED endif endif endif endif endif endif endif endif endif
		else UNCHANGED endif
ENDRULE

RULE NEW ResHVACSys:CentralEquipIssue2
  DATATYPE
    String
  INPUTCLASS
    NotInput
  DEFAULT
    if( IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
		     then if( NumCentralEquipTypes > 1 .AND. ValidOr( HVACCentralRef[2]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr( HVACCentralRef[3]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr( HVACCentralRef[4]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr( HVACCentralRef[5]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
				 else if( NumCentralEquipTypes > 5 .AND. ValidOr( HVACCentralRef[6]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
				 else if( NumCentralEquipTypes > 6 .AND. ValidOr( HVACCentralRef[7]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
				 else if( NumCentralEquipTypes > 7 .AND. ValidOr( HVACCentralRef[8]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
				 else if( NumCentralEquipTypes > 8 .AND. ValidOr( HVACCentralRef[9]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
				 else if( NumCentralEquipTypes > 9 .AND. ValidOr( HVACCentralRef[10]:HWFluidSysRef, "" ) != HWFluidSysRef ) then "All assigned central equipment must connect to the same hot water fluid system"
				 else if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
				 else if( NumCentralEquipTypes > 5 .AND. ValidOr(HVACCentralRef[6]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
				 else if( NumCentralEquipTypes > 6 .AND. ValidOr(HVACCentralRef[7]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
				 else if( NumCentralEquipTypes > 7 .AND. ValidOr(HVACCentralRef[8]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
				 else if( NumCentralEquipTypes > 8 .AND. ValidOr(HVACCentralRef[9]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
				 else if( NumCentralEquipTypes > 9 .AND. ValidOr(HVACCentralRef[10]:ChWFluidSysRef, "") != ChWFluidSysRef ) then "All assigned central equipment must connect to the same chilled water fluid system"
				 else "" endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif
		else if( IfValidAnd( CentralEqpType = "Water source heat pump" ) )
		     then if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
				 else if( NumCentralEquipTypes > 5 .AND. ValidOr(HVACCentralRef[6]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
				 else if( NumCentralEquipTypes > 6 .AND. ValidOr(HVACCentralRef[7]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
				 else if( NumCentralEquipTypes > 7 .AND. ValidOr(HVACCentralRef[8]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
				 else if( NumCentralEquipTypes > 8 .AND. ValidOr(HVACCentralRef[9]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
				 else if( NumCentralEquipTypes > 9 .AND. ValidOr(HVACCentralRef[10]:CWFluidSysRef, "") != CWFluidSysRef ) then "All assigned central equipment must connect to the same condenser water fluid system"
				 else "" endif endif endif endif endif endif endif endif endif
		else if( IfValidAnd( CentralEqpType = "Variable refrigerant flow" ) )
		     then if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
				 else if( NumCentralEquipTypes > 5 .AND. ValidOr(HVACCentralRef[6]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
				 else if( NumCentralEquipTypes > 6 .AND. ValidOr(HVACCentralRef[7]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
				 else if( NumCentralEquipTypes > 7 .AND. ValidOr(HVACCentralRef[8]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
				 else if( NumCentralEquipTypes > 8 .AND. ValidOr(HVACCentralRef[9]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
				 else if( NumCentralEquipTypes > 9 .AND. ValidOr(HVACCentralRef[10]:VRFSysRef, "") != VRFSysRef ) then "All assigned central equipment must connect to the same VRF system"
				 else "" endif endif endif endif endif endif endif endif endif
    else ""
    endif endif endif
ENDRULE

RULE ResHVACSys:CentralEquipIssue
  DEFAULT
    if( Type = "Central Heating and Cooling System" )
    then if( NumCentralEquipTypes > 0 .AND. LocalCompAssigned( HVACCentralRef[1] ) == 0 ) then  "All central equipment assignments must be specified (first is excluded)"
		else if( NumCentralEquipTypes > 1 .AND. LocalCompAssigned( HVACCentralRef[2] ) == 0 ) then  "All central equipment assignments must be specified (second is excluded)"
		else if( NumCentralEquipTypes > 2 .AND. LocalCompAssigned( HVACCentralRef[3] ) == 0 ) then  "All central equipment assignments must be specified (third is excluded)"
		else if( NumCentralEquipTypes > 3 .AND. LocalCompAssigned( HVACCentralRef[4] ) == 0 ) then  "All central equipment assignments must be specified (fourth is excluded)"
		else if( NumCentralEquipTypes > 4 .AND. LocalCompAssigned( HVACCentralRef[5] ) == 0 ) then  "All central equipment assignments must be specified (fifth is excluded)"
		else if( NumCentralEquipTypes > 5 .AND. LocalCompAssigned( HVACCentralRef[6] ) == 0 ) then  "All central equipment assignments must be specified (sixth is excluded)"
		else if( NumCentralEquipTypes > 6 .AND. LocalCompAssigned( HVACCentralRef[7] ) == 0 ) then  "All central equipment assignments must be specified (seventh is excluded)"
		else if( NumCentralEquipTypes > 7 .AND. LocalCompAssigned( HVACCentralRef[8] ) == 0 ) then  "All central equipment assignments must be specified (eighth is excluded)"
		else if( NumCentralEquipTypes > 8 .AND. LocalCompAssigned( HVACCentralRef[9] ) == 0 ) then  "All central equipment assignments must be specified (ninth is excluded)"
		else if( NumCentralEquipTypes > 9 .AND. LocalCompAssigned( HVACCentralRef[10] ) == 0 ) then "All central equipment assignments must be specified (tenth is excluded)"
    else if( NumCentralEquipTypes > 1 .AND. ValidOr( HVACCentralRef[2]:Type, "" ) != CentralEqpType ) then  "All assigned central equipment must be of the same type"
		else if( NumCentralEquipTypes > 2 .AND. ValidOr( HVACCentralRef[3]:Type, "" ) != CentralEqpType ) then  "All assigned central equipment must be of the same type"
		else if( NumCentralEquipTypes > 3 .AND. ValidOr( HVACCentralRef[4]:Type, "" ) != CentralEqpType ) then  "All assigned central equipment must be of the same type"
		else if( NumCentralEquipTypes > 4 .AND. ValidOr( HVACCentralRef[5]:Type, "" ) != CentralEqpType ) then  "All assigned central equipment must be of the same type"
		else if( NumCentralEquipTypes > 5 .AND. ValidOr( HVACCentralRef[6]:Type, "" ) != CentralEqpType ) then  "All assigned central equipment must be of the same type"
		else if( NumCentralEquipTypes > 6 .AND. ValidOr( HVACCentralRef[7]:Type, "" ) != CentralEqpType ) then  "All assigned central equipment must be of the same type"
		else if( NumCentralEquipTypes > 7 .AND. ValidOr( HVACCentralRef[8]:Type, "" ) != CentralEqpType ) then  "All assigned central equipment must be of the same type"
		else if( NumCentralEquipTypes > 8 .AND. ValidOr( HVACCentralRef[9]:Type, "" ) != CentralEqpType ) then  "All assigned central equipment must be of the same type"
		else if( NumCentralEquipTypes > 9 .AND. ValidOr( HVACCentralRef[10]:Type, "" ) != CentralEqpType ) then "All assigned central equipment must be of the same type"
//		else if( IfValidAnd( CentralEqpType = "Four-pipe fan coil" ) )
//		     then if( NumCentralEquipTypes > 1 .AND. ValidOr( HVACCentralRef[2]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
//		     else if( NumCentralEquipTypes > 2 .AND. ValidOr( HVACCentralRef[3]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
//				 else if( NumCentralEquipTypes > 3 .AND. ValidOr( HVACCentralRef[4]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
//				 else if( NumCentralEquipTypes > 4 .AND. ValidOr( HVACCentralRef[5]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
//				 else if( NumCentralEquipTypes > 5 .AND. ValidOr( HVACCentralRef[6]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
//				 else if( NumCentralEquipTypes > 6 .AND. ValidOr( HVACCentralRef[7]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
//				 else if( NumCentralEquipTypes > 7 .AND. ValidOr( HVACCentralRef[8]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
//				 else if( NumCentralEquipTypes > 8 .AND. ValidOr( HVACCentralRef[9]:HWFluidSysRef, "" ) != HWFluidSysRef ) then  "All assigned central equipment must connect to the same hot water fluid system"
//				 else if( NumCentralEquipTypes > 9 .AND. ValidOr( HVACCentralRef[10]:HWFluidSysRef, "" ) != HWFluidSysRef ) then "All assigned central equipment must connect to the same hot water fluid system"
//				 else if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
//		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
//				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
//				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
//				 else if( NumCentralEquipTypes > 5 .AND. ValidOr(HVACCentralRef[6]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
//				 else if( NumCentralEquipTypes > 6 .AND. ValidOr(HVACCentralRef[7]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
//				 else if( NumCentralEquipTypes > 7 .AND. ValidOr(HVACCentralRef[8]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
//				 else if( NumCentralEquipTypes > 8 .AND. ValidOr(HVACCentralRef[9]:ChWFluidSysRef, "") != ChWFluidSysRef ) then  "All assigned central equipment must connect to the same chilled water fluid system"
//				 else if( NumCentralEquipTypes > 9 .AND. ValidOr(HVACCentralRef[10]:ChWFluidSysRef, "") != ChWFluidSysRef ) then "All assigned central equipment must connect to the same chilled water fluid system"
//				 else "" endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif
//		else if( IfValidAnd( CentralEqpType = "Water source heat pump" ) )
//		     then if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
//		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
//				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
//				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
//				 else if( NumCentralEquipTypes > 5 .AND. ValidOr(HVACCentralRef[6]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
//				 else if( NumCentralEquipTypes > 6 .AND. ValidOr(HVACCentralRef[7]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
//				 else if( NumCentralEquipTypes > 7 .AND. ValidOr(HVACCentralRef[8]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
//				 else if( NumCentralEquipTypes > 8 .AND. ValidOr(HVACCentralRef[9]:CWFluidSysRef, "") != CWFluidSysRef ) then  "All assigned central equipment must connect to the same condenser water fluid system"
//				 else if( NumCentralEquipTypes > 9 .AND. ValidOr(HVACCentralRef[10]:CWFluidSysRef, "") != CWFluidSysRef ) then "All assigned central equipment must connect to the same condenser water fluid system"
//				 else "" endif endif endif endif endif endif endif endif endif
//		else if( IfValidAnd( CentralEqpType = "Variable refrigerant flow" ) )
//		     then if( NumCentralEquipTypes > 1 .AND. ValidOr(HVACCentralRef[2]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
//		     else if( NumCentralEquipTypes > 2 .AND. ValidOr(HVACCentralRef[3]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
//				 else if( NumCentralEquipTypes > 3 .AND. ValidOr(HVACCentralRef[4]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
//				 else if( NumCentralEquipTypes > 4 .AND. ValidOr(HVACCentralRef[5]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
//				 else if( NumCentralEquipTypes > 5 .AND. ValidOr(HVACCentralRef[6]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
//				 else if( NumCentralEquipTypes > 6 .AND. ValidOr(HVACCentralRef[7]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
//				 else if( NumCentralEquipTypes > 7 .AND. ValidOr(HVACCentralRef[8]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
//				 else if( NumCentralEquipTypes > 8 .AND. ValidOr(HVACCentralRef[9]:VRFSysRef, "") != VRFSysRef ) then  "All assigned central equipment must connect to the same VRF system"
//				 else if( NumCentralEquipTypes > 9 .AND. ValidOr(HVACCentralRef[10]:VRFSysRef, "") != VRFSysRef ) then "All assigned central equipment must connect to the same VRF system"
//				 else "" endif endif endif endif endif endif endif endif endif
    else CentralEquipIssue2
    endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif endif ;endif endif endif
    else "" endif
ENDRULE	 

RULE ResHVACSys:NumUIDialogTabs
  DEFAULT
    5
ENDRULE

// --------- Set ResZn/ResOtherZn connections ----------

RULE NEW ResZn:ChildDwellUnitRef
  DATATYPE
    DwellUnit
  INPUTCLASS
    NotInput
  DEFAULT
    MaxChildComp( DwellUnit:CondFlrArea )
ENDRULE

RULE NEW ResZn:CentralEqpType
  DATATYPE
    String
  INPUTCLASS
    NotInput
  DEFAULT
    if( ChildDwellUnitRef:DwellUnitTypeRef:HVACSysType = "Central Heating and Cooling System" )
    then ChildDwellUnitRef:DwellUnitTypeRef:CentralEqpType
    else UNDEFINED
    endif
  CHECKSIM
    if( ChildDwellUnitRef:DwellUnitTypeRef:HVACSysType = "Central Heating and Cooling System" .AND.
                  NumUniqueChildVals( DwellUnit:DwellUnitTypeRef:CentralEqpType, 1 ) > 1 )
    then PostError( "The dwellUnits in ResZn '%s' are served by more than one type of central heating and cooling system which is not supported.", Name)
    else UNCHANGED
    endif
ENDRULE

RULE NEW ResZn:HWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( ChildDwellUnitRef:DwellUnitTypeRef:HVACSysType = "Central Heating and Cooling System" .AND. CentralEqpType = "Four-pipe fan coil" )
    then ChildDwellUnitRef:DwellUnitTypeRef:HVACCentralRef:HWFluidSysRef
    else UNDEFINED endif
  CHECKSIM
    if( ChildDwellUnitRef:DwellUnitTypeRef:HVACSysType = "Central Heating and Cooling System" .AND. CentralEqpType = "Four-pipe fan coil" .AND.
                  NumUniqueChildVals( DwellUnit:DwellUnitTypeRef:HWFluidSysRef, 1 ) > 1 )
    then PostError( "The dwellUnits in ResZn '%s' are served by more than one hot water loop which is not supported.", Name)
    else UNCHANGED
    endif
ENDRULE

RULE NEW ResZn:ChWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( ChildDwellUnitRef:DwellUnitTypeRef:HVACSysType = "Central Heating and Cooling System" .AND. CentralEqpType = "Four-pipe fan coil" )
    then ChildDwellUnitRef:DwellUnitTypeRef:HVACCentralRef:ChWFluidSysRef
    else UNDEFINED endif
  CHECKSIM
    if( ChildDwellUnitRef:DwellUnitTypeRef:HVACSysType = "Central Heating and Cooling System" .AND. CentralEqpType = "Four-pipe fan coil" .AND.
                  NumUniqueChildVals( DwellUnit:DwellUnitTypeRef:ChWFluidSysRef, 1 ) > 1 )
    then PostError( "The dwellUnits in ResZn '%s' are served by more than one chill water loop which is not supported.", Name)
    else UNCHANGED
    endif
ENDRULE

RULE NEW ResZn:CWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( ChildDwellUnitRef:DwellUnitTypeRef:HVACSysType = "Central Heating and Cooling System" .AND. CentralEqpType = "Water source heat pump" )
    then ChildDwellUnitRef:DwellUnitTypeRef:HVACCentralRef:CWFluidSysRef
    else UNDEFINED endif
  CHECKSIM
    if( ChildDwellUnitRef:DwellUnitTypeRef:HVACSysType = "Central Heating and Cooling System" .AND. CentralEqpType = "Water source heat pump" .AND.
                  NumUniqueChildVals( DwellUnit:DwellUnitTypeRef:CWFluidSysRef, 1 ) > 1 )
    then PostError( "The dwellUnits in ResZn '%s' are served by more than one condenser water loop which is not supported.", Name)
    else UNCHANGED
    endif
ENDRULE

RULE NEW ResZn:VRFSysRef
  DATATYPE
    VRFSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( ChildDwellUnitRef:DwellUnitTypeRef:HVACSysType = "Central Heating and Cooling System" .AND. CentralEqpType = "Variable refrigerant flow" )
    then ChildDwellUnitRef:DwellUnitTypeRef:HVACCentralRef:VRFSysRef
    else UNDEFINED endif
  CHECKSIM
    if( ChildDwellUnitRef:DwellUnitTypeRef:HVACSysType = "Central Heating and Cooling System" .AND. CentralEqpType = "Variable refrigerant flow" .AND.
                  NumUniqueChildVals( DwellUnit:DwellUnitTypeRef:VRFSysRef, 1 ) > 1 )
    then PostError( "The dwellUnits in ResZn '%s' are served by more than one VRF system which is not supported.", Name)
    else UNCHANGED
    endif
ENDRULE

RULE NEW ResOtherZn:HWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( IfValidAnd( ozHVACSystem:Type = "Central Heating and Cooling System" ) )
    then if( LocalCompAssigned( ozHVACSystem:HVACCentralRef:HWFluidSysRef ) )
         then ozHVACSystem:HVACCentralRef:HWFluidSysRef
         else UNDEFINED endif
    else UNDEFINED endif
ENDRULE

RULE NEW ResOtherZn:ChWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( IfValidAnd( ozHVACSystem:Type = "Central Heating and Cooling System" ) )
    then if( LocalCompAssigned( ozHVACSystem:HVACCentralRef:ChWFluidSysRef ) )
         then ozHVACSystem:HVACCentralRef:ChWFluidSysRef
         else UNDEFINED endif
    else UNDEFINED endif
ENDRULE

RULE NEW ResOtherZn:CWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( IfValidAnd( ozHVACSystem:Type = "Central Heating and Cooling System" ) )
    then if( LocalCompAssigned( ozHVACSystem:HVACCentralRef:CWFluidSysRef ) )
         then ozHVACSystem:HVACCentralRef:CWFluidSysRef
         else UNDEFINED endif
    else UNDEFINED endif
ENDRULE

RULE NEW ResOtherZn:VRFSysRef
  DATATYPE
    VRFSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( IfValidAnd( ozHVACSystem:Type = "Central Heating and Cooling System" ) )
    then if( LocalCompAssigned( ozHVACSystem:HVACCentralRef:VRFSysRef ) )
         then ozHVACSystem:HVACCentralRef:VRFSysRef
         else UNDEFINED endif
    else UNDEFINED endif
ENDRULE

// -------------------- Create ProcLd for Load Passing -------------------------

RULE NEW FluidSys:ProcLdRef
  DATATYPE
    ProcLd
  INPUTCLASS
    NotInput
ENDRULE
; removed test/reference Res loads - now supplied by CSE load passing - SAC 03/19/22
;  ANNUAL_PROPOSED
;    if( Proj:SimResZnInEnergyPlus = 0 .AND. 
;        ( SumRevRef( ResZn:HWFluidSysRef, ResZn:FloorArea) > 0 .OR.
;          SumRevRef( ResOtherZn:HWFluidSysRef, ResOtherZn:Area) > 0 .OR.
;          SumRevRef( ResZn:ChWFluidSysRef, ResZn:FloorArea) > 0 .OR.
;          SumRevRef( ResOtherZn:ChWFluidSysRef, ResOtherZn:Area) > 0 .OR.
;          SumRevRef( ResZn:CWFluidSysRef, ResZn:FloorArea) > 0 .OR.
;          SumRevRef( ResOtherZn:CWFluidSysRef, ResOtherZn:Area) > 0 ) )
;    then RuleLibrary( ProcLd, "ResLoad" , 1, Name)
;    else UNCHANGED
;    endif


// -------------------- Labels -------------------------
RULE NEW ResCentralHtgClgSys:TypeAbbrevStr
  DATATYPE
    String
  INPUTCLASS
    NotInput
  DEFAULT
    switch( Type )
      case "Four-pipe fan coil"       : "FPFC"
      case "Water source heat pump"   : "WSHP"
      case "Hydronic heating only"    : "Hydonic Htg Only"
      case "Variable refrigerant flow": "VRF"
      default                         : "unknown"
    endswitch
ENDRULE

// -------------------- Summary Stats & Tree Label ------------------------- SAC 02/25/22

; sum DwellUnitType area to FloorAreaServed - SAC 03/15/22
RULE ResCentralHtgClgSys:FloorAreaServed
  DEFAULT
	 SumRevRef( ResHVACSys:HVACCentralRef, ResHVACSys:FloorAreaServed ) +
	 SumRevRef( DwellUnitType:HVACCentralRef, DwellUnitType:DUCntrlHtClFlrAreaServed )
ENDRULE

RULE ResCentralHtgClgSys:NumAssigningDUs
  DEFAULT
    if (IfValidAnd( ResProj:IsMultiFamily > 0.5 )==0) then  UNDEFINED
    else  SumRevRef( DwellUnitType:HVACCentralRef, DwellUnitType:NumAssigningCntrlDUs )
    endif
ENDRULE

RULE ResCentralHtgClgSys:TreeDescrip
  DEFAULT
    if (IfValidAnd( ResProj:IsMultiFamily > 0.5 )==0) then  UNDEFINED
    else if (IfValidAnd( NumAssigningDUs > 0 ))
    then  Format( "%s, serving %g dwelling unit(s)", TypeAbbrevStr, NumAssigningDUs )
    else  Format( "%s, not assigned", TypeAbbrevStr )
    endif endif
ENDRULE


RULE DwellUnitType:NumCentralEqpUnits
  DEFAULT
    if( NumCentralEquipTypes = 1 ) then CentralEquipCount[1]
    else if( NumCentralEquipTypes = 2 ) then CentralEquipCount[1] + CentralEquipCount[2]
    else if( NumCentralEquipTypes = 3 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3]
    else if( NumCentralEquipTypes = 4 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3] + CentralEquipCount[4]
    else if( NumCentralEquipTypes > 4 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3] + CentralEquipCount[4] + CentralEquipCount[5]
    else 0
    endif endif endif endif endif
ENDRULE

RULE DwellUnitType:HeatEquipSummary
  DEFAULT
    if( IfValidAnd( HVACSysType = "Central Heating and Cooling System" ) .AND.
        LocalCompAssigned( HVACCentralRef ) )
    then if( HVACCentralRef:Type = "- select system type -" )
         then "unknown central system type"
         else if( HVACCentralRef:Type = "Water source heat pump" )
         then Format( "%.0f %s unit(s), %.1f COP, %.1f EER", NumCentralEqpUnits, CentralEqpType, WSHPCOP47, WSHPEER ) 
         else if( HVACCentralRef:Type = "Variable refrigerant flow" )
         then Format( "%.0f %s indoor unit(s)", NumCentralEqpUnits, CentralEqpType )
         else Format( "%.0f %s unit(s)", NumCentralEqpUnits, CentralEqpType )
         endif endif endif
    else UNCHANGED
    endif
ENDRULE

RULE ResHVACSys:NumCentralEqpUnits
  DEFAULT
    if( NumCentralEquipTypes = 1 ) then CentralEquipCount[1]
    else if( NumCentralEquipTypes = 2 ) then CentralEquipCount[1] + CentralEquipCount[2]
    else if( NumCentralEquipTypes = 3 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3]
    else if( NumCentralEquipTypes = 4 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3] + CentralEquipCount[4]
    else if( NumCentralEquipTypes = 5 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3] + CentralEquipCount[4] + CentralEquipCount[5]
    else if( NumCentralEquipTypes = 6 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3] + CentralEquipCount[4] + CentralEquipCount[5]
                                           + CentralEquipCount[6]
    else if( NumCentralEquipTypes = 7 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3] + CentralEquipCount[4] + CentralEquipCount[5]
                                           + CentralEquipCount[6] + CentralEquipCount[7]
    else if( NumCentralEquipTypes = 8 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3] + CentralEquipCount[4] + CentralEquipCount[5]
                                           + CentralEquipCount[6] + CentralEquipCount[7] + CentralEquipCount[8]
    else if( NumCentralEquipTypes = 9 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3] + CentralEquipCount[4] + CentralEquipCount[5]
                                           + CentralEquipCount[6] + CentralEquipCount[7] + CentralEquipCount[8] + CentralEquipCount[9]
    else if( NumCentralEquipTypes > 9 ) then CentralEquipCount[1] + CentralEquipCount[2] + CentralEquipCount[3] + CentralEquipCount[4] + CentralEquipCount[5]
                                           + CentralEquipCount[6] + CentralEquipCount[7] + CentralEquipCount[8] + CentralEquipCount[9] + CentralEquipCount[10]
    else 0
    endif endif endif endif endif endif endif endif endif endif
ENDRULE

RULE ResHVACSys:HeatEquipSummary
  DEFAULT
    if( IfValidAnd( Type = "Central Heating and Cooling System" ) .AND.
        LocalCompAssigned( HVACCentralRef ) )
    then if( HVACCentralRef:Type = "- select system type -" )
         then "unknown central system type"
         else if( HVACCentralRef:Type = "Water source heat pump" )
         then Format( "%.0f %s unit(s), %.1f COP, %.1f EER", NumCentralEqpUnits, CentralEqpType, WSHPCOP47, WSHPEER )
         else if( HVACCentralRef:Type = "Variable refrigerant flow" )
         then Format( "%.0f %s indoor unit(s)", NumCentralEqpUnits, CentralEqpType )
         else Format( "%.0f %s unit(s)", NumCentralEqpUnits, CentralEqpType )
         endif endif endif
    else UNCHANGED
    endif
ENDRULE

// --------------- For Auto hard Sizing ---------------
RULE Proj:ResAutoHardSizeAirFlowPerSqFt
  HELP
    "Used for AutoHardSizing only, a project level specification of air side 
     supply air flow capacity based on system conditioned floor area. Only 
     applied to ResHVACSys that connected to FluidSys!"
  DEFAULT
    if( LocalStatus(AutoHardSize) = 0 .OR. AutoHardSize = 0 )
    then UNDEFINED
    else 1.0 ; cfm/ft2
    endif  
  SIZING
    UNDEFINED
ENDRULE

RULE Proj:ResAutoHardSizeAirFlowPerTon
  HELP
    "Used for AutoHardSizing only, a project level specification of air side 
     cooling capacity based on supply air flow. Only applied to ResHVACSys that 
     connected to FluidSys!"
  DEFAULT
    if( LocalStatus(AutoHardSize) = 0 .OR. AutoHardSize = 0 )
    then UNDEFINED
    else 400 ; cfm/ton (net) cooling
    endif
  SIZING
    UNDEFINED
ENDRULE

RULE NEW DwellUnitType:SumCentralClgCap
  DESCRIPTION
    "The sum of cooling capacity of the residential central heating and cooling system.
     For auto hard sizing only"
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  UNITS
    Btu/h
  DEFAULT
    if( IfValidAnd( HVACSysType = "Central Heating and Cooling System" ) .AND. 
        IfValidAnd( Proj:AutoHardSize = 1 ) )
    then DUFloorAreaServed * Proj:ResAutoHardSizeAirFlowPerSqFt / Proj:ResAutoHardSizeAirFlowPerTon * 12000
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnitType:SumCentralHtRejLd
  DATATYPE
    Float
  DESCRIPTION
    "The sum of heat rejected by the WSHP at the peak rated output."
  INPUTCLASS
    NotInput
  UNITS
    Btu/h
  DEFAULT
    if( IfValidAnd( HVACSysType = "Central Heating and Cooling System" ) .AND. 
        IfValidAnd( CentralEqpType = "Water source heat pump" ) .AND.
        IfValidAnd( Proj:AutoHardSize = 1 ) )
    then SumCentralClgCap * ( 1 + ( 3.412 / ValidOr( WSHPEER, 12 ) ) )
    else 0
    endif
ENDRULE

RULE NEW DwellUnitType:SumCentralHtgCap
  DESCRIPTION
    "The sum of cooling capacity of the residential central heating and cooling system.
     For auto hard sizing only"
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  UNITS
    Btu/h
  DEFAULT
    if( IfValidAnd( HVACSysType = "Central Heating and Cooling System" ) .AND. 
        IfValidAnd( Proj:AutoHardSize = 1 ) )
    then 1.05 * DUFloorAreaServed * Proj:ResAutoHardSizeAirFlowPerSqFt / Proj:ResAutoHardSizeAirFlowPerTon * 12000
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnitType:SumCentralHtExtractionLd
  DESCRIPTION
    "The sum of extraction load of the residential central heating and cooling system.
     For auto hard sizing only"
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  UNITS
    Btu/h
  DEFAULT
    if( IfValidAnd( HVACSysType = "Central Heating and Cooling System" ) .AND. 
        IfValidAnd( CentralEqpType = "Water source heat pump" ) .AND.
        IfValidAnd( Proj:AutoHardSize = 1 ) )
    then SumCentralHtgCap * ( 1 - 1 / ValidOr( WSHPCOP47, 3 ) )
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:SumCentralClgCap
  DESCRIPTION
    "The sum of cooling capacity of the residential central heating and cooling system.
     For auto hard sizing only"
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  UNITS
    Btu/h
  DEFAULT
    if( IfValidAnd( Type = "Central Heating and Cooling System" ) .AND. 
        IfValidAnd( Proj:AutoHardSize = 1 ) )
    then FloorAreaServed * Proj:ResAutoHardSizeAirFlowPerSqFt / Proj:ResAutoHardSizeAirFlowPerTon * 12000
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:SumCentralHtRejLd
  DATATYPE
    Float
  DESCRIPTION
    "The sum of heat rejected by the WSHP at the peak rated output."
  INPUTCLASS
    NotInput
  UNITS
    Btu/h
  DEFAULT
    if( IfValidAnd( Type = "Central Heating and Cooling System" ) .AND. 
        IfValidAnd( CentralEqpType = "Water source heat pump" ) .AND.
        IfValidAnd( Proj:AutoHardSize = 1 ) )
    then SumCentralClgCap * ( 1 + ( 3.412 / ValidOr( WSHPEER, 12 ) ) )
    else 0
    endif
ENDRULE

RULE NEW ResHVACSys:SumCentralHtgCap
  DESCRIPTION
    "The sum of cooling capacity of the residential central heating and cooling system.
     For auto hard sizing only"
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  UNITS
    Btu/h
  DEFAULT
    if( IfValidAnd( Type = "Central Heating and Cooling System" ) .AND. 
        IfValidAnd( Proj:AutoHardSize = 1 ) )
    then 1.05 * FloorAreaServed * Proj:ResAutoHardSizeAirFlowPerSqFt / Proj:ResAutoHardSizeAirFlowPerTon * 12000
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResHVACSys:SumCentralHtExtractionLd
  DESCRIPTION
    "The sum of extraction load of the residential central heating and cooling system.
     For auto hard sizing only"
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  UNITS
    Btu/h
  DEFAULT
    if( IfValidAnd( Type = "Central Heating and Cooling System" ) .AND. 
        IfValidAnd( CentralEqpType = "Water source heat pump" ) .AND.
        IfValidAnd( Proj:AutoHardSize = 1 ) )
    then SumCentralHtgCap * ( 1 - 1 / ValidOr( WSHPCOP47, 3 ) )
    else UNDEFINED
    endif
ENDRULE

// -----------------------------------------------------------------------------
// --------------------- Central Vent Sys -------------------------------
// -----------------------------------------------------------------------------
RULE ResCentralVentSys:TypeDescrip
// TO DO write *.rtf
  DEFAULT
    switch( Type )
    case "Balanced" : UNDEFINED
    case "Supply"   : UNDEFINED
    case "Exhaust"  : UNDEFINED
    default : UNDEFINED
    endswitch
ENDRULE

RULE ResOtherZn:IAQOption
  RESETS
    CentralSupplyCFM
    CentralExhaustCFM
ENDRULE

RULE DwellUnitType:IAQOption
  RESETS
    CentralSupplyCFM
    CentralExhaustCFM
ENDRULE

RULE ResOtherZn:CentralVentSysRef
  CHECKSIM
    if( IAQOption = "Central Supply / Central Exhaust" .AND.
        IfValidAnd( CentralVentSysRef:Type != "Balanced" ) )
    then PostError("ResOtherZn '%s' needs to be connected to a balanced central ventilation system.", Name )
    else if( ( IAQOption = "Central Supply / Individual Exhaust" .OR.
               IAQOption = "Central Supply" ) .AND.
        IfValidAnd( CentralVentSysRef:Type != "Supply" ) )
    then PostError("ResOtherZn '%s' needs to be connected to a central supply ventilation system.", Name )
    else if( ( IAQOption = "Central Exhaust / Individual Supply" .OR.
               IAQOption = "Central Exhaust" ) .AND.
        IfValidAnd( CentralVentSysRef:Type != "Exhaust" ) )
    then PostError("ResOtherZn '%s' needs to be connected to a central exhaust ventilation system.", Name )
    else UNCHANGED
    endif endif endif
ENDRULE

RULE DwellUnitType:CentralVentSysRef
  CHECKSIM
    if( IAQOption = "Central Supply / Central Exhaust" .AND.
        IfValidAnd( CentralVentSysRef:Type != "Balanced" ) )
    then PostError("DwellUnitType '%s' needs to be connected to a balanced central ventilation system.", Name )
    else if( ( IAQOption = "Central Supply / Individual Exhaust" .OR.
               IAQOption = "Central Supply" ) .AND.
        IfValidAnd( CentralVentSysRef:Type != "Supply" ) )
    then PostError("DwellUnitType '%s' needs to be connected to a central supply ventilation system.", Name )
    else if( ( IAQOption = "Central Exhaust / Individual Supply" .OR.
               IAQOption = "Central Exhaust" ) .AND.
        IfValidAnd( CentralVentSysRef:Type != "Exhaust" ) )
    then PostError("DwellUnitType '%s' needs to be connected to a central exhaust ventilation system.", Name )
    else UNCHANGED
    endif endif endif
ENDRULE

// ---------- Fan flow rate ----------
RULE ResOtherZn:SupplyIAQFanCnt
  DEFAULT
    if( LocalCompAssigned( SupplyIAQFanRef ) )
    then 1
    else UNDEFINED
    endif
ENDRULE

RULE DwellUnitType:SupplyIAQFanCnt
  DEFAULT
    if( LocalCompAssigned( SupplyIAQFanRef ) )
    then 1
    else UNDEFINED
    endif
ENDRULE

RULE ResOtherZn:ExhaustIAQFanCnt
  DEFAULT
    if( LocalCompAssigned( ExhaustIAQFanRef ) )
    then 1
    else UNDEFINED
    endif
ENDRULE

RULE DwellUnitType:ExhaustIAQFanCnt
  DEFAULT
    if( LocalCompAssigned( ExhaustIAQFanRef ) )
    then 1
    else UNDEFINED
    endif
ENDRULE

RULE ResOtherZn:SupplyIAQCFM
  DEFAULT
    if( IAQOption = "Central Exhaust / Individual Supply" .AND.
        LocalCompAssigned( SupplyIAQFanRef ) )
    then SupplyIAQFanRef:IAQCFM * SupplyIAQFanCnt
    else 0
    endif
ENDRULE

RULE DwellUnitType:SupplyIAQCFM
  DEFAULT
    if( IAQOption = "Central Exhaust / Individual Supply" .AND.
        LocalCompAssigned( SupplyIAQFanRef ) )
    then SupplyIAQFanRef:IAQCFM * SupplyIAQFanCnt
    else 0
    endif
ENDRULE

RULE ResOtherZn:ExhaustIAQCFM
  DEFAULT
    if( IAQOption = "Central Supply / Individual Exhaust" .AND.
        LocalCompAssigned( ExhaustIAQFanRef ) )
    then ExhaustIAQFanRef:IAQCFM * ExhaustIAQFanCnt
    else 0
    endif
ENDRULE

RULE DwellUnitType:ExhaustIAQCFM
  DEFAULT
    if( IAQOption = "Central Supply / Individual Exhaust" .AND.
        LocalCompAssigned( ExhaustIAQFanRef ) )
    then ExhaustIAQFanRef:IAQCFM * ExhaustIAQFanCnt
    else 0
    endif
ENDRULE

RULE ResOtherZn:CentralSupplyCFM
  DEFAULT
    if( IAQOption = "Central Supply / Central Exhaust" .OR. 
        IAQOption = "Central Supply / Individual Exhaust" .OR. 
        IAQOption = "Central Supply" )
    then MinIAQCFM
    else if( IAQOption = "Central Exhaust / Individual Supply" )
    then SupplyIAQCFM ; Use CentralVentSys to model individual fans
    else 0
    endif endif
ENDRULE

RULE DwellUnitType:CentralSupplyCFM
  DEFAULT
    if( IAQOption = "Central Supply / Central Exhaust" .OR. 
        IAQOption = "Central Supply / Individual Exhaust" .OR. 
        IAQOption = "Central Supply" )
    then MinIAQCFM
    else if( IAQOption = "Central Exhaust / Individual Supply" )
    then SupplyIAQCFM ; Use CentralVentSys to model individual fans
    else 0
    endif endif
ENDRULE

RULE ResOtherZn:CentralExhaustCFM
  DEFAULT
    if( IAQOption = "Central Supply / Central Exhaust" .OR.
        IAQOption = "Central Exhaust / Individual Supply" .OR.
        IAQOption = "Central Exhaust" )
    then MinIAQCFM
    else if( IAQOption = "Central Supply / Individual Exhaust" )
    then ExhaustIAQCFM
    else 0
    endif endif
ENDRULE

RULE DwellUnitType:CentralExhaustCFM
  DEFAULT
    if( IAQOption = "Central Supply / Central Exhaust" .OR.
        IAQOption = "Central Exhaust / Individual Supply" .OR.
        IAQOption = "Central Exhaust" )
    then MinIAQCFM
    else if( IAQOption = "Central Supply / Individual Exhaust" )
    then ExhaustIAQCFM
    else 0
    endif endif
ENDRULE

RULE NEW DwellUnit:CentralSupplyCFMWithMult
  DATATYPE
    Float
  DESCRIPTION
    "Supply air flow rate from the central ventilation system with multiplier"
  INPUTCLASS
    NotInput
  DEFAULT
    if( LocalCompAssigned(DwellUnitTypeRef) )
    then DwellUnitTypeRef:CentralSupplyCFM * Count
    else 0
    endif
ENDRULE

RULE NEW DwellUnit:CentralExhaustCFMWithMult
  DATATYPE
    Float
  DESCRIPTION
    "Exhaust air flow rate to the central ventilation system with multiplier"
  INPUTCLASS
    NotInput
  DEFAULT
    if( LocalCompAssigned(DwellUnitTypeRef) )
    then DwellUnitTypeRef:CentralExhaustCFM * Count
    else 0
    endif
ENDRULE

RULE NEW DwellUnit:CentralVentSysRef
  DATATYPE
    ResCentralVentSys
  INPUTCLASS
    NotInput
  DEFAULT
    if( CentralSupplyCFMWithMult > 0 .OR. CentralExhaustCFMWithMult > 0 )
    then DwellUnitTypeRef:CentralVentSysRef
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResZn:CentralSupplyCFM
  DATATYPE
    Float
  DESCRIPTION
    "Supply air flow rate from the central ventilation system"
  INPUTCLASS
    NotInput
  DEFAULT
    SumChildren( DwellUnit:CentralSupplyCFMWithMult )
ENDRULE

RULE NEW ResZn:CentralExhaustCFM
  DATATYPE
    Float
  DESCRIPTION
    "Exhaust air flow rate to the central ventilation system"
  INPUTCLASS
    NotInput
  DEFAULT
    SumChildren( DwellUnit:CentralExhaustCFMWithMult )
ENDRULE

RULE ResZn:CentralVentSysRef
  DEFAULT
    if( CentralSupplyCFM > 0 .OR. CentralExhaustCFM > 0 )
    then ChildDwellUnitRef:CentralVentSysRef
    else UNDEFINED
    endif
  CHECKSIM
    if( ( CentralSupplyCFM > 0 .OR. CentralExhaustCFM > 0 ) .AND.
        NumUniqueChildVals( DwellUnit:CentralVentSysRef, 1 ) > 1 )
    then PostError( "The dwellUnits in ResZn '%s' are served by more than one central ventilation system which is not supported.", Name)
    else UNCHANGED
    endif
ENDRULE

RULE ResCentralVentSys:SupFanCap
  DEFAULT
    SumRevRef( ResZn:CentralVentSysRef, ResZn:CentralSupplyCFM ) +
    SumRevRef( ResOtherZn:CentralVentSysRef, ResOtherZn:CentralSupplyCFM )
ENDRULE

RULE ResCentralVentSys:ExhFanCap
  DEFAULT
    SumRevRef( ResZn:CentralVentSysRef, ResZn:CentralExhaustCFM ) +
    SumRevRef( ResOtherZn:CentralVentSysRef, ResOtherZn:CentralExhaustCFM )
ENDRULE

// ---------- Fan power ----------
RULE NEW ResOtherZn:SupplyFanPwr
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    if( IAQOption = "Central Exhaust / Individual Supply" .AND.
        LocalCompAssigned( SupplyIAQFanRef ) )
    then SupplyIAQFanRef:WPerCFMIAQ * SupplyIAQCFM else 0 endif
ENDRULE

RULE NEW DwellUnitType:SupplyFanPwr
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    if( IAQOption = "Central Exhaust / Individual Supply" .AND.
        LocalCompAssigned( SupplyIAQFanRef ) )
    then SupplyIAQFanRef:WPerCFMIAQ * SupplyIAQCFM else 0 endif
ENDRULE

RULE NEW ResOtherZn:ExhaustFanPwr
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    if( IAQOption = "Central Supply / Individual Exhaust" .AND.
        LocalCompAssigned( ExhaustIAQFanRef ) )
    then ExhaustIAQFanRef:WPerCFMIAQ * ExhaustIAQCFM else 0 endif
ENDRULE

RULE NEW DwellUnitType:ExhaustFanPwr
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    if( IAQOption = "Central Supply / Individual Exhaust" .AND.
        LocalCompAssigned( ExhaustIAQFanRef ) )
    then ExhaustIAQFanRef:WPerCFMIAQ * ExhaustIAQCFM else 0 endif
ENDRULE

RULE NEW DwellUnit:SupplyFanPwrWithMult
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    if( LocalCompAssigned(DwellUnitTypeRef) )
    then DwellUnitTypeRef:SupplyFanPwr * Count
    else UNDEFINED
    endif
ENDRULE

RULE NEW DwellUnit:ExhaustFanPwrWithMult
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    if( LocalCompAssigned(DwellUnitTypeRef) )
    then DwellUnitTypeRef:ExhaustFanPwr * Count
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResZn:SupplyFanPwr
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    SumChildren( DwellUnit:SupplyFanPwrWithMult )
ENDRULE

RULE NEW ResZn:ExhaustFanPwr
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    SumChildren( DwellUnit:ExhaustFanPwrWithMult )
ENDRULE

RULE NEW ResCentralVentSys:TotIndividualSupFanPwr
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    SumRevRef( ResZn:CentralVentSysRef, ResZn:SupplyFanPwr ) +
    SumRevRef( ResOtherZn:CentralVentSysRef, ResOtherZn:SupplyFanPwr )
ENDRULE

RULE NEW ResCentralVentSys:TotIndividualExhFanPwr
  DATATYPE
    Float
  INPUTCLASS
    NotInput
  DEFAULT
    SumRevRef( ResZn:CentralVentSysRef, ResZn:ExhaustFanPwr ) +
    SumRevRef( ResOtherZn:CentralVentSysRef, ResOtherZn:ExhaustFanPwr )
ENDRULE

RULE ResCentralVentSys:SupFanPwrIdx
  DEFAULT
    if( Type = "Balanced" .OR. Type = "Supply" )
    then 0.5 ; for Central Supply / Central Exhaust OR Central Supply / Individual Exhaust
    else if( Type = "Exhaust" )
    then if( SupFanCap > 0 )
         then TotIndividualSupFanPwr/SupFanCap ; for Central Exhaust / Individual Supply
         else 0.00001 ; for Central Exhaust only
         endif
    else UNDEFINED
    endif endif
ENDRULE

RULE ResCentralVentSys:ExhFanPwrIdx
  DEFAULT
    if( Type = "Balanced" .OR. Type = "Exhaust" )
    then 0.5 ; for Central Supply / Central Exhaust OR Central Exhaust / Individual Supply
    else if( Type = "Supply" )
    then if( ExhFanCap > 0 )
         then TotIndividualExhFanPwr/ExhFanCap ; for Central Supply / Individual Exhaust
         else 0.00001 ; for Central Supply only
         endif
    else UNDEFINED
    endif endif
ENDRULE

RULE ResCentralVentSys:Type
  RESETS
    HXType
    TempCtrl
    EconoCtrlMthd
    SupFanPwrIdx
    ExhFanPwrIdx
  CHECKSIM
    if( HXType = "Wheel" )
    then PostError("ResCentralVentSys '%s' has thermal 'Wheel' heat exchanger.
                     This option not currently supported.", Name)
    else if( HtRcvryCertification = "HVI")
    then PostError("ResCentralVentSys '%s' is using 'HVI' certified heat exchanger.
                     This option not currently supported.", Name)
    else if( HasHXBypass = "Yes")
    then PostError("ResCentralVentSys '%s' has heat recovery with 'Bypass'.
                     This option not currently supported.", Name)
    else if( EconoLockout = "Yes")
    then PostError("ResCentralVentSys '%s' has heat recovery with 'Economizer Lockout'.
                     This option not currently supported.", Name)
    else if( DefrostCtrl != "None")
    then PostError("ResCentralVentSys '%s' has heat recovery with 'Defrost Control'.
                     This option not currently supported.", Name)
    else if( TempCtrl = "Scheduled" .OR. TempCtrl = "OutsideAirReset" .OR. TempCtrl = "ScheduledDualSetpoint" )
    then PostError("ResCentralVentSys '%s' is using supply temperature control '%s'.
                     This option not currently supported.", Name, TempCtrl)
    else if( CoilClgType = "ChilledWater" )
    then PostError("ResCentralVentSys '%s' is using 'ChilledWater' coil.
                     This option not currently supported.", Name)
    else if( CoilHtgType = "HotWater" )
    then PostError("ResCentralVentSys '%s' is using 'HotWater' coil.
                     This option not currently supported.", Name)
    else if( EconoCtrlMthd != "NoEconomizer" )
    then PostError("ResCentralVentSys '%s' has economizer.
                     This option not currently supported.", Name)
    else UNCHANGED
    endif endif endif endif endif endif endif endif endif
ENDRULE

RULE ResCentralVentSys:TempCtrl
  RESETS
    CoilClgType
    CoilHtgType
ENDRULE

RULE ResCentralVentSys:NumUIDialogTabs
  DEFAULT
    3
ENDRULE

// -----------------------------------------------------------------------------
// Heat Recovery
// -----------------------------------------------------------------------------
RULE ResCentralVentSys:HtRcvrySupFlowRtd
  DEFAULT
    if( IfValidAnd( HXType != "None" ) )
    then SupFanCap
    else UNDEFINED
    endif
ENDRULE

RULE NEW ResCentralVentSys:ImbalFlowWarn
  DATATYPE
    String
  LONGFORM
    ImbalanceFlowWarning
  INPUTCLASS
    NotInput
  DEFAULT
    if( SupFanCap > 0 )
    then if( ( ExhFanCap / SupFanCap ) > 1.3 )
         then "!Exhaust air to Supply air flow ratio is greater than 1.3!"
         else if( ( ExhFanCap / SupFanCap ) < 0.5 ) 
         then "!Supply air to Exhaust air flow ratio is greater than 2!"
         else ""
         endif endif
    else ""
    endif
ENDRULE

RULE ResCentralVentSys:SensHtRcvryEff
  DEFAULT
    if( IfValidAnd( HtRcvryCertification = "HVI" ) )
    then 0.60
    else UNDEFINED
    endif
ENDRULE

RULE ResCentralVentSys:AdjSensHtRcvryEff
  DEFAULT
    if( IfValidAnd( HtRcvryCertification = "HVI" ) )
    then 0.60
    else UNDEFINED
    endif
ENDRULE

RULE ResCentralVentSys:RcvryType
  CHECKSIM
    if( RcvryType = "LatentOnly" )
    then
      PostError("ResCentralVentSys '%s' has RecoveryType 'LatentOnly'.
                 This option is not longer supported.", Name)
    else UNCHANGED
    endif 
ENDRULE
// 100% Flow - Heating
RULE ResCentralVentSys:HtgSensEff100
  DESCRIPTION
    "The sensible heat exchange effectiveness at heating condition 
     with both the supply and exhaust air volume flow rates equal to 100%."
  DEFAULT
    if( RcvryType = "Total" )
    then 0.69
    else if( RcvryType = "SensibleOnly" )
    then 0.61
    else 0
    endif endif
ENDRULE
RULE ResCentralVentSys:HtgLatEff100
  DESCRIPTION
    "The latent heat exchange effectiveness at heating condition 
     with both the supply and exhaust air volume flow rates equal to 100%."
  DEFAULT
    if( RcvryType = "Total" )
    then 0.54
    else if( RcvryType = "LatentOnly" )
    then 0.50
    else 0
    endif endif
ENDRULE
RULE ResCentralVentSys:HtgTotEff100
  DESCRIPTION
    "The total heat exchange effectiveness at heating condition 
     with both the supply and exhaust air volume flow rates equal to 100%."
  DEFAULT
    if( RcvryType = "Total" )
    then 0.64
    else if( RcvryType = "SensibleOnly" )
    then 0.41
    else if( RcvryType = "LatentOnly" )
    then 0.35
    else 0
    endif endif endif
ENDRULE

// 100% Flow - Cooling
RULE ResCentralVentSys:ClgSensEff100
  DESCRIPTION
    "The sensible heat exchange effectiveness at cooling condition 
     with both the supply and exhaust air volume flow rates equal to 100%."
  DEFAULT
    if( RcvryType = "Total" )
    then 0.69
    else if( RcvryType = "SensibleOnly" )
    then 0.59
    else 0
    endif endif
ENDRULE
RULE ResCentralVentSys:ClgLatEff100
  DESCRIPTION
    "The latent heat exchange effectiveness at cooling condition 
     with both the supply and exhaust air volume flow rates equal to 100%."
  DEFAULT
    if( RcvryType = "Total" )
    then 0.43
    else if( RcvryType = "LatentOnly" )
    then 0.45
    else 0
    endif endif
ENDRULE
RULE ResCentralVentSys:ClgTotEff100
  DESCRIPTION
    "The latent heat exchange effectiveness at cooling condition 
     with both the supply and exhaust air volume flow rates equal to 100%."
  DEFAULT
    if( RcvryType = "Total" )
    then 0.69
    else if( RcvryType = "SensibleOnly" )
    then 0.43
    else if( RcvryType = "LatentOnly" )
    then 0.30
    else 0
    endif endif endif
ENDRULE

// 75% Flow - Heating
RULE ResCentralVentSys:HtgSensEff75
  DESCRIPTION
    "The sensible heat exchange effectiveness at heating condition 
     with both the supply and exhaust air volume flow rates equal to 75%."
  DEFAULT
    if( IfValidAnd( HtgSensEff100 > 0 ) )
    then HtgSensEff100 + 0.03 // Estimate
    else 0
    endif  
ENDRULE
RULE ResCentralVentSys:HtgLatEff75
  DESCRIPTION
    "The latent heat exchange effectiveness at heating condition 
     with both the supply and exhaust air volume flow rates equal to 75%."
  DEFAULT
    if( IfValidAnd( HtgLatEff100 > 0 ) )
    then HtgLatEff100 + 0.03 // Estimate
    else 0
    endif  
ENDRULE
RULE ResCentralVentSys:HtgTotEff75
  DESCRIPTION
    "The total heat exchange effectiveness at heating condition 
     with both the supply and exhaust air volume flow rates equal to 75%."
  DEFAULT
    if( IfValidAnd( HtgTotEff100 > 0 ) )
    then HtgTotEff100 + 0.03 // Estimate
    else 0
    endif  
ENDRULE

// 75% Flow - Cooling
RULE ResCentralVentSys:ClgSensEff75
  DESCRIPTION
    "The sensible heat exchange effectiveness at cooling condition 
     with both the supply and exhaust air volume flow rates equal to 75%."
  DEFAULT
    if( IfValidAnd( ClgSensEff100 > 0 ) )
    then ClgSensEff100 + 0.03 // Estimate
    else 0
    endif  
ENDRULE
RULE ResCentralVentSys:ClgLatEff75
  DESCRIPTION
    "The latent heat exchange effectiveness at cooling condition 
     with both the supply and exhaust air volume flow rates equal to 75%."
  DEFAULT
    if( IfValidAnd( ClgLatEff100 > 0 ) )
    then ClgLatEff100 + 0.03 // Estimate
    else 0
    endif
ENDRULE
RULE ResCentralVentSys:ClgTotEff75
  DESCRIPTION
    "The total heat exchange effectiveness at cooling condition 
     with both the supply and exhaust air volume flow rates equal to 75%."
  DEFAULT
    if( IfValidAnd( ClgTotEff100 > 0 ) )
    then ClgTotEff100 + 0.03 // Estimate
    else 0
    endif
ENDRULE

RULE ResCentralVentSys:HtRcvryTempCtrl
  DESCRIPTION
    "This field determines if the heat exchanger's supply air outlet is 
    controlled to a temperature set point."
  DEFAULT
    if( IfValidAnd( HasHXBypass = "Yes") )
    then "Fixed"
    else "None"
    endif
  CHECKSIM
    if( HXType = "Plate" .AND. HasHXBypass = "No" .AND. HtRcvryTempCtrl != "None" ) 
    then
      PostError("HeatRecovery '%s' is Type = 'Plate' and temperature control
                 is set to '%s', but no bypass has been specified. Specify that
                 HeatRecovery unit has a bypass to simulate temperature control, or
                 set Bypass to 'No'.", Name, TempCtrl)
    else
    if( HXType = "Plate" .AND. HasHXBypass = "Yes" .AND. HtRcvryTempCtrl = "None" )
    then 
      PostWarning("HeatRecovery '%s' is Type = 'Plate' and specified to have a bypass, but 
                   temperature control is set to 'None'. For the bypass to be
                   used, a temperature control method and setpoint must be specified.",
                   Name)
    else UNCHANGED
    endif endif
ENDRULE

RULE ResCentralVentSys:FixedSupTemp
  DESCRIPTION
    "Fixed temperature set point in F at heat exchanger supply air outlet."
  DEFAULT
    if( TempCtrl = "Fixed" )
    then
      if( IfValidAnd( TempCtrl = "Fixed" ) )
      then ValidOr( ClgFixedSupTemp, 70 )
      else
      if( IfValidAnd( TempCtrl = "FixedDualSetpoint" ) )
      then ValidOr( HtgFixedSupTemp, 70 )
      else 70
      endif endif
    else UNDEFINED
    endif
ENDRULE

RULE ResCentralVentSys:TempSetptSchRef
  DESCRIPTION
    "Scheduled temperature set point in F at heat exchanger supply air
    outlet. "
  CHECKSIM
    if( HtRcvryTempCtrl = "Scheduled" .AND. 
        LocalCompAssigned( TempSetptSchRef ) = 0 )
    then
      PostError("ResCentralVentSys object '%s' has a the control temperature 
                 specified as a schedule, but no schedule has been defined.", Name)
    else UNCHANGED
    endif
ENDRULE

RULE ResCentralVentSys:DefrostCtrl
  DESCRIPTION
    "Heat exchanger defrost control method."
  HELP
    "There are four heat exchanger defrost control method: None, 
     ExhaustAirRecirculation, ExhaustOnly, and MinimumExhaustTemperature."
  DEFAULT
    "None"
ENDRULE

RULE ResCentralVentSys:DefrostCtrlTemp
  DESCRIPTION
    "The numeric field defines T_db of air which is used to initiate 
     frost control."
  HELP
    "For ExhaustAirRecirculation and ExhaustOnly frost control, the threshold
     temperature defines the supply air inlet temperature below which 
     frost control is active. "
  DEFAULT
    if( DefrostCtrl = "ExhaustAirRecirculation" .OR.
        DefrostCtrl = "ExhaustOnly" )
    then 40
    else UNDEFINED
    endif
ENDRULE

RULE ResCentralVentSys:DefrostTimeFrac
  DESCRIPTION
    "This numeric field defines the fraction of simulation timestep 
    when frost control will be invoked when the threhold temperature 
    is reached."
  HELP
    "Only applicable when DefrostControl = 'ExhaustAirRecirculation'
     and 'ExhaustOnly'."
  DEFAULT
    if( DefrostCtrl = "ExhaustAirRecirculation" .OR.
        DefrostCtrl = "ExhaustOnly" )
    then 0.083
    else UNDEFINED
    endif
ENDRULE

RULE ResCentralVentSys:DefrostTimeFracRt
  DESCRIPTION
    "This numeric field defines the rate of increase in the defrost 
     time fraction as the supply air inlet temperature falls below the
     threhold temperature."
  HELP
    "Only applicable when DefrostControl = 'ExhaustAirRecirculation'
     and 'ExhaustOnly'."
  DEFAULT
    if( DefrostCtrl = "ExhaustAirRecirculation" .OR.
        DefrostCtrl = "ExhaustOnly" )
    then 0.012
    else UNDEFINED
    endif
ENDRULE

RULE ResCentralVentSys:EconoLockout
  DESCRIPTION
    "This field denotes whether the heat exchanger is locked out when
     economizer is operating."
  CHECKCODE
    if( HXType = "Plate" .AND. HasHXBypass = "No" .AND. EconoLockout = "Yes" )  
    then
      PostWarning("HeatRecovery '%s' is a 'Plate' heat exchanger with no bypass.
                   Heat exchanger lockout with economizer will not be simulated.",
                  Name)
    else UNCHANGED
    endif
ENDRULE

RULE ResCentralVentSys:AuxPwr
  DESCRIPTION
    "The electric consumption rate of heat exchanger unit."
  HELP
    "This energy is not added to the air stream."
  DEFAULT
    0
ENDRULE

// -----------------------------------------------------------------------------
// ------------------ Default ResHVACSys Properties ----------------------------
// -----------------------------------------------------------------------------

RULE ResHVACSys:HVACCentralRef
  CHECKSIM
    if( Type = "Central Heating and Cooling System" .AND. LocalCompAssigned( HVACCentralRef ) == 0 )
    then PostError("The central heating and cooling system of ResHVACSys '%s' must be defined", Name)
    else UNCHANGED
    endif
ENDRULE

RULE ResHVACSys:HaveHeating
  DEFAULT
    if( Type = "Central Heating and Cooling System" .AND. LocalCompAssigned( HVACCentralRef ) )
    then 1
    else UNCHANGED
    endif
ENDRULE

RULE ResHVACSys:HaveCooling
  DEFAULT
    if( Type = "Central Heating and Cooling System" .AND. LocalCompAssigned( HVACCentralRef ) )
    then if( HVACCentralRef:Type = "Hydronic heating only" )
         then 0
         else 1
         endif
    else UNCHANGED
    endif
ENDRULE

RULE ResHVACSys:HtOrClDucted
  DEFAULT
    if( Type = "Central Heating and Cooling System" .AND. LocalCompAssigned( HVACCentralRef ) )
    then 0
    else UNCHANGED
    endif
ENDRULE

RULE ResHVACSys:ConstHtgSetpt
  DEFAULT
    if( Type = "Central Heating and Cooling System" )
    then -1
    else UNCHANGED
    endif
ENDRULE

RULE ResHVACSys:DuctMsg
  DEFAULT
    if( Type = "Central Heating and Cooling System" )
    then ""
    else UNCHANGED
    endif
ENDRULE

RULE NEW ResHVACSys:HWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( LocalCompAssigned( HVACCentralRef:HWFluidSysRef ) )
    then HVACCentralRef:HWFluidSysRef
    else UNDEFINED endif
ENDRULE

RULE NEW ResHVACSys:ChWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( LocalCompAssigned( HVACCentralRef:ChWFluidSysRef ) )
    then HVACCentralRef:ChWFluidSysRef
    else UNDEFINED endif
ENDRULE

RULE NEW ResHVACSys:CWFluidSysRef
  DATATYPE
    FluidSys
  INPUTCLASS
    NotInput
  SIZING_PROPOSED
    if( LocalCompAssigned( HVACCentralRef:CWFluidSysRef ) )
    then HVACCentralRef:CWFluidSysRef
    else UNDEFINED endif
ENDRULE

// -----------------------------------------------------------------------------
// --------------------- Default Analysis Method -------------------------------
// -----------------------------------------------------------------------------

RULE NEW Proj:SimResZnInEnergyPlus
  DATATYPE
    Integer
  INPUTCLASS
    OPTIONAL
  DEFAULT
    0
ENDRULE

// -----------------------------------------------------------------------------
// --------------------------- Set Up Flags ------------------------------------
// -----------------------------------------------------------------------------

RULE NEW ResOtherZn:IsCentralHtgClg
  DATATYPE
    Integer
  LONGFORM
    IsCentralHeatingCooling
  DESCRIPTION
    "Whether the resdential zone is served by a central heating/cooling system"
  INPUTCLASS
    NotInput
  DEFAULT
    if( IfValidAnd( ozHVACSystem:Type = "Central Heating and Cooling System" ) )
    then 1
    else 0
    endif
ENDRULE

RULE NEW ResOtherZn:IsCentralVent
  DATATYPE
    Integer
  LONGFORM
    IsCentralVentilating
  DESCRIPTION
    "Whether the resdential zone is served by a central ventilation system"
  INPUTCLASS
    NotInput
  DEFAULT
    if( IAQOption = "Central Supply / Central Exhaust" .OR.
        IAQOption = "Central Supply / Individual Exhaust".OR.
        IAQOption = "Central Exhaust / Individual Supply".OR.
        IAQOption = "Central Supply".OR.
        IAQOption = "Central Exhaust" )
    then 1
    else 0
    endif
ENDRULE

RULE NEW ResOtherZn:SimInEnergyPlus
  DATATYPE
    Integer
  LONGFORM
    SimulateInEnergyPlus
  INPUTCLASS
    Default
  DEFAULT
//    if( IsCentralHtgClg = 1 .OR. IsCentralVent = 1 )
//    then Proj:ResCentralHVACSimMethod
//    else UNDEFINED
//    endif
    Proj:SimResZnInEnergyPlus
ENDRULE  

RULE NEW ResZn:IsCentralHtgClg
  DATATYPE
    Integer
  LONGFORM
    IsCentralHeatingCooling
  DESCRIPTION
    "Whether the Resdential zone is served by a central heating/cooling system"
  INPUTCLASS
    NotInput
  DEFAULT
    if( MaxChild( DwellUnit:DwellUnitTypeRef:HVACSysTypeAbbrev ) == 4 )
    then 1
    else 0
    endif
ENDRULE

RULE NEW ResZn:IsCentralVent
  DATATYPE
    Integer
  LONGFORM
    IsCentralVentilating
  DESCRIPTION
    "Whether the resdential zone is served by a central ventilation system"
  INPUTCLASS
    NotInput
  DEFAULT
    if( LocalCompAssigned( CentralVentSysRef ) )
    then 1
    else 0
    endif
ENDRULE

RULE NEW ResZn:SimInEnergyPlus
  DATATYPE
    Integer
  LONGFORM
    SimulateInEnergyPlus
  INPUTCLASS
    Default
  DEFAULT
//    if( IsCentralHtgClg = 1 .OR. IsCentralVent = 1 )
//    then Proj:ResCentralHVACSimMethod
//    else UNDEFINED
//    endif
    Proj:SimResZnInEnergyPlus
ENDRULE  





