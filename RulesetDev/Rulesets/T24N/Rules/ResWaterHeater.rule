// Residential Water Heaters
// For Space Types equal to High-Rise Residential and Hotel / Motel
//
// -------------------------------------------------------------------------
//  Copyright (c) 2012-2018, California Energy Commission
//  All rights reserved.
//  Redistribution and use in source and binary forms, with or without
//  modification, are permitted provided that the following conditions are
//  met:
// 
//    * Redistributions of source code must retain the above copyright
//  notice, this list of conditions and the following disclaimer.
//    * Redistributions in binary form must reproduce the above copyright
//  notice, this list of conditions and the following disclaimer in
//  the documentation and/or other materials provided with the
//  distribution.
//    * Neither the name of the California Energy Commission nor the names of its
//  contributors may be used to endorse or promote products
//  derived from this software without specific prior written
//  permission.
//
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
//  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
//  TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
//  PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL CALIFORNIA ENERGY COMMISSION
//  BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
//  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
//  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
//  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
//  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
//  OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
//  ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
// -------------------------------------------------------------------------
//  
//


RULE ResDHWSys:CHPWHCompType
  RESETS
    ResetThisWhenTheFollowingIsModified
      ResDHWSys:CHPWHSysDescrip
ENDRULE

RULE ResDHWSys:CHPWHLoopTankType
  RESETS
    ResetThisWhenTheFollowingIsModified
      ResDHWSys:CHPWHSysDescrip
ENDRULE

RULE ResDHWSys:CHPWHLoopTankCompType
  RESETS
    ResetThisWhenTheFollowingIsModified
      ResDHWSys:CHPWHLoopTankType
ENDRULE

RULE ResDHWSys:CHPWHNEEABrand
  RESETS
    ResetThisWhenTheFollowingIsModified
      ResDHWSys:CHPWHIntegPkgType
ENDRULE

RULE ResDHWSys:CHPWHNEEAModel
  RESETS
    ResetThisWhenTheFollowingIsModified
      ResDHWSys:CHPWHNEEABrand
ENDRULE

RULE ResDHWSys:CHPWHLoopTankNEEABrand
  RESETS
    ResetThisWhenTheFollowingIsModified
      ResDHWSys:CHPWHLoopTankIntegPkgType
ENDRULE

RULE ResDHWSys:CHPWHLoopTankNEEAModel
  RESETS
    ResetThisWhenTheFollowingIsModified
      ResDHWSys:CHPWHLoopTankNEEABrand
ENDRULE



; 2019 RES DHW REMOVAL
;// -----------------------------------------------------------------------------
;// ---------- Baseline Residential DHW System Flag -----------------------------
;RULE ResDHWSys:IsBaseSys
;  DESCRIPTION
;    "An integer value used to identify that this water heating system is a baseline system."
;  INPUTCLASS 
;    NotInput
;  DEFAULT
;    0 
;ENDRULE
;
;// ---------- Residential DHW System Status -------------------------------
;RULE ResDHWSys:Status
;  DESCRIPTION
;    "The status of the system or component, used for additions and alterations."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Required
;  DEFAULT
;    if( IfValidAnd( SumChildren(ResWtrHtr:IsNewResDHWHtr) > 0 ) .AND.
;        IfValidAnd( SumChildren(ResWtrHtr:IsExistingDHWHtr) > 0 ) )
;    then 
;      "Altered"
;    else if( Proj:IsAlt )
;    then 
;      "Existing"
;    else 
;      "New"
;    endif endif
;  CHECKCODE           // Status
;    if( CentralSys = 0 .AND. Status = "Altered" ) 
;    then
;      PostError("Residential DHW system '%s' is specified as non-central, and 
;                 has a status of Altered.  This is not allowed.  Individual 
;                 dwelling unit DHW systems may be only New or Existing.  Change 
;                 the status input.",Name)
;    else if( IfValidAnd( SumChildren(ResWtrHtr:IsNewResDHWHtr) > 0 ) .AND.
;             IfValidAnd( SumChildren(ResWtrHtr:IsExistingDHWHtr) > 0 ) )
;    then
;      PostError("Residential DHW system '%s' has a mix of New and Existing 
;                 water heaters, so the status must be Altered.  Change 
;                 the status input.",Name)
;    else UNCHANGED
;    endif endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE NEW ResDHWSys:IsNewResDHWSys
;  DATATYPE
;    Integer
;  LONGFORM
;    IsNewResidentialDomesticHotWaterSystem
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( Status = "New" ) then 1 else 0 endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE NEW ResDHWSys:IsAlteredResDHWSys
;  DATATYPE
;    Integer
;  LONGFORM
;    IsAlteredResidentialDomesticHotWaterSystem
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( Status = "Altered" ) then 1 else 0 endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE NEW ResDHWSys:IsExistingResDHWSys
;  DATATYPE
;    Integer
;  LONGFORM
;    IsExistingResidentialDomesticHotWaterSystem
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( Status = "Existing" ) then 1 else 0 endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// ---------- Residential Water Heater Status -------------------------------
;RULE ResWtrHtr:Status
;  DESCRIPTION
;    "The status of the system or component, used for additions and alterations."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Required
;  DEFAULT
;    if( Parent(Status) = "Altered" ) 
;    then "New"
;    else Parent(Status)
;    endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:IsNewResDHWHtr
;  DATATYPE
;    Integer
;  LONGFORM
;    IsNewResidentialDomesticHotWaterHeater
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( Status = "New" ) then 1 else 0 endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:IsExistingDHWHtr
;  DATATYPE
;    Integer
;  LONGFORM
;    IsExistingDHWHeater
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( Status = "Existing" ) then 1 else 0 endif
;ENDRULE

// -----------------------------------------------------------------------------
// ---------- Any DHW Fluid Systems in the Building Are New --------------
RULE NEW Proj:IsNewResDHWSys
  DATATYPE
    Integer
  LONGFORM
    IsNewResidentialDomesticHotWaterSystem
  DESCRIPTION
    "This is the boolean for yes(1) all DHW fluid systems are new
     or no (0), not all of the DHW fluid systems are new."
  REFERENCE 
    ACM-5.9.1 Water Heating
  INPUTCLASS
    NotInput
  DEFAULT
    if( SumAcrossIf(ResDHWSys:IsExisting, ResDHWSys:FloorAreaServed > 0 ) + 
        SumAcrossIf(ResDHWSys:IsAltered,  ResDHWSys:FloorAreaServed > 0 ) <= 0 )                 
    then 1
    else 0
    endif
ENDRULE

// -----------------------------------------------------------------------------
// ---------- All Water Heaters in the building are New --------------
RULE NEW Proj:IsNewResDHWHtr
  DATATYPE
    Integer
  LONGFORM
    IsNewResidentialDomesticHotWaterHeater
  DESCRIPTION
    "This is the boolean for yes(1) all water heaters on the fluid system are new
     or no (0), not all of the water heaters on the fluid system are new."
  REFERENCE 
    ACM-5.9.1 Water Heating
  INPUTCLASS
    NotInput
  DEFAULT
    if( SumAcrossIf(ResWtrHtr:IsExisting, ResWtrHtr:FloorAreaServed > 0 ) +
        SumAcrossIf(ResWtrHtr:IsAltered,  ResWtrHtr:FloorAreaServed > 0 ) <= 0 )   
    then 1
    else 0
    endif
ENDRULE

// -----------------------------------------------------------------------------
// ---------- Any DHW Fluid Systems in the Building Are Existing --------------
RULE NEW Proj:IsNewDHWFluidSys
  DATATYPE
    Integer
  LONGFORM
    IsNewDHWFluidSystem
  DESCRIPTION
    "This is the boolean for yes(1) one DHW Fluid Systems in the building is new
     or no (0), none of the SHW Fluid Systems in the building are new."
  REFERENCE 
    ACM-5.9.1 Water Heating
  INPUTCLASS
    NotInput
  DEFAULT
    if( Proj:IsNewResDHWSys > 0 .OR. Proj:IsNewResDHWHtr > 0 )
    then 1
    else 0
    endif
ENDRULE

; RES DHW REMOVAL
;// -----------------------------------------------------------------------------
;// -------------- Water Heater Count (default exression only) --------------------
;// - moved default expression up here to ensure it is valid prior to several references prior to the main ResWtrHtr:Cnt RULE
;RULE ResWtrHtr:Cnt
;  DEFAULT
;    1
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// ---------- New Residential Water Heater Count in Building --------------
;RULE NEW ResWtrHtr:NewResDHWHtr
;  DATATYPE
;    Integer
;  LONGFORM
;    NewInBuilding
;  DESCRIPTION
;    "This is the count of new Residential Water Heaters in the building."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( IsNewResDHWHtr .AND. IfValidAnd(Cnt > 0) )
;    then Cnt
;    else 0
;    endif
;ENDRULE

; define RESETS to fix ResWtrHtr defaulting issues - SAC 03/11/22
RULE ResWtrHtr:HeaterElementType
  RESETS
    ResetTheFollowingWhenThisIsModified
      ResWtrHtr:InputRating
      ResWtrHtr:TankType
      ResWtrHtr:HPWHCategory
      ResWtrHtr:StandbyLossMult
ENDRULE

RULE ResWtrHtr:TankType
  RESETS
    ResetTheFollowingWhenThisIsModified
      ResWtrHtr:StandbyLossFrac
      ResWtrHtr:EnergyFactor
      ResWtrHtr:TankVolume
      ResWtrHtr:RecovEff
      ResWtrHtr:InputRating
      ResWtrHtr:FirstHourRating
      ResWtrHtr:RatedFlow
      ResWtrHtr:AnnFuelUse
      ResWtrHtr:AnnElecUse
      ResWtrHtr:StandbyElec
      ResWtrHtr:IntInsulRVal
      ResWtrHtr:ExtInsulRVal
ENDRULE

; 
; 0, ResWtrHtr:HPWHCategory
; 1,    ResWtrHtr:HPWHBrand
; 1,    ResWtrHtr:HPWHComModel
; 
; 0, ResWtrHtr:HPWHBrand
; 1,    ResWtrHtr:HPWHModel
; 1,    ResWtrHtr:ASHPType
; 
; 0, ResWtrHtr:HPWHComModel
; 1,    ResWtrHtr:ASHPType
; 
; 0, ResWtrHtr:ASHPType
; 1,    ResWtrHtr:TankOutside
; 1,    ResWtrHtr:ASHPTSrcOutside
; 1,    ResWtrHtr:EnergyFactor
; 1,    ResWtrHtr:TankVolume
; 
; 0, ResWtrHtr:TankOutside
; 1,    ResWtrHtr:TankZone
; 
; 0, ResWtrHtr:ASHPTSrcOutside
; 1,    ResWtrHtr:ASHPTSrcZone
; 
; 0, DHWLoopTankHeater:TankOutside
; 1,    DHWLoopTankHeater:TankZone

; re-enable WSHP systems - SAC 03/17/22
RULE DwellUnitType:HVACSysType
  CHECKCODE
    if (HVACSysType == "Central Heating and Cooling System" .AND.
        IfValidAnd( CentralEqpType = "Water source heat pump" )==0 .AND.
        IfValidAnd( CentralEqpType = "Variable refrigerant flow" )==0 .AND.
        IfValidAnd( DUFloorAreaServed > 1 ))
    then  PostError( "HVAC system type '%s' / '%s' not yet implemented in analysis for DwellUnitType '%s'", EnumString( HVACSysType ), EnumString( CentralEqpType ), Name )
    else  UNCHANGED  endif
ENDRULE



;
;// -----------------------------------------------------------------------------
;//// ---------- Create baseline Residential Water Heater -------------------------------
;//RULE ResDHWSys:BaseResWtrHtrRef
;//  DESCRIPTION
;//    "This is the baseline water heater."
;//  HELP
;//    ""
;//  REFERENCE 
;//    Res ACM-2.10 Domestic Hot Water
;//  INPUTCLASS
;//    Optional
;//  SIZING_PROPOSED
;//    UNDEFINED
;//  SIZING_BASELINE
;//    UNDEFINED
;//// SAC 6/4/15 - removed retrieval of BaseResWtrHtr from library, as ResWtrHtr properties are being modified individually
;////    if( u:IsNew )
;////    then RuleLibrary(ResWtrHtr, "BaseResWtrHtr", 1, Name)
;////    else UNDEFINED
;////    endif
;//  ANNUAL_PROPOSED
;//    UNDEFINED
;//  ANNUAL_BASELINE 
;//    zb:BaseResWtrHtrRef
;//ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// ---------- Residential Domestic Hot Water Fluid System Name --------------
;RULE ResDHWSys:Name
;  DESCRIPTION
;    "A unique name for each Residential water heating system."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Optional
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// ----------- Floor area served by an individual residential System -----------------
;RULE ResDHWSys:SysFlrArea
;  DESCRIPTION
;    "This is the total floor area of all living units served by the DHW system."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput
;  MINIMUM
;    0 
;  UNITS
;    ft2
;  REPORTPRECISION
;    0
;  DEFAULT
;    SumRevRef(Spc:ResDHWSysRef, Spc:DwellingUnitSpcTotAreaWithMult)
;  SIZING
;    SysFlrArea
;  ANNUAL
;    SysFlrArea
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------------- Residential Distribution System Type --------------------
;; SAC 03/04/21
;RULE ResDHWSys:CentralRecircType
;  DESCRIPTION
;    "Whether or not this system serves more than 1 dwelling unit, and if so, recirculation type."
;  INPUTCLASS
;    Required
;  DEFAULT
;    "Non-Central"
;  CHECKCODE
;    if ( ExcludeWtrHtg )
;    then  UNCHANGED
;    else 
;	    if( IfValidAnd( CentralRecircType = "Central, no Recirculation" ) .AND.
;           IfValidAnd( LivingUnitCnt > 8 ) )
;	    then
;	      PostError("Residential DHW system '%s' must be set to the central 
;	                 recirculation type 'Central with Recirculation' since 
;	                 it serves more than 8 dwelling units.", Name)
;	    else  UNCHANGED
;	    endif
;    endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then  "Non-Central"
;    else if( Proj:SHWBothBaseline )
;    then  "Non-Central"
;    else  UNCHANGED
;    endif endif
;  SIZING_BASELINE
;    if (IfValidAnd( IsBaseSys > 0 ))
;    then  "Non-Central"
;    else  zp:CentralRecircType
;    endif
;  ANNUAL
;    z:CentralRecircType
;ENDRULE
;
;; set based on ResDHWSys:CentralRecircType - SAC 03/04/21
;RULE ResDHWSys:CentralSys
;  DESCRIPTION
;    "Whether or not this system serves more than 1 dwelling unit."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    if (CentralRecircType = "Non-Central")
;    then  0
;    else  1
;    endif
;  SIZING_PROPOSED
;    if (zp:CentralRecircType = "Non-Central")
;    then  0
;    else  1
;    endif
;  SIZING_BASELINE
;    if (zb:CentralRecircType = "Non-Central")
;    then  0
;    else  1
;    endif
;  ANNUAL
;    if (z:CentralRecircType = "Non-Central")
;    then  0
;    else  1
;    endif
;ENDRULE
;
;// -------------------------------------------------------------------
;// 
;RULE ResDHWSys:Type
;  DESCRIPTION
;    "Distribution system types for systems serving individual dwelling units"
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Required
;  DEFAULT
;    "Standard"
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then "Standard"
;    else u:Type
;    endif
;  ANNUAL_PROPOSED
;    z:Type
;ENDRULE
;
;; SAC 1/9/20 - port of new central DHW (CSE) modeling to Com (in Res: DHWSys:NewCentralElecModel) (Com tic #3156) 
;; revised to depend on CentralRecircType - SAC 03/04/21
;RULE NEW ResDHWSys:NewCentralModel
;  DATATYPE
;    Integer
;  LONGFORM
;    NewCentralModel
;  DESCRIPTION
;    "flag indicating this model is to be simulated in CSE via wsBranchModel = 'DayWaste'"  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    if (CentralRecircType == "Central with Recirculation")
;    then  1
;    else  0
;    endif
;ENDRULE
;
;RULE ResDHWSys:CentralSysType
;  DESCRIPTION
;    "Type of residential central DHW system."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Optional
;  DEFAULT
;    if (CentralSys < 1) then  UNDEFINED
;    else  "Other"  endif
;ENDRULE
;
;; added logic to ensure CentralSysTypeVal = 0 for Non-Central systems - SAC 08/26/21
;RULE ResDHWSys:CentralSysTypeVal
;  DESCRIPTION
;    ""  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    if (IfValidAnd( CentralRecircType = "Non-Central" ) .OR.
;        LocalStatus( CentralSysType ) < 1) then  0
;    else  switch (CentralSysType)
;            case  "HPWH"  :  2
;            case  "Other" :  1
;            default :  0
;          endswitch  endif
;ENDRULE
;
;RULE NEW ResWtrHtr:CentralSysTypeVal
;  DATATYPE
;    Integer
;  LONGFORM
;    CentralSystemTypeValue
;  DESCRIPTION
;    ""  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    if (IfValidAnd( ResDHWSys:CentralSysTypeVal >= 0 ))
;    then  ResDHWSys:CentralSysTypeVal
;    else  0  endif
;ENDRULE
;
;
;; SAC 1/10/20 - port of new central DHW (CSE) modeling to Com (in Res: DHWSys:CentralElecDHW) (Com tic #3156) 
;RULE NEW ResDHWSys:CentralElecDHW
;  DATATYPE
;    Integer
;  LONGFORM
;    CentralElectricDHW
;  DESCRIPTION
;    "flag indicating this DHW system is Central and served exclusively by electric DHW heaters"  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    if (CentralSys < 1) then  0
;    else if (IfValidAnd( CentralSysTypeVal = 2 )) then  1
;    else if ( SumChildrenIf( ResWtrHtr:Cnt, ResWtrHtr:ElementType = "Gas" ) < 1 .AND.
;             (SumChildrenIf( ResWtrHtr:Cnt, ResWtrHtr:ElementType = "Electric Resistance" ) > 0 .OR.
;              SumChildrenIf( ResWtrHtr:Cnt, ResWtrHtr:ElementType = "Heat Pump" ) > 0))
;    then  1
;    else  0  endif endif endif
;ENDRULE
;
;; presence of central ResDHWSys that is not all-electric used to set Proj:AllowCentralElecDHWSolPVCred - SAC 09/03/20 (tic #3218)
;RULE NEW ResDHWSys:CentralNonElecDHW
;  DATATYPE
;    Integer
;  LONGFORM
;    CentralNonElectricDHW
;  DESCRIPTION
;    "flag indicating this DHW system is Central and served by one or more non-electric DHW heaters"  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    if (CentralSys < 1) then  0
;    else if (IfValidAnd( CentralSysTypeVal = 2 )) then  0
;    else if ( SumChildrenIf( ResWtrHtr:Cnt, ResWtrHtr:ElementType = "Gas" ) > 0 )
;    then  1
;    else  0  endif endif endif
;ENDRULE
;
;RULE NEW ResWtrHtr:IsElecCentralHtr
;  DATATYPE
;    Integer
;  LONGFORM
;    IsElectricCentralHeater
;  DESCRIPTION
;    "flag indicating elec heater child of central electric DHW system"  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    ResDHWSys:CentralElecDHW
;ENDRULE
;
;
;// -------- Flag for triggering HERS reporting for Residential DHW System with pipe insulation and HERS verified  --------------
;RULE NEW ResDHWSys:HERSResDHWSysPipeIns
;  DATATYPE
;    Integer
;  LONGFORM
;    HERSResidentialDomesticHotWaterSystemPipeInsulation
;  DESCRIPTION
;    ""  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    if( IfValidAnd(Type = "(HERS req'd) Pipe Insulation, All Lines") .AND. IfValidAnd( Status = "New" ) )
;    then 1
;    else 0
;    endif
;ENDRULE
;
;// -------- Flag for triggering HERS reporting for Residential DHW System with parallel piping and HERS verified  --------------
;RULE NEW ResDHWSys:HERSResDHWSysParallelPiping
;  DATATYPE
;    Integer
;  LONGFORM
;    HERSResidentialDomesticHotWaterSystemParallelPiping
;  DESCRIPTION
;    ""  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    if( IfValidAnd(Type = "(HERS req'd) Parallel Piping") .AND. IfValidAnd( Status = "New" ) )
;    then 1
;    else 0
;    endif
;ENDRULE
;
;// -------- Flag for triggering HERS reporting for Residential DHW System - Recirc with demand control, push button and HERS verified  --------------
;RULE NEW ResDHWSys:HERSResDHWSysRecircDemCtrlPushButton
;  DATATYPE
;    Integer
;  LONGFORM
;    HERSResidentialDomesticHotWaterSystemRecirculationDemandControlPushButton
;  DESCRIPTION
;    ""  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    if( IfValidAnd(Type = "(HERS req'd) Recirculation, Demand Control Push Button") .AND. IfValidAnd( Status = "New" ) )
;    then 1
;    else 0
;    endif
;ENDRULE
;
;// -------- Flag for triggering HERS reporting for Residential DHW System - Recirc with demand control, occupancy sensor and HERS verified  --------------
;RULE NEW ResDHWSys:HERSResDHWSysRecircDemCtrlOccSensor
;  DATATYPE
;    Integer
;  LONGFORM
;    HERSResidentialDomesticHotWaterSystemRecirculationDemandControlOccupancySensor
;  DESCRIPTION
;    ""  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    if( IfValidAnd(Type = "(HERS req'd) Recirculation, Demand Control Occupancy/Motion") .AND. IfValidAnd( Status = "New" ) )
;    then 1
;    else 0
;    endif
;ENDRULE
;
;// -------- Flag for triggering HERS reporting for Residential DHW System - compact distribution system expanded credit  --------------
;RULE NEW ResDHWSys:HERSResDHWSysCompactDistSys
;  DATATYPE
;    Integer
;  LONGFORM
;    HERSResidentialDomesticHotWaterSystemCompactDistributionSystem
;  DESCRIPTION
;    ""  
;  HELP
;    ""  
;  INPUTCLASS
;    NotInput   
;  DEFAULT   
;    if( IfValidAnd(CompactDist = "Expanded Credit (HERS req'd)") .AND. IfValidAnd( Status = "New" ) )
;    then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// ------ Distribution Type -------
;// 
;; SAC 1/12/20 - updated Default from 'Demand Control (Standard Design for new construction)' to 'No Control (continuous pumping)' due to recent change in std design rules (Com tic #3156)
;; set based on ResDHWSys:CentralRecircType - SAC 03/04/21
;RULE ResDHWSys:DistType
;  DESCRIPTION
;    "This is the selection of the type of residential system coupled to the
;     water heater."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;// enums must be defined via Enums.txt in order to map to numeric values expected by the T24 DHW simulation engine
;//  OPTION
;//    No Loops or central system pump
;//    No Control
;//    Demand Control
;//    Temperature modulation
;//    Temperature modulation & monitoring
;  DEFAULT
;    if( ExcludeWtrHtg )
;    then 
;      UNDEFINED
;    else if (CentralRecircType = "Central with Recirculation")
;    then  "No Control (continuous pumping)"
;    else  "No loops or central system pump"
;    endif endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED
;    else if (CentralRecircType = "Central with Recirculation")
;    then  "No Control (continuous pumping)"
;    else  "No loops or central system pump"
;    endif endif
;  ANNUAL
;    z:DistType
;ENDRULE
;
;
;// ------------------------------------------------------------------- SAC 1/10/19
;// -------------- Compact Distribution Properties --------------------
;// 
;RULE ResDHWSys:IsRecircSys
;      ; IsRecircSystem in Res
;  INPUTCLASS
;    NotInput
;  CHECKCODE
;    if (IsRecircSys .AND. CentralSys .AND. CentralSysType = "Other" .AND. SysFlrArea > 0 .AND.
;        SumChildrenIf( ResWtrHtr:Cnt, ResWtrHtr:ElementType = "Heat Pump" ) > 0)
;    then  PostError( "ResDHWSys '%s' must be switched to central type 'HPWH' to model a central HPWH system with recirculation", Name )
;    else  UNCHANGED  endif
;  DEFAULT
;    if (CentralSys)
;    then  if (DistType = "No loops or central system pump")
;          then  0
;          else  1
;          endif
;    else  switch (Type)
;             case  "Recirculation, Non-Demand Control"                           :  1
;             case  "Recirculation, Demand Control Push Button"                   :  1
;             case  "Recirculation, Demand Control Occupancy/Motion"              :  1
;             case  "(HERS req'd) Recirculation, Demand Control Push Button"      :  1
;             case  "(HERS req'd) Recirculation, Demand Control Occupancy/Motion" :  1
;             default  :  0
;          endswitch
;    endif
;ENDRULE
;
;; SAC 2/12/20 - added to enable toggling of recirc pump & loop fields in UI
;RULE NEW ResDHWSys:IsCentralRecircSys
;  DATATYPE
;    Float
;  LONGFORM
;    IsCentralRecirculationSystem
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSys .AND. IsRecircSys)
;    then  1
;    else  0  endif
;ENDRULE
;
;RULE ResDHWSys:CompactDistAllowed
;      ; CmpctDistAllowed in Res
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSys) then  0
;    else if (CentralSys = 0 .AND. IsRecircSys) then  0
;    else  1
;    endif endif
;ENDRULE
;
;RULE ResDHWSys:CompactDist
;      ; CompactDistrib in Res rules
;  DESCRIPTION
;    "Distribution system types for systems serving individual dwelling units"
;  REFERENCE 
;    
;  INPUTCLASS
;    Required
;  OPTION
;    not compact
;    Basic Credit
;    Expanded Credit (HERS req'd)
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralRecircType
;  DEFAULT
;    "not compact"
;ENDRULE
;
;RULE ResDHWSys:CompactDistMsg
;      ; CDDistMessage in Res
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CompactDist = "not compact")
;    then  UNDEFINED
;    else  "Qualification based on fixture distances entered in Space / Dwelling Unit Data screen"
;    endif
;ENDRULE
;
;RULE ResDHWSys:CompactDistRTFFile
;      ; CmpctDistDescrip in Res
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    switch (CompactDist)
;       case  "Basic Credit"                 :  "RTF\DHW_CD_Basic.rtf"
;       case  "Expanded Credit (HERS req'd)" :  "RTF\DHW_CD_Exp.rtf"  
;       default :  UNDEFINED
;    endswitch
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// ------ Residential DHW System Living Unit Count -------
;// 
;RULE ResDHWSys:LivingUnitCnt
;  DESCRIPTION
;    "The number of living units served by a central residential DHW System."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput  IgnoreUserInput  "Removed prior to release of 2013-3e and 2016.2"
;  REPORTPRECISION
;    0
;  DEFAULT
;    SumRevRef( Spc:ResDHWSysRef, Spc:ResLivingUnitCntWithMult ) +
;    SumRevRef( Spc:ResDHWSysRef, Spc:HotelMotelGuestRmCntWithMult )
;  CHECKCODE           // LivingUnitCnt
;    if( IfValidAnd(CentralSys = 1) .AND. IfValidAnd(LivingUnitCnt <= 1) )
;    then
;      PostError("Residential DHW system '%s' is specified to serve more than 
;                 one dwelling unit but the Number of Living Units is less 
;                 than or equal to 1.",Name)
;    else
;      UNCHANGED
;    endif
;  SIZING_PROPOSED           
;    if( ExcludeWtrHtg )
;    then 1
;    else LivingUnitCnt
;    endif
;  SIZING_BASELINE
;    if (IfValidAnd( IsBaseSys > 0 ))
;    then 
;	    if ( ExcludeWtrHtg ) 
;	    then 1
;	    else
;	         SumRevRef( Spc:ResDHWSysRef, Spc:ResLivingUnitCntWithMult ) +
;	         SumRevRef( Spc:ResDHWSysRef, Spc:HotelMotelGuestRmCntWithMult )
;      endif
;    else if( CentralSys )
;    then
;      LivingUnitCnt
;    else
;      1
;    endif endif
;  ANNUAL
;    z:LivingUnitCnt
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// ------ Residential DHW System Story Count -------
;// 
;RULE ResDHWSys:SysStoryCnt
;  DESCRIPTION
;    "The number stories served by an individual Residential DHW System.
;    Typical number of stories assigned to one system is 1 - 10. For projects
;    having more than 10 stories it is suggested that the user create a separate 
;    Residential DHW System for every 90 feet of vertical plumbing height."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  COMMONMAXIMUM
;    10
;  REPORTPRECISION
;    0
;  DEFAULT
;    0
;  CHECKCODE           // SysStoryCnt
;    if( CentralSys .AND. IfValidAnd(SysFlrArea > 0) .AND. 
;        IfValidAnd(SysStoryCnt = 0) )
;    then
;      PostError("For Central Systems, more than 0 stories must be assigned 
;                 at '%s'.",Name)
;    else UNCHANGED
;    endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 1
;    else u:SysStoryCnt
;    endif
;  SIZING_BASELINE
;    if (IfValidAnd( IsBaseSys > 0 ))
;    then 1
;    else if( CentralSys )
;    then
;      u:SysStoryCnt
;    else
;      1
;    endif endif
;  ANNUAL
;    z:SysStoryCnt
;ENDRULE
;
;
;// ----------------------------------------------------------------------------- SAC 1/11/20 (Com tic #3156)
;// -------------- Loop Tank Heater & Multiplier --------------------
;RULE ResDHWSys:ResLpTankHtrRef
;  DESCRIPTION
;    "Loop tank water heater - currently restricted to electric resistance storage."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    UNDEFINED 
;ENDRULE
;
;RULE ResDHWSys:ResLpTankHtrMult
;  DESCRIPTION
;    "Loop tank water heater multiplier."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  MINIMUM
;    0
;  MAXIMUM
;    250
;  DEFAULT
;    if (LocalCompAssigned( ResLpTankHtrRef )) 
;    then  1  
;    else  UNDEFINED
;    endif
;ENDRULE
;
;; SAC 1/13/20 (Com tic #3156)
;RULE ResLpTankHtr:whEF
;  DESCRIPTION
;    "Water heater energy factor (for small storage & instantaneous)."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    0.97 
;ENDRULE
;
;RULE ResLpTankHtr:whResHtPwr
;  DESCRIPTION
;    "Water heater resistance heat power (watts)."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    20000 
;ENDRULE
;
;RULE ResLpTankHtr:whVol
;  DESCRIPTION
;    "Water heater tank volume (must be 0 or undefined for instantaneous)."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    300 
;ENDRULE
;
;RULE ResLpTankHtr:TankZn
;  DESCRIPTION
;    "Description of storage tank location (ambient conditions)."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    "Unconditioned" 
;ENDRULE


// -----------------------------------------------------------------------------  SAC 1/9/20 - moved up from below to enable reference in TankVol rule (& RecircPumpPwr)
// -------------- Residential DHW DwellUnit & Bedroom Counts -------------------
//
// added ResDHWSys NumHRRDUsServed & NumHtlMtlUnitsServed to aid in std design solar system sizing - SAC 05/03/21
// revised to count this only for HighRise models (excluding lowrise) - SAC 03/10/22
RULE NEW ResDHWSys:NumHRRDUsServed
  DATATYPE
    Float
  LONGFORM
    NumberOfHighRiseResidentialDwellingUnitsServed
  DESCRIPTION
    "Number of HRR dwelling units served by this DHW system (used for central systems)."
  INPUTCLASS
    NotInput
  DEFAULT
    if (IfValidAnd( Proj:IsHighRiseMFam > 0 ))
    then  SumRevRef( Spc:ResDHWSysRef, Spc:ResLivingUnitCntWithMult )
    else  0  endif
ENDRULE
RULE NEW ResDHWSys:NumHtlMtlUnitsServed
  DATATYPE
    Float
  LONGFORM
    NumberOfHotelMotelUnitsServed
  DESCRIPTION
    "Number of hotel/motel units served by this DHW system (used for central systems)."
  INPUTCLASS
    NotInput
  DEFAULT
    SumRevRef( Spc:ResDHWSysRef, Spc:HotelMotelGuestRmCntWithMult )
ENDRULE

; RES DHW REMOVAL
;RULE NEW ResDHWSys:NumDUsServed
;  DATATYPE
;    Float
;  LONGFORM
;    NumberOfDwellingUnitsServed
;  DESCRIPTION
;    "Number of dwelling units served by this DHW system (used for central systems)."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    NumHRRDUsServed + NumHtlMtlUnitsServed
;ENDRULE
;; SAC 1/9/20   - SAC 2/19/20 - fixed logic to correctly default for CentralSystemType = "HPWH" (where # heaters n/a)
;RULE NEW ResDHWSys:NumDUsServedPerHtr
;  DATATYPE
;    Float
;  LONGFORM
;    NumberOfDwellingUnitsServedPerHeater
;  DESCRIPTION
;    "Number of dwelling units served per heater assigned to this DHW system (used for central systems)."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSys .AND. IfValidAnd( CentralSysType = "HPWH" ))
;    then  ValidOr( NumDUsServed, 0 )
;    else if (IfValidAnd( WtrHtrCnt > 0 )==0)
;    then  0
;    else  ValidOr( NumDUsServed, 0 ) / WtrHtrCnt
;    endif endif
;ENDRULE
;
;; SAC 05/04/21
;RULE NEW ResDHWSys:NumHRRBedroomsServed
;  DATATYPE
;    Float
;  LONGFORM
;    NumberOfHighRiseResidentialBedroomsServed
;  DESCRIPTION
;    "Number of high-rise residential dwelling unit bedrooms served by this DHW system (used for central systems)."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    SumRevRef( Spc:ResDHWSysRef, Spc:ResLivingUnitBedroomCntWithMult )
;ENDRULE
;; SAC 1/29/19
;RULE NEW ResDHWSys:NumBedroomsServed
;  DATATYPE
;    Float
;  LONGFORM
;    NumberOfBedroomsServed
;  DESCRIPTION
;    "Number of dwelling unit bedrooms served by this DHW system (used for central systems)."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    NumHRRBedroomsServed + SumRevRef( Spc:ResDHWSysRef, Spc:HotelMotelGuestRmCntWithMult )
;ENDRULE
;; SAC 1/9/20   - SAC 2/19/20 - fixed logic to correctly default for CentralSystemType = "HPWH" (where # heaters n/a)
;RULE NEW ResDHWSys:NumBedroomsServedPerHtr
;  DATATYPE
;    Float
;  LONGFORM
;    NumberOfBedroomsServedPerHeater
;  DESCRIPTION
;    "Number of dwelling unit bedrooms served per heater assigned to this DHW system (used for central systems)."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSys .AND. IfValidAnd( CentralSysType = "HPWH" ))
;    then  ValidOr( NumBedroomsServed, 0 )
;    else if (IfValidAnd( WtrHtrCnt > 0 )==0)
;    then  0
;    else  ValidOr( NumBedroomsServed, 0 ) / WtrHtrCnt
;    endif endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Central HPWH (simplified inputs) --------------------  SAC 1/12/20 (Com tic #3156)  - SAC 3/12/20 - added 'Colmac CxA20'  - SAC 6/28/20 - major restructuring/additions to accommodate new features
;;  RES -> COM translations:
;;           CentralDHWTypeVal    ->    CentralSysTypeVal
;;           CHPWHSysDescrip      ->    CentralHPWHSysDesc  (enum)
;;           CHPWHIntegPkgType    ->    CentralHPWHIntegratedPackagedType  (enum) - SAC 03/08/21
;;           CHPWHCompType        ->    CentralHPWHCprsrType
;;           CHPWHNEEABrand             ->    CentralHPWHBrand  (enum)
;;           CHPWHNEEAModel             ->    CentralHPWHModel  (enum)
;;           CHPWHComModel              ->    CentralHPWHCommModel  (enum)  - SAC 03/08/21
;;           CHPWHASHPType              ->    CentralHPWHAirSrcHtPumpType  (enum)
;;           CHPWHNumComp               ->    CentralHPWHCprsrCnt
;;           CHPWHPrimTankVol / CHPWHTotTankVol  ->  CentralHPWHPriTankVol
;;           CHPWHTankCount             ->    CentralHPWHTankCnt
;;           CHPWHTankRVal              ->    CentralHPWHTankRVal
;;           CHPWHTankSetpt             ->    CentralHPWHTankSetpt
;;           CHPWHTankLoc               ->    CentralHPWHTankLctn
;;           CHPWHSrcAirLoc             ->    CentralHPWHAirSrc
;
;;           CHPWHLoopTankType          ->    CentralHPWHLpTankType  (enum)
;;           CHPWHLoopTankCompType      ->    CentralHPWHLpTankCprsrType  (enum)
;;           CHPWHLoopTankCompTypeLbl   ->    CentralHPWHLpTankCprsrTypeLabel
;;           CHPWHLoopTankNEEABrand     ->    CentralHPWHLpTankBrand  (enum)
;;           CHPWHLoopTankNEEAModel     ->    CentralHPWHLpTankModel  (enum)
;;           CHPWHLoopTankComModel      ->    CentralHPWHLpTankCommModel  (enum)  - SAC 03/09/21
;;           CHPWHLoopTankASHPType      ->    CentralHPWHLpTankAirSrcHtPumpType  (enum)
;;           CHPWHLoopTankCompCnt       ->    CentralHPWHLpTankCprsrCnt
;;           CHPWHLoopTankCompCntLbl    ->    CentralHPWHLpTankCprsrCntLabel
;;           CHPWHLoopTankVol           ->    CentralHPWHLpTankVol
;;           CHPWHLoopTankTankCnt       ->    CentralHPWHLpTankCnt
;;           CHPWHLoopTankRVal          ->    CentralHPWHLpTankRVal
;;           CHPWHLoopTankSetpt         ->    CentralHPWHLpTankSetpt
;;           CHPWHLoopTankLoc           ->    CentralHPWHLpTankLctn
;;           CHPWHLoopTankSrcAirLoc     ->    CentralHPWHLpTankAirSrc
;
;;           CHPWHLoopTankShowDtls      ->    CentralHPWHLpTankShowDetails
;; ;           CHPWHTankRValReqd          ->    CentralHPWHTankRValReqd
;; ;           CHPWHLoopTankRValReqd      ->    CentralHPWHLpTankRValReqd
;;           CHPWHErrMsg                ->    CentralHPWHErrMsg
;;           ValidAnalysisCHPWH         ->    ValidAnalysisCentralHPWH
;
;RULE ResDHWSys:CentralHPWHSysDesc
;  DESCRIPTION
;    "Central HPWH system description."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralRecircType
;      ResDHWSys:CentralSysType
;  DEFAULT
;    if (LocalStatus( CentralHPWHCprsrType ) > 4 .OR. LocalStatus( CentralHPWHLpTankVol  ) > 4 .OR.
;        LocalStatus( CentralHPWHCprsrCnt  ) > 4 .OR. LocalStatus( CentralHPWHPriTankVol ) > 4)
;    then  "Large Single Pass Primary"
;    else  "- select system description -"  endif
;ENDRULE
;
;; SAC 03/09/21
;RULE ResDHWSys:CentralHPWHIntegratedPackagedType
;  DESCRIPTION
;    "Central HPWH integrated, packaged equipment type."
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralHPWHSysDesc
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHCprsrType
;  DESCRIPTION
;    "Central HPWH large, single pass compressor type."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralHPWHSysDesc
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHCprsrTypeLabel
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSysTypeVal != 2) then  UNDEFINED
;    else if (CentralHPWHSysDesc == "Large Single Pass Primary")
;    then  "HPWH/Compressor Type:"
;    else if (CentralHPWHSysDesc == "Integrated, Packaged System")
;    then  if (CentralHPWHIntegratedPackagedType == "Residential (NEEA rated) Product")
;          then  "NEEA HPWH Brand/Model:"
;          else if (CentralHPWHIntegratedPackagedType == "Commercial Product")
;          then  "Comm HPWH Brand/Model:"
;          else  UNDEFINED  endif endif
;    else  UNDEFINED  endif endif endif
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHBrand
;  DESCRIPTION
;    "Small, integrated, packaged central NEEA HPWH brand."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralHPWHSysDesc
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHModel
;  DESCRIPTION
;    "Small, integrated, packaged central NEEA HPWH model."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralHPWHBrand
;ENDRULE
;
;; SAC 03/09/21
;RULE ResDHWSys:CentralHPWHCommModel
;  DESCRIPTION
;    "Commercial, integrated, packaged central HPWH brand/model."
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralHPWHIntegratedPackagedType
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHCprsrCntLabel
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSysTypeVal != 2) then  UNDEFINED
;    else if (CentralHPWHSysDesc == "Large Single Pass Primary")
;    then  "Cmprsr/Heater Count:"
;    else if (CentralHPWHSysDesc == "Integrated, Packaged System")
;    then  if (CentralHPWHIntegratedPackagedType == "Residential (NEEA rated) Product")
;          then  "NEEA HPWH Count:"
;          else if (CentralHPWHIntegratedPackagedType == "Commercial Product")
;          then  "Comm HPWH Count:"
;          else  UNDEFINED  endif endif
;    else  UNDEFINED  endif endif endif
;ENDRULE
;
;;; TESTING
;;; TESTING
;;RULE NEW ResDHWSys:CentralHPWHASHPTypeVal
;;  DATATYPE
;;    Integer
;;  LONGFORM
;;    CentralHPWHASHPTypeVal
;;  INPUTCLASS
;;    NotInput
;;  DEFAULT
;;    if (CentralSysTypeVal == 2)
;;    then  if (CentralHPWHSysDesc == "Large Single Pass Primary" .AND. EnumValue( CentralHPWHCprsrType ) > 0)
;;          then  mod( EnumValue( CentralHPWHCprsrType ), 100 )
;;          else if (CentralHPWHSysDesc == "Integrated, Packaged System" .AND. EnumValue( CentralHPWHModel ) > 0)
;;          then  mod( EnumValue( CentralHPWHModel ), 100 )
;;          else  0  endif endif
;;    else  0  endif
;;ENDRULE
;
;RULE ResDHWSys:CentralHPWHLpTankType
;  DESCRIPTION
;    "Central HPWH loop tank type."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralHPWHSysDesc
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHLpTankCprsrType
;  DESCRIPTION
;    "Central HPWH large, single pass loop tank compressor type."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralHPWHLpTankType
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHLpTankBrand
;  DESCRIPTION
;    "Small, integrated, packaged central NEEA loop tank HPWH brand."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralHPWHLpTankType
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHLpTankModel
;  DESCRIPTION
;    "Small, integrated, packaged central NEEA loop tank HPWH model."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralHPWHLpTankBrand
;ENDRULE
;
;; SAC 03/09/21
;RULE ResDHWSys:CentralHPWHLpTankCommModel
;  DESCRIPTION
;    "Commercial, integrated, packaged central NEEA loop tank HPWH brand/model."
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResDHWSys:CentralHPWHLpTankType
;ENDRULE
;
;; added elec res label - SAC 08/25/21
;RULE ResDHWSys:CentralHPWHLpTankCprsrTypeLabel
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSysTypeVal != 2) then  UNDEFINED
;    else  switch (CentralHPWHLpTankType)
;;             case  "Electric Resistance"   :  if (IfValidAnd( Proj:EnableResearchMode > 0 ))
;;                                              then  "Res Control Scheme:"
;;                                              else  UNDEFINED  endif
;             case  "NEEA HPWH"             :  "NEEA HPWH Brand/Model:"
;             case  "Commercial HPWH"       :  "Comm HPWH Brand/Model:"
;             case  "Large HPWH/Compressor" :  "HPWH/Compressor Type:"
;             default :  UNDEFINED
;          endswitch  endif
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHLpTankCprsrCntLabel
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSysTypeVal != 2) then  UNDEFINED
;    else  switch (CentralHPWHLpTankType)
;             case  "NEEA HPWH"             :  "NEEA HPWH Count:"
;             case  "Commercial HPWH"       :  "Comm HPWH Count:"
;             case  "Large HPWH/Compressor" :  "Cmprsr/Heater Count:"
;             case  "Electric Resistance"   :  "Heater Count:"
;             default :  UNDEFINED
;          endswitch  endif
;ENDRULE
;
;;   "Default ResDHWSys:CentralHPWHCprsrCnt - Number of central HPWH compressors"   ResDHWSys:CentralHPWHCprsrCnt  =
;;      {  UNDEFINED  }
;;   "Blast user-defined ResDHWSys:CentralHPWHCprsrCntFlt if EnableResearchMode not activated"   ResDHWSys:Action  =    ; SAC 3/6/20
;;      {  if (IfValidAnd( Proj:EnableResearchMode > 0 )==0 .AND. LocalStatus( CentralHPWHCprsrCntFlt ) > 4)
;;         then  EvalRulelist( "ForceDefault_DHWSys_CentralHPWHCprsrCntFlt", 1 )
;;         else  UNCHANGED  endif  }
;;   "Default ResDHWSys:CentralHPWHCprsrCntFlt"   ResDHWSys:CentralHPWHCprsrCntFlt  = {  CentralHPWHCprsrCnt  }
;
;;   "Blast user-defined DHWSys:CHPWHLoopTankResCtrls and StdCHPWHLoopTankResCtrls if EnableResearchMode not activated"   DHWSys:Action  =     ; SAC 07/16/21 (tic #1275)
;;      {  if (IfValidAnd( Proj:EnableResearchMode > 0 )==0 .AND. IfValidAnd( Proj:RunAbbrev == "u" ) .AND.
;;             (LocalStatus( CHPWHLoopTankResCtrls ) > 4 .OR. LocalStatus( StdCHPWHLoopTankResCtrls ) > 4))
;;         then  EvalRulelist( "ForceDefault_DHWSys_CHPWHLoopTankResCtrls", 1 )
;;         else  UNCHANGED  endif  }
;
;; added CentralHPWHCprsrCap, CentralHPWHMinPriTankVol, CentralHPWHLpTankCprsrCap & CentralHPWHLpTankMinTankVol - SAC 08/31/20
;RULE NEW ResDHWSys:CentralHPWHCprsrCap
;  DATATYPE
;    Float
;  LONGFORM
;    CentralHPWHCompressorCapacity
;  DESCRIPTION
;    "Compressor heating capacity @ 40 deg F."
;  UNITS
;    kW
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (IfValidAnd( CentralSysTypeVal = 2 )==0 .OR.
;        CentralHPWHSysDesc != "Large Single Pass Primary" .OR. EnumValue( CentralHPWHCprsrType ) < 1) then  UNDEFINED
;    else  T24RCHPWHCompressor:OutputCap( "CHPWHCompType", EnumValue( CentralHPWHCprsrType ) )
;    endif
;ENDRULE
;
;RULE NEW ResDHWSys:CentralHPWHMinPriTankVol
;  DATATYPE
;    Float
;  LONGFORM
;    CentralHPWHMinimumPrimaryTankVolume
;  DESCRIPTION
;    "Minimum tank volume for CHPWH primary tank(s)."
;  UNITS
;    gal
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (IfValidAnd( CentralHPWHCprsrCap > 0 ) .AND. IfValidAnd( CentralHPWHCprsrCnt > 0 ))
;    then  int( (CentralHPWHCprsrCap * CentralHPWHCprsrCnt * 10) + 0.5 )
;    else  -1
;    endif
;ENDRULE
;
;RULE NEW ResDHWSys:CentralHPWHLpTankCprsrCap
;  DATATYPE
;    Float
;  LONGFORM
;    CentralHPWHLoopTankCompressorCapacity
;  DESCRIPTION
;    "Loop tank compressor heating capacity @ 40 deg F."
;  UNITS
;    kW
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (IfValidAnd( CentralSysTypeVal = 2 )==0 .OR.
;        CentralHPWHLpTankType != "Large HPWH/Compressor" .OR.
;        EnumValue( CentralHPWHLpTankCprsrType ) < 1) then  UNDEFINED
;    else  T24RCHPWHCompressor:OutputCap( "CHPWHCompType", EnumValue( CentralHPWHLpTankCprsrType ) )
;    endif
;ENDRULE
;
;RULE NEW ResDHWSys:CentralHPWHLpTankMinTankVol
;  DATATYPE
;    Float
;  LONGFORM
;    CentralHPWHLoopTankMinimumTankVolume
;  DESCRIPTION
;    "Minimum volume of CHPWH loop tank(s)."
;  UNITS
;    gal
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (IfValidAnd( CentralHPWHLpTankCprsrCap > 0 ) .AND.
;        IfValidAnd( CentralHPWHLpTankCprsrCnt > 0 ))
;    then  int( (CentralHPWHLpTankCprsrCap * CentralHPWHLpTankCprsrCnt * 10) + 0.5 )
;    else  -1
;    endif
;ENDRULE
;
;; updated for CentralHPWHIntegratedPackagedType and CentralHPWHCommModel - SAC 03/09/21
;RULE ResDHWSys:CentralHPWHPriTankVol
;  DESCRIPTION
;    "Central HPWH primary tank volume (total across all tanks)."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  DEFAULT
;    if (IfValidAnd( CentralSysTypeVal = 2 )==0) then  UNDEFINED
;    else if (CentralHPWHSysDesc == "Large Single Pass Primary" .AND. IfValidAnd( CentralHPWHMinPriTankVol > 0 ))
;    then  CentralHPWHMinPriTankVol * 2
;    else if (CentralHPWHSysDesc == "Integrated, Packaged System" .AND.
;             CentralHPWHIntegratedPackagedType == "Residential (NEEA rated) Product" .AND. EnumValue( CentralHPWHModel ) > 1)
;    then  HPWHData_NEEA:TankVolume( "Brand", CentralHPWHBrand, "Model", CentralHPWHModel ) *
;          ValidOr( CentralHPWHCprsrCnt, 0 )
;    else if (CentralHPWHSysDesc == "Integrated, Packaged System" .AND.
;             CentralHPWHIntegratedPackagedType == "Commercial Product" .AND. EnumValue( CentralHPWHCommModel ) > 1)
;    then  switch (CentralHPWHCommModel)
;             case "A. O. Smith CAHP-120  (120 gal)"  :  120 * ValidOr( CentralHPWHCprsrCnt, 0 )
;             default  :  UNDEFINED
;          endswitch
;    else  UNDEFINED
;    endif endif endif endif
;ENDRULE
;
;; updated for CentralHPWHLpTankType and CentralHPWHLpTankCommModel - SAC 03/09/21
;RULE ResDHWSys:CentralHPWHLpTankVol
;  DESCRIPTION
;    "Central HPWH loop tank volume (total across all tanks)."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  DEFAULT
;    if (IfValidAnd( CentralSysTypeVal = 2 )==0) then  UNDEFINED
;    else if (CentralHPWHSysDesc == "Large Single Pass Primary" .AND.
;             IfValidAnd( CentralHPWHLpTankMinTankVol > 0 ))
;    then  CentralHPWHLpTankMinTankVol * 2
;    else if (CentralHPWHSysDesc == "Integrated, Packaged System" .AND.
;             CentralHPWHLpTankType == "NEEA HPWH" .AND. EnumValue( CentralHPWHLpTankModel ) > 1)
;    then  HPWHData_NEEA:TankVolume( "Brand", CentralHPWHLpTankBrand, "Model", CentralHPWHLpTankModel ) *
;          ValidOr( CentralHPWHLpTankCprsrCnt, 0 )
;    else if (CentralHPWHSysDesc == "Integrated, Packaged System" .AND.
;             CentralHPWHLpTankType == "Commercial HPWH" .AND. EnumValue( CentralHPWHLpTankCommModel ) > 1)
;    then  switch (CentralHPWHLpTankCommModel)
;             case "A. O. Smith CAHP-120  (120 gal)"  :  120 * ValidOr( CentralHPWHLpTankCprsrCnt, 0 )
;             default  :  UNDEFINED
;          endswitch
;    else  UNDEFINED
;    endif endif endif endif
;ENDRULE
;
;; updated for CentralHPWHIntegratedPackagedType and CentralHPWHCommModel - SAC 03/08/21
;RULE ResDHWSys:CentralHPWHAirSrcHtPumpType
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSysTypeVal == 2)
;    then  if (CentralHPWHSysDesc == "Large Single Pass Primary" .AND. EnumValue( CentralHPWHCprsrType ) > 0)
;          then  mod( EnumValue( CentralHPWHCprsrType ), 100 )
;          else if (CentralHPWHSysDesc == "Integrated, Packaged System" .AND. 
;                   CentralHPWHIntegratedPackagedType == "Residential (NEEA rated) Product" .AND.
;                   EnumValue( CentralHPWHModel ) > 0)
;          then  mod( EnumValue( CentralHPWHModel ), 100 )
;          else if (CentralHPWHSysDesc == "Integrated, Packaged System" .AND. 
;                   CentralHPWHIntegratedPackagedType == "Commercial Product" .AND.
;                   EnumValue( CentralHPWHCommModel ) > 0)
;          then  mod( EnumValue( CentralHPWHCommModel ), 100 )
;          else  0  endif endif endif
;    else  0  endif
;ENDRULE
;
;; added reference to CentralHPWHLpTankCommModel - SAC 03/09/21
;RULE ResDHWSys:CentralHPWHLpTankAirSrcHtPumpType
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSysTypeVal == 2)
;         then  if (CentralHPWHLpTankType = "Large HPWH/Compressor" .AND. EnumValue( CentralHPWHLpTankCprsrType ) > 0)
;               then  mod( EnumValue( CentralHPWHLpTankCprsrType ), 100 )
;               else if (CentralHPWHLpTankType == "NEEA HPWH" .AND. EnumValue( CentralHPWHLpTankModel ) > 1)
;               then  mod( EnumValue( CentralHPWHLpTankModel ), 100 )
;               else if (CentralHPWHLpTankType == "Commercial HPWH" .AND. EnumValue( CentralHPWHLpTankCommModel ) > 1)
;               then  mod( EnumValue( CentralHPWHLpTankCommModel ), 100 )
;               else  0  endif endif endif
;         else  0  endif
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHLpTankShowDetails
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (IfValidAnd( CentralSysTypeVal = 2 )==0) then  0
;    else if (EnumValue( CentralHPWHSysDesc ) > 0 .AND.
;              ( CentralHPWHLpTankType == "Electric Resistance" .OR. CentralHPWHLpTankType == "Large HPWH/Compressor" ) ) 
;    then  1  else  0  endif endif
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHTankRVal
;  DESCRIPTION
;    "Central HPWH storage tank insulation R-value"
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Default
;  MINIMUM
;    16
;  DEFAULT
;    if (CentralSysTypeVal == 2 .AND. CentralHPWHSysDesc == "Large Single Pass Primary" .AND. IfValidAnd( SysFlrArea > 0 ))
;    then  16
;    else  UNDEFINED  endif
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHLpTankRVal
;  DESCRIPTION
;    "Central HPWH loop tank insulation R-value"
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Default
;  MINIMUM
;    16
;  DEFAULT
;    if (CentralHPWHLpTankShowDetails > 0 .AND. IfValidAnd( SysFlrArea > 0 ))
;    then  16
;    else  UNDEFINED  endif
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHTankMinRVal
;  DESCRIPTION
;    "Central HPWH storage tank insulation MINIMUM R-value"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    16
;ENDRULE
;;      {  if (CentralDHWTypeVal == 2 .AND. CHPWHSysDescrip == 2 .AND.
;;             IfValidAnd( FloorAreaServed[1] > 0 ) .AND. Proj:EnableResearchMode < 1) then  16  else  0  endif  }
;
;RULE ResDHWSys:CentralHPWHLpTankMinRVal
;  DESCRIPTION
;    "Central HPWH loop tank insulation MINIMUM R-value"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    16
;ENDRULE
;;      {  if (CHPWHLoopTankShowDtls > 0 .AND.
;;             IfValidAnd( FloorAreaServed[1] > 0 ) .AND. Proj:EnableResearchMode < 1) then  16  else  0  endif  }
;
;RULE ResDHWSys:CentralHPWHTankSetpt
;  DESCRIPTION
;    "Central HPWH storage tank setpoint temperature"
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput  IgnoreUserInput  "Removed prior to release of 2019.1.3"
;  DEFAULT
;    if (CentralSysTypeVal == 2 .AND. CentralHPWHSysDesc == "Large Single Pass Primary" .AND. IfValidAnd( SysFlrArea > 0 ))
;    then  140
;    else  UNDEFINED  endif
;ENDRULE
;
;RULE ResDHWSys:CentralHPWHLpTankSetpt
;  DESCRIPTION
;    "Central HPWH loop tank setpoint temperature"
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput  IgnoreUserInput  "Removed prior to release of 2019.1.3"
;  DEFAULT
;    if (CentralHPWHLpTankShowDetails > 0 .AND. IfValidAnd( SysFlrArea > 0 ))
;    then  136    ; updated from 136 - SAC 07/31/20  ; returned to 136 default - SAC 08/25/21
;    else  UNDEFINED  endif
;ENDRULE
;
;   ; fixed error check problem: CentralHPWHTankSetpt & CentralHPWHLpTankSetpt being checked when not editable - SAC 08/19/20
;   ; split error checking across several rules to avoid blob size restrictions - first covering LARGE compressor inputs - SAC 03/09/21
;RULE ResDHWSys:CentralHPWHErrMsg
;  INPUTCLASS
;    NotInput
;  CHECKCODE
;    if ( ExcludeWtrHtg )
;    then UNCHANGED
;    else
;	    if (LocalStatus( CentralHPWHErrMsg ) > 0)
;	    then  PostError( "Residential DHW system '%s' %s", Name, CentralHPWHErrMsg )
;	    else  UNCHANGED  endif
;	  endif
;  DEFAULT
;    if (IfValidAnd( CentralSysTypeVal = 2 )==0) then  UNDEFINED
;    else if (CentralHPWHSysDesc == "- select system description -") then  "Central HPWH system type is missing but required"
;    else if (CentralHPWHSysDesc == "Large Single Pass Primary")
;    then  if (EnumValue( CentralHPWHCprsrType ) < 1) then  "Central HPWH input missing:  HPWH/Compressor Type"
;          else if (IfValidAnd( CentralHPWHCprsrCnt > 0 )==0) then  "Central HPWH input error:  Compressor/Heater Count must be > 0"
;          else if (IfValidAnd( CentralHPWHPriTankVol > 0 )==0) then  "Central HPWH input error:  Total Tank Volume must be > 0"
;          else if (IfValidAnd( CentralHPWHTankCnt  > 0 )==0) then  "Central HPWH input error:  Tank Count must be > 0"
;          else if (IfValidAnd( CentralHPWHMinPriTankVol > CentralHPWHPriTankVol )) then  Format( "Central HPWH input error:  Total Tank Volume must be >= %g", CentralHPWHMinPriTankVol )
;          else if (IfValidAnd( CentralHPWHTankRVal  >= CentralHPWHTankMinRVal)==0) then  Format( "Central HPWH input error:  Tank R-Value must be >= %g", CentralHPWHTankMinRVal )
;          else if (EnumValue( CentralHPWHTankLctn ) < 1) then  "Central HPWH input error:  Tank Location selection missing"
;          else if (EnumValue( CentralHPWHAirSrc   ) < 1) then  "Central HPWH input error:  Source Air From selection missing"
;          else  UNDEFINED  endif endif endif endif endif endif endif endif
;    else  UNDEFINED  endif endif endif
;ENDRULE
;   ; 2nd CentralHPWHErrMsg rule - covering NEEA & Comm inputs - SAC 03/09/21
;RULE ResDHWSys:CentralHPWHErrMsg
;  DEFAULT
;    if (LocalStatus( CentralHPWHErrMsg ) < 1 .AND. CentralHPWHSysDesc == "Integrated, Packaged System" .AND.
;        CentralHPWHIntegratedPackagedType == "Residential (NEEA rated) Product")
;    then  if (     EnumValue( CentralHPWHBrand ) <= 1) then  "Central HPWH input missing:  NEEA HPWH brand"
;          else if (EnumValue( CentralHPWHModel ) <= 1) then  "Central HPWH input missing:  NEEA HPWH model"
;          else if (IfValidAnd( CentralHPWHCprsrCnt > 0 )==0) then  "Central HPWH input error:  NEEA HPWH Count must be > 0"
;       ;   else if (IfValidAnd( CentralHPWHTankSetpt  > 0 )==0) then  "Central HPWH input error:  Tank Setpoint must be > 0"
;          else if (EnumValue( CentralHPWHTankLctn ) < 1) then      "Central HPWH input error:  Tank Location selection missing"
;          else if (EnumValue( CentralHPWHAirSrc   ) < 1) then  "Central HPWH input error:  Source Air From selection missing"
;          else  UNCHANGED  endif endif endif endif endif
;    else if (LocalStatus( CentralHPWHErrMsg ) < 1 .AND. CentralHPWHSysDesc == "Integrated, Packaged System" .AND.
;             CentralHPWHIntegratedPackagedType == "Commercial Product")
;    then  if (     EnumValue( CentralHPWHCommModel ) <= 1) then    "Central HPWH input missing:  Commercial HPWH brand/model"
;          else if (IfValidAnd( CentralHPWHCprsrCnt > 0 )==0) then  "Central HPWH input error:  Commercial HPWH Count must be > 0"
;       ;   else if (IfValidAnd( CentralHPWHTankSetpt  > 0 )==0) then  "Central HPWH input error:  Tank Setpoint must be > 0"
;          else if (EnumValue( CentralHPWHTankLctn ) < 1) then      "Central HPWH input error:  Tank Location selection missing"
;          else if (EnumValue( CentralHPWHAirSrc   ) < 1) then      "Central HPWH input error:  Source Air From selection missing"
;          else  UNCHANGED  endif endif endif endif
;    else  UNCHANGED  endif endif
;ENDRULE
;   ; 3rd CentralHPWHErrMsg rule - covering LpTank-LargeOrElecRes inputs - SAC 03/09/21
;RULE ResDHWSys:CentralHPWHErrMsg
;  DEFAULT
;    if (LocalStatus( CentralHPWHErrMsg ) < 1 .AND.
;        (CentralHPWHLpTankType = "Large HPWH/Compressor" .OR. CentralHPWHLpTankType = "Electric Resistance"))
;    then  if (CentralHPWHLpTankType = "Large HPWH/Compressor" .AND.
;              EnumValue( CentralHPWHLpTankCprsrType ) < 1) then          "CHPWH Loop Tank input missing:  HPWH/Compressor Type"
;          else if (IfValidAnd( CentralHPWHLpTankCprsrCnt > 0 )==0) then  "CHPWH Loop Tank input error:  Compressor/Heater Count must be > 0"
;          else if (IfValidAnd( CentralHPWHLpTankVol     > 0 )==0) then   "CHPWH Loop Tank input error:  Total Tank Volume must be > 0"
;          else if (IfValidAnd( CentralHPWHLpTankCnt > 0 )==0) then       "CHPWH Loop Tank input error:  Tank Count must be > 0"
;          else if (IfValidAnd( CentralHPWHLpTankMinTankVol > CentralHPWHLpTankVol )) then     Format( "CHPWH Loop Tank input error:  Total Tank Volume must be >= %g", CentralHPWHLpTankMinTankVol )
;          else if (IfValidAnd( CentralHPWHLpTankRVal   >= CentralHPWHLpTankMinRVal)==0) then  Format( "CHPWH Loop Tank input error:  Tank R-Value must be >= %g", CentralHPWHLpTankMinRVal )
;          else if (EnumValue(  CentralHPWHLpTankLctn ) < 1) then         "CHPWH Loop Tank input error:  Tank Location selection missing"
;          else if (CentralHPWHLpTankType = "Large HPWH/Compressor" .AND.
;                   EnumValue(  CentralHPWHLpTankAirSrc ) < 1) then       "CHPWH Loop Tank input error:  Source Air From selection missing"
;          else  UNCHANGED  endif endif endif endif endif endif endif endif
;    else  UNCHANGED  endif
;ENDRULE
;   ; 4th CentralHPWHErrMsg rule - covering LpTank-NEEAOrCommHPWH inputs - SAC 03/09/21
;RULE ResDHWSys:CentralHPWHErrMsg
;  DEFAULT
;    if (LocalStatus( CentralHPWHErrMsg ) < 1 .AND.
;        (CentralHPWHLpTankType = "NEEA HPWH" .OR. CentralHPWHLpTankType = "Commercial HPWH"))
;    then  if (     CentralHPWHLpTankType = "NEEA HPWH" .AND.
;                   EnumValue( CentralHPWHLpTankBrand ) <= 1) then        "CHPWH Loop Tank input missing:  NEEA HPWH brand"
;          else if (CentralHPWHLpTankType = "NEEA HPWH" .AND.
;                   EnumValue( CentralHPWHLpTankModel ) <= 1) then        "CHPWH Loop Tank input missing:  NEEA HPWH model"
;          else if (CentralHPWHLpTankType = "Commercial HPWH" .AND.
;                   EnumValue( CentralHPWHLpTankCommModel ) <= 1) then    "CHPWH Loop Tank input missing:  Commercial HPWH model"
;          else if (IfValidAnd( CentralHPWHLpTankCprsrCnt > 0 )==0) then  "CHPWH Loop Tank input error:  HPWH/Heater Count must be > 0"
;       ;   else if (IfValidAnd( CentralHPWHLpTankSetpt   > 0 )==0) then  "CHPWH Loop Tank input error:  Tank Setpoint must be > 0"
;          else if (CentralHPWHLpTankShowDetails > 0 .AND.
;                   IfValidAnd( CentralHPWHLpTankVol     > 0 )==0) then   "CHPWH Loop Tank input error:  Total Tank Volume must be > 0"
;          else if (CentralHPWHLpTankShowDetails > 0 .AND.
;                   IfValidAnd( CentralHPWHLpTankCnt > 0 )==0) then       "CHPWH Loop Tank input error:  Tank Count must be > 0"
;          else if (CentralHPWHLpTankShowDetails > 0 .AND.
;                   IfValidAnd( CentralHPWHLpTankRVal >= CentralHPWHLpTankMinRVal )==0) then  Format( "CHPWH Loop Tank input error:  Tank R-Value must be >= %g", CentralHPWHLpTankMinRVal )
;          else if (EnumValue( CentralHPWHLpTankLctn ) < 1) then          "CHPWH Loop Tank input error:  Tank Location selection missing"
;          else if (EnumValue( CentralHPWHLpTankAirSrc ) < 1) then        "CHPWH Loop Tank input error:  Source Air From selection missing"
;          else  UNDEFINED  endif endif endif endif endif endif endif endif endif
;    else  UNCHANGED  endif
;ENDRULE
;
;;   "Set ResDHWSys:CentralHPWHTankRValReqd"         ResDHWSys:CentralHPWHTankRValReqd      =     ; SAC 6/24/20
;;      {  if (CentralSysTypeVal == 2 .AND. CentralHPWHSysDesc == "Large Single Pass Primary" .AND. IfValidAnd( SysFlrArea > 0 )) then  1  else  UNDEFINED  endif  }
;;   "Set ResDHWSys:CentralHPWHLpTankRValReqd"     ResDHWSys:CentralHPWHLpTankRValReqd  =
;;      {  if (CentralHPWHLpTankShowDetails > 0 .AND. IfValidAnd( SysFlrArea > 0 )) then  1  else  UNDEFINED  endif  }
;
;RULE ResDHWSys:ValidAnalysisCentralHPWH
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (CentralSysTypeVal == 2 .AND. IfValidAnd( CentralHPWHCprsrCnt > 0 ) .AND.
;        IfValidAnd( SysFlrArea > 0 ) .AND. LocalStatus( CentralHPWHErrMsg ) < 1)
;    then  1  else  UNDEFINED  endif
;ENDRULE
;
;
;; OLD rules replaced by new versions above - SAC 7/1/20
;;   RULE ResDHWSys:CentralHPWHCprsrType
;;     DESCRIPTION
;;       "Central HPWH compressor type."
;;     REFERENCE 
;;       Res ACM-2.10 Domestic Hot Water
;;     INPUTCLASS
;;       Optional
;;     RESETS
;;       ResetThisWhenTheFollowingIsModified
;;         ResDHWSys:CentralHPWHSysDesc
;;     DEFAULT
;;       if (IfValidAnd( CentralSysType = "HPWH" )) then  "Sanden GS3-45HPA-US"
;;       else  UNDEFINED  endif
;;   ENDRULE
;;   ; SAC 6/28/20 - moved to BEMEnums
;;   ;  OPTION
;;   ;    Sanden
;;   ;    Colmac CxA20
;;   
;;   ; tank volumes based on table from BAW e-mailed 12/19/19 (Res tic #862)
;;   RULE ResDHWSys:CentralHPWHLpTankVol
;;     DESCRIPTION
;;       "Central HPWH loop tank volume."
;;     REFERENCE 
;;       Res ACM-2.10 Domestic Hot Water
;;     INPUTCLASS
;;       Optional
;;     MINIMUM
;;       40
;;     UNITS
;;       gal
;;     RESETS
;;       ResetThisWhenTheFollowingIsModified
;;         ResDHWSys:CentralSys
;;     DEFAULT
;;       if (IfValidAnd( CentralSysType = "HPWH" )==0 .OR.
;;           IfValidAnd( NumDUsServed > 0 )==0) then  UNDEFINED
;;       else if ( NumDUsServed <=  7 ) then   40
;;       else if ( NumDUsServed <= 11 ) then   80
;;       else if ( NumDUsServed <= 23 ) then   96
;;       else if ( NumDUsServed <= 47 ) then  168
;;       else if ( NumDUsServed <= 95 ) then  288
;;       else                                 480
;;       endif endif endif endif endif endif
;;   ENDRULE
;;   
;;   ; SAC 2/6/20 - Removed autosize option
;;   RULE ResDHWSys:CentralHPWHAutosize
;;     DESCRIPTION
;;       "Whether or not to autosize number of central HPWH compressors & primary
;;        tank volume via simulation."
;;     REFERENCE 
;;       Res ACM-2.10 Domestic Hot Water
;;     INPUTCLASS
;;       NotInput  IgnoreUserInput  "Removed during prep for 2019.2.0 (& 1.2) release"
;;     DEFAULT
;;       0
;;   ENDRULE
;;   
;;   RULE ResDHWSys:CentralHPWHCprsrCnt
;;     DESCRIPTION
;;       "Number of central HPWH compressors."
;;     REFERENCE 
;;       Res ACM-2.10 Domestic Hot Water
;;     INPUTCLASS
;;       Optional
;;     MINIMUM
;;       1
;;     RESETS
;;       ResetThisWhenTheFollowingIsModified
;;         ResDHWSys:CentralHPWHCprsrType
;;     CHECKCODE
;;       if (IfValidAnd( CentralSysType = "HPWH" ) .AND. IfValidAnd( CentralHPWHCprsrCnt > 0 )==0)
;;       then
;;         PostError("Central HPWH ResDHWSys '%s' must have a compressor count greater than zero.",Name)
;;       else UNCHANGED
;;       endif
;;     DEFAULT
;;       UNDEFINED
;;   ENDRULE
;;   
;;   RULE ResDHWSys:CentralHPWHPriTankVol
;;     DESCRIPTION
;;       "Central HPWH primary tank volume."
;;     REFERENCE 
;;       Res ACM-2.10 Domestic Hot Water
;;     INPUTCLASS
;;       Optional
;;     MINIMUM
;;       0.001
;;     UNITS
;;       gal
;;     RESETS
;;       ResetThisWhenTheFollowingIsModified
;;         ResDHWSys:CentralHPWHCprsrType
;;     DEFAULT
;;       if (IfValidAnd( CentralSysType = "HPWH" ) .AND. IfValidAnd( CentralHPWHCprsrCnt > 0 ))
;;       then  switch (CentralHPWHCprsrType)
;;                case  "Sanden"       :   80 * CentralHPWHCprsrCnt 
;;                case  "Colmac CxA20" :  800 * CentralHPWHCprsrCnt 
;;                default :  UNDEFINED
;;             endswitch
;;       else  UNDEFINED  endif
;;   ENDRULE
;
;// -----------------------------------------------------------------
;// -------------- Recirculating Pump Horsepower --------------------  SAC 2/12/20 - recharacterized as Prescribed to remove from InputDataModel - converted to PumpPwr in LoadModelAdjustments
;RULE ResDHWSys:PumpBHP
;  DESCRIPTION
;    "The Brake Horsepower of the recirculating water heater pump."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  MINIMUM
;    0
;  MAXIMUM
;    250
;  UNITS
;    bhp
;  REPORTPRECISION
;    2
;  DEFAULT
;    if( ExcludeWtrHtg )
;    then UNDEFINED 
;    else if ( CentralSys ) 
;    then 0.5
;    else UNDEFINED
;    endif endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED // 0.5
;    else u:PumpBHP
;    endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWBothBaseline .OR.
;        Proj:ResDHWPropOnly )
;    then 
;      if( CentralSys )  
;      then
;        u:PumpBHP
;      else                                       // individual ResDHW system
;        UNDEFINED 
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif
;  ANNUAL
;    PumpBHP
;ENDRULE
;
;// -----------------------------------------------------------------
;// -------------- Recirculating Pump Efficiency --------------------  SAC 2/12/20 - recharacterized as Prescribed to remove from InputDataModel - converted to PumpPwr in LoadModelAdjustments
;// 
;RULE ResDHWSys:PumpEff
;  DESCRIPTION
;    "The efficiency of the pump."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  MINIMUM
;    0.00
;  MAXIMUM
;    0.99
;  REPORTPRECISION
;    2
;  DEFAULT
;    if( ExcludeWtrHtg )
;    then UNDEFINED
;    else if ( CentralSys )
;    then 0.6
;    else UNDEFINED
;    endif endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED
;    else u:PumpEff
;    endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWBothBaseline .OR.
;        Proj:ResDHWPropOnly )
;    then 
;      if( CentralSys )  
;      then
;        u:PumpEff
;      else                                       // individual ResDHW system
;        UNDEFINED 
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif
;  ANNUAL
;    z:PumpEff
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------------- Recirculating Pump Power --------------------      SAC 1/10/20 - applies to 'new' CSE central DHW model (Com tic #3156)
;// 
;
;RULE ResDHWSys:RecircPumpPwr
;  DESCRIPTION
;    "The pump power."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  MINIMUM
;    0.00
;  UNITS
;    Watts
;  DEFAULT
;    if( ExcludeWtrHtg )
;    then UNDEFINED
;    else if ( NewCentralModel )
;    then 4 + (ValidOr( NumDUsServed, 0 ) * 0.5)
;    else UNDEFINED
;    endif endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED
;    else u:RecircPumpPwr
;    endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWBothBaseline .OR.
;        Proj:ResDHWPropOnly )
;    then 
;      if( NewCentralModel )  
;      then
;        4 + (ValidOr( NumDUsServed, 0 ) * 0.5)
;      else                                       // individual ResDHW system
;        UNDEFINED 
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif
;  ANNUAL
;    z:RecircPumpPwr
;ENDRULE
;
;; SAC 1/10/20
;RULE ResDHWSys:RecircPumpPwrUnits
;  DESCRIPTION
;    ""
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (IfValidAnd( CentralSys > 0 ))
;    then  if (IfValidAnd( NewCentralModel > 0 ))
;          then  "Watts"
;          else  "bhp"  endif
;    else  UNDEFINED  endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Recirc Loop count --------------------
;// 
;RULE ResDHWSys:LpCnt
;  DESCRIPTION
;    "The number of loops in the residential system."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  MINIMUM
;    1
;  MAXIMUM
;    5
;  REPORTPRECISION
;    0
;  DEFAULT
;    1
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED // 1
;    else u:LpCnt
;    endif
;  ANNUAL
;    z:LpCnt
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Residential Pipe Location --------------------
;//
;RULE ResDHWSys:PipeLctn
;  DESCRIPTION
;    "This is the general location of a recirculation pipe."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;// enums must be defined via Enums.txt in order to map to numeric values expected by the T24 DHW simulation engine
;//  OPTION
;//    Conditioned
;//    Unconditioned
;//    Underground
;  DEFAULT
;    "Conditioned"
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED // "Conditioned"
;    else u:PipeLctn
;    endif
;  ANNUAL
;    z:PipeLctn  
;ENDRULE
;
;
;// ---------------------------------------------------------------------
;RULE ResDHWSys:LpPipeInsThkns
;  DESCRIPTION
;    "Thickness of loop pipe insulation"
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Required
;  DEFAULT
;    1.5
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED // 1.5
;    else u:LpPipeInsThkns
;    endif
;  ANNUAL
;    z:LpPipeInsThkns
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Residential DHW Water Heater Count --------------------
;//
;RULE ResDHWSys:WtrHtrCnt
;  DESCRIPTION
;    "This determines the number of Residential water heaters in the building."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput  IgnoreUserInput  "Removed in transition from 2013 version 3c to 2016.1.0 / 2013 v3d"
;  MINIMUM
;    0
;//  MAXIMUM
;//    100
;  REPORTPRECISION
;    0
;  DEFAULT
;    SumChildren(ResWtrHtr:Cnt)
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 1
;    else SumChildren(ResWtrHtr:Cnt)
;    endif
;  ANNUAL_PROPOSED
;    z:WtrHtrCnt
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Residential DHW Solar Fraction Type --------------------
;//
;RULE ResDHWSys:SolFracType
;  DESCRIPTION
;    "This is the type of solar fraction data used."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    1      // Annual, not monthly
;  SIZING
;    1
;  ANNUAL
;    1
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------------- Residential DHW Annual Solar Fraction --------------------
;//
;RULE ResDHWSys:AnnualSolFrac
;  DESCRIPTION
;    "This is the Annual Solar Fraction."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  MINIMUM
;    0 
;  MAXIMUM
;    1.0
;  REPORTPRECISION
;    2
;  DEFAULT
;    0
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then
;     0
;    else u:AnnualSolFrac
;    endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWBothBaseline )
;    then 
;      if( CentralSys )  
;      then
;        if( Proj:CliZnNum < 10 )
;        then 0.20
;        else 0.35
;        endif 
;      else 
;        0
;      endif 
;    else if( Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then
;        if( Proj:CliZnNum < 10 )
;        then 0.20
;        else 0.35
;        endif 
;      else u:AnnualSolFrac
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif
;  ANNUAL
;    z:AnnualSolFrac
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE ResDHWSys:SolCollectorCnt
;  DESCRIPTION
;    ""
;  PREVIOUSNAMES
;    Number
;  INPUTCLASS
;    Prescribed
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------------- Conversion Water Heater Capacity Rated --------------------
;//
;RULE NEW ResDHWSys:SysHotWtrHrlyUse
;  LONGFORM
;    SystemHotWaterHourlyUse
;  DATATYPE
;    Float
;  DESCRIPTION
;    "Total gal/hr baseline requirements for one Residential DHW System."
;  INPUTCLASS
;    NotInput
;  UNITS
;    gal per h
;  DEFAULT
;    SumRevRef(Spc:ResDHWSysRef, Spc:HotWtrHrlyUseRes)
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Conversion Water Heater Capacity Rated --------------------
;//
;RULE NEW ResWtrHtr:BasePropResWtrHtgTot
;  LONGFORM
;    BaselineProposedResidentialWaterHeatingTotal
;  DATATYPE
;    Float
;  DESCRIPTION
;    "Total gal/hr of one Residential DHW System that takes the Input Rating and
;     converts it to gal/hr then add it to the tank volume."
;  INPUTCLASS
;    NotInput
;  UNITS
;    gal per h
;  DEFAULT
;    if( IfValidAnd(TankVol > 0) .AND. IfValidAnd(InpRating > 0) )
;    then( (TankVol + (InpRating / (8.4 * (135 - 55)))) * Cnt )
;    else UNDEFINED
;    endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------------- Conversion Water Heater Capacity Rated --------------------
;//
;RULE NEW ResDHWSys:BasePropResWtrHtgTot
;  LONGFORM
;    BaselineProposedResidentialWaterHeatingTotal
;  DATATYPE
;    Float
;  DESCRIPTION
;    "Total gal/hr of one Residential DHW System that takes the Input Rating and
;     converts it to gal/hr then add it to the tank volume."
;  INPUTCLASS
;    NotInput
;  UNITS
;    gal per h
;  DEFAULT
;    SumChildren(ResWtrHtr:BasePropResWtrHtgTot)
;ENDRULE

// -----------------------------------------------------------------------------
// -------------- Conversion Water Heater Capacity Rated --------------------
//
; RES DHW REMOVAL
;RULE NEW Proj:BasePropResWtrHtgTot
;  LONGFORM
;    BaselineProposedResidentialWaterHeatingTotal
;  DATATYPE
;    Float
;  DESCRIPTION
;    "Total gal/hr of all Residential DHW Systems in the building that takes
;     the Input Rating and converts it to gal/hr then add it to the tank volume."
;  INPUTCLASS
;    NotInput
;  UNITS
;    gal per h
;  DEFAULT
;    SumChildren(ResDHWSys:BasePropResWtrHtgTot)
;ENDRULE


; RES DHW REMOVAL
;// -----------------------------------------------------------------------------
;// -------------- Residential Drain Water Heat Recovery System --------------------
;// 
;RULE ResDWHRSys:Name
;  DESCRIPTION
;    "A unique name for each residential drain water heat recovery system."
;  REFERENCE 
;    
;  INPUTCLASS
;    Optional
;ENDRULE
;
;RULE ResDWHRSys:Type
;  DESCRIPTION
;    "Type of residential drain water heat recovery system."
;  REFERENCE 
;    
;  INPUTCLASS
;    NotInput
;  OPTION
;    Vertical
;    Horizontal
;  DEFAULT
;    "Vertical"
;ENDRULE
;
;; updated default eff per CEC guidance from 43 to 42 - SAC 09/30/21
;RULE ResDWHRSys:CSARtdEff
;  DESCRIPTION
;    "The Canadian Standards Assoc. rated recovery efficiency."
;  REFERENCE 
;    
;  INPUTCLASS
;    Required
;  UNITS
;    %
;  MINIMUM
;    1
;  MAXIMUM
;    99 
;  DEFAULT
;    42
;ENDRULE


// -----------------------------------------------------------------------------
// -------------- Setup ResSpcDHWFeatures --------------------
; HotelMotelGuestRmCnt - SAC 04/30/21 (tic #3242)
RULE Proj:Action
  DEFAULT
    if (SumAll( Spc:ResLivingUnitCnt ) > 0 .OR.
        SumAll( Spc:HotelMotelGuestRmCnt ) > 0)
    then  EvalRulelist( "Setup_ResSpcDHWFeatures" )
    else  UNCHANGED  endif
ENDRULE


; RES DHW REMOVAL
;// -----------------------------------------------------------------------------
;// -------------- Residential Water Heater Name --------------------
;// 
;RULE ResWtrHtr:Name
;  DESCRIPTION
;    "A unique name for each Residential water heater."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Optional
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------------- Duplicate Water Heater Count --------------------
;//
;RULE ResWtrHtr:Cnt
;  DESCRIPTION
;    "This is the number of identical water heaters."
;  HELP
;    "For Individual ResDHW Sytems: This is the number of duplicate water heaters 
;     in a dwelling unit that are identical in every way.     
;
;
;     For Central ResDHW Systems: This is the number of duplicate water heaters in 
;     the parent Central System that are identical in every way."
;  REFERENCE 
;    ACM-5.9.1 Water Heating
;  INPUTCLASS
;    Required
;  MINIMUM
;    1
;  MAXIMUM
;    1000 
;  REPORTPRECISION
;    0
;;  DEFAULT   - SAC 6/22/16 - expression moved up above to ensure valid when referenced by other rules
;;    1
;  CHECKCODE           // Cnt
;    if( IfValidAnd(Cnt = 0) )
;    then
;      PostError("Residential water heater '%s' must have a count greater than zero.",Name)
;    else UNCHANGED
;    endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 1
;    else u:Cnt
;    endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline )
;    then 
;      if( CentralSys )  
;      then
;        if (IfValidAnd( IsBaseSys > 0 ))
;        then 1
;        else u:Cnt
;        endif
;      else                                           // individual ResDHW system
;        1
;      endif
;    else if( Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then 1
;      else u:Cnt
;      endif
;    else if( Proj:ResDHWBothBaseline )
;    then 
;      if( CentralSys )  
;      then
;        UNDEFINED                                    // won't have central system
;      else
;        1                                            // individual ResDHW system
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                      // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif endif
;//    endif
;  ANNUAL_PROPOSED
;    z:Cnt
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------------- Residential Water Heater Fuel Source --------------------
;//
;; SAC 1/28/19 - removed following check which is now being reported by SYSTEM, not heater:
;;    if( (ElementType = "Heat Pump" .OR. ElementType = "Electric Resistance") .AND.
;;        Parent( CentralSys ) .AND. Parent( DistType ) != "No loops or central system pump" )
;;    then  if (ElementType = "Heat Pump")
;;          then  PostError("Residential water heater '%s' is a Heat Pump, which is not 
;;                    allowed for use on a central system with recirculation.  Change the
;;                    Element Type or remove recirculation distribution.", Name)
;;          else  PostError("Residential water heater '%s' is Electric Resistance, which is
;;                    not allowed for use on a central system with recirculation.  Change the
;;                    Element Type or remove recirculation distribution.", Name)
;;          endif
;
;; added reset of ResWtrHtr:TankCat, ResWtrHtr:IsUEFRtd & ResWtrHtr:HtPumpWtrHtrNEEARtd whenever ResWtrHtr:ElementType is modified - SAC 02/25/21
;RULE ResWtrHtr:ElementType
;  DESCRIPTION
;    "This is the selection of the Residential Water Heater Fuel Source."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Required
;// enums must be defined via Enums.txt in order to map to numeric values expected by the T24 DHW simulation engine
;//  OPTION
;//    Electric Resistance
;//    Gas
;//    Heat Pump
;  RESETS
;    ResetTheFollowingWhenThisIsModified
;      ResWtrHtr:InpRatingElec
;      ResWtrHtr:IsUEFRtd
;      ResWtrHtr:HtPumpWtrHtrNEEARtd
;      ResWtrHtr:UEF
;      ResWtrHtr:TankVol
;      ResWtrHtr:FirstHrRating
;      ResWtrHtr:RcvryEff
;      ResWtrHtr:CentralHPWHCprsrType
;  DEFAULT
;    "Gas"
;  CHECKCODE           // ElementType
;    if( Proj:GasType = "None" .AND. ElementType = "Gas" )
;    then
;      PostError("Residential water heater '%s' is gas fired but the project 
;                 gas type is specified as none.  Change the Element Type 
;                 for the water heater or the project gas type.", Name)
;    else UNCHANGED
;    endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then
;      if( Proj:GasType = "None" )
;      then
;        "Electric Resistance"
;      else
;        "Gas"
;      endif
;    else u:ElementType
;    endif
;  ANNUAL_PROPOSED
;    z:ElementType
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------------- Residential Water Heater Fuel Source Report --------------
;//
;RULE ResWtrHtr:ElementTypeRpt
;  RULESETS
;    T24N
;  DESCRIPTION
;    "Translates ElementType to ElementTypeRpt."
;  INPUTCLASS
;    NotInput
;  ANNUAL_PROPOSED
;    if ( ExcludeWtrHtg )
;    then UNDEFINED
;    else
;	    if( Proj:NatGasAvail = 1 )
;	    then
;	      switch( ElementType ) 
;	        case "Electric Resistance" : "Electric Resistance"
;	        case "Gas"                 : "Natural Gas"
;	        case "Heat Pump"           : "Heat Pump"
;	        case "Oil"                 : "Oil"
;	        default : UNDEFINED
;	      endswitch
;	    else
;	      switch( ElementType ) 
;	        case "Electric Resistance" : "Electric Resistance"
;	        case "Gas"                 : "Propane"
;	        case "Heat Pump"           : "Heat Pump"
;	        case "Oil"                 : "Oil"
;	        default : UNDEFINED
;	      endswitch
;	    endif
;    endif
;  ANNUAL_BASELINE
;    UNDEFINED
;ENDRULE
;
;
;// -------------- HPWH Category -------------- SAC 02/26/21
;//
;RULE ResWtrHtr:HPWHCat
;  DESCRIPTION
;    "Type of residential heat pump water heater."
;  INPUTCLASS
;    CondRequired
;  RESETS
;    ResetTheFollowingWhenThisIsModified
;      ResWtrHtr:IsUEFRtd
;      ResWtrHtr:HtPumpWtrHtrNEEARtd
;      ResWtrHtr:HPWHBrand
;      ResWtrHtr:HPWHCommProd
;      ResWtrHtr:HPWHCommModel
;      ResWtrHtr:TankCat
;  DEFAULT
;    if (ElementType != "Heat Pump") then  UNCHANGED
;    else  "Residential (NEEA rated) Product"  endif
;ENDRULE
;
;
;// -------------- Commercial HPWH Product -------------- SAC 02/26/21
;//
;RULE ResWtrHtr:HPWHCommProd
;  DESCRIPTION
;    "flag indicating this is a commercial heat pump water heater product."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (ElementType == "Heat Pump" .AND.
;        HPWHCat == "Commercial Product")
;    then  1
;    else  0
;    endif
;  SIZING
;    if (ElementType == "Heat Pump" .AND.
;        HPWHCat == "Commercial Product")
;    then  1
;    else  0
;    endif
;  ANNUAL
;    if (ElementType == "Heat Pump" .AND.
;        HPWHCat == "Commercial Product")
;    then  1
;    else  0
;    endif
;ENDRULE
;
;; enumerations defined in Enums.txt file
;RULE ResWtrHtr:HPWHCommModel
;  DESCRIPTION
;    "Model of commercial heat pump water heater product."
;  INPUTCLASS
;    CondRequired
;  DEFAULT
;    if (HPWHCommProd == 1)
;    then  "- select Model -"
;    else  "n/a"
;    endif
;ENDRULE
;
;
;// -------------- Residential HPWH NEEA Certification --------------
;//
;; SAC 9/26/19 - made DEFAULT and SIZING_PROPOSED expressions more consistent so that Resets are not triggered due to default being overridden by SIZING_PROPOSED rule (and thereby blasting UEF)
;; switched from CondRequired to Prescribed - now set/determined based on HPWHCat - SAC 02/25/21
;RULE ResWtrHtr:HtPumpWtrHtrNEEARtd
;  RULESETS
;    T24N
;  DESCRIPTION
;    "Whether the HPWH is NEEA certified."
;  INPUTCLASS
;    Prescribed
;  PREVIOUSNAMES  HtPumpWtrHtrNEEA  HeatPumpWaterHeaterNEEA
;  DEFAULT
;    if (ElementType != "Heat Pump") then  0
;    else  switch (HPWHCat)
;             case  "Residential (NEEA rated) Product"  :  1
;             default  :  0
;          endswitch
;    endif
;  SIZING_PROPOSED
;    if( ElementType = "Heat Pump" )
;    	then UNCHANGED
;    else 0
;    endif
;  ANNUAL_PROPOSED
;    z:HtPumpWtrHtrNEEARtd
;ENDRULE
;;  RESETS
;;    ResetTheFollowingWhenThisIsModified
;;      ResWtrHtr:InpRatingElec
;;      ResWtrHtr:UEF
;;      ResWtrHtr:TankVol
;;      ResWtrHtr:FirstHrRating
;;      ResWtrHtr:RcvryEff
;;      ResWtrHtr:CentralHPWHCprsrType
;
;// -----------------------------------------------------------------------------
;RULE ResWtrHtr:HPWHBrand
;  RULESETS
;    T24N
;  DESCRIPTION
;    "NEEA-rated HPWH brand name."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;// enums defined in Enums.txt to enable numeric-based logic/defaulting consistent w/ Res rules
;//  OPTION
;// defaulting implemented via enumeration definitions
;//  DEFAULT
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE ResWtrHtr:HPWHModel
;  RULESETS
;    T24N
;  DESCRIPTION
;    "NEEA-rated HPWH model name/ID."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;// enums defined in Enums.txt to enable numeric-based logic/defaulting consistent w/ Res rules
;//  OPTION
;// defaulting implemented via enumeration definitions
;//  DEFAULT
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      ResWtrHtr:HPWHBrand
;ENDRULE
;
;// -----------------------------------------------------------------------------  - SAC 3/12/20 - added 'Colmac CxA20'
;RULE ResWtrHtr:CentralHPWHCprsrType
;  DESCRIPTION
;    "Central HPWH compressor type."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    UNDEFINED
;ENDRULE
;;  OPTION      - moved to BEMEnums - SAC 7/1/20
;;    Sanden
;;    Colmac CxA20
;
;// -----------------------------------------------------------------------------
;; revised for commercial HPWH products - SAC 03/02/21
;RULE ResWtrHtr:AirSrcHtPumpType
;  RULESETS
;    T24N
;  DESCRIPTION
;    "CSE simulation air source HPWH type."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Prescribed
;// enums defined in Enums.txt to enable numeric-based logic/defaulting consistent w/ Res rules
;//  OPTION
;  DEFAULT
;    if (ElementType = "Heat Pump" .AND. HtPumpWtrHtrNEEARtd > 0 .AND.
;               EnumValue( CentralHPWHCprsrType ) > 0)
;    then  mod( EnumValue( CentralHPWHCprsrType ), 100 )
;    else if (ElementType = "Heat Pump" .AND. HPWHCommProd > 0 .AND.
;               EnumValue( HPWHCommModel ) > 0)
;    then  mod( EnumValue( HPWHCommModel ), 100 )
;    else if (LocalStatus( HPWHBrand ) < 1 .OR. LocalStatus( HPWHModel ) < 1)
;    then  UNCHANGED
;    else  HPWHData_NEEA:ASHPType( "Brand", HPWHBrand, "Model", HPWHModel )
;    endif endif endif
;ENDRULE
;;  SAC 7/1/20 - replaced
;;    if (     ElementType = "Heat Pump" .AND. HtPumpWtrHtrNEEARtd > 0 .AND.
;;             IfValidAnd( CentralHPWHCprsrType = "Sanden" )) then  "Sanden80"
;;    else if (ElementType = "Heat Pump" .AND. HtPumpWtrHtrNEEARtd > 0 .AND.
;;             IfValidAnd( CentralHPWHCprsrType = "Colmac CxA20" )) then  "ColmacCxA20"
;
;
;// -----------------------------------------------------------------------------
;; revised for commercial HPWH products - SAC 03/02/21
;RULE ResWtrHtr:MakeAndModel
;  RULESETS
;    T24N
;  DESCRIPTION
;    "Make and model of residential water heater."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ElementType = "Heat Pump" .AND. IfValidAnd( HtPumpWtrHtrNEEARtd > 0 ))
;    then  if (LocalStatus( HPWHBrand ) > 0 .AND. LocalStatus( HPWHModel ) > 0)
;          then  HPWHBrand + " / " + HPWHModel
;          else if (LocalStatus( AirSrcHtPumpType ) > 0)
;          then  AirSrcHtPumpType
;          else  "NA"
;          endif endif
;    else if (ElementType = "Heat Pump" .AND. IfValidAnd( HPWHCommProd > 0 ))
;    then  if (LocalStatus( HPWHCommModel ) > 0)
;          then  HPWHCommModel
;          else if (LocalStatus( AirSrcHtPumpType ) > 0)
;          then  AirSrcHtPumpType
;          else  "NA"
;          endif endif
;    else  "NA"
;    endif endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;//RULE NEW ResWtrHtr:HtPumpDisp
;//  DATATYPE
;//    Integer
;//  LONGFORM
;//    HeatPumpDisplay
;//  DESCRIPTION
;//    "flag indicating whether or not to display HPWH inputs in UI"
;//  REFERENCE 
;//    Res ACM-2.10 Domestic Hot Water
;//  INPUTCLASS
;//    NotInput
;//  DEFAULT
;//    1
;//ENDRULE
;
;
;// -----------------------------------------------------------------
;// ------------------ DEMAND RESPONSE HPWHs ------------------------  SAC 08/26/21
;RULE NEW ResWtrHtr:DemRespCompat
;  LONGFORM
;    DemandResponseCompatible
;  DATATYPE
;    Integer
;  DESCRIPTION
;    "whether this HPWH is demand responsive"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (HtPumpWtrHtrNEEARtd .AND. EnumValue( HPWHModel ) > 100000)
;    then  HPWHData_NEEA:JA13( "Brand", HPWHBrand, "Model", HPWHModel )
;    else  0  endif
;ENDRULE
;
;RULE ResDHWSys:DemRespCompat
;  DEFAULT
;    if (CentralSysTypeVal > 0) then  0
;    else if (SumChildren( ResWtrHtr:DemRespCompat ) > 0)
;    then  1
;    else  0
;    endif endif
;  SIZING_BASELINE
;    0
;ENDRULE
;
;;   "reset DHWSys:DemResponsive if user-defined and not research mode"   DHWSys:Action =
;;      {  if (LocalStatus( DemResponsive ) > 5 .AND. IfValidAnd( Proj:EnableResearchMode > 0 )==0)
;;         then  EvalRulelist( "DHWSys_Blast_DemResponsive", 1 )  else  UNCHANGED  endif  }
;
;RULE ResDHWSys:DemResponsive
;  DEFAULT
;    DemRespCompat
;  SIZING_BASELINE
;    DemRespCompat
;ENDRULE
;
;; ResDHWSys:DemResponseCtrl  - allow to default via Enums
;
;RULE ResDHWSys:DemRespValid
;  DEFAULT
;    if (DemResponsive > 0 .AND. EnumValue( DemResponseCtrl ) > 0)
;    then  1
;    else  UNDEFINED  endif
;  SIZING_BASELINE
;    if (DemResponsive > 0 .AND. EnumValue( DemResponseCtrl ) > 0)
;    then  1
;    else  UNDEFINED  endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Total Water Heater Input Rating --------------------
;// 
;RULE ResWtrHtr:InpRating
;  DESCRIPTION
;    "The heating capacity of a water heater at the rated conditions specified
;     in DOE 10 CFR Part 430 or ANSI Z21.10."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Required
;  UNITS
;    Btu/hr
;  REPORTPRECISION
;    -2
;  DEFAULT
;    if ( ExcludeWtrHtg )
;    then 
;      200000
;    else
;	    if( LocalStatus( InpRatingElec ) >= 7 ) then  // if there is a user input value
;	      InpRatingElec * 3.412
;	    else if( Proj:AutoHardSize = 1 .AND. TankCat != "Indirect" .AND. TankCat != "Instantaneous")
;	    then
;	      MAX( 0, ( Parent(SysHotWtrHrlyUse) * 0.6 * 8.4 * (135 - 55) ) / 0.80 )    // Convert Output to Input -> divide by ThrmlEff 0.80. 60% of the capacity is for the burner and conversion from gal/hr to btu/h
;	    else
;	      if( Proj:AutoHardSize = 1 .AND. TankCat = "Instantaneous" )
;	      then
;	        MAX( 0, ( (Parent(SysHotWtrHrlyUse) - 1) * 8.4 * (135 - 55) ) / 0.80 )  // Convert Output to Input -> divide by ThrmlEff 0.80. 100% of the capacity minus 1 gallon is for the burner and conversion from gal/hr to btu/h when instant.
;	      else 0
;	      endif
;	    endif endif
;	  endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 200000
;    else if( ElementType = "Electric Resistance" .OR.
;             ElementType = "Heat Pump" )
;    then u:InpRatingElec * 3.412
;    else u:InpRating
;    endif endif
;  ANNUAL_PROPOSED
;    z:InpRating
;ENDRULE
;
;
;// -------------- Total Water Heater Input Rating - Electric --------------------
;// 
;RULE ResWtrHtr:InpRatingElec
;  DESCRIPTION
;    "The heating capacity of a water heater at the rated conditions specified
;     in DOE 10 CFR Part 430 or ANSI Z21.10."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  UNITS
;    Watts
;  REPORTPRECISION
;    -1
;  DEFAULT
;    Int( InpRating / 3.412 )
;  CHECKCODE
;    if ( ExcludeWtrHtg )
;    then 
;      UNCHANGED
;    else 
;	    if( ElementType = "Heat Pump" )
;	    then
;	      if( IfValidAnd( InpRatingElec > 12000 ) .AND. IfValidAnd( HtPumpWtrHtrNEEARtd < 1 ) )
;	      then
;	      PostError("The rated electrical input of the heat-pump water heater 
;	                 should be <= 12 kW. 
;	                 Check values for water heater '%s'.", Name)
;	      else UNCHANGED
;	      endif
;	    else UNCHANGED
;	    endif 
;	  endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 200000
;    else if( ElementType = "Electric Resistance" .OR.
;             ElementType = "Heat Pump" )
;    then u:InpRatingElec
;    else UNDEFINED
;    endif endif
;  ANNUAL_PROPOSED
;    z:InpRatingElec    
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// 
;; revised for commercial HPWH products - SAC 03/02/21
;RULE ResWtrHtr:TankVol
;  DESCRIPTION
;    "The residential water heater tank volume."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  UNITS
;    gal
;  REPORTPRECISION
;    2
;  DEFAULT
;    if( ExcludeWtrHtg )
;    then
;      0
;    else if (TankCat == "Commercial Packaged Boiler")
;    then  (ResDHWSys:NumBedroomsServedPerHtr * 3) + (ResDHWSys:NumDUsServedPerHtr * 10)     ; SAC 1/9/20 - to facilitate new central gas std design DHW system (Com tic #3156)
;    else
;	    if( Proj:AutoHardSize = 1 )
;	    then 
;	      if( TankCat = "Instantaneous" )
;	      then 0
;	      else Int( (Parent(SysHotWtrHrlyUse) * 0.4) * 1.30 )  // 40% of the capacity is for the tank volume plus 30% oversizing
;	      endif
;	    else
;	      if( TankCat = "Instantaneous" )
;	      then 0
;	      else if( ElementType = "Heat Pump" .AND. IfValidAnd( HtPumpWtrHtrNEEARtd > 0 ) .AND.
;	               LocalStatus( HPWHBrand ) > 0 .AND. LocalStatus( HPWHModel ) > 0 )
;	      then HPWHData_NEEA:TankVolume( "Brand", HPWHBrand, "Model", HPWHModel )
;         else if (ElementType = "Heat Pump" .AND. IfValidAnd( HPWHCommProd > 0 ) .AND.
;	               LocalStatus( HPWHCommModel ) > 0)
;         then  switch (HPWHCommModel)
;                  case  "A. O. Smith CAHP-120  (120 gal)"  :  120
;                  default  :  UNDEFINED
;               endswitch
;	      else UNDEFINED
;	      endif endif endif
;	    endif
;	  endif endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 0
;    else 
;     if( IfValidAnd(ElementType = "Heat Pump") .AND. IfValidAnd(HtPumpWtrHtrNEEARtd = 1) )
;     then  if (LocalStatus( HPWHBrand ) > 0 .AND. LocalStatus( HPWHModel ) > 0)
;           then HPWHData_NEEA:TankVolume( "Brand", HPWHBrand, "Model", HPWHModel )
;           else UNDEFINED
;           endif
;     else if (ElementType = "Heat Pump" .AND. IfValidAnd( HPWHCommProd > 0 ))
;     then  switch (HPWHCommModel)
;              case  "A. O. Smith CAHP-120  (120 gal)"  :  120
;              default  :  UNDEFINED
;           endswitch
;     else u:TankVol
;    endif endif endif
;  ANNUAL_PROPOSED
;    z:TankVol
;ENDRULE
;
;RULE ResWtrHtr:NonStdTankVol
;  DESCRIPTION
;    "The residential primary central heater tank volume."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Optional
;  UNITS
;    gal
;  REPORTPRECISION
;    2
;  DEFAULT
;    UNDEFINED
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;//
;RULE ResWtrHtr:IsUEFRtd
;  DESCRIPTION
;    "A flag to indicate whether UEF is used to describe the water heater 
;     efficiency."
;  HELP
;    "The water heater has a UEF efficiency rating.  The UEF input box only appears 
;      if the input rating and volume fit into a standards classification that uses UEF."  
;  INPUTCLASS
;    Optional
;  DEFAULT
;    if (ElementType == "Heat Pump" .AND.
;        HPWHCat == "UEF Rated")
;    then  1
;    else  0
;    endif
;  CHECKCODE           // IsUEFRtd
;    if( ExcludeWtrHtg )
;    then UNCHANGED
;    else
;	    if( IsUEFRtd <> IsUEFRtdSim )
;	    then
;	      if( ElementType = "Heat Pump" .AND. HtPumpWtrHtrNEEARtd = 1 )
;	      then UNCHANGED
;	      else
;	        PostWarning("Residential water heater '%s' has the flag set to 
;	                     indicate that it is UEF rated, but the volume and input 
;	                     ratings do not fall into a classification which uses UEF 
;	                     ratings.  The flag should be unchecked, or the inputs 
;	                     should be verified to ensure accuracy.",Name)
;	      endif
;	    else UNCHANGED
;	    endif
;   endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;//
;RULE NEW ResWtrHtr:InputPerVol
;  LONGFORM
;    InputPerVolume
;  DATATYPE
;    Float
;  DESCRIPTION
;    "The rated input per gallon."
;  INPUTCLASS
;    NotInput
;  UNITS
;    Btu/h per gal
;  DEFAULT
;    if( LocalStatus( InpRating ) > 0 .AND. LocalStatus( TankVol ) > 0 )
;    then
;      if( TankVol > 0 )
;      then
;        InpRating / TankVol
;      else
;        1000000               //  a big number, since we can't use infinity
;      endif
;    else 0
;    endif
;ENDRULE
;
;// *****************************************************
;RULE NEW ResWtrHtr:IsWtrHtrNewEffDesignation
; DATATYPE
;    Integer
;  LONGFORM
;    IsWaterHeaterNewEfficiencyDesignation
;  DESCRIPTION
;    ""
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( Status = "Existing" .AND. IfValidAnd( IsUEFRtd = 1 )  )
;    then 
;      0        // Do not change modeling inputs
;    else if( Status = "Existing" .AND. IfValidAnd( IsUEFRtd = 0 )  )
;    then
;      1       // Do not change modeling inputs
;    else if ( Status = "New" .AND. IfValidAnd( IsUEFRtd = 1 )  )  
;    then
;      0        // Do not change modeling inputs
;    else if ( Status = "New" .AND. IfValidAnd( IsUEFRtd = 0 ) .AND. IfValidAnd( ElementType = "Heat Pump" )  ) 
;    then
;      1
;    else if ( Status = "New" .AND. IfValidAnd( IsUEFRtd = 0 )  ) 
;    then
;      2
;    else
;      2
;    endif endif endif endif endif
;ENDRULE
;
;
;
;
;// -----------------------------------------------------------------------------
;//
;RULE ResWtrHtr:IsUEFRtdSim
;  DESCRIPTION
;    "A flag to indicated whether UEF is used to describe the water heater 
;     efficiency."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( IfValidAnd( IsWtrHtrNewEffDesignation = 1) )
;    then 0
;    else
;      if( ElementType = "Gas" .AND. (  TankCat = "Instantaneous" .OR.
;                                       TankCat = "Storage"  ) )
;      then
;        if( ( IfValidAnd( InpRating > 50000 ) .AND. IfValidAnd( InpRating <= 200000 ) .AND. 
;              IfValidAnd( TankVol < 2 ) ) .OR.
;            ( IfValidAnd( InpRating <= 75000 ) .AND. 
;              IfValidAnd( TankVol >= 20 ) .AND. IfValidAnd( TankVol <= 100 ) ) .OR.
;            ( IfValidAnd( InpRating > 75000 ) .AND. IfValidAnd( InpRating <= 105000 ) .AND. 
;              IfValidAnd( TankVol >= 20 ) .AND. IfValidAnd( TankVol <= 120 ) .AND. 
;              IfValidAnd( InputPerVol < 4000 ) ) )
;        then 1
;        else 0
;        endif
;      else if( ElementType = "Electric Resistance" .AND. (TankCat = "Instantaneous" .OR.
;                                                          TankCat = "Storage"  ) )
;      then
;        if( ( IfValidAnd( InpRatingElec <= 12000 ) .AND. 
;              IfValidAnd( TankVol < 2 ) ) .OR.
;            ( IfValidAnd( InpRatingElec <= 12000 ) .AND. 
;              IfValidAnd( TankVol >= 20 ) .AND. IfValidAnd( TankVol <= 120 ) ) .OR.
;            ( IfValidAnd( InpRatingElec > 12000 ) .AND. IfValidAnd( InpRatingElec <= 59000 ) .AND. 
;              IfValidAnd( TankVol < 2 ) ) )
;        then 1
;        else 0
;        endif
;      else if( ElementType = "Heat Pump" )
;      then
;        if( HtPumpWtrHtrNEEARtd = 1 )
;        then
;          UNCHANGED
;        else if( ( IfValidAnd( InpRatingElec <= 12000 ) .AND. 
;                   IfValidAnd( TankVol >= 20 ) .AND. IfValidAnd( TankVol <= 120 ) ) )
;        then 1
;        else 0
;        endif endif
;      else 0
;      endif endif endif
;    endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline )
;    then 
;      if ( IfValidAnd( IsUEFRtdSim > 0 ) .AND. ( ElementType = "Gas" .OR. ElementType = "Electric Resistance" ) )  // 7-5-18 NK Added to pass UEF Water Heater on Central Systems - Revise later once Res rules are updated
;      then 
;        if ( CentralSys .AND. ( IfValidAnd( TankType = "Consumer Storage (UEF)" ) .OR. IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) ) )
;        then 1
;        else 0
;        endif
;      else 0
;      endif
;    else if( Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then 0
;      else u:IsUEFRtdSim
;      endif
;    else if( Proj:ResDHWBothBaseline )
;    then 
;      UNDEFINED // 0
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Residential Water Heater Tank Category --------------------
;//
;; fixed default expression bugs: LocalStatus(...) >= 0 (ALWAYS TRUE) -->> LocalStatus(...) > 0  - SAC 03/03/21
;RULE ResWtrHtr:TankCat
;  DESCRIPTION
;    "This is the selection of the Residential Water Heater Tank Category.
;     This parameter is used to determine the Tank Type.  If the selection is
;     instantaneous or storage, the selection will be verified against other 
;     inputs."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Required
;// enums must be defined via Enums.txt in order to map to numeric values expected by the T24 DHW simulation engine
;//  OPTION
;//    Boiler
;//    Indirect
;//    Instantaneous
;//    Storage
;//    Commercial Instantaneous (TE)
;//    Commercial Storage (TE & SBL)
;  RESETS
;    ResetTheFollowingWhenThisIsModified
;      ResWtrHtr:TankVol
;  DEFAULT
;    if( ElementType = "Electric Resistance" .OR. ElementType = "Gas" )
;    then
;      if( ( LocalStatus( InpRating ) > 0 .OR. LocalStatus( InpRatingElec ) > 0 ) .AND.
;            LocalStatus( TankVol ) > 0 )
;      then
;        if( TankVol = 0 )
;        then
;          "Instantaneous"
;        else if( InpRating > 0 .AND. TankVol > 0 )
;        then
;          if( InpRating / TankVol < 4000 )
;          then "Storage"
;          else "Instantaneous"
;          endif
;        else "Storage"
;        endif endif
;      else "Instantaneous"
;      endif
;    else if( ElementType = "Heat Pump" )
;    then "Storage"
;    else "Storage"
;    endif endif
;  CHECKCODE           // TankCat
;    if ( ExcludeWtrHtg )
;    then UNCHANGED
;    else
;	    if( IsUEFRtdSim = 0 )
;	    then 
;	      if( ElementType = "Electric Resistance" .OR. ElementType = "Gas" )
;	      then
;	        if( LocalStatus( InpRating ) >= 7 .AND. LocalStatus( TankVol ) >= 7 )
;	        then
;	          if( TankVol = 0 .AND. TankCat = "Storage" )
;	          then
;	            PostError("Residential water heater '%s' has a storage volume of 0 but
;	                       the Tank Type is set to Storage.  These inputs are 
;	                       incompatible. Please correct the inputs.",Name)
;	          else if( InpRating > 0 .AND. TankVol > 0 )
;	          then
;	            if( InpRating / TankVol < 4000 .AND. TankCat = "Instantaneous" )
;	            then
;	              PostError("Residential water heater '%s' has an input rating less 
;	                         than 4,000 Btu/hr/gal but the Tank Type is set to 
;	                         Instantaneous.  These inputs are incompatible. Please 
;	                         correct the inputs.",Name)
;	            else if( InpRating / TankVol >= 4000 .AND. TankCat = "Storage" )
;	            then
;	              PostError("Residential water heater '%s' has an input rating of 
;	                         4,000 Btu/hr/gal or more, but the Tank Type is set to 
;	                         Storage.  These inputs are incompatible. Please 
;	                         correct the inputs.",Name)
;	            else UNCHANGED
;	            endif endif
;	          else UNCHANGED
;	          endif endif
;	        else UNCHANGED
;	        endif
;	      else UNCHANGED
;	      endif
;	    else 
;	      UNCHANGED
;	    endif
;	  endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then "Storage"
;    else if( zp:ElementType = "Heat Pump" )
;    then "Storage"
;    else u:TankCat
;    endif endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline )
;    then 
;      if( CentralSys )  
;      then
;        if (IfValidAnd( IsBaseSys > 0 ))
;        then "Instantaneous"
;        else zp:TankCat
;        endif
;      else 
;        "Storage"
;      endif
;    else if( Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then "Instantaneous"
;      else zp:TankCat                                  // existing ResDHW
;      endif
;    else if( Proj:ResDHWBothBaseline )
;    then 
;      "Storage"                                 // existing ResDHW
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                   // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif endif
;  ANNUAL_PROPOSED
;    z:TankCat
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;//
;RULE ResWtrHtr:AmbCond
;  DESCRIPTION
;    "This is the surrounding condition of the residential water heater."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;// enums must be defined via Enums.txt in order to map to numeric values expected by the T24 DHW simulation engine
;//  OPTION
;//    Unconditioned
;//    Conditioned
;  DEFAULT
;    "Unconditioned"
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then "Conditioned"
;    else u:AmbCond
;    endif
;  ANNUAL_PROPOSED
;    z:AmbCond
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Residential Water Heater Tank Type --------------------
;//
;; replaced all occurrences of 'UNDEFINED' w/ valid selections, since leaving this undef causes inconsistencies in subsequent rule evals - SAC 03/03/21
;RULE ResWtrHtr:TankType
;  DESCRIPTION
;    "This is the selection of the Residential Water Heater Tank Type."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput  IgnoreUserInput  "ResWtrHtr:TankType removed in transition from 2013 version 3c to 3e and 2016.2.0 to 2016.2.1"
;//  OPTION
;//    "Boiler"
;//    "Indirect" 
;//    "Large Instantaneous"
;//    "Large Storage" 
;//    "Small Instantaneous"
;//    "Small Storage"
;//    "Consumer Instantaneous (UEF)"
;//    "Commercial Instantaneous (TE)"
;//    "Consumer Storage (UEF)"
;//    "Commercial Storage (TE & SBL)"
;//    "Residential-Duty Commercial Storage (UEF)"
;//    "Residential-Duty Commercial Instantaneous (UEF)"
;//    "Heat Pump"
;  DEFAULT
;//    if( IncludeWtrHtg )
;//    then 
;	    if( TankCat = "Boiler" )
;	    then 
;	      "Boiler"
;	    else if( TankCat = "Commercial Packaged Boiler" )
;	    then 
;	      "Commercial Packaged Boiler"
;	    else if( TankCat = "Indirect" )
;	    then 
;	      "Indirect"
;	    else if( TankCat = "Commercial Instantaneous (TE)" )
;	    then 
;	      "Commercial Instantaneous (TE)"
;	    else if( TankCat = "Commercial Storage (TE & SBL)" )
;	    then 
;	      "Commercial Storage (TE & SBL)"            
;	    else if( IsUEFRtdSim = 1 )
;	    then
;	      if( ElementType = "Heat Pump" )
;	      then 
;	        "Small Storage"  ; was: UNDEFINED
;	      else if( ElementType = "Gas" )
;	      then
;	        if( InpRating > 50000 .AND. InpRating <= 200000 .AND. 
;	            TankVol < 2 )
;	        then "Consumer Instantaneous (UEF)"
;	        else if( InpRating <= 75000 .AND. 
;	                 TankVol >= 20 .AND. TankVol <= 100 )
;	        then "Consumer Storage (UEF)"
;	        else if( InpRating > 75000 .AND. InpRating <= 105000 .AND. 
;	                 TankVol >= 20 .AND. TankVol <= 120 .AND. 
;	                 InputPerVol < 4000 )
;	        then "Residential-Duty Commercial Storage (UEF)"
;	        else "Consumer Instantaneous (UEF)"  ; was: UNDEFINED
;	        endif endif endif
;	      else if( ElementType = "Electric Resistance" )
;	      then
;	        if( InpRatingElec <= 12000 .AND. 
;	            TankVol < 2 )
;	        then "Consumer Instantaneous (UEF)"
;	        else if( InpRatingElec <= 12000 .AND. 
;	                 TankVol >= 20 .AND. TankVol <= 120 )
;	        then "Consumer Storage (UEF)"
;	        else if( InpRatingElec > 12000 .AND. InpRatingElec <= 59000 .AND. 
;	                 TankVol < 2 )
;	        then "Residential-Duty Commercial Instantaneous (UEF)"
;	        else "Consumer Storage (UEF)"  ; was: UNDEFINED
;	        endif endif endif
;	      else 
;	        "Consumer Storage (UEF)"  ; was: UNDEFINED
;	      endif endif endif
;	    else if( IsUEFRtdSim = 0 )
;	    then
;	      if( TankCat = "Instantaneous" )
;	      then 
;	        if( ElementType = "Gas" .AND. InpRating > 200000 .AND. IfValidAnd( InputPerVol >= 4000 ) )
;	        then
;	          "Commercial Instantaneous (TE)"
;	        else if( ElementType = "Electric Resistance" .AND. InpRatingElec > 12000  )
;	        then
;	          "Commercial Instantaneous (TE)"
;           else if( ( ElementType = "Gas" .AND. InpRating > 200000 ) .OR.
;	            ( ElementType = "Oil" .AND. InpRating > 210000 ) .OR.
;	            ( ElementType = "Electric Resistance" .AND. InpRatingElec > 12000 ) )
;	        then 
;	          "Large Instantaneous"
;	        else if( TankCat = "Instantaneous" .AND. ( ElementType = "Gas" .AND. InpRating <= 200000 ) .OR.
;	                 ( ElementType = "Oil" .AND. InpRating <= 210000 ) .OR.
;	                 ( ElementType = "Electric Resistance" .AND. InpRatingElec <= 12000 ) )
;	        then 
;	          "Small Instantaneous"
;	        else "Commercial Instantaneous (TE)"  ; was: UNDEFINED
;	        endif endif endif endif
;	      else if( TankCat = "Storage" )
;	      then 
;	        if( ElementType = "Gas" .AND. ( ( InpRating > 75000 .AND. TankVol >= 20 ) .OR. TankVol > 120 ) )
;	        then
;	          "Commercial Storage (TE & SBL)"
;	        else if( ElementType = "Electric Resistance" .AND. ( ( InpRatingElec > 12000 .AND. TankVol >= 20 ) .OR. TankVol > 120 ) )
;	        then
;	          "Commercial Storage (TE & SBL)"
;          else if( ( ElementType = "Gas" .AND. InpRating > 75000 ) .OR.
;	            ( ElementType = "Oil" .AND. InpRating > 105000 ) .OR.
;	            ( ElementType = "Electric Resistance" .AND. InpRatingElec > 12000 ) )
;	        then 
;	          "Large Storage"
;	        else if( ( ElementType = "Gas" .AND. InpRating <= 75000 ) .OR.
;	                 ( ElementType = "Oil" .AND. InpRating <= 105000 ) .OR.
;	                 ( ElementType = "Electric Resistance" .AND. InpRatingElec <= 12000 ) .OR.
;	                 ( ElementType = "Heat Pump" ) )
;	        then 
;	          "Small Storage"
;	        else "Commercial Storage (TE & SBL)"  ; was: UNDEFINED
;	        endif endif endif endif
;	      else "Small Storage"  ; was: UNDEFINED
;	      endif endif
;	    else UNDEFINED
;	    endif endif endif endif endif endif endif
;  SIZING_PROPOSED
;    if( Proj:ResDHWBothBaseline )
;    then 
;      if( CentralSys )  
;      then
;        if (IfValidAnd( IsBaseSys > 0 ))
;        then
;          "Small Instantaneous"
;        else zp:TankType
;        endif
;      else 
;        "Small Instantaneous"
;      endif
;    else if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then
;        "Small Instantaneous"
;      else 
;        if( IfValidAnd( IsUEFRtdSim = 1) .AND. IfValidAnd( ElementType = "Heat Pump") )
;        then UNDEFINED
;        else if( IfValidAnd( TankType = "Boiler" ) .OR. IfValidAnd( TankType = "Indirect" ) )
;        then 
;          "Large Instantaneous"
;        else 
;          TankType
;        endif endif
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif
;  ANNUAL_PROPOSED
;   zp:TankType
;ENDRULE
;
;; SAC 6/21/18 - updated small storage elec heater default input ratings from 8,00 -> 4,500 W
;RULE NEW ResWtrHtr:InpRatingSim
;  DATATYPE
;    Float
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if ( ExcludeWtrHtg )
;    then 
;      200000
;    else 
;	    switch ( ElementTypeNum )
;	      case 1:   ;Gas
;	          switch ( TankType )
;			     			case  "Large Instantaneous" :         210000		; "Large Instantaneous"       
;			     			case  "Large Storage" :    u:InpRating		; "Large Storage"             
;			     			case  "Small Instantaneous" :         195000		; "Small Instantaneous"       
;			     			case  "Small Storage" :          40000		; "Small Storage"            
;			     			case  "Consumer Instantaneous (UEF)" :         190000		; "Consumer Instantaneous (UEF)"             
;			     			case  "Commercial Instantaneous (TE)" :         210000		; "Commercial Instantaneous (TE)"            
;			     			case  "Consumer Storage (UEF)" :          40000		; "Consumer Storage (UEF)"                   
;			     			case  "Commercial Storage (TE & SBL)" :    u:InpRating		; "Commercial Storage (TE & SBL)"            
;			            case  "Residential-Duty Commercial Storage (UEF)" :          76000    ; "Residential-Duty Commercial Storage (UEF)"
;                     case  "Commercial Packaged Boiler" :   300000           ; SAC 1/9/20 - to facilitate new central gas std design DHW system (Com tic #3156)
;								default :	  40000
;	         endswitch
;	      default: InpRating
;	    endswitch
;    endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 200000
;    else u:InpRatingSim
;    endif
;  ANNUAL_PROPOSED
;    z:InpRatingSim
;ENDRULE
;
;RULE NEW ResWtrHtr:InpRatingElecSim
;  DATATYPE
;    Float
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if ( ExcludeWtrHtg )
;    then 
;      200000
;    else 
;	    switch ( ElementTypeNum )
;	      case 0:   ;Electric Resistance
;	          switch ( TankType )
;			     			case  "Large Instantaneous" :    	36000		; "Large Instantaneous"       
;			     			case  "Large Storage" :    u:InpRatingElec		; "Large Storage"             
;			     			case  "Small Instantaneous" :     8000		; "Small Instantaneous"       
;			     			case  "Small Storage" :     4500		; "Small Storage"            
;			     			case  "Consumer Instantaneous (UEF)" :     8000		; "Consumer Instantaneous (UEF)"             
;			     			case  "Commercial Instantaneous (TE)" :    36000		; "Commercial Instantaneous (TE)"            
;			     			case  "Consumer Storage (UEF)" :     4500		; "Consumer Storage (UEF)"                   
;			     			case  "Commercial Storage (TE & SBL)" :    u:InpRatingElec		; "Commercial Storage (TE & SBL)"            
;			          case  "Residential-Duty Commercial Instantaneous (UEF)" :    36000    ; "Residential-Duty Commercial Instantaneous (UEF)"
;								default :	  4500
;	         endswitch
;	      case 5:   8000      ;Heat Pump
;	      default: InpRatingElec
;	    endswitch
;    endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 200000
;    else u:InpRatingElecSim
;    endif
;  ANNUAL_PROPOSED
;    z:InpRatingElecSim
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// 
;RULE NEW ResWtrHtr:ScreenVal
;  LONGFORM
;    ScreenValue
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DESCRIPTION
;    "A value used to determine the input screen configuration."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    switch ( TankType )
;      case  "Boiler"                          :  1
;      case  "Commercial Packaged Boiler"      :  1
;      case  "Indirect"                        :  2
;      case  "Large Instantaneous"             :  if( ElementType = "Gas" ) 
;                                                 then 3
;                                                 else 4
;                                                 endif
;      case  "Large Storage"                   :  if( ElementType = "Gas" ) 
;                                                 then 5
;                                                 else 6
;                                                 endif
;      case  "Small Instantaneous"             :  if( ElementType = "Gas" ) 
;                                                 then 7
;                                                 else 8
;                                                 endif
;      case  "Small Storage"                   :  if (ElementType = "Heat Pump")
;                                                 then
;                                                   if( HtPumpWtrHtrNEEARtd = 0 )
;                                                   then
;                                                     if( IsUEFRtdSim = 0 )
;                                                     then 9
;                                                     else 10
;                                                     endif
;                                                   else 11
;                                                   endif
;                                                 else if( ElementType = "Gas" )
;                                                 then 12
;                                                 else 13
;                                                 endif endif
;      case  "Consumer Instantaneous (UEF)"    :  if( ElementType = "Gas" )
;                                                 then 14
;                                                 else 15
;                                                 endif
;      case  "Commercial Instantaneous (TE)"   :  if( ElementType = "Gas" ) 
;                                                 then 16
;                                                 else 17
;                                                 endif
;      case  "Consumer Storage (UEF)"          :  if( ElementType = "Gas" ) 
;                                                 then 18
;                                                 else 19
;                                                 endif
;      case  "Commercial Storage (TE & SBL)"   :  if( ElementType = "Gas" ) 
;                                                 then 20
;                                                 else 21
;                                                 endif
;      case  "Residential-Duty Commercial Storage (UEF)"        :  22
;      case  "Residential-Duty Commercial Instantaneous (UEF)"  :  23
;      default :  12 // 8
;    endswitch
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:TEDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     thermal energy is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ScreenVal =  1 .OR. ScreenVal =  2 .OR. 
;        ScreenVal =  3 .OR. ScreenVal =  4 .OR.
;        ScreenVal =  5 .OR. ScreenVal =  6 .OR. 
;        ScreenVal = 16 .OR. ScreenVal = 17 .OR. ScreenVal = 20 .OR. ScreenVal =  21 .OR. ScreenVal =  22 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:EFDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     energy factor is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;//    if( ScreenVal =  3 .OR. ScreenVal =  4 .OR. ScreenVal =  7 .OR.   
;    if( ScreenVal =  7 .OR. ScreenVal =  8 .OR. 
;         ScreenVal = 9 .OR. ScreenVal = 12 .OR. ScreenVal = 13 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:MiniTankDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input checkbox for
;     an electric mini tank is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ScreenVal =  3 .OR. ScreenVal =  7 .OR.  
;        ScreenVal = 14 .OR. ScreenVal = 16 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:UEFDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     uniform energy factor is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ScreenVal =  10 .OR. ScreenVal =  14 .OR. ScreenVal = 15 .OR. 
;        ScreenVal = 18 .OR. ScreenVal = 19 .OR. ScreenVal = 22 .OR. 
;        ScreenVal = 23 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:SBLFDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     standby loss fraction is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ScreenVal =  5 .OR. ScreenVal =  6 .OR. 
;        ScreenVal =  20 .OR. ScreenVal =  21 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:PilotDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     pilot energy is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( (ScreenVal =  1 .OR. ScreenVal =  2 .OR. ScreenVal =  3) .AND.
;        TankType != "Commercial Packaged Boiler" )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:TankInsDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     tank insulation is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ScreenVal =  1 .OR. ScreenVal =  2 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:FlowRtDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     flow rate is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ScreenVal =  15 .OR. ScreenVal = 23 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:FirstHrDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     first hour rating is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ScreenVal = 10 .OR. ScreenVal = 18 .OR. ScreenVal = 19 .OR. 
;        ScreenVal = 22 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:REDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     recovery efficiency is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ScreenVal =  15 .OR. ScreenVal = 18 .OR. 
;        ScreenVal = 19 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:LocDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the checkbox input for
;     ambient location is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ScreenVal =  2 ) //.OR. ScreenVal = 16 .OR. ScreenVal = 17 .OR. ScreenVal = 18 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:HtPumpDisp
;  DESCRIPTION
;    "Screens condition to not display Heat Pump Options"
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ElementType = "Heat Pump" )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:TankZnDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     zone location is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;//    if( LocDisp = 1 .AND. ( ScreenVal = 16 .OR. ScreenVal = 17 .OR. 
;//        ScreenVal = 18 ) )
;    if( ScreenVal = 13 .OR. ScreenVal = 9 .OR. ScreenVal = 10 .OR. ScreenVal = 11 .OR. ScreenVal = 19 )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:BrandDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the inputs for
;     brand and model are to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ElementType = "Heat Pump" .AND.
;        (HtPumpWtrHtrNEEARtd = 1 .OR. HPWHCommProd = 1) )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:ComPckgdGasBlr
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the inputs for
;     standard design commercial packaged gas boiler display/edit."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( IfValidAnd( TankType = "Commercial Packaged Boiler" ) )
;      then 1
;    else 0
;    endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------- Baseline Residential Water Heater Tank Volume ---------------
;// 
;RULE NEW ResDHWSys:TankVolTotBase
;  LONGFORM
;    TankVolumeTotalBaseline
;  DATATYPE
;    Float
;  DESCRIPTION
;    ""
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    Int((SysHotWtrHrlyUse * 0.40) * 1.30)
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------- Baseline Residential Water Heater Input Rating ---------------
;// 
;RULE NEW ResDHWSys:InpRatingTotBase
;  LONGFORM
;    InputRatingTotalBaseline
;  DATATYPE
;    Float
;  DESCRIPTION
;    ""
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    Int( ((SysHotWtrHrlyUse * 0.60) * (8.4 * (135 - 55))) / 0.80 ) // Convert required burner capacity to input capacity -> divide by thrml eff 0.80
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// 
;RULE ResWtrHtr:ThrmlEff
;  DESCRIPTION
;    "Thermal Efficiency of the Residential Water Heater."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  MINIMUM
;    0.0 
;  MAXIMUM
;    1.00
;  REPORTPRECISION
;    2
;  DEFAULT
;    if( Proj:AutoEffInput = 1)
;    then
;	    if( ElementType = "Electric Resistance" )
;	    then 0.93
;	    else 0.80
;	    endif
;	  else if (TankType = "Commercial Packaged Boiler")
;	  then  0.80
;	  else
;	    UNDEFINED
;	  endif endif
;  CHECKCODE           // ThrmlEff
;    if ( ExcludeWtrHtg )
;    then UNCHANGED
;    else
;	    if ( IfValidAnd( IsUEFRtdSim = 1 ) .AND. IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) .AND.
;           ( LocalStatus ( ThrmlEff ) < 1 ) .AND. IfValidAnd( TEDisp = 1 ) )
;      then
;	      PostError("Residential water heater '%s' requires a 
;	                 Thermal Efficiency input.",Name)        
;      else if ( IsUEFRtdSim = 0 .AND. ( LocalStatus ( ThrmlEff ) < 1 ) .AND. IfValidAnd( TEDisp = 1 ) )
;	    then
;	      PostError("Residential water heater '%s' requires a 
;	                 Thermal Efficiency input.",Name)
;	    else
;		    if( ElementType = "Gas" )
;		    then
;			      if( IfValidAnd( TankType = "Commercial Instantaneous (TE)" ) .AND.
;			          ( IfValidAnd( ThrmlEff < 0.80 ) .OR. IfValidAnd( ThrmlEff >= 1 ) ) )
;			      then
;			        PostError("Thermal Efficiency for residential water heater '%s' 
;			                   must be at least 0.80 and less than 1.00.",Name)
;			      else if( IfValidAnd( TankType = "Commercial Storage (TE & SBL)" ) .AND.
;			               ( IfValidAnd( ThrmlEff < 0.80 ) .OR. IfValidAnd( ThrmlEff >= 1 ) ) )
;			      then
;			        PostError("Thermal Efficiency for residential water heater '%s' 
;			                   must be at least 0.80 and less than 1.00.",Name)
;			      else if( IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) .AND.
;			               ( IfValidAnd( ThrmlEff < 0.80 ) .OR. IfValidAnd( ThrmlEff >= 1 ) ) )
;			      then
;			        PostError("Thermal Efficiency for residential water heater '%s' 
;			                   must be at least 0.80 and less than 1.00.",Name)
;			      else UNCHANGED
;			      endif endif endif
;			    else if( ElementType = "Electric Resistance" )
;			    then
;			      if( IfValidAnd( TankType = "Commercial Instantaneous (TE)" ) .AND.
;			          ( IfValidAnd( ThrmlEff < 0.80 ) .OR. IfValidAnd( ThrmlEff >= 1 ) ) )
;			      then
;			        PostError("Thermal Efficiency for residential water heater '%s' 
;			                   must be at least 0.80 and less than 1.00.",Name)
;			      else if( IfValidAnd( TankType = "Commercial Storage (TE & SBL)" ) .AND.
;			               ( IfValidAnd( ThrmlEff < 0.80 ) .OR. IfValidAnd( ThrmlEff >= 1 ) ) )
;			      then
;			        PostError("Thermal Efficiency for residential water heater '%s' 
;			                   must be at least 0.80 and less than 1.00.",Name)
;			      else UNCHANGED
;			      endif endif
;			    else UNCHANGED
;			    endif endif
;	    endif endif
;	  endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED
;    else u:ThrmlEff
;    endif
;  ANNUAL_PROPOSED
;    z:ThrmlEff
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;//    properties specific to CSE simulation of "Consumer Instantaneous (UEF)" heaters - SAC 8/19/18
;
;RULE ResWtrHtr:RtdFlow
;  DESCRIPTION
;    "Max gpm at 67 F temp rise (required for UEF-rated equipment)."
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    if ( IfValidAnd( ElementType = "Gas" ) .AND.
;         IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) )
;    then  4.7
;    else  UNDEFINED
;    endif
;ENDRULE
;
;RULE ResWtrHtr:AnnualFuelUse
;  DESCRIPTION
;    "'yellow label' annual fuel use in therms (required for UEF-rated equipment)."
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    if ( IfValidAnd( ElementType = "Gas" ) .AND.
;         IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) )
;    then  205
;    else  UNDEFINED
;    endif
;ENDRULE
;
;RULE ResWtrHtr:AnnualElecUse
;  DESCRIPTION
;    "'yellow label' annual electricity use in kWh (required for UEF-rated equipment)."
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    if ( IfValidAnd( ElementType = "Gas" ) .AND.
;         IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) )
;    then  52
;    else  UNDEFINED
;    endif
;ENDRULE
;
;RULE ResWtrHtr:StdbyElec
;  DESCRIPTION
;    "standby electric power in W (optional for UEF-rated equipment)."
;  INPUTCLASS
;    Prescribed
;  DEFAULT
;    if ( IfValidAnd( ElementType = "Gas" ) .AND.
;         IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) )
;    then  4
;    else  UNDEFINED
;    endif
;ENDRULE
;
;// SAC 5/30/19 - moved up from below to use 
;RULE NEW ResWtrHtr:HtrTypeNum
;  DATATYPE
;    Integer
;  LONGFORM
;    HeaterTypeNumber
;  DESCRIPTION
;    "# consistent w/ TankType enum value - incl. differentiate original Elec/Gas ConsInst from new CSE model"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (ElementType == "Gas" .AND.
;        TankType == "Consumer Instantaneous (UEF)" .AND.
;        IfValidAnd( Proj:EngyCodeYearNum >= 2019 ))
;    then  9
;    else  switch (TankType)
;            case "Boiler"                                          :  0
;            case "Commercial Packaged Boiler"                      : 16
;            case "Indirect"                                        :  1
;            case "Large Instantaneous"                             :  2
;            case "Large Storage"                                   :  3
;            case "Small Instantaneous"                             :  5
;            case "Small Storage"                                   :  6
;            case "Consumer Instantaneous (UEF)"                    : 10
;            case "Commercial Instantaneous (TE)"                   : 11
;            case "Consumer Storage (UEF)"                          : 12
;            case "Commercial Storage (TE & SBL)"                   : 13
;            case "Residential-Duty Commercial Storage (UEF)"       : 14
;            case "Residential-Duty Commercial Instantaneous (UEF)" : 15
;            default : -1
;          endswitch endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// 
;; SAC 1/29/19 - installed new default formula for ResWtrHtr:RcvryEff of "Consumer Instantaneous (UEF)-New" heaters (Res tic #1054)
;RULE ResWtrHtr:RcvryEff
;  DESCRIPTION
;    "Recovery Efficiency of the Residential Water Heater."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  PREVIOUSNAMES  RecovEff
;  MINIMUM
;    0.0 
;  MAXIMUM
;    100.00
;  REPORTPRECISION
;    1
;  DEFAULT
;    if( Proj:AutoEffInput = 1)
;    then
;      if( ElementType = "Electric Resistance" )
;      then
;        99
;      else if( ElementType = "Gas" )
;      then
;            switch (HtrTypeNum) ; HeaterType)
;               case  9 : min( 99, ((1.0702 * ValidOr( UEF, 0.81 ) - 0.0332) * 100) )		; "Consumer Instantaneous (UEF)-New"
;               case 10 :   83		; "Consumer Instantaneous (UEF)"             
;               case 12 :   78		; "Consumer Storage (UEF)"                   
;               case 14 :   80		; "Residential-Duty Commercial Storage (UEF)"
;               default :   UNDEFINED
;            endswitch
;      else
;        UNDEFINED
;      endif endif
;    else
;	      if ( IfValidAnd( IsUEFRtdSim = 1 ) .AND. IfValidAnd( UEF > 0 ) .AND. 
;	           IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) .AND.
;	           IfValidAnd ( ThrmlEff > 0 ) )
;	      then
;	        u:ThrmlEff * 100
;	      else
;	       UNDEFINED
;	      endif      
;     endif
;  CHECKCODE           // RcvryEff
;    if ( ExcludeWtrHtg )
;    then UNCHANGED
;    else
;	    if ( IsUEFRtdSim = 1 .AND. ( LocalStatus ( RcvryEff ) < 1 ) .AND. IfValidAnd( REDisp = 1 ) )
;	    then
;	      PostError("Residential water heater '%s' requires a 
;	                Recovery Efficiency input.",Name)
;	    else
;		    if( ElementType = "Gas" )
;		    then
;		      if( IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) .AND.
;		          ( IfValidAnd( RcvryEff < 80 ) .OR. IfValidAnd( RcvryEff > 99 ) ) )
;		      then
;		        PostError("Recovery Efficiency for residential water heater '%s' 
;		                   must be at least 80 and no more than 99.",Name)
;		      else if( IfValidAnd( TankType = "Consumer Storage (UEF)" ) .AND.
;		               ( IfValidAnd( RcvryEff < 70 ) .OR. IfValidAnd( RcvryEff > 99 ) ) )
;		      then
;		        PostError("Recovery Efficiency for residential water heater '%s' 
;		                   must be at least 70 and no more than 99.",Name)
;	//	      else if( IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) .AND.
;	//	               ( RcvryEff < 80 .OR. RcvryEff > 99 ) )
;	//	      then
;	//	        PostError("Recovery efficiency for residential water heater '%s' 
;	//	                   must be at least 80 and no more than 99.",Name)
;		      else UNCHANGED
;		      endif endif  // endif
;		    else if( ElementType = "Electric Resistance" )
;		    then
;		      if( IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) .AND.
;		          ( IfValidAnd( RcvryEff < 90 ) .OR. IfValidAnd( RcvryEff > 99 ) ) )
;		      then
;		        PostError("Recovery Efficiency for residential water heater '%s' 
;		                   must be at least 90 and no more than 99.",Name)
;		      else if( IfValidAnd( TankType = "Consumer Storage (UEF)" ) .AND.
;		               ( IfValidAnd( RcvryEff < 90 ) .OR. IfValidAnd( RcvryEff > 99 ) ) )
;		      then
;		        PostError("Recovery Efficiency for residential water heater '%s' 
;		                   must be at least 90 and no more than 99.",Name)
;		      else UNCHANGED
;		      endif endif
;		    else UNCHANGED
;		    endif endif
;      endif
;    endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED
;    else 
;      if( ElementType = "Gas" .AND. IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) )
;      then
;            switch (HtrTypeNum) ; HeaterType)
;               case  9 : min( 99, ((1.0702 * ValidOr( UEF, 0.81 ) - 0.0332) * 100) )		; "Consumer Instantaneous (UEF)-New"
;               case 10 :   83		; "Consumer Instantaneous (UEF)"             
;               default :   UNDEFINED
;            endswitch
;      else if ( IfValidAnd( IsUEFRtdSim = 1 ) .AND. IfValidAnd( UEF > 0 ) .AND. 
;                IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) .AND.
;                IfValidAnd ( ThrmlEff > 0 ) )
;      then
;        u:ThrmlEff * 100
;      else
;       u:RcvryEff
;      endif endif     
;    endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline )
;    then 
;      if ( CentralSys .AND. IfValidAnd( IsUEFRtdSim = 1 ) ) // 7-5-18 NK Added to pass UEF Water Heater on Central Systems - Revise later once Res rules are updated
;	    then
;	      zp:RcvryEff
;	    else
;	      UNDEFINED
;	    endif    
;	  else if ( Proj:ResDHWBothBaseline )
;	  then  
;      UNDEFINED
;    else if( Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then 
;        UNDEFINED
;      else 
;	      if ( IfValidAnd( IsUEFRtdSim = 1 ) .AND. IfValidAnd( UEF > 0 ) .AND. IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) )
;	      then
;	        u:ThrmlEff * 100
;	      else
;	       u:RcvryEff
;	      endif     
;	    endif      
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif endif
;  ANNUAL_PROPOSED
;    z:RcvryEff
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -----------------------------------------------------------------------------
;; revised SIZING expression for commercial HPWH products - SAC 03/02/21
;RULE ResWtrHtr:EF
;  DESCRIPTION
;    "The residential water heater Energy Factor."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  PREVIOUSNAMES  EngyFac
;  MINIMUM
;    0.0 
;  MAXIMUM
;    4.00
;  REPORTPRECISION
;    2
;  DEFAULT
;    if( ExcludeWtrHtg )
;    then 
;      0.82 - (0.0019 * TankVol)
;    else
;	    if( Proj:AutoEffInput = 1)
;	    then
;	      if( Parent(CentralSys) = 1 )
;	      then 0.60
;	      else 0.82
;	      endif
;	    else 
;	      if ( IfValidAnd( IsUEFRtdSim = 1 ) .AND. IfValidAnd( UEF > 0 ) )
;	      then
;	        u:UEF
;	      else
;	       UNDEFINED
;	      endif 
;	    endif
;	  endif
;  CHECKCODE           // EF
;    if( ExcludeWtrHtg )
;    then UNCHANGED
;    else
;	    if( IsUEFRtdSim = 0 .AND. EFDisp = 1 .AND. ( LocalStatus( u:EF ) < 1 ) .AND.
;	        IfValidAnd( InpRating > 0 ) .AND. IfValidAnd( HtPumpWtrHtrNEEARtd = 0 ) )
;	    then
;	      PostError("Residential water heater '%s' requires an 
;	                 Energy Factor input.",Name)
;	    else  if( IsUEFRtdSim = 0 .AND. EFDisp = 1 .AND. IfValidAnd(ElementType <> "Heat Pump") .AND. 
;	              IfValidAnd( EF > 1) )
;	    then
;	      PostError("The Energy Factor for water heater '%s' is greater than 
;             1 and it is not a heat pump.  Enter a valid Energy Factor.", 
;             Name)
;	    else 
;	      UNCHANGED
;	    endif endif
;   endif  
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 0.82 - (0.0019 * TankVol)              
;    else 
;     if( IfValidAnd(ElementType = "Heat Pump") .AND.
;         ( IfValidAnd(HtPumpWtrHtrNEEARtd = 1) .OR. IfValidAnd(HPWHCommProd = 1) ) )
;     then UNDEFINED
;     else if ( IfValidAnd( IsUEFRtdSim = 1 ) .AND. IfValidAnd( u:UEF > 0 ) ) 
;	   then u:UEF   // New variable to be TBD later to pass to CSE because EF is not necessarily EF
;	   else u:EF
;     endif endif
;    endif
;  ANNUAL_PROPOSED
;    z:EF
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE ResWtrHtr:UEF
;  DESCRIPTION
;    "The residential water heater Uniform Energy Factor."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  MINIMUM
;    0.0 
;  MAXIMUM
;    4.00
;  REPORTPRECISION
;    2
;  DEFAULT
;    if( Proj:AutoEffInput = 1)
;    then
;      if( Parent(CentralSys) = 1 )
;      then 0.60
;      else 0.82
;      endif
;    else UNDEFINED
;    endif
;  CHECKCODE           // UEF
;    if ( ExcludeWtrHtg )
;    then UNCHANGED
;    else
;	    if ( IsUEFRtdSim = 1 .AND. ( LocalStatus ( UEF ) < 1 ) .AND. IfValidAnd( UEFDisp = 1 ) )
;	    then
;	      PostError("Residential water heater '%s' requires an 
;	                Uniform Energy Factor input.",Name)
;	    else
;		    if( ElementType = "Gas" )
;		    then
;		      if( IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) .AND.
;		          ( IfValidAnd( UEF < 0.80 ) .OR. IfValidAnd( UEF > 0.99 ) ) )
;		      then
;		        PostError("Uniform Energy Factor for residential water heater '%s' 
;		                   must be more than 0.80 and less than 0.99.",Name)
;		      else if( IfValidAnd( TankType = "Consumer Storage (UEF)" ) .AND.
;		               ( IfValidAnd( UEF < 0.24 ) .OR. IfValidAnd( UEF >= 1 ) ) )
;		      then
;		        PostError("Uniform Energy Factor for residential water heater '%s' 
;		                   must be at least 0.24 and less than 1.00.",Name)
;		      else if( IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) .AND.
;		               ( IfValidAnd( UEF < 0.24 ) .OR. IfValidAnd( UEF >= 1 ) ) )
;		      then
;		        PostError("Uniform Energy Factor for residential water heater '%s' 
;		                   must be at least 0.24 and less than 1.00.",Name)
;		      else UNCHANGED
;		      endif endif endif
;		    else if( ElementType = "Electric Resistance" )
;		    then
;		      if( IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) .AND.
;		          ( IfValidAnd( UEF < 0.92 ) .OR. IfValidAnd( UEF >= 1 ) ) )
;		      then
;		        PostError("Uniform Energy Factor for residential water heater '%s' 
;		                   must be at least 0.92 and less than 1.00.",Name)
;		      else if( IfValidAnd( TankType = "Consumer Storage (UEF)" ) .AND.
;		               ( IfValidAnd( UEF < 0.92 ) .OR. IfValidAnd( UEF > 0.94 ) ) )
;		      then
;		        PostError("Uniform Energy Factor for residential water heater '%s' 
;		                   must be at least 0.92 and less than or equal to 0.94.",Name)
;		      else if( IfValidAnd( TankType = "Residential-Duty Commercial Instantaneous (UEF)" ) .AND.
;		               ( IfValidAnd( UEF < 0.80 ) .OR. IfValidAnd( UEF >= 1 ) ) )
;		      then
;		        PostError("Uniform Energy Factor for residential water heater '%s' 
;		                   must be at least 0.80 and less than 1.00.",Name)
;		      else UNCHANGED
;		      endif endif endif
;		    else if( ElementType = "Heat Pump" .AND. IsUEFRtdSim = 1 )
;		    then
;		      if( IfValidAnd( UEF < 2 ) .OR. IfValidAnd( UEF > 4 ) )
;		      then
;		        PostError("Uniform Energy Factor for residential water heater '%s' 
;		                   must be between 2.00 and 4.00.",Name)
;		      else UNCHANGED
;		      endif
;		    else UNCHANGED
;		    endif endif endif
;      endif
;    endif
;  SIZING_PROPOSED
;    if( Proj:ResDHWBothBaseline )
;    then 
;      UNDEFINED
;    else if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWPropOnly )
;    then 
;      if ( IfValidAnd( IsUEFRtdSim = 1 ) )
;      then
;        u:UEF
;      else
;        UNDEFINED
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif
;  ANNUAL_PROPOSED
;    z:UEF
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE ResWtrHtr:FirstHrRating
;  DESCRIPTION
;    "The first hour rating of the residential water heater."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  MINIMUM
;    0 
;  MAXIMUM
;    250
;  REPORTPRECISION
;    0
;  DEFAULT
;    if( Proj:AutoEffInput = 1)
;    then
;      if( ElementType = "Gas" .AND. 
;          IfValidAnd( TankType = "Consumer Storage (UEF)" ) )
;      then 80
;      else if( ElementType = "Gas" .AND. 
;               IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) )
;      then 120
;      else if( ElementType = "Electric Resistance" .AND. 
;               IfValidAnd( TankType = "Consumer Storage (UEF)" ) )
;      then 60
;      else 0
;      endif endif endif
;    else UNDEFINED
;    endif
;  CHECKCODE           // FirstHrRating
;    if ( ExcludeWtrHtg )
;    then UNCHANGED
;    else
;	    if ( IsUEFRtdSim = 1 .AND. ( LocalStatus ( FirstHrRating ) < 1 ) .AND. IfValidAnd( FirstHrDisp = 1 ) )
;	    then
;	      PostError("Residential water heater '%s' requires a 
;	                First Hour Rating input.",Name)
;	    else
;		    if( ElementType = "Gas" )
;		    then
;		      if(  IfValidAnd( TankType = "Consumer Storage (UEF)" ) .AND.
;		          (  IfValidAnd( FirstHrRating < 0 ) .OR.  IfValidAnd( FirstHrRating > 150 ) ) )
;		      then
;		        PostError("The First Hour Rating for residential water heater '%s' 
;		                   must be 150 or less.",Name)
;		      else if(  IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) .AND.
;		               (  IfValidAnd( FirstHrRating < 0 ) .OR.  IfValidAnd( FirstHrRating > 250 ) ) )
;		      then
;		        PostError("The First Hour Rating for residential water heater '%s' 
;		                   must be 250 or less.",Name)
;		      else UNCHANGED
;		      endif endif
;		    else if( ElementType = "Electric Resistance" )
;		    then
;		      if(  IfValidAnd( TankType = "Consumer Storage (UEF)" ) .AND.
;		          (  IfValidAnd( FirstHrRating < 0 ) .OR.  IfValidAnd( FirstHrRating > 100 ) ) )
;		      then
;		        PostError("The First Hour Rating for residential water heater '%s' 
;		                   must be 100 or less.",Name)
;		      else UNCHANGED
;		      endif
;		    else if( ElementType = "Heat Pump" .AND. IsUEFRtdSim = 1 )
;		    then
;		      if(  IfValidAnd( FirstHrRating < 0 ) .OR.  IfValidAnd( FirstHrRating > 100 ) )
;		      then
;		        PostError("The First Hour Rating for residential water heater '%s' 
;		                   must be 100 or less.",Name)
;		      else UNCHANGED
;		      endif
;		    else UNCHANGED
;		    endif endif endif
;	    endif
;	  endif
;  SIZING_PROPOSED
;    if( Proj:ResDHWBothBaseline )
;    then 
;      UNDEFINED
;    else if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWPropOnly )
;    then 
;      if ( IfValidAnd( IsUEFRtdSim = 1 ) )
;      then
;        u:FirstHrRating
;      else
;        UNDEFINED
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif  
;  SIZING_BASELINE
;    if( LocalStatus(TankVol) > 0 ) 
;    then
;      if( Proj:ResDHWUserAndBaseline )
;      then
;	      if ( CentralSys .AND. IfValidAnd( IsUEFRtdSim = 1 )  ) // 7-5-18 NK Added to pass UEF Water Heater on Central Systems - Revise later once Res rules are updated
;	      then
;	        u:FirstHrRating
;	      else
;	        UNDEFINED   
;	      endif   
;      else if ( Proj:ResDHWBothBaseline )
;      then
;        UNDEFINED
;      else if( Proj:ResDHWPropOnly )
;      then 
;        if (IfValidAnd( IsBaseSys > 0 ))
;        then UNDEFINED
;        else zp:FirstHrRating
;        endif        
;       else if( Proj:ResDHWNone )
;      then 
;        UNDEFINED
;      else 
;        UNDEFINED
;      endif endif endif endif
;    else
;      UNDEFINED
;    endif
;  ANNUAL_PROPOSED
;    z:FirstHrRating
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE ResWtrHtr:FlowRate
;  DESCRIPTION
;    "The residential water heater Uniform Energy Factor."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  MINIMUM
;    0 
;  MAXIMUM
;    20
;  REPORTPRECISION
;    2
;  DEFAULT
;    if( Proj:AutoEffInput = 1)
;    then
;      if( ElementType = "Gas" .AND. 
;          IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) )
;      then 8
;      else if( ElementType = "Electric Resistance" .AND. 
;               IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) )
;      then 2
;      else if( ElementType = "Electric Resistance" .AND. 
;               IfValidAnd( TankType = "Residential-Duty Commercial Instantaneous (UEF)" ) )
;      then 5
;      else 0
;      endif endif endif
;    else 
;      if( ElementType = "Gas" .AND. 
;          IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) )
;      then 8
;      else UNDEFINED
;      endif
;   endif
;  CHECKCODE           // FlowRate
;    if ( ExcludeWtrHtg )
;    then UNCHANGED
;    else
;	    if ( IsUEFRtdSim = 1 .AND. ( LocalStatus ( FlowRate ) < 1 ) .AND. IfValidAnd( FlowRtDisp = 1 ) )
;	    then
;	      PostError("Residential water heater '%s' requires a 
;	                Flow Rate input.",Name)
;	    else
;		    if( ElementType = "Gas" )
;		    then
;		      if( IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) .AND.
;		          ( IfValidAnd( FlowRate < 0 ) .OR. IfValidAnd( FlowRate > 20 ) ) )
;		      then
;		        PostWarning("The Flow Rate for residential water heater '%s' 
;		                   must be 20 or less.",Name)
;		      else UNCHANGED
;		      endif
;		    else if( ElementType = "Electric Resistance" )
;		    then
;		      if( IfValidAnd( TankType = "Consumer Instantaneous (UEF)" ) .AND.
;		          ( IfValidAnd( FlowRate < 0 ) .OR. IfValidAnd( FlowRate > 20 ) ) )
;		      then
;		        PostError("The Flow Rate for residential water heater '%s' 
;		                   must be 20 or less.",Name)
;		      else if( IfValidAnd( TankType = "Residential-Duty Commercial Instantaneous (UEF)" ) .AND.
;		               ( IfValidAnd( FlowRate < 0 ) .OR. IfValidAnd( FlowRate > 20 ) ) )
;		      then
;		        PostError("The Flow Rate for residential water heater '%s' 
;		                   must be 20 or less.",Name)
;		      else UNCHANGED
;		      endif endif
;		    else UNCHANGED
;		    endif endif
;	    endif
;	  endif
;  SIZING_PROPOSED
;    if( Proj:ResDHWBothBaseline )
;    then 
;      UNDEFINED
;    else if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWPropOnly )
;    then 
;      if ( IfValidAnd( IsUEFRtdSim = 1 ) )
;      then
;        u:FlowRate
;      else
;        UNDEFINED
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif    
;  SIZING_BASELINE
;    if( LocalStatus(TankVol) > 0 ) 
;    then
;      if( Proj:ResDHWUserAndBaseline )
;      then
;	      if ( CentralSys .AND. IfValidAnd( IsUEFRtdSim = 1 ) ) // 7-5-18 NK Added to pass UEF Water Heater on Central Systems - Revise later once Res rules are updated
;	      then
;	        u:FlowRate
;	      else
;	        UNDEFINED
;	      endif
;      else if ( Proj:ResDHWBothBaseline )
;      then
;        UNDEFINED
;      else if( Proj:ResDHWPropOnly )
;      then 
;        if (IfValidAnd( IsBaseSys > 0 ))
;        then UNDEFINED
;        else zp:FlowRate
;        endif                
;      else if( Proj:ResDHWNone )
;      then 
;        UNDEFINED
;      else 
;        UNDEFINED
;      endif endif endif endif
;    else
;      UNDEFINED
;    endif
;  ANNUAL_PROPOSED
;    z:FlowRate
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Residential Water Heater Exterior Tank Insulation --------------------
;// 
;RULE ResWtrHtr:TankExtInsR
;  DESCRIPTION
;    "The residential water heater's exterior insulation."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Optional
;  REPORTPRECISION
;    1
;  DEFAULT
;    if( (TankCat = "Boiler" .OR. TankCat = "Indirect") .AND. ElementType = "Gas" )
;    then 
;      12
;    else if( TankCat = "Commercial Packaged Boiler" .AND. ElementType = "Gas" )
;    then 
;       0
;    else
;     UNDEFINED  
;    endif endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 12
;    else 
;     if( IfValidAnd(ElementType = "Heat Pump") .AND. IfValidAnd(HtPumpWtrHtrNEEARtd = 1) )
;     then UNDEFINED
;     else 
;       if( (TankCat = "Boiler" .OR. TankCat = "Indirect" .OR. TankCat = "Commercial Packaged Boiler") .AND.
;           ElementType = "Gas" ) 
;       then 
;         u:TankExtInsR
;       else
;         UNDEFINED
;       endif
;    endif endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWBothBaseline )
;    then 
;      if ( IfValidAnd( TankIntInsR > 0 ) )
;      then zp:TankExtInsR
;      else 0
;      endif
;    else if( Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then 12
;      else zp:TankExtInsR
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif
;ENDRULE
;;  ANNUAL   - no need to use expression to execute what happens already by default - SAC 1/24/19
;;    z:TankExtInsR
;
;
;// -----------------------------------------------------------------------------
;// -------------- Residential Water Heater Interior Tank Insulation --------------------
;// 
;RULE ResWtrHtr:TankIntInsR
;  DESCRIPTION
;    "The residential water heater's interior insulation."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Optional
;  REPORTPRECISION
;    1
;  DEFAULT
;    if( (TankCat = "Boiler" .OR. TankCat = "Indirect") .AND. ElementType = "Gas" )
;    then 
;      0
;    else if( TankCat = "Commercial Packaged Boiler" .AND. ElementType = "Gas" )
;    then 
;      12
;    else
;     UNDEFINED  
;    endif endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 0
;        else 
;     if( IfValidAnd(ElementType = "Heat Pump") .AND. IfValidAnd(HtPumpWtrHtrNEEARtd = 1) )
;     then UNDEFINED
;     else 
;      if( (TankCat = "Boiler" .OR. TankCat = "Indirect" .OR. TankCat = "Commercial Packaged Boiler") .AND.
;          ElementType = "Gas" ) 
;      then 
;        u:TankIntInsR
;      else
;        UNDEFINED
;      endif
;    endif endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWBothBaseline )
;    then 
;      if ( IfValidAnd( TankIntInsR > 0 ) )
;      then zp:TankIntInsR
;      else 0
;      endif
;    else if( Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then 0
;      else zp:TankIntInsR
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif
;ENDRULE
;;  ANNUAL   - no need to use expression to execute what happens already by default - SAC 1/29/19
;;    z:TankIntInsR
;
;
;// -------------- Tank Insulation Report --------------------
;// 
;RULE ResWtrHtr:TankInsRpt
;  RULESETS
;    T24N
;  DESCRIPTION
;    "Reporting variable for Tank Insulation"
;  INPUTCLASS
;    NotInput
;  ANNUAL_PROPOSED
;    if ( ExcludeWtrHtg )
;    then UNDEFINED
;    else
;	    if( (TankCat = "Boiler" .OR. TankCat = "Indirect" .OR. TankCat = "Commercial Packaged Boiler") .AND.
;	        ElementType = "Gas" )
;	    then
;		      Format ( FltToStr( TankExtInsR , 1 ) ) + "/" + 
;		      Format ( FltToStr( TankIntInsR , 1 ) )
;	    else
;	      "NA"
;	    endif
;	  endif
;  ANNUAL_BASELINE
;    UNDEFINED
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;// -------------- Residential Water Heater Standby Loss Fraction --------------------
;// 
;RULE ResWtrHtr:StdbyLossFrac
;  DESCRIPTION
;    "The residential water heater's standby loss fraction or pilot energy
;     depending on Tank Category and Rated Capacity."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Optional
;  MINIMUM
;    0.0
;  MAXIMUM
;    10000
;  REPORTPRECISION
;    0
;  DEFAULT
;    if( IfValidAnd( TankType = "Boiler" ) .OR. IfValidAnd( TankType = "Indirect" ) )
;    then 750
;    else if( ElementType = "Gas" )
;    then
;      if( IfValidAnd( TankType = "Large Storage" ) .OR.
;        ( IfValidAnd( TankType = "Large Instantaneous" ) .AND. TankVol >= 10 ) )
;      then
;        round ( (InpRating/800 + 110*SQRT( TankVol )) / (8.25 * 70 * TankVol), 5 )
;      else UNDEFINED
;      endif
;    else if( ElementType = "Electric Resistance" )
;    then
;      if( IfValidAnd( TankType = "Large Storage" ) )
;      then
;       round ( ( 0.3 + 27/TankVol ) / 100, 5 )
;      else UNDEFINED
;      endif
;    else UNDEFINED
;    endif endif endif
;  CHECKCODE           // Standby Loss Fraction
;    if( ExcludeWtrHtg )
;    then UNCHANGED
;    else
;	    if(      PilotDisp = 0 
;	       .AND. SBLFDisp = 1
;	       .AND. StdbyLossFrac = 0 
;	       .AND. InpRating > 0 )
;	    then
;	      PostError("The standby loss fraction for residential water heater '%s' 
;	                 must be greater than 0.",Name)
;	    else UNCHANGED
;	    endif
;	  endif
;  SIZING_PROPOSED
;    if( Proj:ResDHWBothBaseline )
;    then 
;      if( CentralSys )  
;      then
;        if (IfValidAnd( IsBaseSys > 0 ))
;        then
;          0
;        else if( ElementType = "Gas" )
;        then
;          if( IfValidAnd( TankType = "Large Storage" ) .OR.
;            ( IfValidAnd( TankType = "Large Instantaneous" ) .AND. TankVol >= 10 ) )
;          then
;            round ( (InpRatingSim/800 + 110*SQRT( TankVol )) / (8.25 * 70 * TankVol), 5 )
;          else UNDEFINED
;          endif
;        else if( ElementType = "Electric Resistance" )
;        then
;          if( IfValidAnd( TankType = "Large Storage" ) )
;          then
;            round ( ( 0.3 + 27/TankVol ) / 100, 5 )
;          else UNDEFINED
;          endif
;        else UNDEFINED
;        endif endif endif
;      else
;        0
;      endif
;    else if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then
;        0
;      else zp:StdbyLossFrac
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // individual unit ResDHW or no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif
;  ANNUAL_PROPOSED
;     z:StdbyLossFrac
;ENDRULE
;
;//  ANNUAL_PROPOSED
;//    if( ElementType = "Gas" .AND. IfValidAnd( TankType = "Large Instantaneous" ) .AND. 
;//        IfValidAnd( TankVol >= 10 ) )
;//    then
;//      if( CentralSys )  
;//      then
;//        zp:StdbyLossFrac
;//      else
;//        zp:StdbyLossFrac * (8.25 * 70 * TankVol)  // Based on CBECC-Res using StandbyLossFrac for Standby Loss in this case      
;//      endif
;//    else
;//      zp:StdbyLossFrac
;//    endif   
;//  ANNUAL_BASELINE
;//    if( ElementType = "Gas" .AND. IfValidAnd( TankType = "Large Instantaneous" ) .AND. 
;//        IfValidAnd( TankVol >= 10 ) )
;//    then
;//      zb:StdbyLossFrac * (8.25 * 70 * TankVol)  // Based on CBECC-Res using StandbyLossFrac for Standby Loss in this case      
;//    else
;//      zb:StdbyLossFrac
;//    endif   
;
;
;// -----------------------------------------------------------------------------
;RULE ResDHWSys:SolFracFluidSysName
;  DESCRIPTION
;    "Name of the service hot water fluid system with a solar hot water collector."
;  REFERENCE 
;    ACM Section 5.2.1-General Information
;  INPUTCLASS 
;    Prescribed
;  DEFAULT
;    if( IfValidAnd(AnnualSolFrac > 0) )
;    then Name
;    else UNDEFINED
;    endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE ResDHWSys:SolFracRpt
;  DESCRIPTION
;    "Solar Fraction value from Fluid System Data Tab."
;  REFERENCE 
;    ACM Section 5.2.1-General Information
;  INPUTCLASS 
;    Prescribed
;  REPORTPRECISION
;    2
;  DEFAULT
;    AnnualSolFrac
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------------- Residential Water Heater Pilot Energy --------------------
;// 
;RULE ResWtrHtr:PilotEngy
;  DESCRIPTION
;    "The residential water heater's pilot energy."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput
;  PREVIOUSNAMES  PilotEnergy
;  MINIMUM
;    0
;  MAXIMUM
;    10000
;  REPORTPRECISION
;    0
;  DEFAULT
;    if( PilotDisp = 1 )
;    then 750
;    else 0
;    endif
;  SIZING_PROPOSED
;    if( Proj:ResDHWBothBaseline )
;    then 
;      0
;    else if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then
;        0
;      else
;        PilotEngy
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // individual unit ResDHW or no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWBothBaseline )
;    then 
;      0
;    else if( Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then
;        0
;      else
;        zp:PilotEngy
;      endif
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // individual unit ResDHW or no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif
;  ANNUAL_PROPOSED
;    z:PilotEngy
;ENDRULE
;
;
;
;// -----------------------------------------------------------------------------
;// ----------------- Efficiency for Report -------------------------------------
;; revised for commercial HPWH products - SAC 03/02/21
;RULE ResWtrHtr:EffRpt
;  RULESETS
;    T24N
;  INPUTCLASS
;    NotInput
;  ANNUAL_PROPOSED
;    if ( ExcludeWtrHtg )
;    then UNDEFINED
;    else
;	    if( IfValidAnd( IsUEFRtdSim = 1 ) ) then
;	      Format("UEF: %s", FltToStr( UEF, 3 ) )
;	    else if ( ElementType = "Heat Pump" .AND. IfValidAnd( HtPumpWtrHtrNEEARtd = 1 ) ) then
;	      "NEEA Rated"    
;	    else if ( ElementType = "Heat Pump" .AND. IfValidAnd( HPWHCommProd > 0 ) ) then
;	      "Commercial"    
;	    else if( TEDisp = 1 ) then
;	      Format("Thrml. Eff.: %s", FltToStr( ThrmlEff, 3 ) )
;	    else
;	      Format("EF: %s", FltToStr( EF, 3 ) )
;	    endif endif endif endif
;    endif
;  ANNUAL_BASELINE
;    UNDEFINED
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// ----------------- Standby Loss for Report -----------------------------------
;RULE ResWtrHtr:StdbyLossRpt
;  RULESETS
;    T24N
;  INPUTCLASS
;    NotInput
;  ANNUAL_PROPOSED
;    if ( ExcludeWtrHtg )
;    then UNDEFINED
;    else
;	    if( SBLFDisp = 1 )
;	    then
;		    if( ElementType = "Gas" .AND. IfValidAnd( TankType = "Large Instantaneous" ) .AND. 
;		        IfValidAnd( TankVol >= 10 ) )
;		    then
;		      FltToStr( ( StdbyLossFrac / (8.25 * 70 * TankVol) ), 4 )
;		    else
;	        FltToStr( StdbyLossFrac, 4 )
;		    endif   
;	    else
;	      "NA"
;	    endif
;	  endif
;  ANNUAL_BASELINE
;    UNDEFINED
;ENDRULE
;
;// -----------------------------------------------------------------------------
;// -------------- Total Water Heater Input Rating --------------------
;// 
;RULE ResWtrHtr:InpRatingRpt
;  DESCRIPTION
;    "The heating capacity of a water heater at the rated conditions specified
;     in DOE 10 CFR Part 430 or ANSI Z21.10."
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    NotInput
;  UNITS
;    kBtu/hr
;  REPORTPRECISION
;    0
;  DEFAULT
;    UNDEFINED
;  SIZING_PROPOSED
;    UNDEFINED
;  SIZING_BASELINE
;    UNDEFINED
;  ANNUAL_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED
;    else 
;      if ( ElementType = "Gas" )
;      then 
;        InpRating / 1000     //this div by 1000 is a conversion for reporting from Btu/h to kBtu/h
;      else if ( ElementType = "Electric Resistance" )
;      then 
;        InpRatingElec  / 1000
;      else if ( ElementType = "Heat Pump")
;      then 
;        InpRatingElec / 1000
;      else 
;        UNDEFINED
;      endif endif endif
;    endif
;  ANNUAL_BASELINE
;    UNDEFINED
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE ResWtrHtr:ElecMiniTank
;  DESCRIPTION
;    ""
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Optional
;  MINIMUM
;    0 
;  MAXIMUM
;    1 
;  DEFAULT
;    if( Proj:AutoHardSize = 1 .AND. TankCat = "Instantaneous")
;    then 0
;    else UNDEFINED
;    endif
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE ResWtrHtr:ElecMiniTankPwr
;  DESCRIPTION
;    ""
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Optional
;  UNITS
;    Watts  
;  DEFAULT
;    if ( ElecMiniTank = 1 )
;    then 100
;    else UNDEFINED
;    endif
;  SIZING_PROPOSED
;    if( ExcludeWtrHtg )
;    then 0
;    else u:ElecMiniTankPwr
;    endif
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline )
;    then 
;      if( CentralSys )  
;      then
;        if (IfValidAnd( IsBaseSys > 0 ))
;        then 0
;        else UNDEFINED // zp:ElecMiniTankPwr
;        endif
;      else 0
;      endif
;    else if( Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then 0
;      else
;        zp:ElecMiniTankPwr
;      endif
;    else if( Proj:ResDHWBothBaseline )
;    then 0
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // individual unit ResDHW or no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif endif
;  ANNUAL_PROPOSED
;    z:ElecMiniTankPwr
;ENDRULE
;
;// -----------------------------------------------------------------------------
;RULE ResWtrHtr:TankZn
;  DESCRIPTION
;    ""
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    Optional
;  DEFAULT
;    "Unconditioned"
;ENDRULE  // default updated from Cond to Uncond for Res consistency - SAC 8/27/18
;
;
;// -------------- Tank Location Report --------------------
;// 
;RULE ResWtrHtr:TankZnRpt
;  RULESETS
;    T24N
;  DESCRIPTION
;    "Reporting variable for Tank Location or Ambient Condition"
;  INPUTCLASS
;    NotInput
;  ANNUAL_PROPOSED
;    if( ExcludeWtrHtg )
;    then UNDEFINED
;    else 
;      if( ElementType = "Gas" .AND. TankCat = "Indirect") 
;      then AmbCond
;      else if( ElementType = "Heat Pump" )
;      then TankZn
;      else "NA"
;      endif endif
;    endif 
;  ANNUAL_BASELINE
;    UNDEFINED
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE ResWtrHtr:CprsrZn
;  DESCRIPTION
;    ""
;  REFERENCE 
;    Res ACM-2.10 Domestic Hot Water
;  INPUTCLASS
;    CondRequired
;  DEFAULT
;    if( ElementType = "Heat Pump" )
;    then
;      if ( IfValidAnd( HtPumpWtrHtrNEEARtd = 1 ) .AND. IfValidAnd( HPWHBrand = "Sanden" ) )
;      then "Conditioned"
;      else if (HtPumpWtrHtrNEEARtd > 0 .AND.
;               (IfValidAnd( CentralHPWHCprsrType = "Sanden" ) .OR.
;                IfValidAnd( CentralHPWHCprsrType = "Colmac CxA20" )))
;      then  "Unconditioned"
;      else UNDEFINED
;      endif endif
;    else UNDEFINED
;    endif 
;  SIZING_PROPOSED
;    if( Proj:ResDHWBothBaseline )
;    then 
;      UNDEFINED
;    else if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWPropOnly )
;    then 
;	    if( ElementType = "Heat Pump" )
;	    then
;	      if ( IfValidAnd( HtPumpWtrHtrNEEARtd = 1 ) .AND. 
;	            ( IfValidAnd( HPWHBrand = "Sanden" ) .OR.
;                 IfValidAnd( CentralHPWHCprsrType = "Sanden" ) .OR.
;                 IfValidAnd( CentralHPWHCprsrType = "Colmac CxA20" ) ) )
;	      then u:CprsrZn
;	      else UNDEFINED
;	      endif
;	    else UNDEFINED
;	    endif 
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED                                  // no DHW modeled
;    else 
;      UNDEFINED
;    endif endif endif    
;  SIZING_BASELINE
;    if( Proj:ResDHWUserAndBaseline .OR. Proj:ResDHWBothBaseline )
;    then
;      UNDEFINED
;    else if( Proj:ResDHWPropOnly )
;    then 
;      if (IfValidAnd( IsBaseSys > 0 ))
;      then UNDEFINED
;      else 
;		    if( ElementType = "Heat Pump" )
;		    then
;		      if ( IfValidAnd( HtPumpWtrHtrNEEARtd = 1 ) .AND.
;                  ( IfValidAnd( HPWHBrand = "Sanden" ) .OR.
;                    IfValidAnd( CentralHPWHCprsrType = "Sanden" ) .OR.
;                    IfValidAnd( CentralHPWHCprsrType = "Colmac CxA20" ) ) )
;		      then zp:CprsrZn
;		      else UNDEFINED
;		      endif
;		    else UNDEFINED
;		    endif 
;      endif                
;    else if( Proj:ResDHWNone )
;    then 
;      UNDEFINED
;    else 
;      UNDEFINED
;    endif endif endif
;ENDRULE
;
;
;// -----------------------------------------------------------------------------
;RULE NEW ResWtrHtr:CprsrZnDisp
;  DESCRIPTION
;    "Flag to indicate on the ResWtrHtr input screen that the input for
;     compressor zone location is to be displayed and editable."
;  DATATYPE
;    Integer
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( ScreenVal = 11 .AND. IfValidAnd( HPWHBrand = "Sanden" ) )
;    then 1
;    else 0
;    endif
;ENDRULE
;
;
;// ----------------------------------------------------------------------------- SAC 1/30/20 - StdSolarSys (tic #3157)
;// -----   DHWSolarSys   -------------------------------------------------------
;// -----------------------------------------------------------------------------
;      // rules based on Res: RULELIST "Default_DHWSolarSys" 0 0 0 0
;
;      ; allow conditional enumerations to handle Manufac/Brand/Model
;      ;     DHWSolarSys:Manufacturer
;      ;     DHWSolarSys:Brand
;      ;     DHWSolarSys:Model
;; added RULEs for Brand & Model to facilitate RESETS - SAC 08/26/21
;RULE DHWSolarSys:Brand 
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      Manufacturer
;ENDRULE
;RULE DHWSolarSys:Model 
;  RESETS
;    ResetThisWhenTheFollowingIsModified
;      Brand
;ENDRULE
;
;RULE DHWSolarSys:CertID 
;  DESCRIPTION
;    "SRCC/IAPMO certificate ID"
;  DEFAULT
;         if (Manufacturer != "- specify -" .AND. Brand != "- specify -" .AND. Model != "- specify -") 
;         then  SolarThermalCollectors:SRCC_IAPMOnumber( "Manufacturer", Manufacturer,
;                       "BrandName", Brand, "ModelNumber", Model )
;         else  UNDEFINED  endif
;ENDRULE
;
;RULE DHWSolarSys:Cnt
;  DESCRIPTION
;    "Number of solar collector panels"
;  DEFAULT
;   1
;ENDRULE
;
;RULE DHWSolarSys:CntFlt  
;  DESCRIPTION
;    "Number of solar collector panels (float)"
;  DEFAULT
;    UNDEFINED
;ENDRULE
;      ;   if (IfValidAnd( Proj:EnableResearchMode > 0 ))
;      ;   then  if (LocalStatus( Count ) > 5) then  Count
;      ;         else  1  endif
;      ;   else  UNDEFINED  endif
;
;RULE DHWSolarSys:Area 
;  DESCRIPTION
;    "Solar collector panel area"
;  DEFAULT
;         if (Manufacturer != "- specify -" .AND. Brand != "- specify -" .AND. Model != "- specify -") 
;         then  SolarThermalCollectors:Area( "Manufacturer", Manufacturer,
;                       "BrandName", Brand, "ModelNumber", Model ) * 10.7639
;         else  UNDEFINED  endif
;ENDRULE
;
;RULE DHWSolarSys:EffCurveYInt 
;  DESCRIPTION
;    "Solar collector panel efficiency curve Y-intercept"
;  DEFAULT
;         if (Manufacturer != "- specify -" .AND. Brand != "- specify -" .AND. Model != "- specify -") 
;         then  SolarThermalCollectors:YIntercept( "Manufacturer", Manufacturer,
;                       "BrandName", Brand, "ModelNumber", Model )
;         else  UNDEFINED  endif
;ENDRULE
;
;RULE DHWSolarSys:EffCurveSlope 
;  DESCRIPTION
;    "Solar collector panel efficiency curve slope"
;  DEFAULT
;         if (Manufacturer != "- specify -" .AND. Brand != "- specify -" .AND. Model != "- specify -") 
;         then  SolarThermalCollectors:Slope( "Manufacturer", Manufacturer,
;                       "BrandName", Brand, "ModelNumber", Model )
;         else  UNDEFINED  endif
;ENDRULE
;
;RULE DHWSolarSys:TankVol
;  DESCRIPTION
;    "Solar system tank volume"
;  DEFAULT
;    if (IfValidAnd( Area > 0 ) .AND. IfValidAnd( Cnt > 0 ))
;    then  int( (1.5 * Area * Cnt)+0.5 )
;    else  UNDEFINED  endif
;ENDRULE
;
;      ; no defaults
;      ;     DHWSolarSys:Azimuth
;      ;     DHWSolarSys:Tilt
;
;; SAC 2/6/20 - added TankVol default (above) & restored TankVol check
;RULE DHWSolarSys:ErrID 
;  DESCRIPTION
;    "Error ID"
;  DEFAULT
;         if (IfValidAnd(      Azimuth >= 0 )==0) then  2
;         else if (IfValidAnd( Tilt    >= 0 )==0) then  3
;         else if ( Manufacturer = "- specify -") then  4
;         else if ( Brand        = "- specify -") then  5
;         else if ( Model        = "- specify -") then  6
;         else if (IfValidAnd( TankVol >= 0 )==0) then  1
;         else if (LocalStatus( CertID ) > 0 .AND. IfValidAnd( Area > 0 ) .AND.
;                  LocalStatus( EffCurveYInt ) > 0 .AND. LocalStatus( EffCurveSlope ) > 0) then  0
;         else  7  endif endif endif endif endif endif endif
;ENDRULE
;
;RULE DHWSolarSys:ErrMsg
;  DESCRIPTION
;    "Error message"
;  DEFAULT
;         switch (ErrID)
;            case  1 :  "TankVolume must be entered (>=0)"
;            case  2 :  "Azimuth must be entered (>=0)"
;            case  3 :  "Tilt must be entered (>=0)"
;            case  4 :  "Collector Manufacturer must be specified"
;            case  5 :  "Collector Brand must be specified"
;            case  6 :  "Collector Model must be specified"
;            case  7 :  "Error retrieving collector data from lookup table"
;            default :  UNDEFINED
;         endswitch 
;ENDRULE
;
;RULE DHWSolarSys:FloorAreaServed
;  DESCRIPTION
;    "Floor area served by this DHWSolarSys (via ResDHWSys assignments)"
;  DEFAULT
;    SumRevRef( ResDHWSys:DHWSolarSysRef, ResDHWSys:SysFlrArea )
;ENDRULE

;RULE NEW ResDHWSys:IsDHWSolarSysIncl
;  LONGFORM
;    IsDomesticHotWaterSolarSystemIncluded
;  DATATYPE
;    Integer
;  DESCRIPTION
;    ""
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if( IfValidAnd( FloorAreaServed[1] > 0 ) .AND. IfValidAnd( DHWSolarSysRef:ErrId = 0 ) )
;    then 1
;    else 0
;    endif
;ENDRULE

; RES DHW REMOVAL
;; SAC 2/24/20 - copied logic from 'Refresh_DHWSolarSys_ServedAreaDUsBRs' to enable Proposed model reporting
;RULE DHWSolarSys:DwellUnitsServed
;  DESCRIPTION
;    "Number of high-rise res dwelling units served by this DHWSolarSys (via ResDHWSys assignments)"
;  DEFAULT
;    SumRevRef( ResDHWSys:DHWSolarSysRef, ResDHWSys:NumHRRDUsServed )
;ENDRULE
;
;RULE DHWSolarSys:BedroomsServed
;  DESCRIPTION
;    "Number of high-rise res dwelling unit bedrooms served by this DHWSolarSys (via ResDHWSys assignments)"
;  DEFAULT
;    SumRevRef( ResDHWSys:DHWSolarSysRef, ResDHWSys:NumHRRBedroomsServed )
;ENDRULE
;
;; added to facilitate solar sys sizing for hotel/motel guest rooms - SAC 05/04/21
;RULE DHWSolarSys:GuestRoomsServed
;  DESCRIPTION
;    "Number of hotel/motel guest rooms served by this DHWSolarSys (via ResDHWSys assignments)"
;  DEFAULT
;    SumRevRef( ResDHWSys:DHWSolarSysRef, ResDHWSys:NumHtlMtlUnitsServed )
;ENDRULE
;
;// -----   end of:  DHWSolarSys   ----------------------------------------------
;// -----------------------------------------------------------------------------


// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
// +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
// -------- Added to facilitate CSE DHW system inputs -----------
//  SAC 5/26/16
RULE NEW Spc:ResDHWFlrHgtArea
  DATATYPE
    Float
  LONGFORM
    ResDHWFlrHgtArea
  DESCRIPTION
    "Flr area used to calculate average floor height for ResDHWSys."
  INPUTCLASS
    NotInput
  DEFAULT
    if (IfValidAnd( HaveResDHW > 0.5 ))
    then  DwellingUnitSpcTotAreaWithMult
    else  0
    endif
ENDRULE

RULE NEW Spc:ResDHWFlrHgtAreaXHgt
  DATATYPE
    Float
  LONGFORM
    ResDHWFlrHgtAreaXHgt
  DESCRIPTION
    "Flr area x ceiling height used to calculate average floor height for ResDHWSys."
  INPUTCLASS
    NotInput
  DEFAULT
    if (IfValidAnd( HaveResDHW > 0.5 ))
    then  DwellingUnitSpcTotAreaWithMult * FlrToCeilingHgt
    else  0
    endif
ENDRULE

; RES DHW REMOVAL
;RULE NEW ResDHWSys:AvgFlrHgt
;  DATATYPE
;    Float
;  LONGFORM
;    AverageFloorHeight
;  DESCRIPTION
;    "Average (flr area-weighted) floor height for across all served spaces."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (SumRevRef( Spc:ResDHWSysRef, Spc:ResDHWFlrHgtArea ) > 1)
;    then  SumRevRef( Spc:ResDHWSysRef, Spc:ResDHWFlrHgtAreaXHgt ) /
;          SumRevRef( Spc:ResDHWSysRef, Spc:ResDHWFlrHgtArea )
;    else  0
;    endif
;ENDRULE
;
;RULE NEW ResDHWSys:HWSupplyTemp
;  DATATYPE
;    Float
;  LONGFORM
;    HotWaterSupplyTemperature
;  DESCRIPTION
;    "Temperature of water supplied to the fixture."
;  INPUTCLASS
;    NotInput
;  UNITS
;    F
;ENDRULE
;
;RULE NEW ResDHWSys:HWDeltaTemp
;  DATATYPE
;    Float
;  LONGFORM
;    HotWaterDeltaTemperature
;  DESCRIPTION
;    "Temperature drop from heater to fixture."
;  INPUTCLASS
;    NotInput
;  UNITS
;    F
;ENDRULE
;
;RULE NEW ResDHWSys:DistribSysMult
;  DATATYPE
;    Float
;  LONGFORM
;    DistributionSystemMultiplier
;  DESCRIPTION
;    "Multiplier used to adjust HW distribution losses."
;  INPUTCLASS
;    NotInput
;ENDRULE
;
;RULE NEW ResWtrHtr:ElementTypeNum
;  DATATYPE
;    Integer
;  LONGFORM
;    ElementTypeNumber
;  DESCRIPTION
;    "Map back to CBECC-Res HeaterElementType."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    switch ( ElementType )
;      case  "Electric Resistance" :	 0
;      case  "Gas"                 :  1
;      case  "Heat Pump"           :  if (Proj:CSE_DHWUseMthd == "New (via wsDayUse)")
;                                     then  5
;                                     else  3
;                                     endif
;      default :  -1
;    endswitch
;  SIZING
;    switch ( ElementType )
;      case  "Electric Resistance" :	 0
;      case  "Gas"                 :  1
;      case  "Heat Pump"           :  if (Proj:CSE_DHWUseMthd == "New (via wsDayUse)")
;                                     then  5
;                                     else  3
;                                     endif
;      default :  -1
;    endswitch
;  ANNUAL
;    switch ( ElementType )
;      case  "Electric Resistance" :	 0
;      case  "Gas"                 :  1
;      case  "Heat Pump"           :  if (Proj:CSE_DHWUseMthd == "New (via wsDayUse)")
;                                     then  5
;                                     else  3
;                                     endif
;      default :  -1
;    endswitch
;ENDRULE
;
;RULE NEW ResWtrHtr:CSE_SimulateTank
;  DATATYPE
;    Integer
;  LONGFORM
;    CSE_SimulateTank
;  DESCRIPTION
;    "Flag indicating that heater tank is of a type that requires simulation."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (IfValidAnd( TankType = "Large Storage" ) .OR.
;        IfValidAnd( TankType = "Small Storage" ) .OR.
;        IfValidAnd( TankType = "Small Instantaneous"           ) .OR.
;        IfValidAnd( TankType = "Consumer Instantaneous (UEF)"  ) .OR.
;        IfValidAnd( TankType = "Consumer Storage (UEF)"        ) .OR.
;        IfValidAnd( TankType = "Commercial Storage (TE & SBL)" ) .OR.
;        IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) .OR.
;        IfValidAnd( TankType = "Residential-Duty Commercial Instantaneous (UEF)" ) .OR.
;        ( IfValidAnd( TankVolume > 0.001 )==0 .AND.
;          IfValidAnd( TankType = "Indirect" )==0 ))
;    then  0
;    else  1
;    endif
;  SIZING
;    if (IfValidAnd( TankType = "Large Storage" ) .OR.
;        IfValidAnd( TankType = "Small Storage" ) .OR.
;        IfValidAnd( TankType = "Small Instantaneous"           ) .OR.
;        IfValidAnd( TankType = "Consumer Instantaneous (UEF)"  ) .OR.
;        IfValidAnd( TankType = "Consumer Storage (UEF)"        ) .OR.
;        IfValidAnd( TankType = "Commercial Storage (TE & SBL)" ) .OR.
;        IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) .OR.
;        IfValidAnd( TankType = "Residential-Duty Commercial Instantaneous (UEF)" ) .OR.
;        ( IfValidAnd( TankVolume > 0.001 )==0 .AND.
;          IfValidAnd( TankType = "Indirect" )==0 ))
;    then  0
;    else  1
;    endif
;  ANNUAL
;    if (IfValidAnd( TankType = "Large Storage" ) .OR.
;        IfValidAnd( TankType = "Small Storage" ) .OR.
;        IfValidAnd( TankType = "Small Instantaneous"           ) .OR.
;        IfValidAnd( TankType = "Consumer Instantaneous (UEF)"  ) .OR.
;        IfValidAnd( TankType = "Consumer Storage (UEF)"        ) .OR.
;        IfValidAnd( TankType = "Commercial Storage (TE & SBL)" ) .OR.
;        IfValidAnd( TankType = "Residential-Duty Commercial Storage (UEF)" ) .OR.
;        IfValidAnd( TankType = "Residential-Duty Commercial Instantaneous (UEF)" ) .OR.
;        ( IfValidAnd( TankVolume > 0.001 )==0 .AND.
;          IfValidAnd( TankType = "Indirect" )==0 ))
;    then  0
;    else  1
;    endif
;ENDRULE
;


// ----------------------------------------------------------------------------- - SAC 8/9/18
// ---------- Added to enable port of Baseline DHW Rules from Res ruleset ------

RULE NEW Proj:SimulateResStdDHW
  DATATYPE
    Integer
  DESCRIPTION
    "Flag indicating that project being setup for simulation of Baseline DHW."
  INPUTCLASS
    NotInput
  DEFAULT
    0
ENDRULE

; RES DHW REMOVAL
;RULE NEW ResDHWSys:HeatersAllElec
;  DATATYPE
;    Integer
;  DESCRIPTION
;    "Flag indicating that all child ResWtrHtrs are Elec Res or HPWH."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (SumChildren(   ResWtrHtr:Cnt ) < 1 .OR.
;        SumChildrenIf( ResWtrHtr:Cnt, ResWtrHtr:ElementType = "Gas" ) > 0)
;    then  0
;    else  1
;    endif
;  SIZING
;    if (SumChildren(   ResWtrHtr:Cnt ) < 1 .OR.
;        SumChildrenIf( ResWtrHtr:Cnt, ResWtrHtr:ElementType = "Gas" ) > 0)
;    then  0
;    else  1
;    endif
;ENDRULE
;
;; SAC 1/24/19 - added to facilitate small central HPWH std design sizing (HPWHSIZE)
;RULE NEW ResDHWSys:NumGasHtrs
;  DATATYPE
;    Integer
;  DESCRIPTION
;    "Flag indicating whether any child ResWtrHtrs are Fuel powered."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    SumChildrenIf( ResWtrHtr:Cnt, ResWtrHtr:ElementType = "Gas" )
;  SIZING
;    SumChildrenIf( ResWtrHtr:Cnt, ResWtrHtr:ElementType = "Gas" )
;ENDRULE
;
;; SAC 8/20/18 - add same restriction as that specified in CBECC-Res
;; SAC 1/28/19 - revised restriction to allow for small central no-recirc HPWHs
;; SAC 1/12/20 - remove restrictions on central DHW systems w/ elec heaters (Com tic #3156)
;;RULE ResDHWSys:DistType
;;  CHECKCODE        
;;    if( IfValidAnd(CentralSys = 1) .AND. IfValidAnd( WtrHtrCnt > NumGasHtrs ) .AND.
;;        IfValidAnd( Status = "Existing" )==0 )
;;    then
;;      if (IfValidAnd( NumDUsServed > 8 ))
;;      then   
;;        PostError("Central residential DHW system '%s' includes one or more electric
;;             heaters and must therfore not serve more than 8 dwelling units. Larger
;;             DHW systems with electric heaters cannot be analyzed for compliance at
;;             this time.", Name)
;;      else if (IfValidAnd( DistType = "No loops or central system pump" )==0)
;;      then
;;        PostError("Central residential DHW system '%s' includes one or more electric
;;             heaters and must therfore be set to a central distribution type of 'No
;;             loops or central system pump'. Central DHW systems with electric heaters
;;             and recirculation cannot be analyzed for compliance at this time.", Name)
;;      else
;;        UNCHANGED
;;      endif endif
;;    else
;;      UNCHANGED
;;    endif
;;ENDRULE
;
;; SAC 08/27/21
;RULE NEW ResDHWSys:IsAssignedCentralNoRecircElec
;  DATATYPE
;    Float
;  LONGFORM
;    IsAssignedCentralNoRecircElec
;  DESCRIPTION
;    "This system is assigned to DUs and is a central, no recirculation, all electric."
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (IfValidAnd( CentralRecircType = "Central, no Recirculation" ) .AND.
;        IfValidAnd( CentralElecDHW > 0 ) .AND. IfValidAnd( NumDUsServed > 0 ) .AND.
;        IfValidAnd( Status = "Existing" )==0)
;    then  1
;    else  UNDEFINED  endif
;ENDRULE
;
;RULE Proj:Action
;  CHECKCODE
;    if (AnalysisType == "Title24Compliance" .AND.
;        SumAll( ResDHWSys:IsAssignedCentralNoRecircElec ) > 1)
;    then  PostError( "There can only be one central, all-electric, non-recirculation
;               residential DHW system in this model (%g defined in this model).",
;               SumAll( ResDHWSys:IsAssignedCentralNoRecircElec ) )
;    else  UNCHANGED  endif
;ENDRULE

RULE NEW Proj:ResDHWBaselineRulelistName
  DATATYPE
    String
  DESCRIPTION
    "Name of Res DHW Baseline rulelist to evaluate prior to simulation."
  INPUTCLASS
    NotInput
  DEFAULT
    UNDEFINED
  SIZING_PROPOSED
    if (ComponentCount( ResDHWSys ) < 1 .OR.
        SumAll( ResDHWSys:FloorAreaServed ) < 1)
    then  UNDEFINED
    else if (ResDHWUserAndBaseline .OR. ResDHWPropOnly)
    then  UNDEFINED
    else if (ResDHWBothBaseline .AND. SumAll( Bldg:ResFlrArea ) > 0)
    then  "BudgetConversion_ResDHW"
    else  UNDEFINED
    endif endif endif
  SIZING_BASELINE
    if (ComponentCount( ResDHWSys ) < 1 .OR.
        SumAll( ResDHWSys:FloorAreaServed ) < 1)
    then  UNDEFINED
    else if (ResDHWPropOnly)
    then  UNDEFINED
    else if (ResDHWUserAndBaseline)
    then  "BudgetConversion_ResDHW"
    else if (ResDHWBothBaseline .AND. SumAll( Bldg:ResFlrArea ) > 0)
    then  UNDEFINED
  ;  else if (Proj:ResDHWBothBaseline)
  ;  then  "BudgetConversion_ResDHW"
    else  UNDEFINED
    endif endif endif endif
ENDRULE

RULE NEW Spc:NewDwellingUnitSpcTotAreaWithMult
  DATATYPE
    Float
  LONGFORM
    NewDwellingUnitSpaceTotalAreaWithMultiplier
  DESCRIPTION
    "The total 'New' floor area of all dwelling units including multipliers"
  INPUTCLASS
    NotInput
  UNITS 
    ft2
  DEFAULT
    if (OverallStatus = "New")
    then  DwellingUnitSpcTotAreaWithMult
    else  0
    endif
ENDRULE

RULE NEW Spc:NewOrAltDwellingUnitSpcTotAreaWithMult
  DATATYPE
    Float
  LONGFORM
    NewOrAlteredDwellingUnitSpaceTotalAreaWithMultiplier
  DESCRIPTION
    "The total 'New' or 'Altered' floor area of all dwelling units including multipliers"
  INPUTCLASS
    NotInput
  UNITS 
    ft2
  DEFAULT
    if (OverallStatus = "New" .OR.
        OverallStatus = "Altered")
    then  DwellingUnitSpcTotAreaWithMult
    else  0
    endif
ENDRULE

; ---------------------------- added to ensure analysis aware of ResDHW sim needed even when no res dwelling units exist (hotel/motel) - SAC 03/07/22
RULE NEW Proj:SimResDHW
  DATATYPE
    Integer
  LONGFORM
    NewOrAlteredDwellingUnitSpaceTotalAreaWithMultiplier
  DESCRIPTION
    "flag indicating ResDHW sim needed (even if no res dwelling units exist)"
  INPUTCLASS
    NotInput
  DEFAULT
    if (SimMFamUnits > 0 .OR. SumAll( ResDHWSys:FloorAreaServed[1] ) > 1)
    then  1  else  0  endif
  ANNUAL
    if (SimMFamUnits > 0 .OR. SumAll( ResDHWSys:FloorAreaServed[1] ) > 1)
    then  1  else  0  endif
ENDRULE

; RES DHW REMOVAL
;RULE NEW ResDHWSys:NewOrAltServedArea
;  DATATYPE
;    Float
;  DESCRIPTION
;    "New or altered floor area assigning this ResDHWSys."
;  INPUTCLASS
;    NotInput
;  UNITS 
;    ft2
;  DEFAULT
;    SumRevRef(Spc:ResDHWSysRef, Spc:NewOrAltDwellingUnitSpcTotAreaWithMult)
;ENDRULE
;
;RULE NEW ResDHWSys:NewCntrlAreaServed
;  DATATYPE
;    Float
;  DESCRIPTION
;    "New floor area assigning this Central ResDHWSys."
;  INPUTCLASS
;    NotInput
;  UNITS 
;    ft2
;  DEFAULT
;    if (IfValidAnd( CentralSys > 0 ))
;    then  SumRevRef(Spc:ResDHWSysRef, Spc:NewDwellingUnitSpcTotAreaWithMult)
;    else  0
;    endif
;ENDRULE
;
;RULE NEW ResWtrHtr:ForceStdDesign
;  DATATYPE
;    Integer
;  DESCRIPTION
;    "Flag indicating systems that are to be transformed into baseline design"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    0
;ENDRULE
;
;RULE NEW ResWtrHtr:HeaterElementTypeIdx
;  DATATYPE
;    Integer
;  DESCRIPTION
;    "# consistent w/ Res ruleset enum values for HeaterElementType"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    switch (ElementType)
;      case "Electric Resistance" : 0
;      case "Gas"                 : 1
;      case "Heat Pump"           : 5
;      default : -1
;    endswitch
;ENDRULE
;
;RULE NEW ResWtrHtr:IsUEF
;  DATATYPE
;    Integer
;  DESCRIPTION
;    "flag indicating whether or not wtr htr is UEF-rated"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (ElementType = "Heat Pump" .AND.
;//        IfValidAnd( IsUEFRtd > 0 ))
;          IfValidAnd( IsUEFRtdSim > 0 ))
;    then  1
;    else switch (TankType)
;           case "Consumer Instantaneous (UEF)"                    :   1    ; 10 
;           case "Consumer Storage (UEF)"                          :   1    ; 12 
;           case "Residential-Duty Commercial Storage (UEF)"       :   1    ; 14 
;           case "Residential-Duty Commercial Instantaneous (UEF)" :   1    ; 15 
;           default :   0	
;         endswitch  endif
;ENDRULE
;
;RULE NEW ResDHWSys:IsStdDesignElec
;  DATATYPE
;    Integer
;  DESCRIPTION
;    "flag indicating whether or not ResDHWSys std design is elec"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    0
;ENDRULE
;
;
;RULE NEW ResWtrHtr:UserTankZn
;  DATATYPE
;    Integer
;  DESCRIPTION
;    "flag to retain user-specified ResWtrHtr:TankZn for baseline model"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (IfValidAnd( Cnt > 0 )==0 .OR. LocalStatus( TankZn ) < 7 .OR.
;        (IfValidAnd( ElementType = "Electric Resistance" )==0 .AND.
;         IfValidAnd( ElementType = "Heat Pump" )==0) .OR.
;        IfValidAnd( TankZnDisp > 0 )==0)
;    then  0
;    else  switch (TankZn)
;            case  "Unconditioned"                 : 1
;            case  "Conditioned"                   : 2
;            case  "Outside or in Exterior Closet" : 3
;            default : 0
;          endswitch
;    endif
;ENDRULE
;
;RULE NEW ResDHWSys:MaxUserElecHtrTankZn
;  DATATYPE
;    Integer
;  DESCRIPTION
;    "flag to retain user-specified ResWtrHtr:TankZn for baseline model"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    MaxChild( ResWtrHtr:UserTankZn )
;ENDRULE

; RES DHW REMOVAL
;RULE NEW Spc:MaxUserElecHtrTankZn
;  DATATYPE
;    Integer
;  DESCRIPTION
;    "flag to retain user-specified ResWtrHtr:TankZn for baseline model"
;  INPUTCLASS
;    NotInput
;  DEFAULT
;    if (LocalCompAssigned( ResDHWSysRef ))
;    then  ResDHWSysRef:MaxUserElecHtrTankZn
;    else  0
;    endif
;ENDRULE


// ----------------------------------------------------------------------------- SAC 09/03/20 (tic #3218)
// -------------- Central Electric DHW Solar Thermal PV Credit -----------------
// 
; RES DHW REMOVAL
; added logic to prevent TakeCentralElecDHWSolPVCred (& post Warning) unless project's CompType = New and includes DHW - SAC 09/22/20 (tic #3218)
; restore rule and har-wire to 0 for 2022+ (all) analysis
RULE Proj:AllowCentralElecDHWSolPVCred
  DESCRIPTION
    "whether Central Electric DHW Solar PV Credit is an option for this project"
  INPUTCLASS
    NotInput
  CHECKCODE
    if (IfValidAnd( EngyCodeYearNum >= 2022 )==0  .AND.
        IfValidAnd( TakeCentralElecDHWSolPVCred > 0.1 ))
    then  PostError( "Rules governing TakeCentralElecDHWSolPVCred not compatible w/ 2019 & prior analysis." )
    else  UNCHANGED  endif 
  DEFAULT
    0
ENDRULE
; old DEFAULT logic -
;    if (SumAll( ResDHWSys:CentralElecDHW    ) > 0 .AND.
;        SumAll( ResDHWSys:CentralNonElecDHW ) < 1 .AND.
;        SumAcrossIf( DHWSolarSys:FloorAreaServed, DHWSolarSys:ErrID = 0 ) < 1 .AND.
;        CompOptNew .AND. CompOptDHW)
;    then  1  else  0  endif

; switch optional inputs re: ElecDHWSolPVCred from Optional to Prescribed - SAC 06/05/22
RULE Proj:TakeCentralElecDHWSolPVCred
  DESCRIPTION
    "Whether this project will take the Central Electric DHW Solar PV compliance credit"
  INPUTCLASS
    Prescribed
  CHECKCODE
    if (AllowCentralElecDHWSolPVCred < 0.1 .OR.
        TakeCentralElecDHWSolPVCred < 0.1 .OR.
        IfValidAnd( CentralElecDHWSolPVCredPct > 0.1 )==0) then  UNCHANGED
    else if (CompOptNew < 0.1) 
    then  PostWarning( "Solar Thermal Flexibility Credit being ignored. Only valid for Analysis Scope of 'New'." )
    else if (CompOptDHW < 0.1) 
    then  PostWarning( "Solar Thermal Flexibility Credit being ignored. Only valid when DHW included in Analysis Scope." )
    else  UNCHANGED  endif endif endif
  DEFAULT
    0
ENDRULE
;  INPUTCLASS
;    Optional

RULE Proj:CentralElecDHWSolPVCredPct
  DESCRIPTION
    "Percent of standard design solar thermal TDV impact to be applied as the Central Electric DHW Solar PV compliance credit"
  INPUTCLASS
    Prescribed
  MINIMUM
    0
  MAXIMUM
    100
  DEFAULT
    if (AllowCentralElecDHWSolPVCred .AND. TakeCentralElecDHWSolPVCred)
    then  100  else  UNDEFINED  endif
ENDRULE
;  INPUTCLASS
;    Optional

RULE Proj:UseCentralElecDHWSolPVCredPct
  DESCRIPTION
    "Percent of standard design solar thermal TDV impact to be applied as the Central Electric DHW Solar PV compliance credit"
  INPUTCLASS
    NotInput
  DEFAULT
    if (AllowCentralElecDHWSolPVCred .AND. TakeCentralElecDHWSolPVCred .AND.
        IfValidAnd( CentralElecDHWSolPVCredPct > 0 ))
    then  CentralElecDHWSolPVCredPct  else  0  endif
  SIZING
    0
  ANNUAL_PROPOSED
    0
  ANNUAL_BASELINE 
    u:UseCentralElecDHWSolPVCredPct
ENDRULE


