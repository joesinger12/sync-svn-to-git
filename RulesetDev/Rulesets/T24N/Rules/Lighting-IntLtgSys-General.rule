// Interior Lighting - General Information
//
// -------------------------------------------------------------------------
//  Copyright (c ) 2012, California Energy Commission
//  All rights reserved.
//  Redistribution and use in source and binary forms, with or without
//  modification, are permitted provided that the following conditions are
//  met:
// 
//    * Redistributions of source code must retain the above copyright
//  notice, this list of conditions and the following disclaimer.
//    * Redistributions in binary form must reproduce the above copyright
//  notice, this list of conditions and the following disclaimer in
//  the documentation and/or other materials provided with the
//  distribution.
//    * Neither the name of the California Energy Commission nor the names of its
//  contributors may be used to endorse or promote products
//  derived from this software without specific prior written
//  permission.
//
//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
//  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
//  TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
//  PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL CALIFORNIA ENERGY COMMISSION
//  BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
//  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
//  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
//  BUSINESS INTERRUPTION ) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
//  WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
//  OTHERWISE ) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN if
//  ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
// -------------------------------------------------------------------------


// ********** Luminaire Props *************************************************
RULE Lum:Pwr
  DESCRIPTION
    "Luminaire power in Watts." 
  INPUTCLASS
    Compulsory  
  UNITS 
    W
  MINIMUM 
    0
  REPORTPRECISION
    0
  DEFAULT
    0
ENDRULE
RULE Lum:FxtrType
  DESCRIPTION
    "The Luminaire's fixture type." 
  INPUTCLASS
    Required 
  OPTION
    RecessedWithLens    
    RecessedOrDownlight
    NotInCeiling
  DEFAULT
    "RecessedOrDownlight"
ENDRULE
RULE Lum:LampType
  DESCRIPTION
    "The lamp type utilized in the luminaire." 
  INPUTCLASS
    Required 
  OPTION
   LinearFluorescent
   CFL
   Incandescent
   LED
   MetalHalide
   MercuryVapor
   HighPressureSodium
  DEFAULT
    "LED"
  CHECKCODE
    if( FxtrType = "RecessedWithLens" .AND. LampType != "LinearFluorescent" )
    then PostError( "Luminaire '%s' is '%s' '%s'. This combination of fixture type and lamp type is not supported", name, FxtrType, LampType )
    else if( FxtrType = "RecessedOrDownlight" .AND. ( LampType = "MercuryVapor" .OR. LampType = "HighPressureSodium") )
    then PostError( "Luminaire '%s' is '%s' '%s'. This combination of fixture type and lamp type is not supported", name, FxtrType, LampType )
    else UNCHANGED
    endif endif
ENDRULE

// ********** InteriorLightingSystem Props *************************************************
// ParentComponentType set to property of local component, for screen rules
RULE IntLtgSys:ParentComp
  DESCRIPTION
    "ComponentType of Parent; used for screen edit rules and conditional enums."
  DEFAULT
    if( ParentComponentType() = "Spc" )
    then "Spc"
    else if( ParentComponentType() = "ResOtherZn" )
    then "ResOtherZn"
    else ParentComponentType()
    endif endif
ENDRULE
// ********** Manage Luminaire References *************************************
// TO DO - Add Rules for Luminaire[1-5]

RULE NEW IntLtgSys:LumRefPresent1
   DATATYPE
     Integer
   LONGFORM
     LuminaireReferencePresent1
   DESCRIPTION
     "Whether or not first luminaire is assigned." 
   INPUTCLASS
     NotInput
   DEFAULT
      if ( LocalCompAssigned( LumRef[1] )) then  1  else  0  endif
ENDRULE
RULE NEW IntLtgSys:LumRefPresent2
   DATATYPE
     Integer
   LONGFORM
     LuminaireReferencePresent2
   DESCRIPTION
     "Whether or not second luminaire is assigned."  
   INPUTCLASS
     NotInput
   DEFAULT
      if ( LocalCompAssigned( LumRef[2] )) then  1  else  0  endif
ENDRULE
RULE NEW IntLtgSys:LumRefPresent3
   DATATYPE
     Integer
   LONGFORM
     LuminaireReferencePresent3
   DESCRIPTION
     "Whether or not third luminaire is assigned." 
   INPUTCLASS
     NotInput
   DEFAULT
      if ( LocalCompAssigned( LumRef[3] )) then  1  else  0  endif
ENDRULE
RULE NEW IntLtgSys:LumRefPresent4
   DATATYPE
     Integer
   LONGFORM
     LuminaireReferencePresent4
   DESCRIPTION
     "Whether or not fourth luminaire is assigned."  
   INPUTCLASS
     NotInput
   DEFAULT
      if ( LocalCompAssigned( LumRef[4] )) then  1  else  0  endif
ENDRULE
RULE NEW IntLtgSys:LumRefPresent5
   DATATYPE
     Integer
   LONGFORM
     LuminaireReferencePresent5
   DESCRIPTION
     "Whether or not fifth luminaire is assigned."  
   INPUTCLASS
     NotInput
   DEFAULT
      if ( LocalCompAssigned( LumRef[5] )) then  1  else  0  endif
ENDRULE
RULE NEW IntLtgSys:LastLumRefPresent
   DATATYPE
     Integer
   LONGFORM
     LastLuminaireReferencePresent
   DESCRIPTION
     "Index ( 1-5 ) of last luminaire assigned to lighting system."  
   INPUTCLASS
     NotInput
   DEFAULT
		     if ( LumRefPresent5 > 0.5 ) then  5
		else if ( LumRefPresent4 > 0.5 ) then  4
		else if ( LumRefPresent3 > 0.5 ) then  3
		else if ( LumRefPresent2 > 0.5 ) then  2
		else if ( LumRefPresent1 > 0.5 ) then  1
		else  0  endif endif endif endif endif
ENDRULE

RULE IntLtgSys:LumCnt[1]
   DESCRIPTION
     "Luminaire count."  
  INPUTCLASS
    Default
   MINIMUM 
     0
   REPORTPRECISION
    0
  DEFAULT
     if ( LumRefPresent1 )  
     then 0
     else UNDEFINED 
     endif
   SIZING
     if ( LumRefPresent1 ) 
     then u:LumCnt[1]
     else UNDEFINED
     endif
ENDRULE
RULE IntLtgSys:LumCnt[2]
   DESCRIPTION
     "Luminaire count."  
  INPUTCLASS
    Default
   MINIMUM 
     0
   REPORTPRECISION
    0
  DEFAULT
     if ( LumRefPresent2 ) 
     then 0
     else UNDEFINED 
     endif
   SIZING
     if ( LumRefPresent2 ) 
     then u:LumCnt[2]
     else UNDEFINED
     endif
ENDRULE
RULE IntLtgSys:LumCnt[3]
   DESCRIPTION
     "Luminaire count."  
  INPUTCLASS
    Default
   MINIMUM 
     0
   REPORTPRECISION
    0
  DEFAULT
     if ( LumRefPresent3 ) 
     then 0
     else UNDEFINED 
     endif
   SIZING
     if ( LumRefPresent3 ) 
     then u:LumCnt[3]
     else UNDEFINED
     endif
ENDRULE
RULE IntLtgSys:LumCnt[4]
   DESCRIPTION
     "Luminaire count."  
  INPUTCLASS
    Default
   MINIMUM 
     0
   REPORTPRECISION
    0
  DEFAULT
     if ( LumRefPresent4 )  
     then 0
     else UNDEFINED 
     endif
   SIZING
     if ( LumRefPresent4 ) 
     then u:LumCnt[4]
     else UNDEFINED
     endif
ENDRULE
RULE IntLtgSys:LumCnt[5]
   DESCRIPTION
     "Luminaire count."  
  INPUTCLASS
    Default
   MINIMUM 
     0
   REPORTPRECISION
    0
  DEFAULT
     if ( LumRefPresent5 ) 
     then 0
     else UNDEFINED 
     endif
   SIZING
     if ( LumRefPresent5 ) 
     then u:LumCnt[5]
     else UNDEFINED
     endif
ENDRULE

RULE IntLtgSys:LumPwr[1]
  DESCRIPTION
    "Luminaire power ( taking Count into account )."  
  UNITS 
   Watts ( W )
  INPUTCLASS
    NotInput
  MINIMUM 
    0
  REPORTPRECISION
    1
  DEFAULT
	  if ( IfValidAnd( LumRefPresent1 < 0.1 ) )
    then UNDEFINED
    else if( IfValidAnd( LumCnt[1] < 0.1 ) )
    then 0
	  else  LumRef[1]:Pwr * LumCnt[1] 
    endif endif
   SIZING
	  if ( IfValidAnd( LumRefPresent1 < 0.1 ) )
    then UNDEFINED
    else if( IfValidAnd( LumCnt[1] < 0.1 ) )
    then 0
	  else  LumPwr[1]
    endif endif
ENDRULE
RULE IntLtgSys:LumPwr[2]
  DESCRIPTION
    "Luminaire power ( taking Count into account )."  
  UNITS 
   Watts ( W )
  INPUTCLASS
    NotInput
  MINIMUM 
    0
  REPORTPRECISION
    1
  DEFAULT
	  if ( IfValidAnd( LumRefPresent2 < 0.1 ) )
    then UNDEFINED
    else if( IfValidAnd( LumCnt[2] < 0.1 ) )
    then 0
  	else  LumRef[2]:Pwr * LumCnt[2]
    endif endif
   SIZING
	  if ( IfValidAnd( LumRefPresent2 < 0.1 ) )
    then UNDEFINED
    else if( IfValidAnd( LumCnt[2] < 0.1 ) )
    then 0
	  else  LumPwr[2]
    endif endif
ENDRULE
RULE IntLtgSys:LumPwr[3]
  DESCRIPTION
    "Luminaire power ( taking Count into account )."  
  UNITS 
    Watts ( W )
  INPUTCLASS
    NotInput
  MINIMUM 
    0
  REPORTPRECISION
    1
  DEFAULT
	  if ( IfValidAnd( LumRefPresent3 < 0.1 ) )
    then UNDEFINED
    else if( IfValidAnd( LumCnt[3] < 0.1 ) )
    then 0
		else  LumRef[3]:Pwr * LumCnt[3]
    endif endif
   SIZING
	  if ( IfValidAnd( LumRefPresent3 < 0.1 ) )
    then UNDEFINED
    else if( IfValidAnd( LumCnt[3] < 0.1 ) )
    then 0
	  else  LumPwr[3]
    endif endif
ENDRULE
RULE IntLtgSys:LumPwr[4]
  DESCRIPTION
    "Luminaire power ( taking Count into account )."  
  UNITS 
    Watts ( W )
  INPUTCLASS
    NotInput
  MINIMUM 
    0
  REPORTPRECISION
    1
  DEFAULT
	  if ( IfValidAnd( LumRefPresent4 < 0.1 ) )
    then UNDEFINED
    else if( IfValidAnd( LumCnt[4] < 0.1 ) )
    then 0
		else  LumRef[4]:Pwr * LumCnt[4]
    endif endif
   SIZING
	  if ( IfValidAnd( LumRefPresent4 < 0.1 ) )
    then UNDEFINED
    else if( IfValidAnd( LumCnt[4] < 0.1 ) )
    then 0
	  else  LumPwr[4]
    endif endif
  ANNUAL
    UNCHANGED
ENDRULE
RULE IntLtgSys:LumPwr[5]
  DESCRIPTION
    "Luminaire power ( taking Count into account )."  
  UNITS 
    Watts ( W )
  INPUTCLASS
    NotInput
  MINIMUM 
    0
  REPORTPRECISION
    1
  DEFAULT
	  if ( IfValidAnd( LumRefPresent5 < 0.1 ) )
    then UNDEFINED
    else if( IfValidAnd( LumCnt[5] < 0.1 ) )
    then 0
		else  LumRef[5]:Pwr * LumCnt[5]
    endif endif
   SIZING
	  if ( IfValidAnd( LumRefPresent5 < 0.1 ) )
    then UNDEFINED
    else if( IfValidAnd( LumCnt[5] < 0.1 ) )
    then 0
	  else  LumPwr[5]
    endif endif
ENDRULE


// ********** Luminaire Status ************************************************
// Rules to identify whether 'user' defined lighting power is to be utilized
// for propsed and/or standard design.

RULE NEW IntLtgSys:DefaultLumStatus
  DATATYPE 
    Enumeration
  LONGFORM
    DefaultLuminaireStatus
  DESCRIPTION
    "This property holds the default Luminaire Status based on project compliance
     and envelope status."  
  INPUTCLASS
    NotInput
  OPTION
    New
    Altered
    Existing
    Future
  DEFAULT 
    if( Proj:IsNewLtg )
    then "New"
    else if( Proj:IsExistingLtg )
    then "Existing"
    else if( Proj:IsFutureLtg )
    then "Future"           
    else if( Proj:CompType = "ExistingAlteration" .OR.
             Proj:CompType = "ExistingAdditionAndAlteration" .OR.
             Proj:CompType = "AdditionComplete" .OR.
             Proj:CompType = "AdditionEnvelopeAndPartialLighting" .OR.
             Proj:CompType = "AdditionEnvelopeAndLighting" )
    then ValidOr( Parent( DefaultLtgStatus ), "New" )
    else if( Proj:CompType = "AdditionEnvelope" .OR.
             Proj:CompType = "AdditionEnvelopeAndMechanical" )
    then if( IfValidAnd( Parent( DefaultLtgStatus ) = "New" ) )
      then "Future"
      else "Existing"
      endif
    else "New"
    endif endif endif endif endif
  SIZING
    UNDEFINED
ENDRULE

RULE IntLtgSys:LumStatus[1]
// Proj:CompType options:
//    ComplianceType                         Valid Options                Default (* indicates the only option)
//    --------------                         -------------                -------
//    NewComplete                            New                          *New
//    NewEnvelope                            Future                       *Future
//    NewEnvelopeAndLighting                 New                          *New     
//    NewEnvelopeAndPartialLighting          New, Future                  New    
//    NewEnvelopeAndMechanical               Future                       *Future
//    NewMechanical                          Existing                     *Existing     
//    NewMechanicalAndLighting               New                          *New     
//    NewMechanicalAndPartialLighting        New, Existing                New
//    ExistingAlteration                     New, Altered, Existing       REF:EnvStatus
//    ExistingAdditionAndAlteration          New, Altered, Existing       REF:EnvStatus
//    AdditionComplete                       New, Existing                REF:EnvStatus
//    AdditionEnvelope                       Future, Exist                If(EnvStatus = New) then Future, else Existing
//    AdditionEnvelopeAndLighting            New, Existing                REF:EnvStatus
//    AdditionEnvelopeAndPartialLighting     New, Existing, Future,       REF:EnvStatus
//    AdditionEnvelopeAndMechanical          Future, Exist                If(EnvStatus = New) then Future, else Existing
//    AdditionMechanical                     Existing                     *Existing
//    AdditionMechanicalAndLighting          New, Existing                New
//    AdditionMechanicalAndPartialLighting   New, Future,                 New

  DESCRIPTION
    "Property to identify whether a Luminaire is to be treated as 
     New, Altered or Existing." 
  HELP
    "Used to determine whether user specified or standard design values for 
     lighting power are installed in the proposed and baseline models.

      New:       Applies to luminaires in 'New' Spaces or luminaires in 'Altered'
                 spaces wheere th following conditions are met: 
                    a) Alteration increases space area.
                    b) Alteration increases total lighting power in a space.

      Altered:   Luminaires located in Existing or Altered spaces
                 which have been changed, replaced, removed, relocated; or 
                 connected to altered or revised wiring.  Matches the 
                 definition of ‘affected’ luminaires in Standards Table 141.0-E.
                 If more than 10% of the luminaires have been altered, the
                 lighting power in the standard design will be subject to the 
                 prescriptive requirements of 140.6.
                  
      Existing:  Applies to NewMechanical or NewMechanicalAndPartialLighting
                 Compliance, in which lighting compliance has been evaluated in 
                 in a previous compliance evaluation.  Also applies to 
                 Additions/Alterations Compliance where luminaires are
                 not being modified as part the addition/alteration.

      Future:    In NewEnvelope, NewEnvelopeAndPartialLighting, or
                 NewEnvelopeAndMechanical compliance, where Lighting
                 is not part of the current compliance evaluation, Luminaires 
                 and Interior Lighting Systems with Status = Future will be
                 ignored."
  OPTION
    New
    Altered
    Existing
    Future
  INPUTCLASS : S901G
    NotInput
  INPUTCLASS
    Default
  DEFAULT : S901G
	  if( LumRefPresent1 ) 
    then "New"
    else UNCHANGED
    endif
  DEFAULT
	  if( LumRefPresent1 ) 
    then DefaultLumStatus
    else UNCHANGED
    endif
ENDRULE
RULE IntLtgSys:LumStatus[2]
  DESCRIPTION
    "Property to identify whether a Luminaire is to be treated as 
     New, Altered or Existing." 
  HELP
    "Used to determine whether user specified or standard design values for 
     lighting power are installed in the proposed and baseline models.

      New:       Applies to luminaires in 'New' Spaces or luminaires in 'Altered'
                 spaces wheere th following conditions are met: 
                    a) Alteration increases space area.
                    b) Alteration increases total lighting power in a space.

      Altered:   Luminaires located in Existing or Altered spaces
                 which have been changed, replaced, removed, relocated; or 
                 connected to altered or revised wiring.  Matches the 
                 definition of ‘affected’ luminaires in Standards Table 141.0-E.
                 If more than 10% of the luminaires have been altered, the
                 lighting power in the standard design will be subject to the 
                 prescriptive requirements of 140.6.
                  
      Existing:  Applies to NewMechanical or NewMechanicalAndPartialLighting
                 Compliance, in which lighting compliance has been evaluated in 
                 in a previous compliance evaluation.  Also applies to 
                 Additions/Alterations Compliance where luminaires are
                 not being modified as part the addition/alteration.

      Future:    In NewEnvelope, NewEnvelopeAndPartialLighting, or
                 NewEnvelopeAndMechanical compliance, where Lighting
                 is not part of the current compliance evaluation, Luminaires 
                 and Interior Lighting Systems with Status = Future will be
                 ignored."
  OPTION
    New
    Altered
    Existing
    Future
  INPUTCLASS : S901G
    NotInput
  INPUTCLASS
    Default
  DEFAULT
	  if ( LumRefPresent2 )
    then LumStatus[1]
    else UNCHANGED
    endif
ENDRULE
RULE IntLtgSys:LumStatus[3]
  DESCRIPTION
    "Property to identify whether a Luminaire is to be treated as 
     New, Altered or Existing." 
  HELP
    "Used to determine whether user specified or standard design values for 
     lighting power are installed in the proposed and baseline models.

      New:       Applies to luminaires in 'New' Spaces or luminaires in 'Altered'
                 spaces wheere th following conditions are met: 
                    a) Alteration increases space area.
                    b) Alteration increases total lighting power in a space.

      Altered:   Luminaires located in Existing or Altered spaces
                 which have been changed, replaced, removed, relocated; or 
                 connected to altered or revised wiring.  Matches the 
                 definition of ‘affected’ luminaires in Standards Table 141.0-E.
                 If more than 10% of the luminaires have been altered, the
                 lighting power in the standard design will be subject to the 
                 prescriptive requirements of 140.6.
                  
      Existing:  Applies to NewMechanical or NewMechanicalAndPartialLighting
                 Compliance, in which lighting compliance has been evaluated in 
                 in a previous compliance evaluation.  Also applies to 
                 Additions/Alterations Compliance where luminaires are
                 not being modified as part the addition/alteration.

      Future:    In NewEnvelope, NewEnvelopeAndPartialLighting, or
                 NewEnvelopeAndMechanical compliance, where Lighting
                 is not part of the current compliance evaluation, Luminaires 
                 and Interior Lighting Systems with Status = Future will be
                 ignored."
  OPTION
    New
    Altered
    Existing
    Future
  INPUTCLASS : S901G
    NotInput
  INPUTCLASS
    Default
  DEFAULT
	  if ( LumRefPresent3 )
    then LumStatus[2]
    else UNCHANGED
    endif
ENDRULE
RULE IntLtgSys:LumStatus[4]
  DESCRIPTION
    "Property to identify whether a Luminaire is to be treated as 
     New, Altered or Existing." 
  HELP
    "Used to determine whether user specified or standard design values for 
     lighting power are installed in the proposed and baseline models.

      New:       Applies to luminaires in 'New' Spaces or luminaires in 'Altered'
                 spaces wheere th following conditions are met: 
                    a) Alteration increases space area.
                    b) Alteration increases total lighting power in a space.

      Altered:   Luminaires located in Existing or Altered spaces
                 which have been changed, replaced, removed, relocated; or 
                 connected to altered or revised wiring.  Matches the 
                 definition of ‘affected’ luminaires in Standards Table 141.0-E.
                 If more than 10% of the luminaires have been altered, the
                 lighting power in the standard design will be subject to the 
                 prescriptive requirements of 140.6.
                  
      Existing:  Applies to NewMechanical or NewMechanicalAndPartialLighting
                 Compliance, in which lighting compliance has been evaluated in 
                 in a previous compliance evaluation.  Also applies to 
                 Additions/Alterations Compliance where luminaires are
                 not being modified as part the addition/alteration.

      Future:    In NewEnvelope, NewEnvelopeAndPartialLighting, or
                 NewEnvelopeAndMechanical compliance, where Lighting
                 is not part of the current compliance evaluation, Luminaires 
                 and Interior Lighting Systems with Status = Future will be
                 ignored."
  OPTION
    New
    Altered
    Existing
    Future
  INPUTCLASS : S901G
    NotInput
  INPUTCLASS
    Default
  DEFAULT
	  if ( LumRefPresent4 )
    then LumStatus[3]
    else UNCHANGED
    endif
ENDRULE
RULE IntLtgSys:LumStatus[5]
  DESCRIPTION
    "Property to identify whether a Luminaire is to be treated as 
     New, Altered or Existing." 
  HELP
    "Used to determine whether user specified or standard design values for 
     lighting power are installed in the proposed and baseline models.

      New:       Applies to luminaires in 'New' Spaces or luminaires in 'Altered'
                 spaces wheere th following conditions are met: 
                    a) Alteration increases space area.
                    b) Alteration increases total lighting power in a space.

      Altered:   Luminaires located in Existing or Altered spaces
                 which have been changed, replaced, removed, relocated; or 
                 connected to altered or revised wiring.  Matches the 
                 definition of ‘affected’ luminaires in Standards Table 141.0-E.
                 If more than 10% of the luminaires have been altered, the
                 lighting power in the standard design will be subject to the 
                 prescriptive requirements of 140.6.
                  
      Existing:  Applies to NewMechanical or NewMechanicalAndPartialLighting
                 Compliance, in which lighting compliance has been evaluated in 
                 in a previous compliance evaluation.  Also applies to 
                 Additions/Alterations Compliance where luminaires are
                 not being modified as part the addition/alteration.

      Future:    In NewEnvelope, NewEnvelopeAndPartialLighting, or
                 NewEnvelopeAndMechanical compliance, where Lighting
                 is not part of the current compliance evaluation, Luminaires 
                 and Interior Lighting Systems with Status = Future will be
                 ignored."
  OPTION
    New
    Altered
    Existing
    Future
  INPUTCLASS : S901G
    NotInput
  INPUTCLASS
    Default
  DEFAULT
	  if ( LumRefPresent5 )
    then LumStatus[4]
    else UNCHANGED
    endif
ENDRULE

RULE NEW IntLtgSys:IsValidLumStatus1
  DATATYPE 
    Integer
  LONGFORM
    IsValidLuminaireStatus
  DESCRIPTION
    "This flag identifies whether the user selected luminaire status is not valid."  
  INPUTCLASS
    NotInput
  DEFAULT 
    if( (IfValidAnd( LumStatus[1] = "New" ) .AND.
         ValidCompStatus:Ltg_New( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[1] = "Altered" ) .AND.
         ValidCompStatus:Ltg_Altered( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[1] = "Existing" ) .AND.
         ValidCompStatus:Ltg_Existing( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[1] = "Future" ) .AND.
         ValidCompStatus:Ltg_Future( "ComplianceType", Proj:CompType ) = 1 ) )
    then 1
    else 0
    endif   
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsValidLumStatus2
  DATATYPE 
    Integer
  LONGFORM
    IsValidLuminaireStatus
  DESCRIPTION
    "This flag identifies whether the user selected luminaire status is not valid."  
  INPUTCLASS
    NotInput
  DEFAULT 
    if( (IfValidAnd( LumStatus[2] = "New" ) .AND.
         ValidCompStatus:Ltg_New( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[2] = "Altered" ) .AND.
         ValidCompStatus:Ltg_Altered( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[2] = "Existing" ) .AND.
         ValidCompStatus:Ltg_Existing( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[2] = "Future" ) .AND.
         ValidCompStatus:Ltg_Future( "ComplianceType", Proj:CompType ) = 1 ) )
    then 1
    else 0
    endif   
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsValidLumStatus3
  DATATYPE 
    Integer
  LONGFORM
    IsValidLuminaireStatus
  DESCRIPTION
    "This flag identifies whether the user selected luminaire status is not valid."  
  INPUTCLASS
    NotInput
  DEFAULT 
    if( (IfValidAnd( LumStatus[3] = "New" ) .AND.
         ValidCompStatus:Ltg_New( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[3] = "Altered" ) .AND.
         ValidCompStatus:Ltg_Altered( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[3] = "Existing" ) .AND.
         ValidCompStatus:Ltg_Existing( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[3] = "Future" ) .AND.
         ValidCompStatus:Ltg_Future( "ComplianceType", Proj:CompType ) = 1 ) )
    then 1
    else 0
    endif   
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsValidLumStatus4
  DATATYPE 
    Integer
  LONGFORM
    IsValidLuminaireStatus
  DESCRIPTION
    "This flag identifies whether the user selected luminaire status is not valid."  
  INPUTCLASS
    NotInput
  DEFAULT 
    if( (IfValidAnd( LumStatus[4] = "New" ) .AND.
         ValidCompStatus:Ltg_New( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[4] = "Altered" ) .AND.
         ValidCompStatus:Ltg_Altered( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[4] = "Existing" ) .AND.
         ValidCompStatus:Ltg_Existing( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[4] = "Future" ) .AND.
         ValidCompStatus:Ltg_Future( "ComplianceType", Proj:CompType ) = 1 ) )
    then 1
    else 0
    endif   
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsValidLumStatus5
  DATATYPE 
    Integer
  LONGFORM
    IsValidLuminaireStatus
  DESCRIPTION
    "This flag identifies whether the user selected luminaire status is not valid."  
  INPUTCLASS
    NotInput
  DEFAULT 
    if( (IfValidAnd( LumStatus[5] = "New" ) .AND.
         ValidCompStatus:Ltg_New( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[5] = "Altered" ) .AND.
         ValidCompStatus:Ltg_Altered( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[5] = "Existing" ) .AND.
         ValidCompStatus:Ltg_Existing( "ComplianceType", Proj:CompType ) = 1 ) .OR.
        (IfValidAnd( LumStatus[5] = "Future" ) .AND.
         ValidCompStatus:Ltg_Future( "ComplianceType", Proj:CompType ) = 1 ) )
    then 1
    else 0
    endif   
  SIZING
    UNDEFINED
ENDRULE

// Confirm or Reassign the Acutal Luminaire Status that will be used for compliance
RULE NEW IntLtgSys:LumStatusForComp1
  DATATYPE 
    String
  LONGFORM
    LuminaireStatusForCompliance1
  DESCRIPTION
    "String to hold the status of the luminaire that will be used for compliance."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumRefPresent1 < 0.1 ) ) then UNDEFINED else
    if( Proj:IsNewLtg ) then "New" else 
    if( Proj:IsExistingLtg ) then "Existing" else
    if( Proj:IsFutureLtg ) then "Future" else
    if( IsValidLumStatus1 ) then LumStatus[1] else
    DefaultLumStatus
    endif endif endif endif endif
  CHECKCODE
	  if ( IfValidAnd( LumRefPresent1 < 0.1 ) )
    then UNCHANGED
    else if( IsValidLumStatus1 = 0 )
    then
      PostWarning( "For Interior Lighting Systems '%s': Luminaire 1 status '%s'
                    is not valid for the selected compliance type: '%s'.  
                    Luminaire 1 Status has been reset to '%s'.",
                    Name, LumStatus[1], Proj:CompType, LumStatusForComp1 )
     else UNCHANGED
     endif endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:LumStatusForComp2
  DATATYPE 
    String
  LONGFORM
    LuminaireStatusForCompliance2
  DESCRIPTION
    "String to hold the status of the luminaire that will be used for compliance."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumRefPresent2 < 0.1 ) ) then UNDEFINED else
    if( Proj:IsNewLtg ) then "New" else 
    if( Proj:IsExistingLtg ) then "Existing" else
    if( Proj:IsFutureLtg ) then "Future" else
    if( IsValidLumStatus2 ) then LumStatus[2] else
    DefaultLumStatus
    endif endif endif endif endif
  CHECKCODE
	  if ( IfValidAnd( LumRefPresent2 < 0.1 ) )
    then UNCHANGED
    else if( IsValidLumStatus2 = 0 )
    then
      PostWarning( "For Interior Lighting Systems '%s': Luminaire 2 status '%s'
                    is not valid for the selected compliance type: '%s'.  
                    Luminaire 2 Status has been reset to '%s'.",
                    Name, LumStatus[2], Proj:CompType, LumStatusForComp2 )
     else UNCHANGED
     endif endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:LumStatusForComp3
  DATATYPE 
    String
  LONGFORM
    LuminaireStatusForCompliance3
  DESCRIPTION
    "String to hold the status of the luminaire that will be used for compliance."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumRefPresent3 < 0.1 ) ) then UNDEFINED else
    if( Proj:IsNewLtg ) then "New" else 
    if( Proj:IsExistingLtg ) then "Existing" else
    if( Proj:IsFutureLtg ) then "Future" else
    if( IsValidLumStatus3 ) then LumStatus[3] else
    DefaultLumStatus
    endif endif endif endif endif
  CHECKCODE
	  if ( IfValidAnd( LumRefPresent3 < 0.1 ) )
    then UNCHANGED
    else if( IsValidLumStatus3 = 0 )
    then
      PostWarning( "For Interior Lighting Systems '%s': Luminaire 3 status '%s'
                    is not valid for the selected compliance type: '%s'.  
                    Luminaire 3 Status has been reset to '%s'.",
                    Name, LumStatus[3], Proj:CompType, LumStatusForComp3 )
     else UNCHANGED
     endif endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:LumStatusForComp4
  DATATYPE 
    String
  LONGFORM
    LuminaireStatusForCompliance4
  DESCRIPTION
    "String to hold the status of the luminaire that will be used for compliance."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumRefPresent4 < 0.1 ) ) then UNDEFINED else
    if( Proj:IsNewLtg ) then "New" else 
    if( Proj:IsExistingLtg ) then "Existing" else
    if( Proj:IsFutureLtg ) then "Future" else
    if( IsValidLumStatus4 ) then LumStatus[4] else
    DefaultLumStatus
    endif endif endif endif endif
  CHECKCODE
	  if ( IfValidAnd( LumRefPresent4 < 0.1 ) )
    then UNCHANGED
    else if( IsValidLumStatus4 = 0 )
    then
      PostWarning( "For Interior Lighting Systems '%s': Luminaire 4 status '%s'
                    is not valid for the selected compliance type: '%s'.  
                    Luminaire 4 Status has been reset to '%s'.",
                    Name, LumStatus[4], Proj:CompType, LumStatusForComp4 )
     else UNCHANGED
     endif endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:LumStatusForComp5
  DATATYPE 
    String
  LONGFORM
    LuminaireStatusForCompliance5
  DESCRIPTION
    "String to hold the status of the luminaire that will be used for compliance."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumRefPresent5 < 0.1 ) ) then UNDEFINED else
    if( Proj:IsNewLtg ) then "New" else 
    if( Proj:IsExistingLtg ) then "Existing" else
    if( Proj:IsFutureLtg ) then "Future" else
    if( IsValidLumStatus5 ) then LumStatus[5] else
    DefaultLumStatus
    endif endif endif endif endif
  CHECKCODE
	  if ( IfValidAnd( LumRefPresent5 < 0.1 ) )
    then UNCHANGED
    else if( IsValidLumStatus5 = 0 )
    then
      PostWarning( "For Interior Lighting Systems '%s': Luminaire 5 status '%s'
                    is not valid for the selected compliance type: '%s'.  
                    Luminaire 5 Status has been reset to '%s'.",
                    Name, LumStatus[5], Proj:CompType, LumStatusForComp5 )
     else UNCHANGED
     endif endif
  SIZING
    UNDEFINED
ENDRULE

// Set IsNew, IsAlt, etc flags to aid in counting luminaires of each status
RULE NEW IntLtgSys:IsNewLum1
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsNew1
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as New."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp1 = "New" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsNewLum2
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsNew2
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as New."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp2 = "New" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsNewLum3
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsNew3
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as New."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp3 = "New" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsNewLum4
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsNew4
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as New."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp4 = "New" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsNewLum5
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsNew5
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as New."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp5 = "New" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE

RULE NEW IntLtgSys:IsAltLum1
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsAltered1
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Alterted."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp1 = "Altered" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsAltLum2
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsAltered1
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Alterted."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp2 = "Altered" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsAltLum3
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsAltered1
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Alterted."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp3 = "Altered" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsAltLum4
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsAltered1
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Alterted."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp4 = "Altered" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsAltLum5
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsAltered1
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Alterted."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp5 = "Altered" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE

RULE NEW IntLtgSys:IsExsLum1
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsExisting1
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Existing."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp1 = "Existing" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsExsLum2
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsExisting2
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Existing."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp2 = "Existing" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsExsLum3
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsExisting3
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Existing."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp3 = "Existing" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsExsLum4
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsExisting4
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Existing."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp4 = "Existing" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsExsLum5
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsExisting5
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Existing."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp5 = "Existing" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE

RULE NEW IntLtgSys:IsFutureLum1
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsFuture1
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Future."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp1 = "Future" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsFutureLum2
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsFuture2
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Future."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp2 = "Future" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsFutureLum3
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsFuture13
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Future."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp3 = "Future" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsFutureLum4
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsFuture4
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Future."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp4 = "Future" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:IsFutureLum5
  DATATYPE 
    Integer
  LONGFORM
    LuminaireIsFuture5
  DESCRIPTION
    "Flag to identify whether first referenced luminaire is to be treated as Future."  
  INPUTCLASS
    NotInput
  DEFAULT 
	  if ( IfValidAnd( LumStatusForComp5 = "Future" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE

RULE NEW IntLtgSys:NewLumCnt
  DATATYPE 
    Integer
  LONGFORM
    NewLuminaireCount
  DESCRIPTION
    "Flag to identify whether InteriorLightingSystem is to be treated as New."  
  INPUTCLASS
    NotInput
  DEFAULT 
    ValidOr( LumCnt[1], 0 ) * ValidOr( IsNewLum1, 0 ) +
    ValidOr( LumCnt[2], 0 ) * ValidOr( IsNewLum2, 0 ) +
    ValidOr( LumCnt[3], 0 ) * ValidOr( IsNewLum3, 0 ) +
    ValidOr( LumCnt[4], 0 ) * ValidOr( IsNewLum4, 0 ) +
    ValidOr( LumCnt[5], 0 ) * ValidOr( IsNewLum5, 0 )
ENDRULE

RULE NEW IntLtgSys:AltLumCnt
  DATATYPE 
    Integer
  LONGFORM
    AlteredLuminaireCount
  DESCRIPTION
    "Flag to identify whether InteriorLightingSystem is to be treated as
     Altered."  
  INPUTCLASS
    NotInput
  DEFAULT 
    ValidOr( LumCnt[1], 0 ) * ValidOr( IsAltLum1, 0 ) +
    ValidOr( LumCnt[2], 0 ) * ValidOr( IsAltLum2, 0 ) +
    ValidOr( LumCnt[3], 0 ) * ValidOr( IsAltLum3, 0 ) +
    ValidOr( LumCnt[4], 0 ) * ValidOr( IsAltLum4, 0 ) +
    ValidOr( LumCnt[5], 0 ) * ValidOr( IsAltLum5, 0 )
ENDRULE

RULE NEW IntLtgSys:ExistLumCnt
  DATATYPE 
    Integer
  LONGFORM
    ExistingLuminaireCount
  DESCRIPTION
    "Flag to identify whether InteriorLightingSystem is to be treated as 
     Existing."  
  INPUTCLASS
    NotInput
  DEFAULT 
    ValidOr( LumCnt[1], 0 ) * ValidOr( IsExsLum1, 0 ) +
    ValidOr( LumCnt[2], 0 ) * ValidOr( IsExsLum2, 0 ) +
    ValidOr( LumCnt[3], 0 ) * ValidOr( IsExsLum3, 0 ) +
    ValidOr( LumCnt[4], 0 ) * ValidOr( IsExsLum4, 0 ) +
    ValidOr( LumCnt[5], 0 ) * ValidOr( IsExsLum5, 0 )
ENDRULE

RULE NEW IntLtgSys:FutureLumCnt
  DATATYPE 
    Integer
  LONGFORM
    ExistingLuminaireCount
  DESCRIPTION
    "Flag to identify whether InteriorLightingSystem is to be treated as 
     Future."  
  INPUTCLASS
    NotInput
  DEFAULT 
    ValidOr( LumCnt[1], 0 ) * ValidOr( IsFutureLum1, 0 ) +
    ValidOr( LumCnt[2], 0 ) * ValidOr( IsFutureLum2, 0 ) +
    ValidOr( LumCnt[3], 0 ) * ValidOr( IsFutureLum3, 0 ) +
    ValidOr( LumCnt[4], 0 ) * ValidOr( IsFutureLum4, 0 ) +
    ValidOr( LumCnt[5], 0 ) * ValidOr( IsFutureLum5, 0 )
ENDRULE


// TO DO - Modify Rule Logic to reference the above OR Eliminate Entirely
//RULE IntLtgSys:Status
//  DESCRIPTION
//    "Flag to identify whether an InteriorLightingSystem is to be treated as 
//     New, Altered or Existing." 
//  HELP
//    "Used to determine whether user specified or standard design values for 
//     lighting power are installed in the proposed and baseline models.
//
//      New:       Applies to new lighting systems and/or luminaire or wiring 
//                 modifications where any of the following conditions are met:
//                    a) Alteration increases space area.
//                    b) Alteration increases total lighting power in a space.
//
//      Altered:   Applies to luminaire modifications in existing spaces, which
//                 do not increase the total space lighting power.
//                  
//      Existing:  Applies to NewMechanical or NewMechanicalAndPartialLighting
//                 Compliance, in which Lighting systems have been evaluated in 
//                 in a previous compliance evaluation.  Also applies to 
//                 Additions/Alterations Compliance where lighting systems are
//                 not being modified as part the addition/alteration.
//
//      Future:    In NewEnvelope, NewEnvelopeAndPartialLighting, or
//                 NewEnvelopeAndMechanical compliance, where Lighting Systems
//                 are not part of the current compliance evaluation, Interior 
//                 Lighting Systems with Status = Future will be ignored."
//  INPUTCLASS
//    Required
//  OPTION
//    New
//    Altered
//    Existing
//    Future
//  DEFAULT
//    if( Proj:IsNewLtg .OR.
//          // NewComplete
//          // NewEnvelopeAndLighting
//          // NewMechanicalAndLighting
//        Proj:IsPartLtg )
//          // NewEnvelopeAndPartialLighting
//          // NewMechanicalAndPartialLighting
//    then "New"
//    else if( Proj:IsFutureLtg )
//          // NewEnvelope
//          // NewEnvelopeAndMechanical
//    then "Future"            //  Future Interior Lighting Systems will be ignored
//    else if( Proj:IsNewMech = 1 .AND.
//             Proj:IsAddOrAlt = 0 )
//          // NewMechanical
//    then "Existing"
//    else if( Proj:IsAddOrAlt = 1 .AND. 
//             Spc:EnvStatus <> "New" )
//    then "Altered" 
//    else "New"
//    endif endif endif endif
//  CHECKCODE
//    if( ( Proj:IsNewLtg .AND. Status <> "New" ) .OR.
//        ( Proj:IsFutureLtg .AND. Status <> "Future" ) .OR.
//        ( Proj:IsExistingLtg .AND. Status <> "Existing") )
//    then PostWarning( "For interior lighting system '%s', the lighting status 
//                      '%s' is incompatible with Compliance Type '%s', and will
//                       be ignored.  All interior lighting will be treated as 
//                      '%s' for compliance purposes.",
//                       Name, Status, Proj:CompType, StatusforComp )
//    else if( ( Proj:IsAddOrAlt  .AND. Status  = "Future") .OR.
//             ( Proj:IsAddOrAlt = 0 .AND. Status = "Altered" ) .OR.
//             ( Proj:IsAdd .AND. Status = "Altered" ) .OR.
//             ( Proj:CompType = "NewEnvelopeAndPartialLighting" .AND. 
//                 Status = "Existing" ) .OR.
//             ( Proj:CompType = "NewMechanicalAndPartialLighting" .AND. 
//                 Status = "Future" ) )
//    then PostWarning( "For interior lighting system '%s', the lighting status 
//                      '%s' is incompatible with Compliance Type '%s', and will
//                       be ignored.  All interior lighting will be treated as 
//                      '%s' for compliance purposes.",
//                       Name, Status, Proj:CompType, StatusforComp )
//    else if( Proj:IsFutureLtg .OR. Status = Future )
//    then 
//      PostWarning( "Interior lighting system '%s' will ignored for NewEnvelope 
//                    and NewEnvelopeAndMechanical compliance types, or when the
//                    Interior Lighting System Status is 'Future'.",
//                    u:Name )
//    else UNCHANGED
//    endif endif endif
//  SIZING
//    UNDEFINED
//  ANNUAL
//    UNDEFINED
//ENDRULE
//
//RULE NEW IntLtgSys:StatusforComp
//  DATATYPE
//    String
//  LONGFORM
//    StatusforCompliance
//  DESCRIPTION
//    "A string to hold the true lighting status for the default/checkcode transform"  
//  INPUTCLASS
//    NotInput
//  DEFAULT
//    if( NewLumcnt > 0 ) then "New"  else 
//    if( AltLumCnt > 0 ) then "Altered" else
//    if( ExistLumCnt > 0 ) then "Existing" else
//    if( FutureLumCnt > 0 ) then "Future" else "New"
//    endif endif endif endif
//ENDRULE



// ********** Regulated Interior Lighting Power - IntLtgSys *******************
RULE IntLtgSys:Pwr
  DESCRIPTION
    "Total connected lighting power for all luminaires in an interior lighting system. 
     This includes the loads for lamps and ballasts."
  UNITS
    Watts ( W )
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    ValidOr( LumPwr[1], 0 ) +
    ValidOr( LumPwr[2], 0 ) +
    ValidOr( LumPwr[3], 0 ) +
    ValidOr( LumPwr[4], 0 ) +
    ValidOr( LumPwr[5], 0 )

  SIZING
    ValidOr( LumPwr[1], 0 ) +
    ValidOr( LumPwr[2], 0 ) +
    ValidOr( LumPwr[3], 0 ) +
    ValidOr( LumPwr[4], 0 ) +
    ValidOr( LumPwr[5], 0 )
ENDRULE

RULE IntLtgSys:PwrReg  
  DESCRIPTION
     "Whether this lighting system's power is Regulated vs. Non-Regulated. 
      Defaults to True ( regulated )." 
  INPUTCLASS
    Default
  OPTION
    0
    1
  DEFAULT
    1		; default to this IntLtgSys's power being regulated
  SIZING
    UNDEFINED
ENDRULE

RULE IntLtgSys:RegInstLtgPwr
  DESCRIPTION
    "A container for the installed regulated lighting power specified at the
     interior lighting system level"
  HELP
    "Primarily for reporting purposes, this value does not include any Power
     Adjustment Factors"
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    if( ParentComp = "ResOtherZn")
    then Pwr ; All lights in ResOtherZn count as regulated lights
    else if( PwrReg = 1 )
    then Pwr
    else 0
    endif endif
ENDRULE

// ********** Power Adjustment Factors ( PAF ) ********************************
RULE NEW ResOtherZn:OccClass
  DATATYPE
    Enumeration
  DESCRIPTION
    "The occupancy classification of the zone. This is noly to make ResOtherZn 
     compatible with some IntLtgSys rules."
  OPTION
    Nonresidential
    Residential
  DEFAULT
    "Nonresidential" ; non-dwelling units
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:DaylitLum
  RULESETS
    T24N
  DATATYPE
    Integer
  LONGFORM
    DaylitLuminaire
  DESCRIPTION
    "A flag to determine whether luminaires associated with an interior
     lighting system are located within a daylit zone."
  INPUTCLASS
    NotInput
  DEFAULT 
    if( ParentComp = "Spc" )
    then if( ( IfValidAnd( Spc:SkylitDaylitArea > 0 ) .AND. 
             IfValidAnd( DaylitAreaType = "SkylitDaylit" ) ) .OR.
             ( IfValidAnd( Spc:PriSideDaylitArea > 0 ) .AND. 
             IfValidAnd( DaylitAreaType = "PrimarySidelit" ) ) .OR.
             ( IfValidAnd( Spc:SecSideDaylitArea  > 0 ) .AND.
             IfValidAnd( DaylitAreaType = "SecondarySidelit" ) ) )
         then 1
         else 0
         endif
    else 0
    endif
  ENDRULE
RULE NEW IntLtgSys:SkyOrPriSideDaylitLum
  RULESETS
    T24N
  DATATYPE
    Integer
  LONGFORM
    SkylitOrPrimarySidelitDaylitLuminaire
  DESCRIPTION
    "A flag to determine whether luminaires associated with an interior
     lighting system are located within a primary sidelit or skylit daylit
     zone."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 T24N_2019
    if( Proj:IsDetailedGeometry )
    then if( ( IfValidAnd( Spc:SkylitDaylitArea > 0 ) .AND. 
             IfValidAnd( DaylitAreaType = "SkylitDaylit" ) ) .OR.
             ( IfValidAnd( Spc:PriSideDaylitArea > 0 ) .AND. 
             IfValidAnd( DaylitAreaType = "PrimarySidelit" ) )  )
         then 1
         else 0
         endif
    else if ( IfValidAnd( DaylitAreaType = "SkylitDaylit" ) .OR.
              IfValidAnd( DaylitAreaType = "PrimarySidelit" ) )
         then 1
         else 0
    endif endif
  DEFAULT
    if( ParentComp = "Spc" .AND. Proj:IsDetailedGeometry )
    then if( ( IfValidAnd( Spc:SkylitDaylitArea > 0 ) .AND. 
             IfValidAnd( DaylitAreaType = "SkylitDaylit" ) ) .OR.
             ( IfValidAnd( Spc:PriSideDaylitArea > 0 ) .AND. 
             IfValidAnd( DaylitAreaType = "PrimarySidelit" ) ) .OR.
             ( IfValidAnd( Spc:SecSideDaylitArea > 0 ) .AND. 
             IfValidAnd( DaylitAreaType = "SecondarySidelit" ) )  )
         then 1
         else 0
         endif
    else if ( IfValidAnd( DaylitAreaType = "SkylitDaylit" ) .OR.
              IfValidAnd( DaylitAreaType = "PrimarySidelit" ) .OR.
              IfValidAnd( DaylitAreaType = "SecondarySidelit" ) )
         then 1
         else 0
    endif endif
ENDRULE

RULE IntLtgSys:PAFCredType[1]
  DESCRIPTION
    "Selection of PAF Credit Type allows the software to apply the power
     adjustment factors ( PAF ) which represents the percent reduction in 
     lighting power that will approximate the effect of the control.
     Models account for such controls by multiplying the controlled watts 
     by ( 1-PAF )."
  HELP : T24N
    "PAFCreditTypes are identified in the 2013 T24 Part 6,
     Table 140.6-A" 
  INPUTCLASS : T24N_2013 T24N_2016 S901G ECBC
    Default
  INPUTCLASS
    Default
;  OPTION Lists specified in array index 5
  DEFAULT 
     "- none specified -" 
ENDRULE		
RULE IntLtgSys:PAFCredType[2]
  DESCRIPTION
    "Selection of PAF Credit Type allows the software to apply the power
     adjustment factors ( PAF ) which represents the percent reduction in 
     lighting power that will approximate the effect of the control.
     Models account for such controls by multiplying the controlled watts 
     by ( 1-PAF )."
  HELP : T24N
    "PAFCreditTypes are identified in the 2013 T24 Part 6,
     Table 140.6-A" 
  INPUTCLASS : T24N_2013 T24N_2016 S901G ECBC
    NotInput
  INPUTCLASS
    Default
;  OPTION Lists specified in array index 5
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
     "- none specified -" 
ENDRULE		
RULE IntLtgSys:PAFCredType[3]
  DESCRIPTION
    "Selection of PAF Credit Type allows the software to apply the power
     adjustment factors ( PAF ) which represents the percent reduction in 
     lighting power that will approximate the effect of the control.
     Models account for such controls by multiplying the controlled watts 
     by ( 1-PAF )."
  HELP : T24N
    "PAFCreditTypes are identified in the 2013 T24 Part 6,
     Table 140.6-A" 
  INPUTCLASS : T24N_2013 T24N_2016 S901G ECBC
    NotInput
  INPUTCLASS
    Default
;  OPTION Lists specified in array index 5
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT 
     "- none specified -" 
ENDRULE		
RULE IntLtgSys:PAFCredType[4]
  DESCRIPTION
    "Selection of PAF Credit Type allows the software to apply the power
     adjustment factors ( PAF ) which represents the percent reduction in 
     lighting power that will approximate the effect of the control.
     Models account for such controls by multiplying the controlled watts 
     by ( 1-PAF )."
  HELP : T24N
    "PAFCreditTypes are identified in the 2013 T24 Part 6,
     Table 140.6-A" 
  INPUTCLASS : T24N_2013 T24N_2016 S901G ECBC
    NotInput
  INPUTCLASS
    Default
;  OPTION Lists specified in array index 5
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT 
     "- none specified -" 
ENDRULE		
RULE IntLtgSys:PAFCredType[5]
  DESCRIPTION
    "Selection of PAF Credit Type allows the software to apply the power
     adjustment factors ( PAF ) which represents the percent reduction in 
     lighting power that will approximate the effect of the control.
     Models account for such controls by multiplying the controlled watts 
     by ( 1-PAF )."
  HELP : T24N
    "PAFCreditTypes are identified in the 2013 T24 Part 6,
     Table 140.6-A" 
  INPUTCLASS : T24N_2013 T24N_2016 S901G ECBC
    NotInput
  INPUTCLASS
    Default
  OPTION : S901G ECBC
    - none specified -
    OccupancySensor
  OPTION : T24N_2013
    - none specified -
    PartialOnOccupantSensingControl
    OccupantSensingControls-1to125SF
    OccupantSensingControls-126to250SF
    OccupantSensingControls-251to500SF
    ManualDimming
    MultisceneProgrammableControls
    DemandResponsiveControl
    CombinedManualDimmingPlusPartialOnOccupantSensingControl
  OPTION : T24N_2016
    - none specified -
    DaylightDimmingPlusOff
    OccupantSensingControls-1to125SF
    OccupantSensingControls-126to250SF
    OccupantSensingControls-251to500SF
    DemandResponsiveControl
    InstitutionalTuning
  OPTION : T24N_2019
    - none specified -
    DaylightDimmingPlusOff
    OccupantSensingControls-1to125SF
    OccupantSensingControls-126to250SF
    OccupantSensingControls-251to500SF
    InstitutionalTuning
    DemandResponsiveControl
    Clerestories
    HorizontalSlats    
    LightShelves
  OPTION
    - none specified -
    DaylightDimmingPlusOff
    OccupantSensingControls-1to125SF
    OccupantSensingControls-126to250SF
    InstitutionalTuning
    DemandResponsiveControl
    Clerestories
    HorizontalSlats    
    LightShelves
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT 
     "- none specified -" 
ENDRULE		

RULE NEW IntLtgSys:DisplayPAFDialog2
  DATATYPE
    Integer
  LONGFORM
    DisplayPowerAdjustmentFactorDialog2
  DESCRIPTION
    "A flag to determine whether to display subsequent PAF dialogs based on
     presence of previous dialog."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    0
  DEFAULT
    if( IfValidAnd ( PAFCredType[1] <> "- none specified -" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:DisplayPAFDialog3
  DATATYPE
    Integer
  LONGFORM
    DisplayPowerAdjustmentFactorDialog3
  DESCRIPTION
    "A flag to determine whether to display subsequent PAF dialogs based on
     presence of previous dialog."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    0
  DEFAULT
    if( IfValidAnd ( PAFCredType[2] <> "- none specified -" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:DisplayPAFDialog4
  DATATYPE
    Integer
  LONGFORM
    DisplayPowerAdjustmentFactorDialog4
  DESCRIPTION
    "A flag to determine whether to display subsequent PAF dialogs based on
     presence of previous dialog."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    0
  DEFAULT
    if( IfValidAnd ( PAFCredType[3] <> "- none specified -" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:DisplayPAFDialog5
  DATATYPE
    Integer
  LONGFORM
    DisplayPowerAdjustmentFactorDialog5
  DESCRIPTION
    "A flag to determine whether to display subsequent PAF dialogs based on
     presence of previous dialog."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    0
  DEFAULT
    if( IfValidAnd ( PAFCredType[4] <> "- none specified -" ) )
    then 1
    else 0
    endif
  SIZING
    UNDEFINED
ENDRULE


RULE NEW IntLtgSys:PAFPermitted
  RULESETS
    S901G ECBC T24N_2013 T24N_2016
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorPermitted
  DESCRIPTION
    "A flag to determine whether a valid PAF is selected and permitted for the
     parent space function."
  INPUTCLASS
    NotInput
  DEFAULT : S901G
    if( ParentStatus( SpcFunc ) > 0 .AND.
        IfValidAnd ( PAFCredType[1] <> "- none specified -" ) )
    then LtgInputRestrictions:PAFCredType( "CreditType",PAFCredType[1], 
                                           "SpaceFunction",Spc:SpcFunc )
    else 0
    endif
  DEFAULT : T24N_2013
    if ( IfValidAnd( PAFCredType[1] = "DemandResponsiveControl" ) )
    then if( IfValidAnd( Bldg:TotFlrArea < 10000 ) )
      then 1
      else 0
      endif
    else if( ParentStatus( SpcFunc ) > 0 .AND.
             IfValidAnd ( PAFCredType[1] <> "- none specified -" ) )
    then LtgInputRestrictions:PAFCredType( "AllowanceType",PAFCredType[1], 
                                           "SpaceFunction",Spc:SpcFunc )
    else 0
    endif endif
  DEFAULT : T24N_2016
    if ( IfValidAnd( PAFCredType[1] = "DemandResponsiveControl" ) )
    then if( IfValidAnd( Bldg:TotFlrArea < 10000 ) )
      then 1
      else 0
      endif
    else if ( IfValidAnd( PAFCredType[1] = "DaylightDimmingPlusOff" ) )
    then if ( Proj:IsDetailedGeometry = 0 .AND.
              IfValidAnd( Parent( OccClass ) != "Residential" )  .AND.
              ( DaylitAreaType = "PrimarySidelit" .OR.
                DaylitAreaType = "SkylitDaylit" ) )
      then 1
      else 0
      endif
    else if( ParentStatus( SpcFunc ) > 0 .AND.
             IfValidAnd ( PAFCredType[1] <> "- none specified -" ) )
    then LtgInputRestrictions:PAFCredType( "AllowanceType",PAFCredType[1], 
                                           "SpaceFunction",Spc:SpcFunc )
    else 0
    endif endif endif
  CHECKCODE : S901G
    if( IfValidAnd ( PAFCredType[1] <> "- none specified -" ) .AND.
        PAFPermitted = 0 )
    then PostError( "The selected PAF Credit '%s' is not permitted for the 
                     space '%s'. Refer to ASHRAE 90.1-2010 Section 9.4.1.2.",
                     u:PAFCredType[1], Parent( Name ) )
    else UNCHANGED
    endif
  CHECKCODE : T24N
    if( IfValidAnd ( PAFCredType[1] <> "- none specified -" ) .AND.
        PAFPermitted = 0 )
    then PostError( "The selected PAF Credit '%s' is not permitted for the 
                     space '%s'. Refer to Title 24, Part 6, Section 140.6(a)2
                     for PAF restrictions",
                     u:PAFCredType[1], Parent( Name ) )
    else UNCHANGED
    endif
ENDRULE
   
RULE NEW IntLtgSys:PAFCombError2
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorCombinationError2
  DESCRIPTION
    "A flag to determine whether an allowed PAF combination is selected."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT 
    if( IfValidAnd ( PAFCredType[2] <> "- none specified -" ) )
    then PAFs:PAFCombError( "DaylitLum", "*",
                            "PrevPAFCredType",PAFCredType[1],
                            "PAFCredType",PAFCredType[2] ) 
    else 0 
    endif
ENDRULE
RULE NEW IntLtgSys:PAFCombError3
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorCombinationError3
  DESCRIPTION
    "A flag to determine whether an allowed PAF combination is selected."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT 
    if( IfValidAnd ( PAFCredType[3] <> "- none specified -" ) )
    then PAFs:PAFCombError( "DaylitLum", "*",
                            "PrevPAFCredType",PAFCredType[1],
                            "PAFCredType",PAFCredType[3] ) +
         PAFs:PAFCombError( "DaylitLum", "*",
                            "PrevPAFCredType",PAFCredType[2],
                            "PAFCredType",PAFCredType[3] )
    else 0 
    endif
ENDRULE
RULE NEW IntLtgSys:PAFCombError4
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorCombinationError4
  DESCRIPTION
    "A flag to determine whether an allowed PAF combination is selected."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT 
    if( IfValidAnd ( PAFCredType[3] <> "- none specified -" ) )
    then PAFs:PAFCombError( "DaylitLum", "*",
                            "PrevPAFCredType",PAFCredType[1],
                            "PAFCredType",PAFCredType[4] ) +
         PAFs:PAFCombError( "DaylitLum", "*",
                            "PrevPAFCredType",PAFCredType[2],
                            "PAFCredType",PAFCredType[4] ) + 
         PAFs:PAFCombError( "DaylitLum", "*",
                            "PrevPAFCredType",PAFCredType[3],
                            "PAFCredType",PAFCredType[4] )
    else 0 
    endif
ENDRULE
RULE NEW IntLtgSys:PAFCombError5
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorCombinationError5
  DESCRIPTION
    "A flag to determine whether an allowed PAF combination is selected."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT 
    if( IfValidAnd ( PAFCredType[3] <> "- none specified -" ) )
    then PAFs:PAFCombError( "DaylitLum", "*",
                            "PrevPAFCredType",PAFCredType[1],
                            "PAFCredType",PAFCredType[5] ) +
         PAFs:PAFCombError( "DaylitLum", "*",
                            "PrevPAFCredType",PAFCredType[2],
                            "PAFCredType",PAFCredType[5] ) + 
         PAFs:PAFCombError( "DaylitLum", "*",
                            "PrevPAFCredType",PAFCredType[3],
                            "PAFCredType",PAFCredType[5] ) + 
         PAFs:PAFCombError( "DaylitLum", "*",
                            "PrevPAFCredType",PAFCredType[4],
                            "PAFCredType",PAFCredType[5] )
    else 0 
    endif
ENDRULE

// Determine whether the system is qualify for the credit from "Demand Responsive Control" - JP (tic 3374) 12/12/22
RULE NEW Spc:MultLvlLtgCtrlReq
  RULESETS
    T24N
  DATATYPE
    Integer
  DESCRIPTION
    "A flag to determine whether multilevel lighting Control is mandatorily required"
  INPUTCLASS
    NotInput
  DEFAULT
    if( Area < 100 .OR. SpcFunc = "Restrooms" .OR. IsHlthCare > 0 )
    then 0
    else if( IfValidAnd( IntLtgSysChildren > 0 ) )
    then if( SumChildrenIf( IntLtgSys:Pwr, IntLtgSys:AllowType = "GeneralAllowance" ) / Area > 0.5 )
         then 1
         else 0
         endif
    else if( IfValidAnd( IntLPDReg > 0.5 ) )
    then 1
    else 0
    endif endif endif
ENDRULE
RULE IntLtgSys:MultLvlCtrlReq
  DESCRIPTION
    "A flag to determine whether multilevel lighting Control is mandatorily required"
  DEFAULT
    if( ParentComp = "ResOtherZn" )
    then 0
    else if( Spc:MultLvlLtgCtrlReq > 0 .AND. AllowType = "GeneralAllowance" )
    then 1
    else 0
    endif endif
ENDRULE
RULE IntLtgSys:MultLvlCtrlExcept
  DESCRIPTION
    "This flag indicates this lighting system meets criteria of Exception(s) to 130.1(b).
     This flag is used to determine whether this lighting system is able to claim the 
     lighting power credit from 'Demand Responsive Control'."
  HELP
    "Check this checkbox if this system serves an enclosed area smaller than 100 
     square feet or has only one luminaire with no more than two lamps or has only 
     one inseparable SSL luminaire."
  DEFAULT
    0
ENDRULE
RULE IntLtgSys:DRCExcept
  DESCRIPTION
    "This flag indicates this lighting system meets criteria of Exception to 110.12(c)
     This flag is used to determine whether this lighting system is able to claim the 
     lighting power credit from 'Demand Responsive Control'."
  HELP
    "Check this checkbox if this system serves a space where a health or life safety 
     statute, ordinance, or regulation does not permit the general lighting to be reduced."
  DEFAULT
    0
  CHECKCODE
    if( DRCExcept > 0 .AND. AllowType = "GeneralAllowance" .AND. (
        IfValidAnd( PAFCredType[1] = "DemandResponsiveControl" ) .OR.  
        IfValidAnd( PAFCredType[2] = "DemandResponsiveControl" ) .OR.
        IfValidAnd( PAFCredType[3] = "DemandResponsiveControl" ) .OR.
        IfValidAnd( PAFCredType[4] = "DemandResponsiveControl" ) .OR.
        IfValidAnd( PAFCredType[5] = "DemandResponsiveControl" ) ) )
    then PostError( "Based on the Exception conditon to 110.12(c) ordinance or
                     regulation does not permit the general lighting to be reduced.
                     Therefore, 'DemandResponsiveControl' should not be used for
                     lighting system '%s', Name" )
    else UNCHANGED
    endif
ENDRULE
RULE NEW IntLtgSys:ReqDRCPwr
  RULESETS
    T24N
  DATATYPE
    Float
  DESCRIPTION
    "Lighting power in the scope of Section 110.12(c)"
  INPUTCLASS
    NotInput
  DEFAULT
    if( MultLvlCtrlReq > 0 .AND. MultLvlCtrlExcept = 0 .AND. DRCExcept = 0 )
    then Pwr
    else 0
    endif 
ENDRULE
RULE NEW Spc:ReqDRCLtgPwr
  RULESETS
    T24N
  DATATYPE
    Float
  DESCRIPTION
    "Lighting power in the scope of Section 110.12(c)"
  INPUTCLASS
    NotInput
  DEFAULT
    if( IfValidAnd( IntLtgSysChildren > 0 ) )
    then SumChildren( IntLtgSys:ReqDRCPwr )
    else if( MultLvlLtgCtrlReq > 0 )
    then ValidOr( IntLPDReg, 0 ) * Area
    else 0
    endif endif
ENDRULE
RULE NEW Bldg:ReqDRCLtgPwr
  RULESETS
    T24N
  DATATYPE
    Float
  DESCRIPTION
    "Total lighting power in the scope of Section 110.12(c)"
  INPUTCLASS
    NotInput
  DEFAULT
    SumChildren( Spc:ReqDRCLtgPwr )
ENDRULE

// PAFErrorFlags
RULE NEW IntLtgSys:PAFErrorFlag1
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorErrorFlag1
  DESCRIPTION
    "A flag to determine whether a valid PAF is selected and permitted for the
     parent space function.
     Error Code 1: Duplicate PAF
     Error Code 2: Simulate Daylighting Explicitly
     Error Code 3: Prohibited per Title 24, Part 6, Section 140.6(a)2"
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( IfValidAnd ( PAFCredType[1] <> "- none specified -" ) )
    then if ( IfValidAnd( PAFCredType[1] = "DaylightDimmingPlusOff" ) )
      then if ( ( ( Proj:IsDetailedGeometry = 0 .AND. IfValidAnd( Parent( OccClass ) != "Residential" ) )
                  .OR. ParentComp = "ResOtherZn" ) .AND.
                SkyOrPriSideDaylitLum )
        then 0
        else 2  // Error - simulate daylighting explicitly (Detiled) or Assign Daylit Zone (Simplified)
        endif
      else if ( IfValidAnd( PAFCredType[1] = "OccupantSensingControls-1to125SF" ) .OR.
                IfValidAnd( PAFCredType[1] = "OccupantSensingControls-126to250SF" ) .OR.
                IfValidAnd( PAFCredType[1] = "OccupantSensingControls-251to500SF" ) )
      then if ( IfValidAnd( Parent( SpcFunc ) = "Office Area (>250 square feet)" ) .OR.
                IfValidAnd( Parent( SpcFunc ) = "Office Area (Open plan office)" ) )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
//    else if ( IfValidAnd( PAFCredType[1] = "InstitutionalTuning" ) )
//    then 0
      else if ( IfValidAnd( PAFCredType[1] = "DemandResponsiveControl" ) )
      then if ( Bldg:ReqDRCLtgPwr < 4000 .OR. MultLvlCtrlReq = 0 .OR. MultLvlCtrlExcept > 0 )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else if ( IfValidAnd( PAFCredType[1] = "HorizontalSlats" ) )
      then if ( ( IfValidAnd( Parent( OccClass ) != "Residential" ) .OR. ParentComp = "ResOtherZn" ) .AND.
                SkyOrPriSideDaylitLum )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else if ( IfValidAnd( PAFCredType[1] = "Clerestories" ) .OR.
                IfValidAnd( PAFCredType[1] = "LightShelves" ) )
      then if ( ( IfValidAnd( Parent( OccClass ) != "Residential" ) .OR. ParentComp = "ResOtherZn" ) .AND.
                IfValidAnd( Parent( ClerestoryPAFAllowed ) > 0.1 ) )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else 0  // all error conditions are represented above
      endif endif endif endif endif
    else 0
    endif
  CHECKCODE : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  CHECKCODE 
    if( PAFErrorFlag1 = 1 )
    then PostError( "PAF Credit '%s' is selected more than once for Interior
                     Lighting System '%s'",
                     u:PAFCredType[1], Name )
    else if( PAFErrorFlag1 = 2 )
    then PostError( "PAF '%s' is not available for Space '%s'.  For detailed
                     geometry models, simulate daylighting explicitly, 
                     otherwise assign daylit zone.",
                     u:PAFCredType[1], Parent( Name ) )
    else if( PAFErrorFlag1 = 3 )
    then PostError( "The selected PAF Credit '%s' is not permitted for the 
                     space '%s'. Refer to Title 24, Part 6, Section 140.6(a)2
                     for PAF restrictions",
                     u:PAFCredType[1], Parent( Name ) )
    else UNCHANGED
    endif endif endif
ENDRULE
RULE NEW IntLtgSys:PAFErrorFlag2
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorErrorFlag2
  DESCRIPTION
    "A flag to determine whether a valid PAF is selected and permitted for the
     parent space function."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( IfValidAnd ( PAFCredType[2] <> "- none specified -" ) )
    then if( IfValidAnd( PAFCredType[2] = PAFCredType[1] ) )
      then 1   // Error - duplicate PAF Credit Types
      else if( PAFCombError2 > 0 )
      then 3   // prohibited per Title 24, Part 6, Section 140.6(a)2
      else if ( IfValidAnd( PAFCredType[2] = "DaylightDimmingPlusOff" ) )
      then if ( ( ( Proj:IsDetailedGeometry = 0 .AND. IfValidAnd( Parent( OccClass ) != "Residential" ) )
                  .OR. ParentComp = "ResOtherZn" ) .AND.
                SkyOrPriSideDaylitLum )
        then 0
        else 2  // Error - simulate daylighting explicitly
        endif
      else if ( IfValidAnd( PAFCredType[2] = "OccupantSensingControls-1to125SF" ) .OR.
                IfValidAnd( PAFCredType[2] = "OccupantSensingControls-126to250SF" ) .OR.
                IfValidAnd( PAFCredType[2] = "OccupantSensingControls-251to500SF" ) )
      then if ( IfValidAnd( Parent( SpcFunc ) = "Office Area (>250 square feet)" ) .OR.
                IfValidAnd( Parent( SpcFunc ) = "Office Area (Open plan office)" ) )
        then 0
        else 3  // prohibited per itle 24, Part 6, Section 140.6(a)2
        endif
//    else if ( IfValidAnd( PAFCredType[2] = "InstitutionalTuning" ) )
//    then 0
      else if ( IfValidAnd( PAFCredType[2] = "DemandResponsiveControl" ) )
      then if ( Bldg:ReqDRCLtgPwr < 4000 .OR. MultLvlCtrlReq = 0 .OR. MultLvlCtrlExcept > 0 )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else if ( IfValidAnd( PAFCredType[2] = "HorizontalSlats" ) )
      then if ( ( IfValidAnd( Parent( OccClass ) != "Residential" ) .OR. ParentComp = "ResOtherZn" ) .AND.
                SkyOrPriSideDaylitLum )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else if ( IfValidAnd( PAFCredType[2] = "Clerestories" ) .OR.
                IfValidAnd( PAFCredType[2] = "LightShelves" ) )
      then if ( ( IfValidAnd( Parent( OccClass ) != "Residential" ) .OR. ParentComp = "ResOtherZn" ) .AND.
                IfValidAnd( Parent( ClerestoryPAFAllowed ) > 0.1 ) )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else 0  // all error conditions are represented above
      endif endif endif endif endif endif endif
    else 0
    endif
  CHECKCODE : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  CHECKCODE 
    if( PAFErrorFlag2 = 1 )
    then PostError( "PAF Credit '%s' is selected more than once for Interior
                     Lighting System '%s'",
                     u:PAFCredType[2], Name )
    else if( PAFErrorFlag2 = 2 )
    then PostError( "PAF '%s' is not available for Space '%s'.  For detailed
                     geometry models, simulate daylighting explicitly, 
                     otherwise assign daylit zone.",
                     u:PAFCredType[2], Parent( Name ) )
    else if( PAFErrorFlag2 = 3 )
    then PostError( "The selected PAF Credit '%s' is not permitted for the 
                     space '%s'. Refer to Title 24, Part 6, Section 140.6(a)2
                     for PAF restrictions",
                     u:PAFCredType[2], Parent( Name ) )
    else UNCHANGED
    endif endif endif
ENDRULE
RULE NEW IntLtgSys:PAFErrorFlag3
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorErrorFlag3
  DESCRIPTION
    "A flag to determine whether a valid PAF is selected and permitted for the
     parent space function."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( IfValidAnd ( PAFCredType[3] <> "- none specified -" ) )
    then if( IfValidAnd( PAFCredType[3] = PAFCredType[1] ) .OR.
             IfValidAnd( PAFCredType[3] = PAFCredType[2] ) )
      then 1   // Error - duplicate PAF Credit Types
      else if( PAFCombError3 > 0 )
      then 3   // prohibited per Title 24, Part 6, Section 140.6(a)2
      else if ( IfValidAnd( PAFCredType[3] = "DaylightDimmingPlusOff" ) )
      then if ( ( ( Proj:IsDetailedGeometry = 0 .AND. IfValidAnd( Parent( OccClass ) != "Residential" ) )
                  .OR. ParentComp = "ResOtherZn" ) .AND.
                SkyOrPriSideDaylitLum )
        then 0
        else 2  // Error - simulate daylighting explicitly
        endif
      else if ( IfValidAnd( PAFCredType[3] = "OccupantSensingControls-1to125SF" ) .OR.
                IfValidAnd( PAFCredType[3] = "OccupantSensingControls-126to250SF" ) .OR.
                IfValidAnd( PAFCredType[3] = "OccupantSensingControls-251to500SF" ) )
      then if ( IfValidAnd( Parent( SpcFunc ) = "Office Area (>250 square feet)" ) .OR.
                IfValidAnd( Parent( SpcFunc ) = "Office Area (Open plan office)" ) )
        then 0
        else 3  // prohibited per itle 24, Part 6, Section 140.6(a)2
        endif
//    else if ( IfValidAnd( PAFCredType[3] = "InstitutionalTuning" ) )
//    then 0
      else if ( IfValidAnd( PAFCredType[3] = "DemandResponsiveControl" ) )
      then if ( Bldg:ReqDRCLtgPwr < 4000 .OR. MultLvlCtrlReq = 0 .OR. MultLvlCtrlExcept > 0 )
        then 0
        else 3  // prohibited per itle 24, Part 6, Section 140.6(a)2
        endif
      else if ( IfValidAnd( PAFCredType[3] = "HorizontalSlats" ) )
      then if ( ( IfValidAnd( Parent( OccClass ) != "Residential" ) .OR. ParentComp = "ResOtherZn" ) .AND.
                SkyOrPriSideDaylitLum )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else if ( IfValidAnd( PAFCredType[3] = "Clerestories" ) .OR.
                IfValidAnd( PAFCredType[3] = "LightShelves" ) )
      then if ( ( IfValidAnd( Parent( OccClass ) != "Residential" ) .OR. ParentComp = "ResOtherZn" ) .AND.
                IfValidAnd( Parent( ClerestoryPAFAllowed ) > 0.1 ) )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else 0  // all error conditions are represented above
      endif endif endif endif endif endif endif
    else 0
    endif
  CHECKCODE : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  CHECKCODE 
    if( PAFErrorFlag3 = 1 )
    then PostError( "PAF Credit '%s' is selected more than once for Interior
                     Lighting System '%s'",
                     u:PAFCredType[3], Name )
    else if( PAFErrorFlag3 = 2 )
    then PostError( "PAF '%s' is not available for Space '%s'.  For detailed
                     geometry models, simulate daylighting explicitly, 
                     otherwise assign daylit zone.",
                     u:PAFCredType[3], Parent( Name ) )
    else if( PAFErrorFlag3 = 3 )
    then PostError( "The selected PAF Credit '%s' is not permitted for the 
                     space '%s'. Refer to Title 24, Part 6, Section 140.6(a)2
                     for PAF restrictions",
                     u:PAFCredType[3], Parent( Name ) )
    else UNCHANGED
    endif endif endif
ENDRULE
RULE NEW IntLtgSys:PAFErrorFlag4
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorErrorFlag4
  DESCRIPTION
    "A flag to determine whether a valid PAF is selected and permitted for the
     parent space function."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( IfValidAnd ( PAFCredType[4] <> "- none specified -" ) )
    then if( IfValidAnd( PAFCredType[4] = PAFCredType[1] ) .OR.
             IfValidAnd( PAFCredType[4] = PAFCredType[2] ) .OR.
             IfValidAnd( PAFCredType[4] = PAFCredType[3] ) )
      then 1   // Error - duplicate PAF Credit Types
      else if( PAFCombError4 > 0 )
      then 3   // prohibited per Title 24, Part 6, Section 140.6(a)2
      else if ( IfValidAnd( PAFCredType[4] = "DaylightDimmingPlusOff" ) )
      then if ( ( ( Proj:IsDetailedGeometry = 0 .AND. IfValidAnd( Parent( OccClass ) != "Residential" ) )
                  .OR. ParentComp = "ResOtherZn" ) .AND.
                SkyOrPriSideDaylitLum )
        then 0
        else 2  // Error - simulate daylighting explicitly
        endif
      else if ( IfValidAnd( PAFCredType[4] = "OccupantSensingControls-1to125SF" ) .OR.
                IfValidAnd( PAFCredType[4] = "OccupantSensingControls-126to250SF" ) .OR.
                IfValidAnd( PAFCredType[4] = "OccupantSensingControls-251to500SF" ) )
      then if ( IfValidAnd( Parent( SpcFunc ) = "Office Area (>250 square feet)" ) .OR.
                IfValidAnd( Parent( SpcFunc ) = "Office Area (Open plan office)" ) )
        then 0
        else 3  // prohibited per itle 24, Part 6, Section 140.6(a)2
        endif
//    else if ( IfValidAnd( PAFCredType[4] = "InstitutionalTuning" ) )
//    then 0
      else if ( IfValidAnd( PAFCredType[4] = "DemandResponsiveControl" ) )
      then if ( Bldg:ReqDRCLtgPwr < 4000 .OR. MultLvlCtrlReq = 0 .OR. MultLvlCtrlExcept > 0 )
        then 0
        else 3  // prohibited per itle 24, Part 6, Section 140.6(a)2
        endif
      else if ( IfValidAnd( PAFCredType[4] = "HorizontalSlats" ) )
      then if ( ( IfValidAnd( Parent( OccClass ) != "Residential" ) .OR. ParentComp = "ResOtherZn" ) .AND.
                SkyOrPriSideDaylitLum )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else if ( IfValidAnd( PAFCredType[4] = "Clerestories" ) .OR.
                IfValidAnd( PAFCredType[4] = "LightShelves" ) )
      then if ( ( IfValidAnd( Parent( OccClass ) != "Residential" ) .OR. ParentComp = "ResOtherZn" ) .AND.
                IfValidAnd( Parent( ClerestoryPAFAllowed ) > 0.1 ) )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else 0  // all error conditions are represented above
      endif endif endif endif endif endif endif
    else 0
    endif
  CHECKCODE : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  CHECKCODE 
    if( PAFErrorFlag4 = 1 )
    then PostError( "PAF Credit '%s' is selected more than once for Interior
                     Lighting System '%s'",
                     u:PAFCredType[4], Name )
    else if( PAFErrorFlag4 = 2 )
    then PostError( "PAF '%s' is not available for Space '%s'.  For detailed
                     geometry models, simulate daylighting explicitly, 
                     otherwise assign daylit zone.",
                     u:PAFCredType[5], Parent( Name ) )
    else if( PAFErrorFlag4 = 3 )
    then PostError( "The selected PAF Credit '%s' is not permitted for the 
                     space '%s'. Refer to Title 24, Part 6, Section 140.6(a)2
                     for PAF restrictions",
                     u:PAFCredType[5], Parent( Name ) )
    else UNCHANGED
    endif endif endif
ENDRULE
RULE NEW IntLtgSys:PAFErrorFlag5
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorErrorFlag5
  DESCRIPTION
    "A flag to determine whether a valid PAF is selected and permitted for the
     parent space function."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( IfValidAnd ( PAFCredType[5] <> "- none specified -" ) )
    then if( IfValidAnd( PAFCredType[5] = PAFCredType[1] ) .OR.
             IfValidAnd( PAFCredType[5] = PAFCredType[2] ) .OR.
             IfValidAnd( PAFCredType[5] = PAFCredType[3] ) .OR.
             IfValidAnd( PAFCredType[5] = PAFCredType[4] ) )
      then 1   // Error - duplicate PAF Credit Types
      else if( PAFCombError2 > 0 )
      then 3   // prohibited per Title 24, Part 6, Section 140.6(a)2
      else if ( IfValidAnd( PAFCredType[5] = "DaylightDimmingPlusOff" ) )
      then if ( ( ( Proj:IsDetailedGeometry = 0 .AND. IfValidAnd( Parent( OccClass ) != "Residential" ) )
                  .OR. ParentComp = "ResOtherZn" ) .AND.
                SkyOrPriSideDaylitLum )
        then 0
        else 2  // Error - simulate daylighting explicitly
        endif
      else if ( IfValidAnd( PAFCredType[5] = "OccupantSensingControls-1to125SF" ) .OR.
                IfValidAnd( PAFCredType[5] = "OccupantSensingControls-126to250SF" ) .OR.
                IfValidAnd( PAFCredType[5] = "OccupantSensingControls-251to500SF" ) )
      then if ( IfValidAnd( Parent( SpcFunc ) = "Office Area (>250 square feet)" ) .OR.
                IfValidAnd( Parent( SpcFunc ) = "Office Area (Open plan office)" ) )
        then 0
        else 3  // prohibited per itle 24, Part 6, Section 140.6(a)2
        endif
//    else if ( IfValidAnd( PAFCredType[5] = "InstitutionalTuning" ) )
//    then 0
      else if ( IfValidAnd( PAFCredType[5] = "DemandResponsiveControl" ) )
      then if ( Bldg:ReqDRCLtgPwr < 4000 .OR. MultLvlCtrlReq = 0 .OR. MultLvlCtrlExcept > 0 )
        then 0
        else 3  // prohibited per itle 24, Part 6, Section 140.6(a)2
        endif
      else if ( IfValidAnd( PAFCredType[5] = "HorizontalSlats" ) )
      then if ( ( IfValidAnd( Parent( OccClass ) != "Residential" ) .OR. ParentComp = "ResOtherZn" ) .AND.
                SkyOrPriSideDaylitLum )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else if ( IfValidAnd( PAFCredType[5] = "Clerestories" ) .OR.
                IfValidAnd( PAFCredType[5] = "LightShelves" ) )
      then if ( ( IfValidAnd( Parent( OccClass ) != "Residential" ) .OR. ParentComp = "ResOtherZn" ) .AND.
                IfValidAnd( Parent( ClerestoryPAFAllowed ) > 0.1 ) )
        then 0
        else 3  // prohibited per Title 24, Part 6, Section 140.6(a)2
        endif
      else 0  // all error conditions are represented above
      endif endif endif endif endif endif endif
    else 0
    endif
  CHECKCODE : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  CHECKCODE 
    if( PAFErrorFlag5 = 1 )
    then PostError( "PAF Credit '%s' is selected more than once for Interior
                     Lighting System '%s'",
                     u:PAFCredType[5], Name )
    else if( PAFErrorFlag5 = 2 )
    then PostError( "PAF '%s' is not available for Space '%s'.  For detailed
                     geometry models, simulate daylighting explicitly, 
                     otherwise assign daylit zone.",
                     u:PAFCredType[5], Parent( Name ) )
    else if( PAFErrorFlag5 = 3 )
    then PostError( "The selected PAF Credit '%s' is not permitted for the 
                     space '%s'. Refer to Title 24, Part 6, Section 140.6(a)2
                     for PAF restrictions",
                     u:PAFCredType[5], Parent( Name ) )
    else UNCHANGED
    endif endif endif
ENDRULE

RULE NEW IntLtgSys:PAFMsg1
  DATATYPE
    String
  LONGFORM
    PowerAdjustmentFactorMessage1
  DESCRIPTION
    "A string to provide additional detail regarding PAF restrictions in the
     user interface."
  INPUTCLASS
    NotInput
  DEFAULT : S901G
    if( IfValidAnd( PAFPermitted = 1 ) )
    then UNCHANGED
    else "PAF PROHIBITED - Per ASHRAE 90.1 Section 9.4.1.2"
    endif
  DEFAULT : T24N_2013 T24N_2016
    if( IfValidAnd( PAFPermitted = 1 ) )
    then UNCHANGED
    else if( Proj:IsDetailedGeometry .AND.
             IfValidAnd( PAFCredType[1] = "DaylightDimmingPlusOff" ) )
    then "PAF PROHIBITED - Use Space:DaylightingControlType"
    else "PAF PROHIBITED - Per Standards Sec. 140.6(a)2"
    endif endif
  DEFAULT
    if( PAFErrorFlag1 = 1 )
    then "PAF PROHIBITED - Duplicate Entry"
    else if( PAFErrorFlag1 = 2 )
    then if( Proj:IsDetailedGeometry )
      then "PAF PROHIBITED - Simulate Dayltg Explicitly"
      else "PAF PROHIBITED - Assign Daylit Zone"
      endif
    else if( PAFErrorFlag1 = 3 )
    then "PAF PROHIBITED - Per Standards Sec. 140.6(a)2"
    else UNCHANGED
    endif endif endif
  SIZING   
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:PAFMsg2
  DATATYPE
    String
  LONGFORM
    PowerAdjustmentFactorMessage2
  DESCRIPTION
    "A string to provide additional detail regarding PAF restrictions in the
     user interface."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( PAFErrorFlag2 = 1 )
    then "PAF PROHIBITED - Duplicate Entry"
    else if( PAFErrorFlag2 = 2 )
    then if( Proj:IsDetailedGeometry )
      then "PAF PROHIBITED - Simulate Dayltg Explicitly"
      else "PAF PROHIBITED - Assign Daylit Zone"
      endif
    else if( PAFErrorFlag2 = 3 )
    then "PAF PROHIBITED - Per Standards Sec. 140.6(a)2"
    else UNCHANGED
    endif endif endif
  SIZING   
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:PAFMsg3
  DATATYPE
    String
  LONGFORM
    PowerAdjustmentFactorMessage3
  DESCRIPTION
    "A string to provide additional detail regarding PAF restrictions in the
     user interface."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( PAFErrorFlag3 = 1 )
    then "PAF PROHIBITED - Duplicate Entry"
    else if( PAFErrorFlag3 = 2 )
    then if( Proj:IsDetailedGeometry )
      then "PAF PROHIBITED - Simulate Dayltg Explicitly"
      else "PAF PROHIBITED - Assign Daylit Zone"
      endif
    else if( PAFErrorFlag3 = 3 )
    then "PAF PROHIBITED - Per Standards Sec. 140.6(a)2"
    else UNCHANGED
    endif endif endif
  SIZING   
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:PAFMsg4
  DATATYPE
    String
  LONGFORM
    PowerAdjustmentFactorMessage4
  DESCRIPTION
    "A string to provide additional detail regarding PAF restrictions in the
     user interface."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( PAFErrorFlag4 = 1 )
    then "PAF PROHIBITED - Duplicate Entry"
    else if( PAFErrorFlag4 = 2 )
    then if( Proj:IsDetailedGeometry )
      then "PAF PROHIBITED - Simulate Dayltg Explicitly"
      else "PAF PROHIBITED - Assign Daylit Zone"
      endif
    else if( PAFErrorFlag4 = 3 )
    then "PAF PROHIBITED - Per Standards Sec. 140.6(a)2"
    else UNCHANGED
    endif endif endif
  SIZING   
    UNDEFINED
ENDRULE
RULE NEW IntLtgSys:PAFMsg5
  DATATYPE
    String
  LONGFORM
    PowerAdjustmentFactorMessage5
  DESCRIPTION
    "A string to provide additional detail regarding PAF restrictions in the
     user interface."
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( PAFErrorFlag5 = 1 )
    then "PAF PROHIBITED - Duplicate Entry"
    else if( PAFErrorFlag5 = 2 )
    then if( Proj:IsDetailedGeometry )
      then "PAF PROHIBITED - Simulate Dayltg Explicitly"
      else "PAF PROHIBITED - Assign Daylit Zone"
      endif
    else if( PAFErrorFlag5 = 3 )
    then "PAF PROHIBITED - Per Standards Sec. 140.6(a)2"
    else UNCHANGED
    endif endif endif
  SIZING   
    UNDEFINED
ENDRULE

RULE IntLtgSys:PAF[1]
  DESCRIPTION
    "Power adjustment factors ( PAFs ) represent the percent reduction in lighting power
     that will approximate the effect of the control.  Models account for such
     controls by multiplying the controlled watts by ( 1-PAF )."
  INPUTCLASS 
    NotInput
  REPORTPRECISION
    2
  DEFAULT : S901G ECBC
    if( PAFCredType[1] <> "- none specified -" )
    then PAFs:PAF( "PAFCat","AllOther","PAFCredType",PAFCredType[1])
    else 0
    endif
  DEFAULT : T24N_2013
    if( PAFCredType[1] <> "- none specified -" )
    then PAFs:PAF( "PAFCredType",PAFCredType[1] )
    else 0
    endif
  DEFAULT : T24N_2016
    if( PAFCredType[1] <> "- none specified -" )
    then PAFs:PAF( "DaylitLum", DaylitLum,
                   "PAFCredType",PAFCredType[1] )
    else 0
    endif
  DEFAULT
    if( PAFCredType[1] <> "- none specified -" )
    then PAFs:PAF( "DaylitLum", DaylitLum,
                   "PrevPAFCredType","*",
                   "PAFCredType",PAFCredType[1] )
    else 0
    endif
ENDRULE
RULE IntLtgSys:PAF[2]
  DESCRIPTION
    "Power adjustment factors ( PAFs ) represent the percent reduction in lighting power
     that will approximate the effect of the control.  Models account for such
     controls by multiplying the controlled watts by ( 1-PAF )."
  INPUTCLASS 
    NotInput
  REPORTPRECISION
    2
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    0
  DEFAULT
    if( LocalStatus( PAFCredType[2] ) > 0 .AND.
        PAFCredType[2] <> "- none specified -" )
    then PAFs:PAF( "DaylitLum", DaylitLum,
                   "PrevPAFCredType","*",
                   "PAFCredType",PAFCredType[2] )
    else 0
    endif
ENDRULE
RULE IntLtgSys:PAF[3]
  DESCRIPTION
    "Power adjustment factors ( PAFs ) represent the percent reduction in lighting power
     that will approximate the effect of the control.  Models account for such
     controls by multiplying the controlled watts by ( 1-PAF )."
  INPUTCLASS 
    NotInput
  REPORTPRECISION
    2
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    0
  DEFAULT
    if( LocalStatus( PAFCredType[3] ) > 0 .AND.
        PAFCredType[3] <> "- none specified -" )
    then PAFs:PAF( "DaylitLum", DaylitLum,
                   "PrevPAFCredType","*",
                   "PAFCredType",PAFCredType[3] )
    else 0
    endif
ENDRULE
RULE IntLtgSys:PAF[4]
  DESCRIPTION
    "Power adjustment factors ( PAFs ) represent the percent reduction in lighting power
     that will approximate the effect of the control.  Models account for such
     controls by multiplying the controlled watts by ( 1-PAF )."
  INPUTCLASS 
    NotInput
  REPORTPRECISION
    2
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    0
  DEFAULT
    if( LocalStatus( PAFCredType[4] ) > 0 .AND.
        PAFCredType[4] <> "- none specified -" )
    then PAFs:PAF( "DaylitLum", DaylitLum,
                   "PrevPAFCredType","*",
                   "PAFCredType",PAFCredType[4] )
    else 0
    endif
ENDRULE
RULE IntLtgSys:PAF[5]
  DESCRIPTION
    "Power adjustment factors ( PAFs ) represent the percent reduction in lighting power
     that will approximate the effect of the control.  Models account for such
     controls by multiplying the controlled watts by ( 1-PAF )."
  INPUTCLASS 
    NotInput
  REPORTPRECISION
    2
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    0
  DEFAULT
    if( LocalStatus( PAFCredType[5] ) > 0 .AND.
        PAFCredType[5] <> "- none specified -" )
    then PAFs:PAF( "DaylitLum", DaylitLum,
                   "PrevPAFCredType","*",
                   "PAFCredType",PAFCredType[5] )
    else 0
    endif
ENDRULE

RULE IntLtgSys:PAFCtrlCred
  DESCRIPTION
    "A container for the value ( Watts ) of the control credit ( PAF ) for an
     Interior Lighting System"
  HELP
    "Primarily for reporting purposes"
  INPUTCLASS 
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    if( PwrReg = 1 )
    then RegInstLtgPwr * ( 1 - ( ( 1 - PAF[1] ) * 
                                 ( 1 - PAF[2] ) *
                                 ( 1 - PAF[3] ) *
                                 ( 1 - PAF[4] ) *
                                 ( 1 - PAF[5] ) ) )
    else 0
    endif
ENDRULE

RULE NEW IntLtgSys:PAFCreditFlag
  RULESETS
    T24N
  DATATYPE
    Integer
  LONGFORM
    PowerAdjustmentFactorCreditFlag
  DESCRIPTION
    "A flag to indicate that one or more lighting systems is claiming credit via
     a power adjustment Factor"
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    if( ParentStatus( SpcFunc ) > 0 .AND.
        IfValidAnd ( PAFCredType[1] <> "- none specified -" ) .AND.
        IfValidAnd ( PAFPermitted == 1 ) )
    then 1
    else 0
    endif
  DEFAULT
    if ( PAF[1] > 0 .OR.
         PAF[2] > 0 .OR.
         PAF[3] > 0 .OR.
         PAF[4] > 0 .OR.
         PAF[5] > 0 )
    then 1
    else 0
    endif
ENDRULE

RULE IntLtgSys:RegLtgPwr
  DESCRIPTION
    "A container for the regulated lighting power specified at the
     interior lighting system level after adjustment by PAFs"
  HELP
    "This value includes the impact of any Power Adjustment Factors
     claimed for instalation of advanced controls"
  MINIMUM 
    0
  REPORTPRECISION
    0
  DEFAULT
    MAX ( RegInstLtgPwr - PAFCtrlCred,0 )
ENDRULE


// ********** Non-Regulated Interior Lighting Power - IntLtgSys ***************
RULE IntLtgSys:NonRegLtgPwr
  DESCRIPTION
    "A container for the Non Regulated Lighting Power"
  MINIMUM 
    0
  REPORTPRECISION
    0
  DEFAULT
    if ( PwrReg = 0 .AND. ParentComp = "Spc" )
    then Pwr
    else 0
    endif
ENDRULE
RULE IntLtgSys:NonRegExclusion
  DESCRIPTION
    "The category to which the non-regulated lighting belongs."
  INPUTCLASS
    CondRequired
  MINIMUM 
    0
  DEFAULT
    UNDEFINED
  CHECKCODE
    if( IfValidAnd( NonRegLtgPwr > 0 ) .AND.
      ( LocalStatus( NonRegExclusion ) < 1 .OR.
        NonRegExclusion = "- specify -" ) )
    then
      PostError( "In Spc '%s', A Non-Regulated Exclusion must be specified for
                  non-regulated lighting power > 0 Watts.",
                  Parent( Name ) )
    else
      UNCHANGED
    endif    
  SIZING
    UNDEFINED
ENDRULE

// ********** Interior Lighting System Relevant Heights ***********************
RULE IntLtgSys:LumMntgHgt
  DESCRIPTION
    "The Luminaire Height of a IntLtgSys. Assumed by default to be the same as 
     the space floor to ceiling height."
  UNITS
    ft
  INPUTCLASS
    Default
  REPORTPRECISION
    1
  DEFAULT
    if( ParentComp = "Spc" )
    then min( 10, Parent( FlrToCeilingHgt ) )
    else min( 10, Parent( CeilingHeight ) )
    endif
  CHECKSIM
    if( ParentComp = "Spc" )
    then if( LumMntgHgt > Parent( FlrToCeilingHgt ) )
         then PostError( "The luminarie mounting height of lighting system '%s' is
                          greater than the ceiling height", Name )
         else UNCHANGED endif
    else if( LumMntgHgt > Parent( CeilingHeight ) )
         then PostError( "The luminarie mounting height of lighting system '%s' is
                          greater than the ceiling height", Name )
         else UNCHANGED endif
    endif
  MINIMUM 
    0
  MAXIMUM 
    100
ENDRULE
RULE NEW IntLtgSys:LumMntgHgtXPwr
  DATATYPE
    Float
  LONGFORM
    LuminaireMountingHeightXPower 
  DESCRIPTION
    ""
  UNITS
    ft
  INPUTCLASS
    NotInput
  DEFAULT
    LumMntgHgt * Pwr
ENDRULE
RULE IntLtgSys:WorkPlaneHgt
  DESCRIPTION
    "The Workplane Height of an IntLtgSys, only necessary for Tailored Method
     Baseline General and Additional Lighting Power Allowances."
  INPUTCLASS
    Default
  MINIMUM 
    0
  MAXIMUM 
    10
  UNITS 
    ft
  REPORTPRECISION
    1
  DEFAULT
    3
ENDRULE
RULE NEW IntLtgSys:WorkPlaneHgtXPwr
  DATATYPE
    Float
  LONGFORM
    WorkPlaneHeightXPower
  DESCRIPTION
    ""
  UNITS
    ft
  INPUTCLASS
    NotInput
  DEFAULT
    WorkPlaneHgt * Pwr
ENDRULE

// ********** Reporting *******************************************************
RULE IntLtgSys:ParentSpcName
  DESCRIPTION
    "The Space Name of the IntLtgSys Parent Space"  
  INPUTCLASS
    NotInput
  DEFAULT
    Parent( Name )
ENDRULE
RULE IntLtgSys:ParentSpcIsCond
  DESCRIPTION
    "The Conditioning Status of the IntLtgSys Parent Space"  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentComp = "Spc" )
    then Space:IsCond
    else if( IfValidAnd( ResOtherZn:Type = "Conditioned" ) )
    then 1
    else 0
    endif endif
ENDRULE

RULE NEW IntLtgSys:CondLumCnt_1
  DATATYPE 
    Integer
  LONGFORM
    ConditionedLuminaireCount
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Conditioned Space."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond .AND.
        IfValidAnd( LumCnt[1] >= 0 ) ) 
    then LumCnt[1]
    else 0
    endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
    if( ParentSpcIsCond .AND.
        IfValidAnd( LumCnt[1] >= 0 ) )  
      then LumCnt[1]
      else 0
      endif
    endswitch
ENDRULE
RULE NEW IntLtgSys:CondLumCnt_2
  DATATYPE 
    Integer
  LONGFORM
    ConditionedLuminaireCount
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Conditioned Space."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond .AND.
        IfValidAnd( LumCnt[2] >= 0 ) ) 
    then LumCnt[2]
    else 0
    endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
    if( ParentSpcIsCond .AND.
        IfValidAnd( LumCnt[2] >= 0 ) ) 
      then LumCnt[2]
      else 0
      endif
    endswitch
ENDRULE
RULE NEW IntLtgSys:CondLumCnt_3
  DATATYPE 
    Integer
  LONGFORM
    ConditionedLuminaireCount
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Conditioned Space."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond .AND.
        IfValidAnd( LumCnt[3] >= 0 ) ) 
    then LumCnt[3]
    else 0
    endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
    if( ParentSpcIsCond .AND.
        IfValidAnd( LumCnt[3] >= 0 ) ) 
      then LumCnt[3]
      else 0
      endif
    endswitch
ENDRULE
RULE NEW IntLtgSys:CondLumCnt_4
  DATATYPE 
    Integer
  LONGFORM
    ConditionedLuminaireCount
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Conditioned Space."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond .AND.
        IfValidAnd( LumCnt[4] >= 0 ) ) 
    then LumCnt[4]
    else 0
    endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
    if( ParentSpcIsCond .AND.
        IfValidAnd( LumCnt[4] >= 0 ) ) 
      then LumCnt[4]
      else 0
      endif
    endswitch
ENDRULE
RULE NEW IntLtgSys:CondLumCnt_5
  DATATYPE 
    Integer
  LONGFORM
    ConditionedLuminaireCount
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Conditioned Space."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond .AND.
        IfValidAnd( LumCnt[5] >= 0 ) )  
    then LumCnt[5]
    else 0
    endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
    if( ParentSpcIsCond .AND.
        IfValidAnd( LumCnt[5] >= 0 ) )  
      then LumCnt[5]
      else 0
      endif
    endswitch
ENDRULE


RULE NEW IntLtgSys:CondLumCntWithMult_1
  DATATYPE 
    Integer
  LONGFORM
    ConditionedLuminaireCountWithMultiplier
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Conditioned Space
     including floor multiplier."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond .AND.
        IfValidAnd( CondLumCnt_1 >= 0 ) ) 
    then CondLumCnt_1 * ValidOr(Parent(Mult),1)
    else 0
    endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
	    if( ParentSpcIsCond .AND.
	        IfValidAnd( CondLumCnt_1 >= 0 ) ) 
	    then CondLumCnt_1 * ValidOr(Parent(Mult),1)
	    else 0
	    endif
    endswitch
ENDRULE

RULE NEW IntLtgSys:CondLumCntWithMult_2
  DATATYPE 
    Integer
  LONGFORM
    ConditionedLuminaireCountWithMultiplier
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Conditioned Space
     including floor multiplier."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond .AND.
        IfValidAnd( CondLumCnt_2 >= 0 ) ) 
    then CondLumCnt_2 * ValidOr(Parent(Mult),1)
    else 0
    endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
	    if( ParentSpcIsCond .AND.
	        IfValidAnd( CondLumCnt_2 >= 0 ) ) 
	    then CondLumCnt_2 * ValidOr(Parent(Mult),1)
	    else 0
	    endif
    endswitch
ENDRULE

RULE NEW IntLtgSys:CondLumCntWithMult_3
  DATATYPE 
    Integer
  LONGFORM
    ConditionedLuminaireCountWithMultiplier
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Conditioned Space
     including floor multiplier."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond .AND.
        IfValidAnd( CondLumCnt_3 >= 0 ) ) 
    then CondLumCnt_3 * ValidOr(Parent(Mult),1)
    else 0
    endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
	    if( ParentSpcIsCond .AND.
	        IfValidAnd( CondLumCnt_3 >= 0 ) ) 
	    then CondLumCnt_3 * ValidOr(Parent(Mult),1)
	    else 0
	    endif
    endswitch
ENDRULE

RULE NEW IntLtgSys:CondLumCntWithMult_4
  DATATYPE 
    Integer
  LONGFORM
    ConditionedLuminaireCountWithMultiplier
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Conditioned Space
     including floor multiplier."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond .AND.
        IfValidAnd( CondLumCnt_4 >= 0 ) ) 
    then CondLumCnt_4 * ValidOr(Parent(Mult),1)
    else 0
    endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
	    if( ParentSpcIsCond .AND.
	        IfValidAnd( CondLumCnt_4 >= 0 ) ) 
	    then CondLumCnt_4 * ValidOr(Parent(Mult),1)
	    else 0
	    endif
    endswitch
ENDRULE

RULE NEW IntLtgSys:CondLumCntWithMult_5
  DATATYPE 
    Integer
  LONGFORM
    ConditionedLuminaireCountWithMultiplier
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Conditioned Space
     including floor multiplier."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond .AND.
        IfValidAnd( CondLumCnt_5 >= 0 ) ) 
    then CondLumCnt_5 * ValidOr(Parent(Mult),1)
    else 0
    endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
	    if( ParentSpcIsCond .AND.
	        IfValidAnd( CondLumCnt_5 >= 0 ) ) 
	    then CondLumCnt_5 * ValidOr(Parent(Mult),1)
	    else 0
	    endif
    endswitch
ENDRULE

RULE NEW IntLtgSys:UncondLumCnt_1
  DATATYPE 
    Integer
  LONGFORM
    UnconditionedLuminaireCount
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Unconditioned Space."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond ) 
    then 0
    else if( IfValidAnd( LumCnt[1] >= 0 ) )
    then LumCnt[1]
    else 0
    endif endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
      if( ParentSpcIsCond ) 
      then 0
      else if( IfValidAnd( LumCnt[1] >= 0 ) )
      then LumCnt[1]
      else 0
      endif endif
    endswitch
ENDRULE
RULE NEW IntLtgSys:UncondLumCnt_2
  DATATYPE 
    Integer
  LONGFORM
    UnconditionedLuminaireCount
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Unconditioned Space."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond ) 
    then 0
    else if( IfValidAnd( LumCnt[2] >= 0 ) )
    then LumCnt[2]
    else 0
    endif endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
      if( ParentSpcIsCond ) 
      then 0
      else if( IfValidAnd( LumCnt[2] >= 0 ) )
      then LumCnt[2]
      else 0
      endif endif
    endswitch
ENDRULE
RULE NEW IntLtgSys:UncondLumCnt_3
  DATATYPE 
    Integer
  LONGFORM
    UnconditionedLuminaireCount
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Unconditioned Space."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond ) 
    then 0
    else if( IfValidAnd( LumCnt[3] >= 0 ) )
    then LumCnt[3]
    else 0
    endif endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
      if( ParentSpcIsCond ) 
      then 0
      else if( IfValidAnd( LumCnt[3] >= 0 ) )
      then LumCnt[3]
      else 0
      endif endif
    endswitch
ENDRULE
RULE NEW IntLtgSys:UncondLumCnt_4
  DATATYPE 
    Integer
  LONGFORM
    UnconditionedLuminaireCount
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Unconditioned Space."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond ) 
    then 0
    else if( IfValidAnd( LumCnt[4] >= 0 ) )
    then LumCnt[4]
    else 0
    endif endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
      if( ParentSpcIsCond ) 
      then 0
      else if( IfValidAnd( LumCnt[4] >= 0 ) )
      then LumCnt[4]
      else 0
      endif endif
    endswitch
ENDRULE
RULE NEW IntLtgSys:UncondLumCnt_5
  DATATYPE 
    Integer
  LONGFORM
    UnconditionedLuminaireCount
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Unconditioned Space."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond ) 
    then 0
    else if( IfValidAnd( LumCnt[5] >= 0 ) )
    then LumCnt[5]
    else 0
    endif endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
      if( ParentSpcIsCond ) 
      then 0
      else if( IfValidAnd( LumCnt[5] >= 0 ) )
      then LumCnt[5]
      else 0
      endif endif
    endswitch
ENDRULE

RULE NEW IntLtgSys:UncondLumCntWithMult_1
  DATATYPE 
    Integer
  LONGFORM
    UnconditionedLuminaireCountWithMultiplier
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Unconditioned Space
     including floor multiplier."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond )
    then 0
    else if ( IfValidAnd( UncondLumCnt_1 >= 0 ) )
    then UncondLumCnt_1 * ValidOr(Parent(Mult),1)
    else 0
    endif endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
	    if( ParentSpcIsCond )
	    then 0
	    else if ( IfValidAnd( UncondLumCnt_1 >= 0 ) )
	    then UncondLumCnt_1 * ValidOr(Parent(Mult),1)
	    else 0
	    endif endif
    endswitch
ENDRULE

RULE NEW IntLtgSys:UncondLumCntWithMult_2
  DATATYPE 
    Integer
  LONGFORM
    UnconditionedLuminaireCountWithMultiplier
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Unconditioned Space
     including floor multiplier."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond )
    then 0
    else if ( IfValidAnd( UncondLumCnt_2 >= 0 ) )
    then UncondLumCnt_2 * ValidOr(Parent(Mult),1)
    else 0
    endif endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
	    if( ParentSpcIsCond )
	    then 0
	    else if ( IfValidAnd( UncondLumCnt_2 >= 0 ) )
	    then UncondLumCnt_2 * ValidOr(Parent(Mult),1)
	    else 0
	    endif endif
    endswitch
ENDRULE

RULE NEW IntLtgSys:UncondLumCntWithMult_3
  DATATYPE 
    Integer
  LONGFORM
    UnconditionedLuminaireCountWithMultiplier
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Unconditioned Space
     including floor multiplier."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond )
    then 0
    else if ( IfValidAnd( UncondLumCnt_3 >= 0 ) )
    then UncondLumCnt_3 * ValidOr(Parent(Mult),1)
    else 0
    endif endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
	    if( ParentSpcIsCond )
	    then 0
	    else if ( IfValidAnd( UncondLumCnt_3 >= 0 ) )
	    then UncondLumCnt_3 * ValidOr(Parent(Mult),1)
	    else 0
	    endif endif
    endswitch
ENDRULE

RULE NEW IntLtgSys:UncondLumCntWithMult_4
  DATATYPE 
    Integer
  LONGFORM
    UnconditionedLuminaireCountWithMultiplier
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Unconditioned Space
     including floor multiplier."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond )
    then 0
    else if ( IfValidAnd( UncondLumCnt_4 >= 0 ) )
    then UncondLumCnt_4 * ValidOr(Parent(Mult),1)
    else 0
    endif endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
	    if( ParentSpcIsCond )
	    then 0
	    else if ( IfValidAnd( UncondLumCnt_4 >= 0 ) )
	    then UncondLumCnt_4 * ValidOr(Parent(Mult),1)
	    else 0
	    endif endif
    endswitch
ENDRULE

RULE NEW IntLtgSys:UncondLumCntWithMult_5
  DATATYPE 
    Integer
  LONGFORM
    UnconditionedLuminaireCountWithMultiplier
  DESCRIPTION
    "Container for Quantitiy of Luminaires in Unconditioned Space
     including floor multiplier."  
  INPUTCLASS
    NotInput
  DEFAULT
    if( ParentSpcIsCond )
    then 0
    else if ( IfValidAnd( UncondLumCnt_5 >= 0 ) )
    then UncondLumCnt_5 * ValidOr(Parent(Mult),1)
    else 0
    endif endif
  SIZING
    switch ( ApplyStdLtg )
    case  1: UNDEFINED   ; IntLtgSys do not apply to standard design
    default:             ; proposed design
	    if( ParentSpcIsCond )
	    then 0
	    else if ( IfValidAnd( UncondLumCnt_5 >= 0 ) )
	    then UncondLumCnt_5 * ValidOr(Parent(Mult),1)
	    else 0
	    endif endif
    endswitch
ENDRULE



RULE Lum:CondCnt
  DESCRIPTION
    "The total quantity of the Luminaire in conditioned spaces" 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    SumRevRef( IntLtgSys:LumRef[1], IntLtgSys:CondLumCnt_1 ) + 
    SumRevRef( IntLtgSys:LumRef[2], IntLtgSys:CondLumCnt_2 ) + 
    SumRevRef( IntLtgSys:LumRef[3], IntLtgSys:CondLumCnt_3 ) + 
    SumRevRef( IntLtgSys:LumRef[4], IntLtgSys:CondLumCnt_4 ) + 
    SumRevRef( IntLtgSys:LumRef[5], IntLtgSys:CondLumCnt_5 )
ENDRULE

RULE Lum:CondCntWithMult
  DESCRIPTION
    "The total quantity of the Luminaire in conditioned spaces
     including floor multiplier." 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    SumRevRef( IntLtgSys:LumRef[1], IntLtgSys:CondLumCntWithMult_1 ) + 
    SumRevRef( IntLtgSys:LumRef[2], IntLtgSys:CondLumCntWithMult_2 ) + 
    SumRevRef( IntLtgSys:LumRef[3], IntLtgSys:CondLumCntWithMult_3 ) + 
    SumRevRef( IntLtgSys:LumRef[4], IntLtgSys:CondLumCntWithMult_4 ) + 
    SumRevRef( IntLtgSys:LumRef[5], IntLtgSys:CondLumCntWithMult_5 )
ENDRULE

RULE Lum:UncondCnt
  DESCRIPTION
    "The total quantity of the Luminaire in unconditioned spaces" 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    SumRevRef( IntLtgSys:LumRef[1], IntLtgSys:UncondLumCnt_1 ) + 
    SumRevRef( IntLtgSys:LumRef[2], IntLtgSys:UncondLumCnt_2 ) + 
    SumRevRef( IntLtgSys:LumRef[3], IntLtgSys:UncondLumCnt_3 ) + 
    SumRevRef( IntLtgSys:LumRef[4], IntLtgSys:UncondLumCnt_4 ) + 
    SumRevRef( IntLtgSys:LumRef[5], IntLtgSys:UncondLumCnt_5 )
ENDRULE

RULE Lum:UncondCntWithMult
  DESCRIPTION
    "The total quantity of the Luminaire in unconditioned spaces
     including floor multiplier." 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    SumRevRef( IntLtgSys:LumRef[1], IntLtgSys:UncondLumCntWithMult_1 ) + 
    SumRevRef( IntLtgSys:LumRef[2], IntLtgSys:UncondLumCntWithMult_2 ) + 
    SumRevRef( IntLtgSys:LumRef[3], IntLtgSys:UncondLumCntWithMult_3 ) + 
    SumRevRef( IntLtgSys:LumRef[4], IntLtgSys:UncondLumCntWithMult_4 ) + 
    SumRevRef( IntLtgSys:LumRef[5], IntLtgSys:UncondLumCntWithMult_5 )
ENDRULE


RULE Lum:TotCnt
  DESCRIPTION
    "The total quantity of the Luminaire in the project" 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    CondCnt + UncondCnt
ENDRULE

RULE Lum:TotCntWithMult
  DESCRIPTION
    "The total quantity of the Luminaire in the project
     including floor multiplier." 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    ( ValidOr(UncondCntWithMult,0) + ValidOr(CondCntWithMult,0) ) 
ENDRULE


RULE Lum:TotPwr
  DESCRIPTION
    "The total power of the Luminaires of this type in the project" 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    Lum:Pwr*Lum:TotCnt
ENDRULE

RULE Lum:TotPwrWithMult
  DESCRIPTION
    "The total power of the Luminaires of this type in the project
    including floor multiplier." 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    ValidOr(Lum:Pwr,0) * ValidOr(Lum:TotCntWithMult,0)
ENDRULE


RULE Lum:CondPwr
  DESCRIPTION
    "The total Power of the Luminaire in conditioned spaces" 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    Lum:Pwr*Lum:CondCnt
ENDRULE

RULE Lum:CondPwrWithMult
  DESCRIPTION
    "The total Power of the Luminaire in conditioned spaces
     including floor multiplier." 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    ValidOr(Lum:Pwr,0) * ValidOr(Lum:CondCntWithMult,0)
ENDRULE



RULE Lum:UncondPwr
  DESCRIPTION
    "The total Power of the Luminaire in unconditioned spaces" 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    Lum:Pwr*Lum:UncondCnt
ENDRULE


RULE Lum:UncondPwrWithMult
  DESCRIPTION
    "The total Power of the Luminaire in unconditioned spaces
     including floor multiplier." 
  INPUTCLASS
    NotInput
  REPORTPRECISION
    0
  DEFAULT
    ValidOr(Lum:Pwr,0) * ValidOr(Lum:UncondCntWithMult,0)
ENDRULE


RULE Lum:PwrNA8Default
  DESCRIPTION
    "Check box for lamp power determined from NA8 defaults." 
  INPUTCLASS
    Default 
  DEFAULT
    0  
ENDRULE
RULE Lum:LumDescRpt
  DESCRIPTION
    "A string containing a short description of the luminaire" 
  INPUTCLASS
    Optional
  DEFAULT
    UNDEFINED
ENDRULE

RULE NEW IntLtgSys:IsAcceptanceTestReqd1
  DATATYPE 
    Integer
  LONGFORM
    IsAcceptanceTestRequired1
  DESCRIPTION
    "Primarily for reporting purposes; a boolean flag to represent whether
     acceptance testing is required as per Standards, Section 130.4 (b)" 
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    0
ENDRULE
RULE NEW IntLtgSys:IsAcceptanceTestReqd2
  DATATYPE 
    Integer
  LONGFORM
    IsAcceptanceTestRequired2
  DESCRIPTION
    "Primarily for reporting purposes; a boolean flag to represent whether
     acceptance testing is required as per Standards, Section 130.4 (b)" 
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    0
ENDRULE
RULE NEW IntLtgSys:IsAcceptanceTestReqd3
  DATATYPE 
    Integer
  LONGFORM
    IsAcceptanceTestRequired3
  DESCRIPTION
    "Primarily for reporting purposes; a boolean flag to represent whether
     acceptance testing is required as per Standards, Section 130.4 (b)" 
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    0
ENDRULE
RULE NEW IntLtgSys:IsAcceptanceTestReqd4
  DATATYPE 
    Integer
  LONGFORM
    IsAcceptanceTestRequired4
  DESCRIPTION
    "Primarily for reporting purposes; a boolean flag to represent whether
     acceptance testing is required as per Standards, Section 130.4 (b)" 
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    0
ENDRULE
RULE NEW IntLtgSys:IsAcceptanceTestReqd5
  DATATYPE 
    Integer
  LONGFORM
    IsAcceptanceTestRequired5
  DESCRIPTION
    "Primarily for reporting purposes; a boolean flag to represent whether
     acceptance testing is required as per Standards, Section 130.4 (b)" 
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    0
ENDRULE
RULE IntLtgSys:IsAcceptanceTestReqdRpt
  RULESETS
    T24N
  DESCRIPTION
    "Primarily for reporting purposes; a boolean flag to represent whether
     acceptance testing is required as per Standards, Section 130.4 (b)"
  INPUTCLASS
    Default
  DEFAULT : T24N_2013 T24N_2016
    0
  DEFAULT 
     if( IfValidAnd( PAFCredType[1] <> "- none specified -" ) .OR.
         IfValidAnd( PAFCredType[2] <> "- none specified -" ) .OR.
         IfValidAnd( PAFCredType[3] <> "- none specified -" ) .OR.
         IfValidAnd( PAFCredType[4] <> "- none specified -" ) .OR.
         IfValidAnd( PAFCredType[5] <> "- none specified -" ) )
     then IsAcceptanceTestReqd1 + 
          IsAcceptanceTestReqd2 + 
          IsAcceptanceTestReqd3 + 
          IsAcceptanceTestReqd4 + 
          IsAcceptanceTestReqd5
     else 0
     endif
ENDRULE	


RULE NEW IntLtgSys:LtgCtrlCnt1
  DATATYPE 
    Integer
  LONGFORM
    LightingControlCount1
  DESCRIPTION
    "Primarily for reporting purposes; identifies the number of lighting controls
     associated with a particular interior lighting system"
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( IfValidAnd( PAFCredType[1] <> "- none specified -" ) )
    then 1
    else 0
    endif
ENDRULE
RULE NEW IntLtgSys:LtgCtrlCnt2
  DATATYPE 
    Integer
  LONGFORM
    LightingControlCount2
  DESCRIPTION
    "Primarily for reporting purposes; identifies the number of lighting controls
     associated with a particular interior lighting system"
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( IfValidAnd( PAFCredType[2] <> "- none specified -" ) )
    then 1
    else 0
    endif
ENDRULE
RULE NEW IntLtgSys:LtgCtrlCnt3
  DATATYPE 
    Integer
  LONGFORM
    LightingControlCount3
  DESCRIPTION
    "Primarily for reporting purposes; identifies the number of lighting controls
     associated with a particular interior lighting system"
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( IfValidAnd( PAFCredType[3] <> "- none specified -" ) )
    then 1
    else 0
    endif
ENDRULE
RULE NEW IntLtgSys:LtgCtrlCnt4
  DATATYPE 
    Integer
  LONGFORM
    LightingControlCount4
  DESCRIPTION
    "Primarily for reporting purposes; identifies the number of lighting controls
     associated with a particular interior lighting system"
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( IfValidAnd( PAFCredType[4] <> "- none specified -" ) )
    then 1
    else 0
    endif
ENDRULE
RULE NEW IntLtgSys:LtgCtrlCnt5
  DATATYPE 
    Integer
  LONGFORM
    LightingControlCount5
  DESCRIPTION
    "Primarily for reporting purposes; identifies the number of lighting controls
     associated with a particular interior lighting system"
  INPUTCLASS
    NotInput
  DEFAULT : T24N_2013 T24N_2016 S901G ECBC
    UNCHANGED
  DEFAULT
    if( IfValidAnd( PAFCredType[5] <> "- none specified -" ) )
    then 1
    else 0
    endif
ENDRULE

RULE IntLtgSys:LtgCtrlCntRpt
  RULESETS T24N
  DESCRIPTION
    "Primarily for reporting purposes; identifies the number of lighting controls
     associated with a particular interior lighting system"
  INPUTCLASS
    Default
  DEFAULT : T24N_2013 T24N_2016
    1
  DEFAULT 
    LtgCtrlCnt1 + 
    LtgCtrlCnt2 + 
    LtgCtrlCnt3 + 
    LtgCtrlCnt4 + 
    LtgCtrlCnt5
ENDRULE	

// ********** UI Support ******************************************************
RULE IntLtgSys:ParentSpcFunc
  DESCRIPTION
    "The Space Function of the IntLtgSys Parent Space"  
  INPUTCLASS
    NotInput
  DEFAULT
    Parent( SpcFunc )
ENDRULE
RULE IntLtgSys:IntLtgSpecMthd
  DESCRIPTION
    "The method for selecting baseline lighting and other loads for a space"  
  DEFAULT
    if( ParentStatus( IntLtgSpecMthd ) > 0 )
    then Parent( IntLtgSpecMthd )
    else UNDEFINED
    endif
ENDRULE



